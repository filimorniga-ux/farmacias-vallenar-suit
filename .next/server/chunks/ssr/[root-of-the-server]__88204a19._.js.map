{"version":3,"sources":["../../../../src/lib/db.ts","../../../../src/components/auth/RouteGuard.tsx/__nextjs-internal-proxy.mjs","../../../../src/lib/data/payroll.ts","../../../../src/components/rrhh/EmployeeGrid.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/rrhh/page.tsx"],"sourcesContent":["import { Pool } from 'pg';\n\nconst pool = new Pool({\n    connectionString: process.env.DATABASE_URL,\n    ssl:\n        process.env.NODE_ENV === 'production'\n            ? { rejectUnauthorized: false }\n            : false,\n});\n\nexport async function query(text: string, params?: any[]) {\n    const start = Date.now();\n    const res = await pool.query(text, params);\n    const duration = Date.now() - start;\n    console.log('Executed query', { text, duration, rows: res.rowCount });\n    return res;\n}\n\nexport default pool;\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/auth/RouteGuard.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/auth/RouteGuard.tsx\",\n    \"default\",\n);\n","import { query } from '../db';\n\nexport interface PayrollData {\n    totalSales: number;\n    commissionableSales: number;\n    nonCommissionableSales: number;\n    totalCommissions: number;\n}\n\nexport async function getPayrollData(): Promise<PayrollData> {\n    const now = new Date();\n    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).toISOString();\n\n    // 1. Fetch all products to know which are commissionable\n    // We need a map of product_id -> comisionable (boolean)\n    const productsSql = `SELECT id, comisionable FROM productos`;\n    const productsRes = await query(productsSql);\n\n    const productMap = new Map<number, boolean>();\n    productsRes.rows.forEach((row: any) => {\n        productMap.set(row.id, row.comisionable);\n    });\n\n    // 2. Fetch all sales for the current month\n    const salesSql = `\n    SELECT items\n    FROM ventas\n    WHERE fecha >= $1\n  `;\n    const salesRes = await query(salesSql, [startOfMonth]);\n\n    let totalSales = 0;\n    let commissionableSales = 0;\n    let nonCommissionableSales = 0;\n    let totalCommissions = 0;\n\n    const COMMISSION_RATE = 0.03; // 3%\n\n    // 3. Iterate through sales and items\n    salesRes.rows.forEach((sale: any) => {\n        const items = sale.items; // JSONB array\n        if (Array.isArray(items)) {\n            items.forEach((item: any) => {\n                const amount = Number(item.total) || 0;\n                const productId = Number(item.producto_id);\n                const isCommissionable = productMap.get(productId) || false;\n\n                totalSales += amount;\n\n                if (isCommissionable) {\n                    commissionableSales += amount;\n                    totalCommissions += Math.round(amount * COMMISSION_RATE);\n                } else {\n                    nonCommissionableSales += amount;\n                }\n            });\n        }\n    });\n\n    return {\n        totalSales,\n        commissionableSales,\n        nonCommissionableSales,\n        totalCommissions,\n    };\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/rrhh/EmployeeGrid.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/rrhh/EmployeeGrid.tsx\",\n    \"default\",\n);\n","import { getPayrollData } from '@/lib/data/payroll';\nimport EmployeeGrid from '@/components/rrhh/EmployeeGrid'; // Client component wrapper\nimport RouteGuard from '@/components/auth/RouteGuard';\n\nexport const dynamic = 'force-dynamic';\n\nexport default async function RRHHPage() {\n    const payrollData = await getPayrollData();\n\n    // Mock Employees\n    const employees = [\n        {\n            id: 1,\n            name: 'Juan P√©rez',\n            role: 'Qu√≠mico Farmac√©utico',\n            baseSalary: 1800000,\n            isActive: true,\n            photoUrl: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80',\n        },\n        {\n            id: 2,\n            name: 'Mar√≠a Gonz√°lez',\n            role: 'Auxiliar de Farmacia',\n            baseSalary: 600000,\n            isActive: true,\n            photoUrl: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80',\n        },\n        {\n            id: 3,\n            name: 'Carlos Rodr√≠guez',\n            role: 'Vendedor',\n            baseSalary: 500000,\n            isActive: true,\n            photoUrl: 'https://images.unsplash.com/photo-1519244703995-f4e0f30006d5?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80',\n        },\n        {\n            id: 4,\n            name: 'Ana Mart√≠nez',\n            role: 'Vendedor',\n            baseSalary: 500000,\n            isActive: false,\n            photoUrl: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80',\n        },\n    ];\n\n    return (\n        <RouteGuard allowedRoles={['ADMIN']}>\n            <div className=\"min-h-screen bg-gray-100 py-8\">\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                    <div className=\"md:flex md:items-center md:justify-between mb-8\">\n                        <div className=\"min-w-0 flex-1\">\n                            <h2 className=\"text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight\">\n                                üë• Recursos Humanos\n                            </h2>\n                            <p className=\"mt-1 text-sm text-gray-500\">\n                                Gesti√≥n de personal y c√°lculo de remuneraciones (Anti-Canela).\n                            </p>\n                        </div>\n                    </div>\n\n                    <EmployeeGrid employees={employees} payrollData={payrollData} />\n                </div>\n            </div>\n        </RouteGuard>\n    );\n}\n"],"names":[],"mappings":"+ZAAA,IAAA,EAAA,EAAA,CAAA,CAAA,yCAEA,IAAM,EAAO,IAAI,EAAA,IAAI,CAAC,CAClB,iBAAkB,QAAQ,GAAG,CAAC,YAAY,CAC1C,IAEU,CADN,AACQ,oBAAoB,CAAM,CAE1C,GADc,AAGP,eAAe,EAAM,CAAY,CAAE,CAAc,EACpD,IAAM,EAAQ,KAAK,GAAG,GAChB,EAAM,MAAM,EAAK,KAAK,CAAC,EAAM,GAC7B,EAAW,KAAK,GAAG,GAAK,EAE9B,OADA,QAAQ,GAAG,CAAC,iBAAkB,MAAE,WAAM,EAAU,KAAM,EAAI,QAAQ,AAAC,GAC5D,CACX,2ECde,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAuB,AAAvB,EACX,WAAa,MAAM,AAAI,MAAM,oSAAsS,EACnU,mEACA,8DAHW,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,gRAAkR,EAC/S,+CACA,0HCLJ,IAAA,EAAA,EAAA,CAAA,CAAA,gBASO,eAAe,IAClB,IAAM,EAAM,IAAI,KACV,EAAe,IAAI,KAAK,EAAI,WAAW,GAAI,EAAI,QAAQ,GAAI,GAAG,WAAW,GAKzE,EAAc,MAAM,CAAA,EAAA,EAAA,KAAA,AAAK,EADX,AACY,CADX,sCAAsC,CAAC,EAGtD,EAAa,IAAI,IACvB,EAAY,IAAI,CAAC,OAAO,CAAC,AAAC,IACtB,EAAW,GAAG,CAAC,EAAI,EAAE,CAAE,EAAI,YAAY,CAC3C,GAGA,IAAM,EAAW,CAAC;;;;EAIpB,CAAC,CACO,EAAW,MAAM,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,EAAU,CAAC,EAAa,EAEjD,EAAa,EACb,EAAsB,EACtB,EAAyB,EACzB,EAAmB,EAyBvB,OApBA,EAAS,IAAI,CAAC,OAAO,CAAC,AAAC,IACnB,IAAM,EAAQ,EAAK,KAAK,CACpB,CADsB,KAChB,OAAO,CAAC,CADsB,GAEpC,EAAM,EADgB,KACT,CAAC,AAAC,IACX,IAAM,EAAS,OAAO,EAAK,KAAK,GAAK,EAC/B,EAAY,OAAO,EAAK,WAAW,EACnC,EAAmB,EAAW,GAAG,CAAC,IAAc,GAEtD,GAAc,EAEV,GACA,GAAuB,EACvB,GAAoB,KAAK,EAFP,GAEY,CAftB,IAeuB,EAfjB,EAiBd,GAA0B,AAjBP,CAmB3B,CAJgD,CAMxD,GAEO,YACH,sBACA,yBACA,mBACA,CACJ,CACJ,6GC/De,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAU,AAAJ,MAAU,sSAAwS,EACrU,qEACA,8DAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAU,AAAJ,MAAU,kRAAoR,EACjT,iDACA,0ICLJ,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,CAD2D,CAC3D,EAAA,CAAA,CAAA,gBAIe,MALuE,SAKxD,IAC1B,IAAM,EAAc,MAAM,CAAA,EAAA,EAAA,cAAA,AAAc,IAsCxC,MACI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAU,CAAA,CAAC,aAAc,CAAC,QAAQ,UAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yCACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2DACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2BACX,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gGAAuF,wBAGrG,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA6B,wEAMlD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAY,CAAA,CAAC,UAlDZ,CAkDuB,AAjDrC,CACI,GAAI,EACJ,KAAM,aACN,KAAM,uBACN,WAAY,KACZ,UAAU,EACV,SAAU,2JACd,EACA,CACI,GAAI,EACJ,KAAM,iBACN,KAAM,uBACN,WAAY,IACZ,UAAU,EACV,SAAU,2JACd,EACA,CACI,GAAI,EACJ,KAAM,mBACN,KAAM,WACN,WAAY,IACZ,UAAU,EACV,SAAU,2JACd,EACA,CACI,GAAI,EACJ,KAAM,eACN,KAAM,WACN,WAAY,IACZ,UAAU,EACV,SAAU,2JACd,EACH,CAiBmD,YAAa,UAKrE,2DA7DuB","ignoreList":[1,3]}