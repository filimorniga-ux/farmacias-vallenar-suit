module.exports=[85220,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(87532),e=a.i(38784),f=a.i(81560),g=a.i(70106);let h=(0,g.default)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),i=(0,g.default)("banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),j=(0,g.default)("receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);var k=a.i(71931),l=a.i(15618);let m=(0,g.default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),n=(0,g.default)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),o=(0,g.default)("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),p=(0,g.default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);async function q(a,b){await new Promise(a=>setTimeout(a,800));let c=Math.round(a/1.19);return{folio:Math.floor(1e5*Math.random())+1,fecha:new Date().toISOString(),total:a,neto:c,iva:a-c,items:b,razon_social:"FARMACIAS VALLENAR SPA",rut_emisor:"76.123.456-7",direccion:"Calle Prat 123, Vallenar",giro:"VENTA AL POR MENOR DE PRODUCTOS FARMACEUTICOS",track_id:crypto.randomUUID(),estado:"ACEPTADO"}}var r=a.i(68114);let s=(0,g.default)("qr-code",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);function t({data:a}){return(0,b.jsxs)("div",{id:"ticket-print-area",className:"bg-white p-4 w-[80mm] mx-auto text-black font-mono text-xs leading-tight",children:[(0,b.jsxs)("div",{className:"text-center mb-4",children:[(0,b.jsx)("h1",{className:"font-bold text-sm uppercase mb-1",children:"FARMACIAS VALLENAR"}),(0,b.jsxs)("p",{children:["RUT: ",a.rut_emisor]}),(0,b.jsx)("p",{children:a.giro}),(0,b.jsx)("p",{children:a.direccion}),(0,b.jsx)("p",{children:"Fono: +56 51 261 2345"})]}),(0,b.jsxs)("div",{className:"text-center border-t border-b border-black border-dashed py-2 mb-2",children:[(0,b.jsx)("h2",{className:"font-bold",children:"BOLETA ELECTRÃ“NICA"}),(0,b.jsxs)("p",{className:"text-sm font-bold",children:["NÂº ",a.folio]}),(0,b.jsx)("p",{className:"text-[10px]",children:"S.I.I. - VALLENAR"}),(0,b.jsxs)("p",{className:"mt-1",children:["Fecha: ",new Date(a.fecha).toLocaleString()]})]}),(0,b.jsx)("div",{className:"mb-2",children:(0,b.jsxs)("table",{className:"w-full text-left",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-black border-dashed",children:[(0,b.jsx)("th",{className:"py-1 w-8",children:"Cant"}),(0,b.jsx)("th",{className:"py-1",children:"Desc"}),(0,b.jsx)("th",{className:"py-1 text-right",children:"Total"})]})}),(0,b.jsx)("tbody",{children:a.items.map((a,c)=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"py-1 align-top",children:a.cantidad}),(0,b.jsx)("td",{className:"py-1 align-top truncate max-w-[120px]",children:a.nombre}),(0,b.jsx)("td",{className:"py-1 align-top text-right",children:(0,r.formatCurrency)(a.total)})]},c))})]})}),(0,b.jsxs)("div",{className:"border-t border-black border-dashed pt-2 mb-4",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Neto:"}),(0,b.jsx)("span",{children:(0,r.formatCurrency)(a.neto)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"IVA (19%):"}),(0,b.jsx)("span",{children:(0,r.formatCurrency)(a.iva)})]}),(0,b.jsxs)("div",{className:"flex justify-between font-bold text-sm mt-1",children:[(0,b.jsx)("span",{children:"TOTAL:"}),(0,b.jsx)("span",{children:(0,r.formatCurrency)(a.total)})]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center mb-4",children:[(0,b.jsx)("div",{className:"border border-black p-1 mb-1",children:(0,b.jsx)(s,{size:80,className:"text-black"})}),(0,b.jsxs)("p",{className:"text-[8px] uppercase text-center",children:["Timbre ElectrÃ³nico SII",(0,b.jsx)("br",{}),"Res. 80 de 2014 - Verifique documento: www.sii.cl"]})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"font-bold text-[10px]",children:"Â¡GRACIAS POR SU PREFERENCIA!"}),(0,b.jsx)("p",{className:"text-[10px] mt-1",children:"Copia Cliente"})]})]})}var u=a.i(48182),v=a.i(20226),w=a.i(62435);let x=(0,v.create)()((0,w.persist)((a,b)=>({cart:[],addToCart:b=>a(a=>a.cart.find(a=>a.id===b.id)?{cart:a.cart.map(a=>a.id===b.id?{...a,quantity:a.quantity+1}:a)}:{cart:[...a.cart,{...b,quantity:1}]}),removeFromCart:b=>a(a=>({cart:a.cart.filter(a=>a.id!==b)})),updateQuantity:(b,c)=>a(a=>({cart:a.cart.map(a=>{if(a.id===b){let b=a.quantity+c;return b>0?{...a,quantity:b}:a}return a})})),clearCart:()=>a({cart:[]}),getCartTotal:()=>b().cart.reduce((a,b)=>a+b.price*b.quantity,0)}),{name:"farmacias-vallenar-cart"})),y=(0,v.create)()((0,w.persist)(a=>({pendingSales:[],addOfflineSale:(b,c)=>a(a=>({pendingSales:[...a.pendingSales,{id:crypto.randomUUID(),timestamp:new Date().toISOString(),items:b,total:c}]})),removeOfflineSale:b=>a(a=>({pendingSales:a.pendingSales.filter(a=>a.id!==b)})),clearOfflineSales:()=>a({pendingSales:[]})}),{name:"farmacias-vallenar-offline-sales"})),z=[{id:1,name:"Paracetamol 500mg",price:2990,stock:100,requiresPrescription:!1},{id:2,name:"Ibuprofeno 400mg",price:3490,stock:50,requiresPrescription:!1},{id:3,name:"Amoxicilina 500mg",price:5990,stock:30,requiresPrescription:!0},{id:4,name:"Loratadina 10mg",price:1990,stock:80,requiresPrescription:!1},{id:5,name:"LosartÃ¡n 50mg",price:8990,stock:150,requiresPrescription:!1}];function A(){let[g,s]=(0,c.useState)(""),[v,w]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(!1),{cart:G,addToCart:H,removeFromCart:I,updateQuantity:J,clearCart:K,getCartTotal:L}=x(),{pendingSales:M,addOfflineSale:N,clearOfflineSales:O}=y(),P=function(){let[a,b]=(0,c.useState)(!0);return(0,c.useEffect)(()=>{let a=()=>b(!0),c=()=>b(!1);return window.addEventListener("online",a),window.addEventListener("offline",c),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",c)}},[]),a}(),[Q,R]=(0,c.useState)(!1);(0,c.useEffect)(()=>{R(!0)},[]);let S=L(),T=async()=>{if(0!==G.length){w(!0);try{if(!P){N(G,S),alert("Sin conexiÃ³n. Venta guardada localmente para sincronizaciÃ³n posterior."),K();return}let a=G.map(a=>({nombre:a.name,cantidad:a.quantity,precio:a.price,total:a.price*a.quantity})),b=await q(S,a);B(b),D(!0),K()}catch(a){console.error(a),window.confirm("Error de conexiÃ³n con SII. Â¿Guardar venta localmente?")&&(N(G,S),K())}finally{w(!1)}}},U=async()=>{if(0!==M.length){F(!0);try{for(let a of M){let b=a.items.map(a=>({nombre:a.name,cantidad:a.quantity,precio:a.price,total:a.price*a.quantity}));await q(a.total,b)}O(),alert("SincronizaciÃ³n completada exitosamente.")}catch(a){alert("Error durante la sincronizaciÃ³n. Intente nuevamente.")}finally{F(!1)}}},V=()=>{D(!1),B(null),K()},W=z.filter(a=>a.name.toLowerCase().includes(g.toLowerCase()));return Q?(0,b.jsx)(u.default,{allowedRoles:["ADMIN","QF","VENDEDOR"],children:(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 p-4",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,b.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-center gap-4 bg-white p-4 rounded-xl shadow-sm",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:"ðŸ›’ Punto de Venta"}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("button",{onClick:async()=>{try{let{getNextTicket:b}=await a.A(85490),c=await b(1);if(c.success&&c.ticket){alert(`Llamando a ticket: ${c.ticket.numero_ticket}`);let a=new SpeechSynthesisUtterance(`Atenci\xf3n, n\xfamero ${c.ticket.numero_ticket}, pase a caja.`);window.speechSynthesis.speak(a)}else alert(c.message||c.error||"No hay clientes en espera")}catch(a){console.error(a),alert("Error al llamar siguiente nÃºmero")}},className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium shadow-sm",children:[(0,b.jsx)("span",{className:"text-xl",children:"ðŸ“¢"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Llamar Siguiente"})]}),(0,b.jsxs)("div",{className:(0,r.cn)("flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium",P?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"),children:[P?(0,b.jsx)(n,{size:16}):(0,b.jsx)(o,{size:16}),P?"Online":"Modo Offline"]}),M.length>0&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-sm text-orange-600 font-medium",children:[M.length," pendiente(s)"]}),(0,b.jsxs)("button",{onClick:U,disabled:!P||E,className:"flex items-center gap-1 px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,b.jsx)(p,{size:16,className:(0,r.cn)(E&&"animate-spin")}),E?"Sincronizando...":"Sincronizar"]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,b.jsx)("div",{className:"bg-white p-4 rounded-xl shadow-sm",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(d.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),(0,b.jsx)("input",{type:"text",placeholder:"Buscar producto...",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:g,onChange:a=>s(a.target.value)})]})}),(0,b.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:W.map(a=>(0,b.jsxs)("button",{onClick:()=>H(a),className:"bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition-all text-left group",children:[(0,b.jsx)("div",{className:"font-semibold text-gray-900 group-hover:text-blue-600",children:a.name}),(0,b.jsxs)("div",{className:"text-gray-500 text-sm mt-1",children:["Stock: ",a.stock]}),(0,b.jsxs)("div",{className:"text-lg font-bold text-blue-600 mt-2",children:["$",a.price.toLocaleString()]}),a.requiresPrescription&&(0,b.jsx)("span",{className:"inline-block mt-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Receta"})]},a.id))})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-sm h-[calc(100vh-8rem)] flex flex-col sticky top-4",children:[(0,b.jsx)("div",{className:"p-4 border-b border-gray-100",children:(0,b.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2",children:[(0,b.jsx)(e.ShoppingCart,{className:"text-blue-600"}),"Carro de Compra"]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:0===G.length?(0,b.jsx)("div",{className:"text-center text-gray-400 py-8",children:"Carro vacÃ­o"}):G.map(a=>(0,b.jsxs)("div",{className:"flex justify-between items-center bg-gray-50 p-3 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),(0,b.jsxs)("div",{className:"text-sm text-gray-500",children:["$",a.price.toLocaleString()," x ",a.quantity]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-white rounded-lg border border-gray-200",children:[(0,b.jsx)("button",{onClick:()=>J(a.id,-1),className:"p-1 hover:bg-gray-100 rounded-l-lg",children:(0,b.jsx)(m,{size:16})}),(0,b.jsx)("span",{className:"w-8 text-center text-sm",children:a.quantity}),(0,b.jsx)("button",{onClick:()=>J(a.id,1),className:"p-1 hover:bg-gray-100 rounded-r-lg",children:(0,b.jsx)(l.Plus,{size:16})})]}),(0,b.jsx)("button",{onClick:()=>I(a.id),className:"text-red-500 hover:text-red-700 p-1",children:(0,b.jsx)(f.Trash2,{size:18})})]})]},a.id))}),(0,b.jsxs)("div",{className:"p-4 border-t border-gray-100 bg-gray-50 rounded-b-xl",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4 text-lg font-bold",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsxs)("span",{children:["$",S.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,b.jsxs)("button",{className:"flex items-center justify-center gap-2 p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50",children:[(0,b.jsx)(i,{size:20,className:"text-green-600"}),"Efectivo"]}),(0,b.jsxs)("button",{className:"flex items-center justify-center gap-2 p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50",children:[(0,b.jsx)(h,{size:20,className:"text-blue-600"}),"Tarjeta"]})]}),(0,b.jsx)("button",{onClick:T,disabled:0===G.length||v,className:(0,r.cn)("w-full py-4 text-white rounded-xl font-bold text-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors",P?"bg-blue-600 hover:bg-blue-700":"bg-orange-500 hover:bg-orange-600"),children:v?"Procesando...":(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j,{}),P?"Emitir Boleta":"Guardar Offline"]})})]})]})]}),C&&A&&(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 print:p-0 print:bg-white print:static",children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden flex flex-col max-h-[90vh] print:shadow-none print:max-w-none print:max-h-none print:w-auto print:rounded-none",children:[(0,b.jsxs)("div",{className:"p-4 border-b flex justify-between items-center bg-gray-50 print:hidden",children:[(0,b.jsx)("h3",{className:"font-bold text-lg text-gray-800",children:"Boleta Generada"}),(0,b.jsxs)("button",{onClick:V,className:"text-gray-400 hover:text-gray-600",children:[(0,b.jsx)("span",{className:"sr-only",children:"Cerrar"}),"âœ•"]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-100 flex justify-center print:p-0 print:bg-white print:overflow-visible",children:(0,b.jsx)("div",{className:"shadow-lg print:shadow-none",children:(0,b.jsx)(t,{data:A})})}),(0,b.jsxs)("div",{className:"p-4 border-t bg-white grid grid-cols-2 gap-4 print:hidden",children:[(0,b.jsxs)("button",{onClick:V,className:"flex items-center justify-center gap-2 px-4 py-3 border border-gray-300 rounded-xl text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:[(0,b.jsx)(l.Plus,{size:20}),"Nueva Venta"]}),(0,b.jsxs)("button",{onClick:()=>{window.print()},className:"flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-colors shadow-lg shadow-blue-200",children:[(0,b.jsx)(k.Printer,{size:20}),"Imprimir"]})]})]})})]})})}):null}a.s(["default",()=>A],85220)}];

//# sourceMappingURL=src_app_caja_page_tsx_e558d8b5._.js.map