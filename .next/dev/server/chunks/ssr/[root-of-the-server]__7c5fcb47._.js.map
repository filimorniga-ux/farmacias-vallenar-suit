{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\n// Disable SSL verification for self-signed certs in development\nif (process.env.NODE_ENV !== 'production') {\n    process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';\n}\n\nconst pool = new Pool({\n    // La conexi√≥n se sigue leyendo de la variable DATABASE_URL\n    connectionString: process.env.DATABASE_URL,\n    // [PARCHE CR√çTICO PARA EL ENTORNO LOCAL]\n    ssl: {\n        rejectUnauthorized: false,\n    },\n});\n\n// Handle idle client errors to prevent crash\npool.on('error', (err, client) => {\n    console.error('Unexpected error on idle client', err);\n    // Don't exit the process, just log it\n});\n\nexport async function query(text: string, params?: any[]) {\n    const start = Date.now();\n    try {\n        const res = await pool.query(text, params);\n        const duration = Date.now() - start;\n        console.log('Executed query', { text, duration, rows: res.rowCount });\n        return res;\n    } catch (error) {\n        console.warn('‚ö†Ô∏è Safe Mode: Database connection failed. Returning empty data.');\n        // console.error('Database Error:', error); // Uncomment for debugging\n        // Return a safe mock object to prevent app crash\n        return {\n            rows: [],\n            rowCount: 0,\n            command: '',\n            oid: 0,\n            fields: []\n        };\n    }\n}\n\nexport default pool;\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,gEAAgE;AAChE,wCAA2C;IACvC,QAAQ,GAAG,CAAC,4BAA4B,GAAG;AAC/C;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IAClB,2DAA2D;IAC3D,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,yCAAyC;IACzC,KAAK;QACD,oBAAoB;IACxB;AACJ;AAEA,6CAA6C;AAC7C,KAAK,EAAE,CAAC,SAAS,CAAC,KAAK;IACnB,QAAQ,KAAK,CAAC,mCAAmC;AACjD,sCAAsC;AAC1C;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACpD,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACA,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;QACnC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,kBAAkB;YAAE;YAAM;YAAU,MAAM,IAAI,QAAQ;QAAC;QACnE,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,IAAI,CAAC;QACb,sEAAsE;QACtE,iDAAiD;QACjD,OAAO;YACH,MAAM,EAAE;YACR,UAAU;YACV,SAAS;YACT,KAAK;YACL,QAAQ,EAAE;QACd;IACJ;AACJ;uCAEe"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/lib/data/payroll.ts"],"sourcesContent":["import { query } from '../db';\n\nexport interface PayrollData {\n    totalSales: number;\n    commissionableSales: number;\n    nonCommissionableSales: number;\n    totalCommissions: number;\n}\n\nexport async function getPayrollData(): Promise<PayrollData> {\n    const now = new Date();\n    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).toISOString();\n\n    // 1. Fetch all products to know which are commissionable\n    // We need a map of product_id -> comisionable (boolean)\n    const productsSql = `SELECT id, comisionable FROM productos`;\n    const productsRes = await query(productsSql);\n\n    const productMap = new Map<number, boolean>();\n    productsRes.rows.forEach((row: any) => {\n        productMap.set(row.id, row.comisionable);\n    });\n\n    // 2. Fetch all sales for the current month\n    const salesSql = `\n    SELECT items\n    FROM ventas\n    WHERE fecha >= $1\n  `;\n    const salesRes = await query(salesSql, [startOfMonth]);\n\n    let totalSales = 0;\n    let commissionableSales = 0;\n    let nonCommissionableSales = 0;\n    let totalCommissions = 0;\n\n    const COMMISSION_RATE = 0.03; // 3%\n\n    // 3. Iterate through sales and items\n    salesRes.rows.forEach((sale: any) => {\n        const items = sale.items; // JSONB array\n        if (Array.isArray(items)) {\n            items.forEach((item: any) => {\n                const amount = Number(item.total) || 0;\n                const productId = Number(item.producto_id);\n                const isCommissionable = productMap.get(productId) || false;\n\n                totalSales += amount;\n\n                if (isCommissionable) {\n                    commissionableSales += amount;\n                    totalCommissions += Math.round(amount * COMMISSION_RATE);\n                } else {\n                    nonCommissionableSales += amount;\n                }\n            });\n        }\n    });\n\n    return {\n        totalSales,\n        commissionableSales,\n        nonCommissionableSales,\n        totalCommissions,\n    };\n}\n"],"names":[],"mappings":";;;;AAAA;;;;;;AASO,eAAe;IAClB,MAAM,MAAM,IAAI;IAChB,MAAM,eAAe,IAAI,KAAK,IAAI,WAAW,IAAI,IAAI,QAAQ,IAAI,GAAG,WAAW;IAE/E,yDAAyD;IACzD,wDAAwD;IACxD,MAAM,cAAc,CAAC,sCAAsC,CAAC;IAC5D,MAAM,cAAc,MAAM,IAAA,yHAAK,EAAC;IAEhC,MAAM,aAAa,IAAI;IACvB,YAAY,IAAI,CAAC,OAAO,CAAC,CAAC;QACtB,WAAW,GAAG,CAAC,IAAI,EAAE,EAAE,IAAI,YAAY;IAC3C;IAEA,2CAA2C;IAC3C,MAAM,WAAW,CAAC;;;;EAIpB,CAAC;IACC,MAAM,WAAW,MAAM,IAAA,yHAAK,EAAC,UAAU;QAAC;KAAa;IAErD,IAAI,aAAa;IACjB,IAAI,sBAAsB;IAC1B,IAAI,yBAAyB;IAC7B,IAAI,mBAAmB;IAEvB,MAAM,kBAAkB,MAAM,KAAK;IAEnC,qCAAqC;IACrC,SAAS,IAAI,CAAC,OAAO,CAAC,CAAC;QACnB,MAAM,QAAQ,KAAK,KAAK,EAAE,cAAc;QACxC,IAAI,MAAM,OAAO,CAAC,QAAQ;YACtB,MAAM,OAAO,CAAC,CAAC;gBACX,MAAM,SAAS,OAAO,KAAK,KAAK,KAAK;gBACrC,MAAM,YAAY,OAAO,KAAK,WAAW;gBACzC,MAAM,mBAAmB,WAAW,GAAG,CAAC,cAAc;gBAEtD,cAAc;gBAEd,IAAI,kBAAkB;oBAClB,uBAAuB;oBACvB,oBAAoB,KAAK,KAAK,CAAC,SAAS;gBAC5C,OAAO;oBACH,0BAA0B;gBAC9B;YACJ;QACJ;IACJ;IAEA,OAAO;QACH;QACA;QACA;QACA;IACJ;AACJ"}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/components/rrhh/EmployeeGrid.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/rrhh/EmployeeGrid.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/rrhh/EmployeeGrid.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAwS,GACrU,sEACA","ignoreList":[0]}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/components/rrhh/EmployeeGrid.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/rrhh/EmployeeGrid.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/rrhh/EmployeeGrid.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAoR,GACjT,kDACA","ignoreList":[0]}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 188, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/components/auth/RouteGuard.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/auth/RouteGuard.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/auth/RouteGuard.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAsS,GACnU,oEACA","ignoreList":[0]}},
    {"offset": {"line": 202, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/components/auth/RouteGuard.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/auth/RouteGuard.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/auth/RouteGuard.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAkR,GAC/S,gDACA","ignoreList":[0]}},
    {"offset": {"line": 216, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 226, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/app/rrhh/page.tsx"],"sourcesContent":["import { getPayrollData } from '@/lib/data/payroll';\nimport EmployeeGrid from '@/components/rrhh/EmployeeGrid'; // Client component wrapper\nimport RouteGuard from '@/components/auth/RouteGuard';\n\nexport const dynamic = 'force-dynamic';\n\nexport default async function RRHHPage() {\n    const payrollData = await getPayrollData();\n\n    // Mock Employees\n    const employees = [\n        {\n            id: 1,\n            name: 'Juan P√©rez',\n            role: 'Qu√≠mico Farmac√©utico',\n            baseSalary: 1800000,\n            isActive: true,\n            photoUrl: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80',\n        },\n        {\n            id: 2,\n            name: 'Mar√≠a Gonz√°lez',\n            role: 'Auxiliar de Farmacia',\n            baseSalary: 600000,\n            isActive: true,\n            photoUrl: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80',\n        },\n        {\n            id: 3,\n            name: 'Carlos Rodr√≠guez',\n            role: 'Vendedor',\n            baseSalary: 500000,\n            isActive: true,\n            photoUrl: 'https://images.unsplash.com/photo-1519244703995-f4e0f30006d5?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80',\n        },\n        {\n            id: 4,\n            name: 'Ana Mart√≠nez',\n            role: 'Vendedor',\n            baseSalary: 500000,\n            isActive: false,\n            photoUrl: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80',\n        },\n    ];\n\n    return (\n        <RouteGuard allowedRoles={['ADMIN']}>\n            <div className=\"min-h-screen bg-gray-100 py-8\">\n                <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n                    <div className=\"md:flex md:items-center md:justify-between mb-8\">\n                        <div className=\"min-w-0 flex-1\">\n                            <h2 className=\"text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight\">\n                                üë• Recursos Humanos\n                            </h2>\n                            <p className=\"mt-1 text-sm text-gray-500\">\n                                Gesti√≥n de personal y c√°lculo de remuneraciones (Anti-Canela).\n                            </p>\n                        </div>\n                    </div>\n\n                    <EmployeeGrid employees={employees} payrollData={payrollData} />\n                </div>\n            </div>\n        </RouteGuard>\n    );\n}\n"],"names":[],"mappings":";;;;;;;AAAA;AACA,mPAA2D,2BAA2B;AACtF;;;;;;;;;AAEO,MAAM,UAAU;AAER,eAAe;IAC1B,MAAM,cAAc,MAAM,IAAA,+IAAc;IAExC,iBAAiB;IACjB,MAAM,YAAY;QACd;YACI,IAAI;YACJ,MAAM;YACN,MAAM;YACN,YAAY;YACZ,UAAU;YACV,UAAU;QACd;QACA;YACI,IAAI;YACJ,MAAM;YACN,MAAM;YACN,YAAY;YACZ,UAAU;YACV,UAAU;QACd;QACA;YACI,IAAI;YACJ,MAAM;YACN,MAAM;YACN,YAAY;YACZ,UAAU;YACV,UAAU;QACd;QACA;YACI,IAAI;YACJ,MAAM;YACN,MAAM;YACN,YAAY;YACZ,UAAU;YACV,UAAU;QACd;KACH;IAED,qBACI,8OAAC,mJAAU;QAAC,cAAc;YAAC;SAAQ;kBAC/B,cAAA,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAI,WAAU;kCACX,cAAA,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAG,WAAU;8CAAuF;;;;;;8CAGrG,8OAAC;oCAAE,WAAU;8CAA6B;;;;;;;;;;;;;;;;;kCAMlD,8OAAC,qJAAY;wBAAC,WAAW;wBAAW,aAAa;;;;;;;;;;;;;;;;;;;;;;AAKrE"}}]
}