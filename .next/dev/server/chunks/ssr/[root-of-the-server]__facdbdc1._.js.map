{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\n// Disable SSL verification for self-signed certs in development\nif (process.env.NODE_ENV !== 'production') {\n    process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';\n}\n\nconst pool = new Pool({\n    // La conexión se sigue leyendo de la variable DATABASE_URL\n    connectionString: process.env.DATABASE_URL,\n    // [PARCHE CRÍTICO PARA EL ENTORNO LOCAL]\n    ssl: {\n        rejectUnauthorized: false,\n    },\n});\n\n// Handle idle client errors to prevent crash\npool.on('error', (err, client) => {\n    console.error('Unexpected error on idle client', err);\n    // Don't exit the process, just log it\n});\n\nexport async function query(text: string, params?: any[]) {\n    const start = Date.now();\n    try {\n        const res = await pool.query(text, params);\n        const duration = Date.now() - start;\n        console.log('Executed query', { text, duration, rows: res.rowCount });\n        return res;\n    } catch (error) {\n        console.warn('⚠️ Safe Mode: Database connection failed. Returning empty data.');\n        // console.error('Database Error:', error); // Uncomment for debugging\n        // Return a safe mock object to prevent app crash\n        return {\n            rows: [],\n            rowCount: 0,\n            command: '',\n            oid: 0,\n            fields: []\n        };\n    }\n}\n\nexport default pool;\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,gEAAgE;AAChE,wCAA2C;IACvC,QAAQ,GAAG,CAAC,4BAA4B,GAAG;AAC/C;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IAClB,2DAA2D;IAC3D,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,yCAAyC;IACzC,KAAK;QACD,oBAAoB;IACxB;AACJ;AAEA,6CAA6C;AAC7C,KAAK,EAAE,CAAC,SAAS,CAAC,KAAK;IACnB,QAAQ,KAAK,CAAC,mCAAmC;AACjD,sCAAsC;AAC1C;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACpD,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACA,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;QACnC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,kBAAkB;YAAE;YAAM;YAAU,MAAM,IAAI,QAAQ;QAAC;QACnE,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,IAAI,CAAC;QACb,sEAAsE;QACtE,iDAAiD;QACjD,OAAO;YACH,MAAM,EAAE;YACR,UAAU;YACV,SAAS;YACT,KAAK;YACL,QAAQ,EAAE;QACd;IACJ;AACJ;uCAEe"}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/actions/sync.ts"],"sourcesContent":["'use server';\n\nimport { query } from '../lib/db';\nimport { InventoryBatch, EmployeeProfile } from '../domain/types';\n\nexport async function fetchInventory(): Promise<InventoryBatch[]> {\n    try {\n        const res = await query('SELECT * FROM productos');\n\n        // Map DB columns to Domain Type\n        // Assuming DB columns might be snake_case or slightly different. \n        // We map what we can and default the rest for safety.\n        return res.rows.map((row: any) => ({\n            id: row.id?.toString() || `PROD-${Math.random()}`,\n            sku: row.sku || row.codigo || 'UNKNOWN',\n            name: row.nombre || row.name || 'Sin Nombre',\n            dci: row.dci || row.principio_activo || '',\n            laboratory: row.laboratory || row.laboratorio || 'GENERICO',\n            isp_register: row.isp_register || row.registro_isp || '',\n            format: row.format || row.formato || 'CAJA',\n            units_per_box: Number(row.units_per_box || row.unidades_por_caja) || 1,\n            is_bioequivalent: row.is_bioequivalent || row.es_bioequivalente || false,\n\n            // Legacy / Optional / Derived defaults\n            concentration: row.concentration || '',\n            unit_count: Number(row.unit_count) || 1,\n            is_generic: row.is_generic || false,\n            bioequivalent_status: (row.bioequivalent_status || 'NO_BIOEQUIVALENTE') as any,\n\n            // Financials\n            cost_net: Number(row.cost_net || row.costo_neto) || 0,\n            tax_percent: Number(row.tax_percent || row.iva) || 19,\n            price_sell_box: Number(row.price_sell_box || row.precio_venta_caja) || Number(row.price || row.precio) || 0,\n            price_sell_unit: Number(row.price_sell_unit || row.precio_venta_unitario) || 0,\n\n            // Legacy Mapped\n            price: Number(row.price || row.precio) || 0,\n            cost_price: Number(row.cost_price) || 0,\n\n            // Logistics\n            stock_actual: Number(row.stock_actual || row.stock) || 0,\n            stock_min: Number(row.stock_min || row.stock_min) || 5,\n            stock_max: Number(row.stock_max) || 100,\n            expiry_date: row.vencimiento ? new Date(row.vencimiento).getTime() : Date.now() + 31536000000,\n            location_id: row.location_id || 'BODEGA_CENTRAL',\n\n            category: (row.category || row.categoria) as any,\n            condition: (row.sale_condition || row.condicion_venta) as any,\n            allows_commission: row.allows_commission || row.permite_comision || false,\n            active_ingredients: row.active_ingredients || row.principios_activos ? (Array.isArray(row.principios_activos) ? row.principios_activos : [row.principios_activos]) : [],\n            supplier_id: row.supplier_id || row.proveedor_id || 'SUP-001'\n        }));\n    } catch (error) {\n        console.error('Error fetching inventory:', error);\n        return [];\n    }\n}\n\nexport async function fetchEmployees(): Promise<EmployeeProfile[]> {\n    try {\n        const res = await query('SELECT * FROM users');\n\n        return res.rows.map((row: any) => ({\n            id: row.id?.toString() || `EMP-${Math.random()}`,\n            rut: row.rut || 'SIN-RUT',\n            name: row.name || 'Usuario Sistema',\n            role: row.role || 'CASHIER',\n            access_pin: row.pin || '0000',\n            status: row.status || 'ACTIVE',\n            current_status: 'OUT',\n            job_title: 'CAJERO_VENDEDOR', // Default for sync\n            labor_data: {\n                base_salary: 500000,\n                afp: 'MODELO',\n                isapre: 'FONASA',\n                contract_hours: 45\n            }\n        }));\n    } catch (error) {\n        console.error('Error fetching employees:', error);\n        return [];\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {fetchInventory as '00e784d5c5f2ec456092b35d28d82364fccfd88096'} from 'ACTIONS_MODULE0'\nexport {fetchEmployees as '00346fc19a5a497002ca66cbb9f34c6abb27d97160'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 211, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n"],"names":["registerServerReference"],"mappings":"AAAA,oDAAoD;;;+BAC3CA,2BAAAA;;;eAAAA,QAAAA,uBAAuB;;;wBAAQ","ignoreList":[0]}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts"],"sourcesContent":["// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n"],"names":["ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"AAAA,+EAA+E;AAC/E,yEAAyE;AACzE,iEAAiE;;;;+BACjDA,4BAAAA;;;eAAAA;;;AAAT,SAASA,yBAAyBC,OAAc;IACrD,IAAK,IAAIC,IAAI,GAAGA,IAAID,QAAQE,MAAM,EAAED,IAAK;QACvC,MAAME,SAASH,OAAO,CAACC,EAAE;QACzB,IAAI,OAAOE,WAAW,YAAY;YAChC,MAAM,OAAA,cAEL,CAFK,IAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,OAAO,uEAAuE,CAAC,GADhJ,qBAAA;uBAAA;4BAAA;8BAAA;YAEN;QACF;IACF;AACF","ignoreList":[0]}}]
}