{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\n// Disable SSL verification for self-signed certs in development\nif (process.env.NODE_ENV !== 'production') {\n    process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';\n}\n\nconst pool = new Pool({\n    // La conexión se sigue leyendo de la variable DATABASE_URL\n    connectionString: process.env.DATABASE_URL,\n    // [PARCHE CRÍTICO PARA EL ENTORNO LOCAL]\n    ssl: {\n        rejectUnauthorized: false,\n    },\n});\n\nexport async function query(text: string, params?: any[]) {\n    const start = Date.now();\n    try {\n        const res = await pool.query(text, params);\n        const duration = Date.now() - start;\n        console.log('Executed query', { text, duration, rows: res.rowCount });\n        return res;\n    } catch (error) {\n        console.error('Database Error (Returning Mock):', error);\n        // Return a safe mock object to prevent app crash\n        return {\n            rows: [],\n            rowCount: 0,\n            command: '',\n            oid: 0,\n            fields: []\n        };\n    }\n}\n\nexport default pool;\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,gEAAgE;AAChE,wCAA2C;IACvC,QAAQ,GAAG,CAAC,4BAA4B,GAAG;AAC/C;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IAClB,2DAA2D;IAC3D,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,yCAAyC;IACzC,KAAK;QACD,oBAAoB;IACxB;AACJ;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACpD,MAAM,QAAQ,KAAK,GAAG;IACtB,IAAI;QACA,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;QACnC,MAAM,WAAW,KAAK,GAAG,KAAK;QAC9B,QAAQ,GAAG,CAAC,kBAAkB;YAAE;YAAM;YAAU,MAAM,IAAI,QAAQ;QAAC;QACnE,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,oCAAoC;QAClD,iDAAiD;QACjD,OAAO;YACH,MAAM,EAAE;YACR,UAAU;YACV,SAAS;YACT,KAAK;YACL,QAAQ,EAAE;QACd;IACJ;AACJ;uCAEe"}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/actions/dashboard.ts"],"sourcesContent":["'use server';\n\nimport { query } from '@/lib/db';\n\nexport interface DashboardMetrics {\n    salesToday: number;\n    ticketCount: number;\n    criticalStock: number;\n    expiringBatches: number;\n    coldChainStatus: 'Estable' | 'Alerta';\n}\n\nexport async function getDashboardMetrics(): Promise<DashboardMetrics> {\n    try {\n        // 1. Sales Today & Ticket Count\n        const salesSql = `\n            SELECT \n                COALESCE(SUM(total), 0) as total_sales, \n                COUNT(*) as ticket_count \n            FROM ventas \n            WHERE DATE(fecha) = CURRENT_DATE\n        `;\n        const salesResult = await query(salesSql);\n        const salesToday = salesResult.rows.length > 0 ? parseInt(salesResult.rows[0].total_sales || '0') : 0;\n        const ticketCount = salesResult.rows.length > 0 ? parseInt(salesResult.rows[0].ticket_count || '0') : 0;\n\n        // 2. Critical Stock (Products with < 10 units)\n        // We sum up lots for each product\n        const stockSql = `\n            SELECT COUNT(*) as critical_count \n            FROM (\n                SELECT p.id, COALESCE(SUM(l.cantidad_disponible), 0) as total_stock \n                FROM productos p \n                LEFT JOIN lotes l ON p.id = l.producto_id \n                GROUP BY p.id\n            ) as stocks \n            WHERE total_stock < 10\n        `;\n        const stockResult = await query(stockSql);\n        const criticalStock = stockResult.rows.length > 0 ? parseInt(stockResult.rows[0].critical_count || '0') : 0;\n\n        // 3. Expiring Batches (Next 30 days)\n        const expiringSql = `\n            SELECT COUNT(*) as expiring_count\n            FROM lotes\n            WHERE fecha_vencimiento <= CURRENT_DATE + INTERVAL '30 days'\n            AND cantidad_disponible > 0\n        `;\n        const expiringResult = await query(expiringSql);\n        const expiringBatches = expiringResult.rows.length > 0 ? parseInt(expiringResult.rows[0].expiring_count || '0') : 0;\n\n        return {\n            salesToday,\n            ticketCount,\n            criticalStock,\n            expiringBatches,\n            coldChainStatus: 'Estable' // Mocked for now\n        };\n    } catch (error) {\n        console.error('Error fetching dashboard metrics:', error);\n        return {\n            salesToday: 0,\n            ticketCount: 0,\n            criticalStock: 0,\n            expiringBatches: 0,\n            coldChainStatus: 'Estable'\n        };\n    }\n}\n"],"names":[],"mappings":";;;;;AAEA;;;;;;;;AAUO,eAAe;IAClB,IAAI;QACA,gCAAgC;QAChC,MAAM,WAAW,CAAC;;;;;;QAMlB,CAAC;QACD,MAAM,cAAc,MAAM,IAAA,yHAAK,EAAC;QAChC,MAAM,aAAa,YAAY,IAAI,CAAC,MAAM,GAAG,IAAI,SAAS,YAAY,IAAI,CAAC,EAAE,CAAC,WAAW,IAAI,OAAO;QACpG,MAAM,cAAc,YAAY,IAAI,CAAC,MAAM,GAAG,IAAI,SAAS,YAAY,IAAI,CAAC,EAAE,CAAC,YAAY,IAAI,OAAO;QAEtG,+CAA+C;QAC/C,kCAAkC;QAClC,MAAM,WAAW,CAAC;;;;;;;;;QASlB,CAAC;QACD,MAAM,cAAc,MAAM,IAAA,yHAAK,EAAC;QAChC,MAAM,gBAAgB,YAAY,IAAI,CAAC,MAAM,GAAG,IAAI,SAAS,YAAY,IAAI,CAAC,EAAE,CAAC,cAAc,IAAI,OAAO;QAE1G,qCAAqC;QACrC,MAAM,cAAc,CAAC;;;;;QAKrB,CAAC;QACD,MAAM,iBAAiB,MAAM,IAAA,yHAAK,EAAC;QACnC,MAAM,kBAAkB,eAAe,IAAI,CAAC,MAAM,GAAG,IAAI,SAAS,eAAe,IAAI,CAAC,EAAE,CAAC,cAAc,IAAI,OAAO;QAElH,OAAO;YACH;YACA;YACA;YACA;YACA,iBAAiB,UAAU,iBAAiB;QAChD;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO;YACH,YAAY;YACZ,aAAa;YACb,eAAe;YACf,iBAAiB;YACjB,iBAAiB;QACrB;IACJ;AACJ;;;IAxDsB;;AAAA,+OAAA"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getDashboardMetrics as '00d3da74548a9b500601edf7f88390a057ffaf3f00'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n"],"names":["registerServerReference"],"mappings":"AAAA,oDAAoD;;;+BAC3CA,2BAAAA;;;eAAAA,QAAAA,uBAAuB;;;wBAAQ","ignoreList":[0]}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts"],"sourcesContent":["// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n"],"names":["ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"AAAA,+EAA+E;AAC/E,yEAAyE;AACzE,iEAAiE;;;;+BACjDA,4BAAAA;;;eAAAA;;;AAAT,SAASA,yBAAyBC,OAAc;IACrD,IAAK,IAAIC,IAAI,GAAGA,IAAID,QAAQE,MAAM,EAAED,IAAK;QACvC,MAAME,SAASH,OAAO,CAACC,EAAE;QACzB,IAAI,OAAOE,WAAW,YAAY;YAChC,MAAM,OAAA,cAEL,CAFK,IAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,OAAO,uEAAuE,CAAC,GADhJ,qBAAA;uBAAA;4BAAA;8BAAA;YAEN;QACF;IACF;AACF","ignoreList":[0]}}]
}