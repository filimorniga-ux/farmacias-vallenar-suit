{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/StockEntryModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { X, ScanBarcode, Save, Package, Calendar, AlertTriangle, CheckCircle2 } from 'lucide-react';\nimport { InventoryBatch } from '../../../domain/types';\nimport { usePharmaStore } from '../../store/useStore';\nimport { toast } from 'sonner';\n\ninterface StockEntryModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst StockEntryModal: React.FC<StockEntryModalProps> = ({ isOpen, onClose }) => {\n    const { inventory, updateStock, addNewProduct } = usePharmaStore();\n    const [activeTab, setActiveTab] = useState<'SCAN' | 'CREATE'>('SCAN');\n    const [step, setStep] = useState<'SCAN' | 'DETAILS' | 'NEW_PRODUCT'>('SCAN');\n    const [scannedSku, setScannedSku] = useState('');\n    const [selectedProduct, setSelectedProduct] = useState<InventoryBatch | null>(null);\n\n    // Agile Fields\n    const [lot, setLot] = useState('');\n    const [expiry, setExpiry] = useState('');\n    const [quantity, setQuantity] = useState('');\n\n    // New Product Fields\n    const [newProductData, setNewProductData] = useState<Partial<InventoryBatch>>({});\n\n    const scanInputRef = useRef<HTMLInputElement>(null);\n    const lotInputRef = useRef<HTMLInputElement>(null);\n    const expiryInputRef = useRef<HTMLInputElement>(null);\n    const qtyInputRef = useRef<HTMLInputElement>(null);\n\n    useEffect(() => {\n        if (isOpen) {\n            resetFlow();\n        }\n    }, [isOpen]);\n\n    const resetFlow = () => {\n        setStep('SCAN');\n        setScannedSku('');\n        setSelectedProduct(null);\n        setLot('');\n        setExpiry('');\n        setQuantity('');\n        setNewProductData({});\n        if (activeTab === 'SCAN') {\n            setTimeout(() => scanInputRef.current?.focus(), 100);\n        }\n    };\n\n    const handleScan = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!scannedSku) return;\n\n        const product = inventory.find(p => p.sku === scannedSku);\n        if (product) {\n            setSelectedProduct(product);\n            setStep('DETAILS');\n            setTimeout(() => lotInputRef.current?.focus(), 100);\n            toast.success('Producto Identificado');\n        } else {\n            setNewProductData({ sku: scannedSku });\n            setStep('NEW_PRODUCT');\n            toast.info('Producto Nuevo Detectado');\n        }\n    };\n\n    const handleQuickSave = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!selectedProduct || !quantity) return;\n\n        // Parse Expiry (DDMMAA -> Timestamp)\n        let expiryTimestamp = Date.now();\n        if (expiry.length === 6) {\n            const day = parseInt(expiry.substring(0, 2));\n            const month = parseInt(expiry.substring(2, 4)) - 1;\n            const year = 2000 + parseInt(expiry.substring(4, 6));\n            expiryTimestamp = new Date(year, month, day).getTime();\n        }\n\n        // Update Stock (In a real app, this would create a batch entry)\n        updateStock(selectedProduct.id, parseInt(quantity));\n\n        toast.success(`Ingresadas ${quantity} un. de ${selectedProduct.name}`);\n        resetFlow();\n    };\n\n    const handleNewProductSave = (e: React.FormEvent) => {\n        e.preventDefault();\n        // Validate mandatory fields\n        if (!newProductData.name || !newProductData.dci || !newProductData.isp_register) {\n            toast.error('Faltan campos obligatorios');\n            return;\n        }\n\n        const newProduct: InventoryBatch = {\n            id: `BATCH-${Date.now()}`,\n            sku: scannedSku,\n            name: newProductData.name!,\n            dci: newProductData.dci!,\n            laboratory: newProductData.laboratory || 'GENERICO',\n            isp_register: newProductData.isp_register!,\n            format: newProductData.format || 'Comprimido',\n            units_per_box: Number(newProductData.units_per_package) || 1,\n            is_bioequivalent: newProductData.bioequivalent || false,\n\n            // Legacy / Aliases\n            active_ingredient: newProductData.dci!,\n            unit_format_string: newProductData.unit_format_string || 'Unidad',\n            units_per_package: Number(newProductData.units_per_package) || 1,\n            bioequivalent: newProductData.bioequivalent || false,\n            bioequivalent_status: newProductData.bioequivalent ? 'BIOEQUIVALENTE' : 'NO_BIOEQUIVALENTE',\n\n            price: Number(newProductData.price) || 0,\n            cost_price: Number(newProductData.cost_price) || 0,\n\n            // Advanced Financials\n            cost_net: Number(newProductData.cost_price) || 0,\n            tax_percent: 19,\n            price_sell_box: Number(newProductData.price) || 0,\n            price_sell_unit: Number(newProductData.price_sell_unit) || 0,\n\n            stock_actual: Number(quantity) || 0,\n            stock_min: 10,\n            stock_max: 100,\n            expiry_date: Date.now(), // Should parse expiry\n            location_id: 'BODEGA_CENTRAL',\n            condition: 'VD',\n            category: newProductData.category || 'MEDICAMENTO',\n            allows_commission: false,\n            active_ingredients: [newProductData.dci!],\n            is_generic: false,\n            concentration: newProductData.concentration || '',\n            unit_count: Number(newProductData.units_per_package) || 1,\n            aisle: newProductData.aisle || '' // Added Location/Aisle\n        };\n\n        addNewProduct(newProduct);\n        toast.success('Producto Creado e Ingresado');\n        resetFlow();\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden\">\n                {/* Header */}\n                <div className=\"bg-slate-900 p-6 flex justify-between items-center text-white\">\n                    <div className=\"flex items-center gap-3\">\n                        <Package className=\"text-cyan-400\" size={28} />\n                        <div>\n                            <h2 className=\"text-xl font-bold\">Ingreso Rápido de Stock</h2>\n                            <p className=\"text-slate-400 text-sm\">WMS Ágil - Bodega Central</p>\n                        </div>\n                    </div>\n                    <button onClick={onClose} className=\"text-slate-400 hover:text-white\"><X /></button>\n                </div>\n\n                {/* Tabs */}\n                <div className=\"flex border-b border-slate-100\">\n                    <button\n                        onClick={() => { setActiveTab('SCAN'); resetFlow(); }}\n                        className={`flex-1 py-4 font-bold text-sm transition-colors ${activeTab === 'SCAN' ? 'text-cyan-600 border-b-2 border-cyan-600 bg-cyan-50' : 'text-slate-500 hover:bg-slate-50'}`}\n                    >\n                        Escaneo Rápido (Stock)\n                    </button>\n                    <button\n                        onClick={() => { setActiveTab('CREATE'); setStep('NEW_PRODUCT'); }}\n                        className={`flex-1 py-4 font-bold text-sm transition-colors ${activeTab === 'CREATE' ? 'text-amber-600 border-b-2 border-amber-600 bg-amber-50' : 'text-slate-500 hover:bg-slate-50'}`}\n                    >\n                        Crear Producto Maestro\n                    </button>\n                </div>\n                {/* Content */}\n                <div className=\"p-6 max-h-[80vh] overflow-y-auto custom-scrollbar\">\n                    {step === 'SCAN' && (\n                        <div className=\"flex flex-col items-center justify-center py-12\">\n                            <div className=\"w-24 h-24 bg-cyan-50 rounded-full flex items-center justify-center mb-6 animate-pulse\">\n                                <ScanBarcode className=\"text-cyan-500\" size={48} />\n                            </div>\n                            <h3 className=\"text-2xl font-bold text-slate-800 mb-2\">Escanea un Producto</h3>\n                            <p className=\"text-slate-500 mb-8 text-center max-w-xs\">\n                                Escanea el código de barras o escribe el SKU para identificar o crear un producto.\n                            </p>\n\n                            <form onSubmit={handleScan} className=\"w-full max-w-md relative\">\n                                <input\n                                    ref={scanInputRef}\n                                    type=\"text\"\n                                    className=\"w-full pl-6 pr-12 py-4 text-xl font-mono bg-slate-50 border-2 border-slate-200 rounded-2xl focus:border-cyan-500 focus:outline-none transition-all text-center uppercase\"\n                                    placeholder=\"EAN / SKU...\"\n                                    value={scannedSku}\n                                    onChange={e => setScannedSku(e.target.value.toUpperCase())}\n                                />\n                                <button\n                                    type=\"submit\"\n                                    className=\"absolute right-3 top-1/2 -translate-y-1/2 p-2 bg-cyan-500 text-white rounded-xl hover:bg-cyan-600 transition\"\n                                >\n                                    <ScanBarcode size={20} />\n                                </button>\n                            </form>\n                        </div>\n                    )}\n\n                    {step === 'DETAILS' && selectedProduct && (\n                        <div className=\"space-y-6\">\n                            <div className=\"bg-cyan-50 p-4 rounded-2xl border border-cyan-100 flex gap-4 items-center\">\n                                <div className=\"w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-sm\">\n                                    <Package className=\"text-cyan-600\" />\n                                </div>\n                                <div>\n                                    <h3 className=\"font-bold text-slate-800 text-lg\">{selectedProduct.name}</h3>\n                                    <p className=\"text-slate-500 text-sm font-mono\">{selectedProduct.sku}</p>\n                                </div>\n                            </div>\n\n                            <form onSubmit={handleQuickSave} className=\"grid grid-cols-2 gap-4\">\n                                <div className=\"col-span-2\">\n                                    <label className=\"block text-sm font-bold text-slate-700 mb-1\">Cantidad a Ingresar</label>\n                                    <input\n                                        ref={qtyInputRef}\n                                        type=\"number\"\n                                        className=\"w-full p-4 text-2xl font-bold text-center border-2 border-slate-200 rounded-xl focus:border-cyan-500 outline-none\"\n                                        value={quantity}\n                                        onChange={e => setQuantity(e.target.value)}\n                                        placeholder=\"0\"\n                                        autoFocus\n                                    />\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">N° Lote (Opcional)</label>\n                                    <input\n                                        ref={lotInputRef}\n                                        type=\"text\"\n                                        className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                        value={lot}\n                                        onChange={e => setLot(e.target.value)}\n                                        placeholder=\"LOTE-001\"\n                                    />\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Vencimiento (DDMMAA)</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                        value={expiry}\n                                        onChange={e => setExpiry(e.target.value)}\n                                        placeholder=\"311225\"\n                                        maxLength={6}\n                                    />\n                                </div>\n\n                                <button\n                                    type=\"submit\"\n                                    className=\"col-span-2 py-4 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition flex items-center justify-center gap-2 mt-4\"\n                                >\n                                    <Save size={20} /> Confirmar Ingreso\n                                </button>\n                            </form>\n                        </div>\n                    )}\n\n                    {step === 'NEW_PRODUCT' && (\n                        <form onSubmit={handleNewProductSave} className=\"space-y-8\">\n                            {/* 1. Identificación & Ubicación */}\n                            <section>\n                                <h4 className=\"text-sm font-bold text-cyan-600 uppercase tracking-wider mb-4 border-b border-cyan-100 pb-2\">\n                                    1. Identificación y Ubicación\n                                </h4>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div className=\"col-span-2\">\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Nombre Comercial *</label>\n                                        <input\n                                            type=\"text\"\n                                            required\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-bold text-lg focus:border-cyan-500 outline-none\"\n                                            value={newProductData.name || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, name: e.target.value })}\n                                            placeholder=\"Ej: PARACETAMOL 500MG\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Categoría</label>\n                                        <input\n                                            list=\"categories\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl focus:border-cyan-500 outline-none\"\n                                            value={newProductData.category || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, category: e.target.value })}\n                                            placeholder=\"Seleccionar o Escribir...\"\n                                        />\n                                        <datalist id=\"categories\">\n                                            <option value=\"MEDICAMENTO\" />\n                                            <option value=\"INSUMO_MEDICO\" />\n                                            <option value=\"RETAIL_BELLEZA\" />\n                                            <option value=\"SUPLEMENTO\" />\n                                        </datalist>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Ubicación Física *</label>\n                                        <input\n                                            type=\"text\"\n                                            required\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl focus:border-cyan-500 outline-none\"\n                                            value={newProductData.aisle || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, aisle: e.target.value })}\n                                            placeholder=\"Ej: Estante A1 / Pasillo 3\"\n                                        />\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* 2. Datos Sanitarios */}\n                            <section>\n                                <h4 className=\"text-sm font-bold text-cyan-600 uppercase tracking-wider mb-4 border-b border-cyan-100 pb-2\">\n                                    2. Datos Sanitarios (Seremi)\n                                </h4>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div className=\"col-span-2\">\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Principio Activo (DCI) *</label>\n                                        <input\n                                            type=\"text\"\n                                            required\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl focus:border-cyan-500 outline-none\"\n                                            value={newProductData.dci || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, dci: e.target.value })}\n                                            placeholder=\"Ej: PARACETAMOL\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Laboratorio</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                            value={newProductData.laboratory || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, laboratory: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Registro ISP *</label>\n                                        <input\n                                            type=\"text\"\n                                            required\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                            value={newProductData.isp_register || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, isp_register: e.target.value })}\n                                        />\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* 3. Precios y Costos */}\n                            <section>\n                                <h4 className=\"text-sm font-bold text-cyan-600 uppercase tracking-wider mb-4 border-b border-cyan-100 pb-2\">\n                                    3. Estructura de Precios\n                                </h4>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Precio Venta (Caja)</label>\n                                        <div className=\"relative\">\n                                            <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\">$</span>\n                                            <input\n                                                type=\"number\"\n                                                className=\"w-full pl-6 p-3 border border-slate-200 rounded-xl font-bold text-lg\"\n                                                value={newProductData.price || ''}\n                                                onChange={e => {\n                                                    const price = parseInt(e.target.value) || 0;\n                                                    const units = newProductData.units_per_package || 1;\n                                                    setNewProductData({\n                                                        ...newProductData,\n                                                        price,\n                                                        price_sell_box: price,\n                                                        price_sell_unit: Math.round(price / units)\n                                                    });\n                                                }}\n                                            />\n                                        </div>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Unidades por Caja</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                            value={newProductData.units_per_package || ''}\n                                            onChange={e => {\n                                                const units = parseInt(e.target.value) || 1;\n                                                const price = newProductData.price || 0;\n                                                setNewProductData({\n                                                    ...newProductData,\n                                                    units_per_package: units,\n                                                    price_sell_unit: Math.round(price / units)\n                                                });\n                                            }}\n                                            placeholder=\"1\"\n                                        />\n                                    </div>\n                                    <div className=\"col-span-2\">\n                                        <div className=\"p-3 bg-slate-100 rounded-xl flex justify-between items-center\">\n                                            <span className=\"text-xs font-bold text-slate-500\">Costo Unitario Calculado:</span>\n                                            <span className=\"font-mono font-bold text-slate-700\">\n                                                ${(newProductData.price_sell_unit || 0).toLocaleString()} c/u\n                                            </span>\n                                        </div>\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* 4. Lote Inicial */}\n                            <section>\n                                <h4 className=\"text-sm font-bold text-cyan-600 uppercase tracking-wider mb-4 border-b border-cyan-100 pb-2\">\n                                    4. Lote Inicial (Opcional)\n                                </h4>\n                                <div className=\"grid grid-cols-3 gap-4\">\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">N° Lote</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                            value={lot}\n                                            onChange={e => setLot(e.target.value)}\n                                            placeholder=\"LOTE-001\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Vencimiento</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                            value={expiry}\n                                            onChange={e => setExpiry(e.target.value)}\n                                            placeholder=\"DDMMAA\"\n                                            maxLength={6}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Stock Inicial</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-bold\"\n                                            value={quantity}\n                                            onChange={e => setQuantity(e.target.value)}\n                                            placeholder=\"0\"\n                                        />\n                                    </div>\n                                </div>\n                            </section>\n\n                            <button\n                                type=\"submit\"\n                                className=\"w-full py-4 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition shadow-lg shadow-cyan-200 flex items-center justify-center gap-2\"\n                            >\n                                <Save size={20} /> Crear Producto Maestro\n                            </button>\n                        </form>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default StockEntryModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1083, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/StockTransferModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { ArrowRightLeft, MapPin, Box, Search } from 'lucide-react';\nimport { InventoryBatch } from '../../../domain/types';\n\ninterface StockTransferModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst StockTransferModal: React.FC<StockTransferModalProps> = ({ isOpen, onClose }) => {\n    const { inventory, transferStock } = usePharmaStore();\n    const [searchTerm, setSearchTerm] = useState('');\n    const [selectedProduct, setSelectedProduct] = useState<InventoryBatch | null>(null);\n    const [qty, setQty] = useState('');\n    const [targetLocation, setTargetLocation] = useState('SUCURSAL_CENTRO');\n\n    if (!isOpen) return null;\n\n    const filteredInventory = inventory.filter(i =>\n        i.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        i.sku.includes(searchTerm)\n    );\n\n    const handleTransfer = () => {\n        if (selectedProduct && qty) {\n            transferStock(selectedProduct.id, targetLocation as any, parseInt(qty));\n            onClose();\n            setSearchTerm('');\n            setSelectedProduct(null);\n            setQty('');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-slate-900 p-6 border-b border-slate-800 text-white\">\n                    <h3 className=\"text-xl font-bold flex items-center gap-2\">\n                        <ArrowRightLeft className=\"text-purple-400\" /> Transferencia de Stock\n                    </h3>\n                </div>\n\n                <div className=\"p-6 space-y-6\">\n                    {/* 1. Select Product */}\n                    {!selectedProduct ? (\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 mb-2 uppercase\">1. Buscar Producto (Origen)</label>\n                            <div className=\"relative mb-4\">\n                                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\n                                <input\n                                    type=\"text\"\n                                    autoFocus\n                                    placeholder=\"Nombre o SKU...\"\n                                    className=\"w-full pl-10 pr-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none\"\n                                    value={searchTerm}\n                                    onChange={(e) => setSearchTerm(e.target.value)}\n                                />\n                            </div>\n                            <div className=\"h-48 overflow-y-auto border border-slate-100 rounded-xl bg-slate-50 p-2 space-y-2\">\n                                {filteredInventory.map(item => (\n                                    <div\n                                        key={item.id}\n                                        onClick={() => setSelectedProduct(item)}\n                                        className=\"p-3 bg-white rounded-lg border border-slate-200 hover:border-purple-400 cursor-pointer transition flex justify-between items-center\"\n                                    >\n                                        <div>\n                                            <p className=\"font-bold text-sm text-slate-800\">{item.name}</p>\n                                            <p className=\"text-xs text-slate-500\">{item.location_id}</p>\n                                        </div>\n                                        <span className=\"bg-slate-100 text-slate-600 px-2 py-1 rounded text-xs font-bold\">Stock: {item.stock_actual}</span>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"bg-purple-50 border border-purple-100 rounded-xl p-4 flex justify-between items-center\">\n                            <div>\n                                <h4 className=\"font-bold text-purple-900\">{selectedProduct.name}</h4>\n                                <p className=\"text-xs text-purple-700\">Origen: {selectedProduct.location_id}</p>\n                            </div>\n                            <button onClick={() => setSelectedProduct(null)} className=\"text-xs font-bold text-purple-500 hover:text-purple-700\">CAMBIAR</button>\n                        </div>\n                    )}\n\n                    {/* 2. Transfer Details */}\n                    {selectedProduct && (\n                        <div className=\"grid grid-cols-2 gap-4 animate-in fade-in slide-in-from-bottom-2\">\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Destino</label>\n                                <div className=\"relative\">\n                                    <MapPin className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n                                    <select\n                                        className=\"w-full pl-9 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none appearance-none bg-white\"\n                                        value={targetLocation}\n                                        onChange={(e) => setTargetLocation(e.target.value)}\n                                    >\n                                        <option value=\"SUCURSAL_CENTRO\">Sucursal Centro</option>\n                                        <option value=\"SUCURSAL_NORTE\">Sucursal Norte</option>\n                                        <option value=\"BODEGA_CENTRAL\">Bodega Central</option>\n                                        <option value=\"KIOSCO\">Kiosco</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Cantidad</label>\n                                <div className=\"relative\">\n                                    <Box className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n                                    <input\n                                        type=\"number\"\n                                        className=\"w-full pl-9 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none\"\n                                        max={selectedProduct.stock_actual}\n                                        value={qty}\n                                        onChange={(e) => setQty(e.target.value)}\n                                    />\n                                </div>\n                                <p className=\"text-[10px] text-right text-slate-400 mt-1\">Máx: {selectedProduct.stock_actual}</p>\n                            </div>\n                        </div>\n                    )}\n\n                    <div className=\"flex gap-3 pt-4\">\n                        <button onClick={onClose} className=\"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl transition\">Cancelar</button>\n                        <button\n                            onClick={handleTransfer}\n                            disabled={!selectedProduct || !qty || parseInt(qty) > (selectedProduct?.stock_actual || 0)}\n                            className=\"flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition shadow-lg shadow-purple-200 disabled:opacity-50\"\n                        >\n                            Transferir\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default StockTransferModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1492, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/InventoryEditModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { X, Save, Thermometer, AlertTriangle, Tag, Package, DollarSign, Activity, Barcode, Syringe, Calendar, Trash2, Plus, Edit2 } from 'lucide-react';\nimport { InventoryBatch } from '../../../domain/types';\nimport { usePharmaStore } from '../../store/useStore';\nimport { toast } from 'sonner';\n\ninterface InventoryEditModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    product: InventoryBatch | null;\n}\n\nconst InventoryEditModal: React.FC<InventoryEditModalProps> = ({ isOpen, onClose, product }) => {\n    const { updateProduct, inventory, updateBatchDetails, addNewProduct } = usePharmaStore();\n    const [formData, setFormData] = useState<Partial<InventoryBatch>>({});\n    const [activeBatches, setActiveBatches] = useState<InventoryBatch[]>([]);\n    const [newTag, setNewTag] = useState('');\n\n    useEffect(() => {\n        if (product) {\n            setFormData({\n                ...product,\n                contraindications: product.contraindications || [],\n                therapeutic_tags: product.therapeutic_tags || []\n            });\n            // Filter batches for this product (assuming SKU is the grouper)\n            setActiveBatches(inventory.filter(i => i.sku === product.sku && i.stock_actual > 0));\n        }\n    }, [product, inventory]);\n\n    if (!isOpen || !product) return null;\n\n    const handleSave = () => {\n        if (product.id) {\n            // Update the main product (and potentially all batches if we want to sync shared data)\n            // For now, we update the specific batch passed as \"product\"\n            updateProduct(product.id, formData);\n\n            // In a real \"Master Product\" scenario, we might want to update ALL batches with shared data\n            // inventory.filter(i => i.sku === product.sku).forEach(b => updateProduct(b.id, formData));\n\n            toast.success('Producto actualizado correctamente');\n            onClose();\n        }\n    };\n\n    const handleBatchUpdate = (batchId: string, field: keyof InventoryBatch, value: any) => {\n        updateBatchDetails(product.id, batchId, { [field]: value });\n        toast.success('Lote actualizado');\n    };\n\n    const handleAddBatch = () => {\n        const newBatch: InventoryBatch = {\n            ...product,\n            id: `NEW-${Date.now()}`, // Temporary ID\n            stock_actual: 0,\n            expiry_date: Date.now() + 31536000000, // +1 year\n            location_id: 'BODEGA_CENTRAL',\n            aisle: '',\n            cost_net: 0,\n            tax_percent: 19,\n            price_sell_box: 0,\n            price_sell_unit: 0,\n            price: 0,\n            cost_price: 0\n        };\n        addNewProduct(newBatch); // Using addNewProduct as \"addBatch\" effectively\n        toast.success('Nuevo lote creado');\n    };\n\n    const handleMermarBatch = (batchId: string) => {\n        if (confirm('¿Estás seguro de dar de baja este lote? El stock quedará en 0.')) {\n            updateBatchDetails(product.id, batchId, { stock_actual: 0 });\n            toast.success('Lote dado de baja');\n        }\n    };\n\n    const handleAddTag = (e: React.KeyboardEvent) => {\n        if (e.key === 'Enter' && newTag.trim()) {\n            e.preventDefault();\n            const currentTags = formData.therapeutic_tags || [];\n            if (!currentTags.includes(newTag.trim().toUpperCase())) {\n                setFormData({\n                    ...formData,\n                    therapeutic_tags: [...currentTags, newTag.trim().toUpperCase()]\n                });\n            }\n            setNewTag('');\n        }\n    };\n\n    const removeTag = (tagToRemove: string) => {\n        setFormData({\n            ...formData,\n            therapeutic_tags: (formData.therapeutic_tags || []).filter(tag => tag !== tagToRemove)\n        });\n    };\n\n    const toggleContraindication = (ci: string) => {\n        const current = formData.contraindications || [];\n        if (current.includes(ci)) {\n            setFormData({ ...formData, contraindications: current.filter(c => c !== ci) });\n        } else {\n            setFormData({ ...formData, contraindications: [...current, ci] });\n        }\n    };\n\n    // SEREMI Calculation\n    const pricePerUnit = formData.price && formData.units_per_package\n        ? Math.round(formData.price / formData.units_per_package)\n        : 0;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-5xl h-[90vh] flex flex-col animate-in fade-in zoom-in duration-200\">\n                {/* Header */}\n                <div className=\"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 rounded-t-3xl\">\n                    <div>\n                        <h2 className=\"text-2xl font-bold text-slate-800 flex items-center gap-2\">\n                            <Package className=\"text-cyan-600\" />\n                            Gestor Maestro de Producto\n                        </h2>\n                        <p className=\"text-slate-500 text-sm\">{product.name} ({product.sku})</p>\n                    </div>\n                    <div className=\"flex gap-2\">\n                        <button\n                            onClick={handleSave}\n                            className=\"px-6 py-2 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition flex items-center gap-2 shadow-lg shadow-cyan-200\"\n                        >\n                            <Save size={18} /> Guardar Cambios\n                        </button>\n                        <button onClick={onClose} className=\"p-2 hover:bg-slate-200 rounded-full transition-colors\">\n                            <X size={24} className=\"text-slate-400\" />\n                        </button>\n                    </div>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-y-auto p-8 bg-slate-50/30\">\n                    <div className=\"grid grid-cols-12 gap-8\">\n\n                        {/* Left Column: Master Data */}\n                        <div className=\"col-span-12 lg:col-span-7 space-y-6\">\n\n                            {/* 1. IDENTIFICACIÓN RÁPIDA (NEW) */}\n                            <section className=\"bg-white p-6 rounded-2xl shadow-sm border border-slate-100\">\n                                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <Tag size={16} /> Identificación Rápida\n                                </h3>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Código de Barras (EAN)</label>\n                                        <div className=\"relative\">\n                                            <Barcode className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\n                                            <input\n                                                type=\"text\"\n                                                className=\"w-full pl-10 p-3 border border-slate-200 rounded-xl font-mono text-slate-700 focus:border-cyan-500 focus:outline-none bg-slate-50\"\n                                                value={formData.barcode || ''}\n                                                onChange={e => setFormData({ ...formData, barcode: e.target.value })}\n                                                placeholder=\"Escanea aquí...\"\n                                            />\n                                        </div>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Vía de Administración</label>\n                                        <div className=\"relative\">\n                                            <Syringe className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\n                                            <select\n                                                className=\"w-full pl-10 p-3 border border-slate-200 rounded-xl font-bold text-slate-700 focus:border-cyan-500 focus:outline-none appearance-none bg-white\"\n                                                value={formData.administration_route || ''}\n                                                onChange={e => setFormData({ ...formData, administration_route: e.target.value as any })}\n                                            >\n                                                <option value=\"\">Seleccionar...</option>\n                                                <option value=\"ORAL\">Oral</option>\n                                                <option value=\"TOPICA\">Tópica</option>\n                                                <option value=\"OFTALMICA\">Oftálmica</option>\n                                                <option value=\"NASAL\">Nasal</option>\n                                                <option value=\"RECTAL\">Rectal</option>\n                                                <option value=\"VAGINAL\">Vaginal</option>\n                                                <option value=\"PARENTERAL\">Parenteral (Inyectable)</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* 2. DATOS SANITARIOS (SEREMI) */}\n                            <section className=\"bg-amber-50 p-6 rounded-2xl border border-amber-100 shadow-sm\">\n                                <h3 className=\"text-sm font-bold text-amber-700 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <AlertTriangle size={16} /> Datos Sanitarios (Norma Seremi)\n                                </h3>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div className=\"col-span-2\">\n                                        <label className=\"block text-xs font-bold text-amber-800/60 mb-1\">Principio Activo (DCI)</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-amber-200 rounded-xl font-bold text-slate-700 focus:border-amber-500 focus:outline-none bg-white\"\n                                            value={formData.dci || ''}\n                                            onChange={e => setFormData({ ...formData, dci: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-amber-800/60 mb-1\">Laboratorio</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-amber-200 rounded-xl font-bold bg-white\"\n                                            value={formData.laboratory || ''}\n                                            onChange={e => setFormData({ ...formData, laboratory: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-amber-800/60 mb-1\">Registro ISP</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-amber-200 rounded-xl font-mono text-sm bg-white\"\n                                            value={formData.isp_register || ''}\n                                            onChange={e => setFormData({ ...formData, isp_register: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-amber-800/60 mb-1\">Unidades por Caja</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-amber-200 rounded-xl font-mono bg-white\"\n                                            value={formData.units_per_package || 1}\n                                            onChange={e => setFormData({ ...formData, units_per_package: parseInt(e.target.value) })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-amber-800/60 mb-1\">Precio Unitario Calc.</label>\n                                        <div className=\"w-full p-3 bg-amber-100/50 border border-amber-200 rounded-xl font-mono font-bold text-amber-800\">\n                                            ${pricePerUnit}\n                                        </div>\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* 3. DATOS COMERCIALES */}\n                            <section className=\"bg-white p-6 rounded-2xl shadow-sm border border-slate-100\">\n                                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <DollarSign size={16} /> Datos Comerciales\n                                </h3>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div className=\"col-span-2\">\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Nombre Comercial</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-bold text-slate-700 focus:border-cyan-500 focus:outline-none\"\n                                            value={formData.name || ''}\n                                            onChange={e => setFormData({ ...formData, name: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Precio Venta</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                            value={formData.price || 0}\n                                            onChange={e => setFormData({ ...formData, price: Number(e.target.value) })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Costo Neto</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                            value={formData.cost_price || 0}\n                                            onChange={e => setFormData({ ...formData, cost_price: Number(e.target.value) })}\n                                        />\n                                    </div>\n                                </div>\n                            </section>\n                        </div>\n\n                        {/* Right Column: Batch Management & Tags */}\n                        <div className=\"col-span-12 lg:col-span-5 space-y-6\">\n\n                            {/* 4. GESTIÓN DE LOTES (CRITICAL) */}\n                            <section className=\"bg-blue-50 p-6 rounded-2xl shadow-sm border border-blue-100\">\n                                <div className=\"flex justify-between items-center mb-6\">\n                                    <h3 className=\"text-sm font-bold text-blue-800 uppercase tracking-wider flex items-center gap-2\">\n                                        <Package size={16} className=\"text-blue-600\" /> Existencias Físicas (Lotes)\n                                    </h3>\n                                    <button\n                                        onClick={handleAddBatch}\n                                        className=\"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold rounded-lg transition flex items-center gap-1 shadow-sm\"\n                                    >\n                                        <Plus size={14} /> Nuevo Lote\n                                    </button>\n                                </div>\n\n                                <div className=\"space-y-3 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar\">\n                                    {activeBatches.map(batch => (\n                                        <div key={batch.id} className=\"bg-white p-4 rounded-xl border border-blue-200 shadow-sm hover:border-blue-300 transition-colors\">\n                                            <div className=\"flex justify-between items-start mb-3\">\n                                                <div className=\"flex-1\">\n                                                    <label className=\"text-[10px] font-bold text-slate-400 uppercase\">N° Lote</label>\n                                                    <input\n                                                        type=\"text\"\n                                                        value={batch.id} // Usually Batch Number is separate, but using ID for now\n                                                        readOnly\n                                                        className=\"block w-full text-sm font-bold text-slate-700 bg-transparent outline-none\"\n                                                    />\n                                                </div>\n                                                <button\n                                                    onClick={() => handleMermarBatch(batch.id)}\n                                                    className=\"text-slate-300 hover:text-red-500 transition-colors\"\n                                                    title=\"Dar de baja\"\n                                                >\n                                                    <Trash2 size={16} />\n                                                </button>\n                                            </div>\n\n                                            <div className=\"grid grid-cols-2 gap-3 mb-3\">\n                                                <div>\n                                                    <label className=\"flex items-center gap-1 text-[10px] font-bold text-slate-400 uppercase mb-1\">\n                                                        <Calendar size={10} /> Vencimiento\n                                                    </label>\n                                                    <input\n                                                        type=\"date\"\n                                                        value={new Date(batch.expiry_date).toISOString().split('T')[0]}\n                                                        onChange={e => handleBatchUpdate(batch.id, 'expiry_date', new Date(e.target.value).getTime())}\n                                                        className=\"w-full p-2 bg-slate-50 border border-slate-100 rounded-lg text-xs font-bold text-slate-600\"\n                                                    />\n                                                </div>\n                                                <div>\n                                                    <label className=\"flex items-center gap-1 text-[10px] font-bold text-slate-400 uppercase mb-1\">\n                                                        <Package size={10} /> Stock\n                                                    </label>\n                                                    <input\n                                                        type=\"number\"\n                                                        value={batch.stock_actual}\n                                                        onChange={e => handleBatchUpdate(batch.id, 'stock_actual', parseInt(e.target.value))}\n                                                        className=\"w-full p-2 bg-slate-50 border border-slate-100 rounded-lg text-xs font-bold text-slate-600\"\n                                                    />\n                                                </div>\n                                            </div>\n\n                                            <div>\n                                                <label className=\"text-[10px] font-bold text-slate-400 uppercase mb-1 block\">Ubicación</label>\n                                                <input\n                                                    type=\"text\"\n                                                    value={batch.aisle || ''}\n                                                    onChange={e => handleBatchUpdate(batch.id, 'aisle', e.target.value)}\n                                                    placeholder=\"Ej: Estante A1\"\n                                                    className=\"w-full p-2 bg-slate-50 border border-slate-100 rounded-lg text-xs text-slate-600\"\n                                                />\n                                            </div>\n                                        </div>\n                                    ))}\n\n                                    {activeBatches.length === 0 && (\n                                        <div className=\"text-center py-8 text-slate-400 text-sm italic\">\n                                            No hay lotes activos para este producto.\n                                        </div>\n                                    )}\n                                </div>\n                            </section>\n\n                            {/* Tags */}\n                            <section className=\"bg-white p-6 rounded-2xl shadow-sm border border-slate-100\">\n                                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <Activity size={16} /> Etiquetas Terapéuticas\n                                </h3>\n                                <div className=\"flex flex-wrap gap-2 mb-3\">\n                                    {formData.therapeutic_tags?.map(tag => (\n                                        <span key={tag} className=\"px-3 py-1 bg-cyan-50 text-cyan-700 rounded-full text-xs font-bold flex items-center gap-1\">\n                                            {tag}\n                                            <button onClick={() => removeTag(tag)} className=\"hover:text-cyan-900\"><X size={12} /></button>\n                                        </span>\n                                    ))}\n                                </div>\n                                <input\n                                    type=\"text\"\n                                    className=\"w-full p-3 border border-slate-200 rounded-xl text-sm\"\n                                    placeholder=\"Escribe y presiona Enter...\"\n                                    value={newTag}\n                                    onChange={e => setNewTag(e.target.value)}\n                                    onKeyDown={handleAddTag}\n                                />\n                            </section>\n\n                            <section className=\"bg-red-50 p-6 rounded-2xl border border-red-100\">\n                                <h3 className=\"text-sm font-bold text-red-400 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <AlertTriangle size={16} /> Contraindicaciones\n                                </h3>\n                                <div className=\"space-y-2\">\n                                    {['EMBARAZO', 'LACTANCIA', 'HIPERTENSION', 'DIABETES', 'ULCERA'].map(ci => (\n                                        <label key={ci} className=\"flex items-center gap-2 cursor-pointer hover:bg-red-100/50 p-2 rounded-lg transition\">\n                                            <input\n                                                type=\"checkbox\"\n                                                className=\"w-4 h-4 text-red-500 rounded focus:ring-red-400\"\n                                                checked={formData.contraindications?.includes(ci) || false}\n                                                onChange={() => toggleContraindication(ci)}\n                                            />\n                                            <span className=\"text-sm font-bold text-red-800\">{ci}</span>\n                                        </label>\n                                    ))}\n                                </div>\n                            </section>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default InventoryEditModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2653, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/BulkImportModal.tsx"],"sourcesContent":["import React, { useState, useCallback } from 'react';\nimport { X, Upload, FileSpreadsheet, AlertTriangle, CheckCircle, Download, Loader2, FileType, Edit2, Save } from 'lucide-react';\nimport { useDropzone } from 'react-dropzone';\nimport * as XLSX from 'xlsx';\nimport { toast } from 'sonner';\nimport { usePharmaStore } from '../../store/useStore';\nimport { InventoryBatch } from '../../../domain/types';\nimport { v4 as uuidv4 } from 'uuid';\n\ninterface BulkImportModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\ninterface ImportedRow {\n    id: string; // Internal ID for editing\n    sku: string;\n    name: string;\n    dci?: string;\n    laboratory?: string;\n    price_sell: number;\n    cost_net: number;\n    stock: number;\n    lot_number: string;\n    expiry_date: string; // DD/MM/YYYY\n    location?: string;\n    is_refrigerated?: string; // SI/NO\n    isValid: boolean;\n    errors: string[];\n    needs_review?: boolean;\n}\n\ntype ImportFormat = 'OFFICIAL' | 'LEGACY';\n\nconst BulkImportModal: React.FC<BulkImportModalProps> = ({ isOpen, onClose }) => {\n    const { importInventory } = usePharmaStore();\n    const [step, setStep] = useState<'UPLOAD' | 'PREVIEW'>('UPLOAD');\n    const [importedData, setImportedData] = useState<ImportedRow[]>([]);\n    const [isProcessing, setIsProcessing] = useState(false);\n    const [importFormat, setImportFormat] = useState<ImportFormat>('OFFICIAL');\n\n    // --- Parsing Logic ---\n\n    const parseOfficialRow = (row: any[]): ImportedRow => {\n        const errors: string[] = [];\n        const sku = row[0]?.toString() || '';\n        const name = row[1]?.toString() || '';\n        const price_sell = parseFloat(row[4]) || 0;\n\n        if (!sku) errors.push('Falta SKU');\n        if (!name) errors.push('Falta Nombre');\n        if (price_sell <= 0) errors.push('Precio inválido');\n\n        return {\n            id: uuidv4(),\n            sku,\n            name,\n            dci: row[2]?.toString(),\n            laboratory: row[3]?.toString(),\n            price_sell,\n            cost_net: parseFloat(row[5]) || 0,\n            stock: parseInt(row[6]) || 0,\n            lot_number: row[7]?.toString() || 'S/L',\n            expiry_date: row[8]?.toString() || '',\n            location: row[9]?.toString(),\n            is_refrigerated: row[10]?.toString(),\n            isValid: errors.length === 0,\n            errors,\n            needs_review: false\n        };\n    };\n\n    const parseLegacyRow = (row: any[]): ImportedRow => {\n        const errors: string[] = [];\n        // Legacy Format Mapping (Hypothetical based on requirements)\n        // Col 0: Barcode (SKU)\n        // Col 1: Product Name (Complex String)\n        // Col 2: Stock\n        // Col 3: Price Sell\n        // Col 4: Cost Net\n        // Col 5: Category/Location (Optional)\n\n        const sku = row[0]?.toString() || '';\n        const rawName = row[1]?.toString() || '';\n        const stock = parseInt(row[2]) || 0;\n        const price_sell = parseFloat(row[3]) || 0;\n        const cost_net = parseFloat(row[4]) || 0;\n        const location = row[5]?.toString() || 'BODEGA_CENTRAL';\n\n        if (!sku) errors.push('Falta SKU');\n        if (!rawName) errors.push('Falta Nombre');\n\n        // Intelligent Parsing: \"AMOXICILINA 500MG LAB CHILE\" -> Name + Lab\n        let name = rawName;\n        let laboratory = 'GENERICO';\n\n        // Regex to find \"LAB\" or \"LABORATORIO\" and split\n        const labRegex = /(.*)\\s+(?:LAB|LABORATORIO)\\.?\\s+(.*)/i;\n        const match = rawName.match(labRegex);\n\n        if (match) {\n            name = match[1].trim();\n            laboratory = match[2].trim();\n        }\n\n        // Defaults for missing data\n        const lot_number = 'LOTE-MIGRACION';\n\n        // Default Expiry: 1 Year from now\n        const nextYear = new Date();\n        nextYear.setFullYear(nextYear.getFullYear() + 1);\n        const expiry_date = nextYear.toLocaleDateString('es-CL'); // DD/MM/YYYY\n\n        return {\n            id: uuidv4(),\n            sku,\n            name,\n            dci: name, // Guess DCI is same as name for legacy\n            laboratory,\n            price_sell,\n            cost_net,\n            stock,\n            lot_number,\n            expiry_date,\n            location,\n            is_refrigerated: 'NO',\n            isValid: errors.length === 0,\n            errors,\n            needs_review: true // Always flag legacy for review\n        };\n    };\n\n    const onDrop = useCallback((acceptedFiles: File[]) => {\n        const file = acceptedFiles[0];\n        if (!file) return;\n\n        setIsProcessing(true);\n        const reader = new FileReader();\n\n        reader.onload = (e) => {\n            try {\n                const data = new Uint8Array(e.target?.result as ArrayBuffer);\n                const workbook = XLSX.read(data, { type: 'array' });\n                const sheetName = workbook.SheetNames[0];\n                const worksheet = workbook.Sheets[sheetName];\n                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });\n\n                // Skip header row\n                const rows = jsonData.slice(1) as any[][];\n\n                const parsedRows: ImportedRow[] = rows.map((row) => {\n                    return importFormat === 'OFFICIAL'\n                        ? parseOfficialRow(row)\n                        : parseLegacyRow(row);\n                }).filter(r => r.sku || r.name);\n\n                setImportedData(parsedRows);\n                setStep('PREVIEW');\n\n                if (importFormat === 'LEGACY') {\n                    toast.info(`Se detectaron ${parsedRows.length} productos. Se asignaron valores por defecto para revisión.`);\n                }\n            } catch (error) {\n                console.error(error);\n                toast.error('Error al procesar el archivo Excel');\n            } finally {\n                setIsProcessing(false);\n            }\n        };\n\n        reader.readAsArrayBuffer(file);\n    }, [importFormat]);\n\n    const { getRootProps, getInputProps, isDragActive } = useDropzone({\n        onDrop,\n        accept: {\n            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'],\n            'application/vnd.ms-excel': ['.xls'],\n            'text/csv': ['.csv']\n        },\n        maxFiles: 1\n    });\n\n    const handleDownloadTemplate = () => {\n        const headers = [\n            'SKU', 'Nombre', 'DCI', 'Laboratorio', 'Precio Venta', 'Costo Neto', 'Stock', 'Lote', 'Vencimiento (DD/MM/AAAA)', 'Ubicación', 'Es Refrigerado (SI/NO)'\n        ];\n        const example = [\n            '780001', 'Paracetamol 500mg', 'Paracetamol', 'Mintlab', 1990, 500, 100, 'L-2024', '31/12/2025', 'ESTANTE-A', 'NO'\n        ];\n\n        const ws = XLSX.utils.aoa_to_sheet([headers, example]);\n        const wb = XLSX.utils.book_new();\n        XLSX.utils.book_append_sheet(wb, ws, 'Plantilla');\n        XLSX.writeFile(wb, 'Formato_Vallenar.xlsx');\n    };\n\n    const handleUpdateRow = (id: string, field: keyof ImportedRow, value: any) => {\n        setImportedData(prev => prev.map(row => {\n            if (row.id === id) {\n                return { ...row, [field]: value };\n            }\n            return row;\n        }));\n    };\n\n    const handleImport = async () => {\n        setIsProcessing(true);\n        try {\n            const validRows = importedData.filter(r => r.isValid);\n\n            if (validRows.length === 0) {\n                toast.error('No hay datos válidos para importar');\n                return;\n            }\n\n            const itemsToImport = validRows.map(row => {\n                // Parse date DD/MM/YYYY to timestamp\n                let expiry = Date.now() + 31536000000; // Default 1 year\n                if (row.expiry_date) {\n                    // Handle different date formats if needed, but assuming DD/MM/YYYY from parser\n                    const parts = row.expiry_date.split('/');\n                    if (parts.length === 3) {\n                        expiry = new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0])).getTime();\n                    } else if (row.expiry_date.includes('-')) {\n                        const parts = row.expiry_date.split('-');\n                        if (parts.length === 3) {\n                            // Try YYYY-MM-DD\n                            expiry = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2])).getTime();\n                        }\n                    }\n                }\n\n                return {\n                    id: uuidv4(),\n                    sku: row.sku,\n                    name: row.name,\n                    dci: row.dci || row.name,\n                    laboratory: row.laboratory || 'GENERICO',\n                    price_sell: row.price_sell,\n                    cost_net: row.cost_net,\n                    stock_actual: row.stock,\n                    lot_number: row.lot_number,\n                    expiry_date: expiry,\n                    location_id: row.location || 'BODEGA_CENTRAL',\n                    is_refrigerated: row.is_refrigerated?.toUpperCase() === 'SI',\n                    status: 'AVAILABLE',\n                    // Default values for required fields in InventoryBatch\n                    isp_register: 'PENDIENTE',\n                    format: 'UNIDAD',\n                    units_per_box: 1,\n                    is_bioequivalent: false,\n                    condition: 'VD',\n                    category: 'MEDICAMENTO'\n                } as any;\n            });\n\n            await importInventory(itemsToImport);\n            toast.success(`${itemsToImport.length} productos importados exitosamente`);\n            onClose();\n            setStep('UPLOAD');\n            setImportedData([]);\n        } catch (error) {\n            console.error(error);\n            toast.error('Error al guardar en la base de datos');\n        } finally {\n            setIsProcessing(false);\n        }\n    };\n\n    if (!isOpen) return null;\n\n    const validCount = importedData.filter(r => r.isValid).length;\n    const errorCount = importedData.length - validCount;\n    const reviewCount = importedData.filter(r => r.needs_review).length;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col\">\n                {/* Header */}\n                <div className=\"p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50 rounded-t-2xl\">\n                    <div>\n                        <h2 className=\"text-xl font-bold text-gray-800 flex items-center gap-2\">\n                            <FileSpreadsheet className=\"text-green-600\" />\n                            Importación Masiva Inteligente\n                        </h2>\n                        <p className=\"text-sm text-gray-500\">Carga de inventario desde Excel (Oficial o Legacy)</p>\n                    </div>\n                    <button onClick={onClose} className=\"p-2 hover:bg-gray-200 rounded-full transition-colors\">\n                        <X size={20} className=\"text-gray-500\" />\n                    </button>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-hidden p-8\">\n                    {step === 'UPLOAD' ? (\n                        <div className=\"h-full flex flex-col items-center justify-center gap-8\">\n\n                            {/* Format Selector */}\n                            <div className=\"bg-gray-50 p-1 rounded-xl flex gap-1 border border-gray-200\">\n                                <button\n                                    onClick={() => setImportFormat('OFFICIAL')}\n                                    className={`px-6 py-3 rounded-lg font-bold text-sm transition-all flex items-center gap-2 ${importFormat === 'OFFICIAL'\n                                            ? 'bg-white text-green-600 shadow-sm'\n                                            : 'text-gray-500 hover:text-gray-700'\n                                        }`}\n                                >\n                                    <FileSpreadsheet size={18} />\n                                    Plantilla Oficial Vallenar\n                                </button>\n                                <button\n                                    onClick={() => setImportFormat('LEGACY')}\n                                    className={`px-6 py-3 rounded-lg font-bold text-sm transition-all flex items-center gap-2 ${importFormat === 'LEGACY'\n                                            ? 'bg-white text-orange-600 shadow-sm'\n                                            : 'text-gray-500 hover:text-gray-700'\n                                        }`}\n                                >\n                                    <FileType size={18} />\n                                    Formato Histórico / Legacy\n                                </button>\n                            </div>\n\n                            <div className=\"text-center max-w-md\">\n                                {importFormat === 'OFFICIAL' ? (\n                                    <>\n                                        <div className=\"bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-green-600\">\n                                            <Upload size={32} />\n                                        </div>\n                                        <h3 className=\"text-xl font-bold text-gray-800 mb-2\">Sube tu plantilla oficial</h3>\n                                        <p className=\"text-gray-500 mb-6\">\n                                            Estructura estricta. Ideal para cargas limpias y validadas.\n                                        </p>\n                                        <button\n                                            onClick={handleDownloadTemplate}\n                                            className=\"px-6 py-3 bg-white border-2 border-green-500 text-green-600 font-bold rounded-xl hover:bg-green-50 transition-colors flex items-center gap-2 mx-auto\"\n                                        >\n                                            <Download size={20} />\n                                            Descargar Plantilla\n                                        </button>\n                                    </>\n                                ) : (\n                                    <>\n                                        <div className=\"bg-orange-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-orange-600\">\n                                            <FileType size={32} />\n                                        </div>\n                                        <h3 className=\"text-xl font-bold text-gray-800 mb-2\">Importador Inteligente Legacy</h3>\n                                        <p className=\"text-gray-500 mb-6\">\n                                            Sube tu Excel antiguo. El sistema intentará separar Nombre/Laboratorio y rellenará datos faltantes (Lotes, Fechas) para revisión.\n                                        </p>\n                                        <div className=\"text-xs text-left bg-orange-50 p-4 rounded-lg border border-orange-100 text-orange-800\">\n                                            <strong>Columnas esperadas (sin encabezado):</strong>\n                                            <ul className=\"list-disc pl-4 mt-1 space-y-1\">\n                                                <li>Col A: Código Barras (SKU)</li>\n                                                <li>Col B: Nombre Completo (ej: \"AMOXICILINA LAB CHILE\")</li>\n                                                <li>Col C: Stock</li>\n                                                <li>Col D: Precio Venta</li>\n                                                <li>Col E: Costo Neto</li>\n                                            </ul>\n                                        </div>\n                                    </>\n                                )}\n                            </div>\n\n                            <div className=\"w-full max-w-2xl\">\n                                <div\n                                    {...getRootProps()}\n                                    className={`border-3 border-dashed rounded-2xl p-12 text-center cursor-pointer transition-all ${isDragActive\n                                        ? 'border-green-500 bg-green-50'\n                                        : 'border-gray-300 hover:border-green-400 hover:bg-gray-50'\n                                        }`}\n                                >\n                                    <input {...getInputProps()} />\n                                    {isProcessing ? (\n                                        <div className=\"flex flex-col items-center gap-3 text-gray-500\">\n                                            <Loader2 className=\"animate-spin\" size={32} />\n                                            <p>Procesando e interpretando datos...</p>\n                                        </div>\n                                    ) : (\n                                        <>\n                                            <p className=\"font-bold text-gray-700 text-lg mb-2\">\n                                                Arrastra y suelta tu archivo aquí\n                                            </p>\n                                            <p className=\"text-gray-400 text-sm\">Soporta .xlsx, .xls, .csv</p>\n                                        </>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"h-full flex flex-col\">\n                            <div className=\"flex gap-4 mb-6\">\n                                <div className=\"flex-1 bg-green-50 border border-green-200 rounded-xl p-4 flex items-center gap-3\">\n                                    <CheckCircle className=\"text-green-600\" size={24} />\n                                    <div>\n                                        <p className=\"text-sm text-green-800 font-bold\">Listos para Importar</p>\n                                        <p className=\"text-2xl font-bold text-green-700\">{validCount}</p>\n                                    </div>\n                                </div>\n                                {reviewCount > 0 && (\n                                    <div className=\"flex-1 bg-orange-50 border border-orange-200 rounded-xl p-4 flex items-center gap-3\">\n                                        <Edit2 className=\"text-orange-600\" size={24} />\n                                        <div>\n                                            <p className=\"text-sm text-orange-800 font-bold\">Requieren Revisión</p>\n                                            <p className=\"text-2xl font-bold text-orange-700\">{reviewCount}</p>\n                                        </div>\n                                    </div>\n                                )}\n                                <div className=\"flex-1 bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3\">\n                                    <AlertTriangle className=\"text-red-600\" size={24} />\n                                    <div>\n                                        <p className=\"text-sm text-red-800 font-bold\">Errores Bloqueantes</p>\n                                        <p className=\"text-2xl font-bold text-red-700\">{errorCount}</p>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div className=\"flex-1 overflow-auto border border-gray-200 rounded-xl shadow-inner bg-gray-50\">\n                                <table className=\"w-full text-sm text-left border-collapse\">\n                                    <thead className=\"bg-white text-gray-700 font-bold sticky top-0 shadow-sm z-10\">\n                                        <tr>\n                                            <th className=\"p-3 border-b\">Estado</th>\n                                            <th className=\"p-3 border-b\">SKU</th>\n                                            <th className=\"p-3 border-b\">Nombre Producto</th>\n                                            <th className=\"p-3 border-b\">Laboratorio</th>\n                                            <th className=\"p-3 border-b\">Precio</th>\n                                            <th className=\"p-3 border-b\">Stock</th>\n                                            <th className=\"p-3 border-b w-32\">Lote</th>\n                                            <th className=\"p-3 border-b w-32\">Vencimiento</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody className=\"divide-y divide-gray-100 bg-white\">\n                                        {importedData.slice(0, 200).map((row) => (\n                                            <tr key={row.id} className={`group transition-colors ${!row.isValid ? 'bg-red-50' :\n                                                    row.needs_review ? 'bg-orange-50/50 hover:bg-orange-50' :\n                                                        'hover:bg-gray-50'\n                                                }`}>\n                                                <td className=\"p-3\">\n                                                    {!row.isValid ? (\n                                                        <div className=\"group/tooltip relative\">\n                                                            <AlertTriangle size={16} className=\"text-red-500 cursor-help\" />\n                                                            <div className=\"absolute left-6 top-0 bg-red-800 text-white text-xs p-2 rounded shadow-lg w-48 hidden group-hover/tooltip:block z-20\">\n                                                                {row.errors.join(', ')}\n                                                            </div>\n                                                        </div>\n                                                    ) : row.needs_review ? (\n                                                        <div title=\"Datos autogenerados. Revise si es necesario.\">\n                                                            <Edit2 size={16} className=\"text-orange-500\" />\n                                                        </div>\n                                                    ) : (\n                                                        <CheckCircle size={16} className=\"text-green-500\" />\n                                                    )}\n                                                </td>\n                                                <td className=\"p-3 font-mono text-xs\">{row.sku}</td>\n                                                <td className=\"p-3 font-bold text-gray-800\">\n                                                    <input\n                                                        type=\"text\"\n                                                        value={row.name}\n                                                        onChange={(e) => handleUpdateRow(row.id, 'name', e.target.value)}\n                                                        className=\"bg-transparent border-none focus:ring-1 focus:ring-blue-500 rounded w-full text-sm font-bold\"\n                                                    />\n                                                </td>\n                                                <td className=\"p-3 text-gray-600\">\n                                                    <input\n                                                        type=\"text\"\n                                                        value={row.laboratory}\n                                                        onChange={(e) => handleUpdateRow(row.id, 'laboratory', e.target.value)}\n                                                        className=\"bg-transparent border-none focus:ring-1 focus:ring-blue-500 rounded w-full text-xs\"\n                                                    />\n                                                </td>\n                                                <td className=\"p-3\">${row.price_sell.toLocaleString()}</td>\n                                                <td className=\"p-3\">{row.stock}</td>\n                                                <td className=\"p-3\">\n                                                    <input\n                                                        type=\"text\"\n                                                        value={row.lot_number}\n                                                        onChange={(e) => handleUpdateRow(row.id, 'lot_number', e.target.value)}\n                                                        className={`w-full px-2 py-1 rounded border text-xs ${row.lot_number === 'LOTE-MIGRACION' ? 'border-orange-300 bg-orange-50 text-orange-800' : 'border-gray-200'\n                                                            }`}\n                                                    />\n                                                </td>\n                                                <td className=\"p-3\">\n                                                    <input\n                                                        type=\"text\"\n                                                        value={row.expiry_date}\n                                                        onChange={(e) => handleUpdateRow(row.id, 'expiry_date', e.target.value)}\n                                                        className=\"w-full px-2 py-1 rounded border border-gray-200 text-xs\"\n                                                        placeholder=\"DD/MM/YYYY\"\n                                                    />\n                                                </td>\n                                            </tr>\n                                        ))}\n                                    </tbody>\n                                </table>\n                                {importedData.length > 200 && (\n                                    <div className=\"p-4 text-center text-gray-500 text-sm bg-gray-50 border-t border-gray-200\">\n                                        Mostrando primeros 200 de {importedData.length} registros. Los demás se importarán correctamente.\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                    )}\n                </div>\n\n                {/* Footer */}\n                <div className=\"p-6 border-t border-gray-100 bg-gray-50 rounded-b-2xl flex justify-between items-center\">\n                    {step === 'PREVIEW' ? (\n                        <>\n                            <button\n                                onClick={() => {\n                                    setStep('UPLOAD');\n                                    setImportedData([]);\n                                }}\n                                className=\"px-6 py-3 text-gray-600 font-bold hover:bg-gray-200 rounded-xl transition-colors\"\n                            >\n                                Cancelar\n                            </button>\n                            <button\n                                onClick={handleImport}\n                                disabled={validCount === 0 || isProcessing}\n                                className=\"px-8 py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n                            >\n                                {isProcessing ? <Loader2 className=\"animate-spin\" /> : <Save size={20} />}\n                                Confirmar e Importar ({validCount})\n                            </button>\n                        </>\n                    ) : (\n                        <div />\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default BulkImportModal;\n"],"names":[],"mappings":"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"}}]
}