{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/actions/sync.ts"],"sourcesContent":["'use server';\n\nimport { query } from '../lib/db';\nimport { InventoryBatch, EmployeeProfile } from '../domain/types';\n\nexport async function fetchInventory(): Promise<InventoryBatch[]> {\n    try {\n        const res = await query('SELECT * FROM productos');\n\n        // Map DB columns to Domain Type\n        // Assuming DB columns might be snake_case or slightly different. \n        // We map what we can and default the rest for safety.\n        return res.rows.map((row: any) => ({\n            id: row.id?.toString() || `PROD-${Math.random()}`,\n            sku: row.sku || row.codigo || 'UNKNOWN',\n            name: row.nombre || row.name || 'Sin Nombre',\n            dci: row.dci || row.principio_activo || '',\n            // lot_number is removed as per new mapping, if needed, add back with a default\n            expiry_date: row.vencimiento ? new Date(row.vencimiento).getTime() : Date.now() + 31536000000,\n            category: (row.category || row.categoria) as any, // Use row.category if available, fallback to row.categoria\n            condition: (row.sale_condition || row.condicion_venta) as any, // Map DB column to new field name, fallback to old DB field\n            // storage_condition is removed as per new mapping, if needed, add back with a default\n            allows_commission: row.allows_commission || row.permite_comision || false,\n            active_ingredients: row.active_ingredients || row.principios_activos ? (Array.isArray(row.principios_activos) ? row.principios_activos : [row.principios_activos]) : [],\n            is_bioequivalent: row.is_bioequivalent || row.es_bioequivalente || false,\n            stock_actual: Number(row.stock_actual || row.stock) || 0,\n            stock_min: Number(row.stock_min || row.stock_min) || 5,\n            stock_max: Number(row.stock_max) || 100, // New field\n            price: Number(row.price || row.precio) || 0,\n            cost_price: Number(row.cost_price) || 0, // New field\n            supplier_id: row.supplier_id || row.proveedor_id || 'SUP-001',\n            location_id: row.location_id || 'BODEGA_CENTRAL' // New field with default\n        }));\n    } catch (error) {\n        console.error('Error fetching inventory:', error);\n        return [];\n    }\n}\n\nexport async function fetchEmployees(): Promise<EmployeeProfile[]> {\n    try {\n        const res = await query('SELECT * FROM users');\n\n        return res.rows.map((row: any) => ({\n            id: row.id?.toString() || `EMP-${Math.random()}`,\n            rut: row.rut || 'UNKNOWN',\n            name: row.nombre || row.name || 'Sin Nombre',\n            role: row.rol || 'CASHIER', // Default to safest role\n            access_pin: row.pin || '0000',\n            labor_data: {\n                base_salary: parseFloat(row.base_salary),\n                afp: row.afp,\n                isapre: row.isapre,\n                contract_hours: 45 // Default to 45 hours\n            },\n            status: row.status,\n            current_status: 'OUT' // Default status\n        }));\n    } catch (error) {\n        console.error('Error fetching employees:', error);\n        return [];\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAKsB,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/actions/sync.ts"],"sourcesContent":["'use server';\n\nimport { query } from '../lib/db';\nimport { InventoryBatch, EmployeeProfile } from '../domain/types';\n\nexport async function fetchInventory(): Promise<InventoryBatch[]> {\n    try {\n        const res = await query('SELECT * FROM productos');\n\n        // Map DB columns to Domain Type\n        // Assuming DB columns might be snake_case or slightly different. \n        // We map what we can and default the rest for safety.\n        return res.rows.map((row: any) => ({\n            id: row.id?.toString() || `PROD-${Math.random()}`,\n            sku: row.sku || row.codigo || 'UNKNOWN',\n            name: row.nombre || row.name || 'Sin Nombre',\n            dci: row.dci || row.principio_activo || '',\n            // lot_number is removed as per new mapping, if needed, add back with a default\n            expiry_date: row.vencimiento ? new Date(row.vencimiento).getTime() : Date.now() + 31536000000,\n            category: (row.category || row.categoria) as any, // Use row.category if available, fallback to row.categoria\n            condition: (row.sale_condition || row.condicion_venta) as any, // Map DB column to new field name, fallback to old DB field\n            // storage_condition is removed as per new mapping, if needed, add back with a default\n            allows_commission: row.allows_commission || row.permite_comision || false,\n            active_ingredients: row.active_ingredients || row.principios_activos ? (Array.isArray(row.principios_activos) ? row.principios_activos : [row.principios_activos]) : [],\n            is_bioequivalent: row.is_bioequivalent || row.es_bioequivalente || false,\n            stock_actual: Number(row.stock_actual || row.stock) || 0,\n            stock_min: Number(row.stock_min || row.stock_min) || 5,\n            stock_max: Number(row.stock_max) || 100, // New field\n            price: Number(row.price || row.precio) || 0,\n            cost_price: Number(row.cost_price) || 0, // New field\n            supplier_id: row.supplier_id || row.proveedor_id || 'SUP-001',\n            location_id: row.location_id || 'BODEGA_CENTRAL' // New field with default\n        }));\n    } catch (error) {\n        console.error('Error fetching inventory:', error);\n        return [];\n    }\n}\n\nexport async function fetchEmployees(): Promise<EmployeeProfile[]> {\n    try {\n        const res = await query('SELECT * FROM users');\n\n        return res.rows.map((row: any) => ({\n            id: row.id?.toString() || `EMP-${Math.random()}`,\n            rut: row.rut || 'UNKNOWN',\n            name: row.nombre || row.name || 'Sin Nombre',\n            role: row.rol || 'CASHIER', // Default to safest role\n            access_pin: row.pin || '0000',\n            labor_data: {\n                base_salary: parseFloat(row.base_salary),\n                afp: row.afp,\n                isapre: row.isapre,\n                contract_hours: 45 // Default to 45 hours\n            },\n            status: row.status,\n            current_status: 'OUT' // Default status\n        }));\n    } catch (error) {\n        console.error('Error fetching employees:', error);\n        return [];\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAuCsB,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/store/useStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist, createJSONStorage } from 'zustand/middleware';\nimport { InventoryBatch, EmployeeProfile, SaleItem, Customer, QueueTicket, Supplier, PurchaseOrder, CartItem, SaleTransaction, Expense, CashShift, CashMovement, CashMovementReason, AttendanceLog, AttendanceStatus, StockTransfer, WarehouseIncident, SupplierDocument } from '../../domain/types';\nimport { fetchInventory, fetchEmployees } from '../../actions/sync';\n\n// --- MOCK SUPPLIERS ---\nconst MOCK_SUPPLIERS: Supplier[] = [\n    {\n        id: 'SUP-001',\n        rut: '76.111.111-1',\n        business_name: 'Laboratorio Chile S.A.',\n        fantasy_name: 'LabChile',\n        contact_email: 'ventas@labchile.cl',\n        lead_time_days: 2,\n        contacts: [\n            { name: 'Juan Pérez', role: 'SALES', email: 'juan.perez@labchile.cl', phone: '+56911111111', is_primary: true },\n            { name: 'María González', role: 'BILLING', email: 'facturacion@labchile.cl', phone: '+56911111112', is_primary: false }\n        ],\n        categories: ['MEDICAMENTOS'],\n        payment_terms: '30_DIAS',\n        rating: 5,\n        bank_account: { bank: 'Banco de Chile', account_type: 'CORRIENTE', account_number: '111-222-333', email_notification: 'pagos@labchile.cl' }\n    },\n    {\n        id: 'SUP-002',\n        rut: '76.222.222-2',\n        business_name: 'Novo Nordisk Farmacéutica Ltda.',\n        fantasy_name: 'Novo Nordisk',\n        contact_email: 'orders@novo.com',\n        lead_time_days: 5,\n        contacts: [\n            { name: 'Ana Silva', role: 'SALES', email: 'ana.silva@novo.com', phone: '+56922222222', is_primary: true }\n        ],\n        categories: ['MEDICAMENTOS', 'INSUMOS'],\n        payment_terms: '60_DIAS',\n        rating: 4\n    },\n    {\n        id: 'SUP-003',\n        rut: '76.333.333-3',\n        business_name: 'Droguería Hofmann S.A.',\n        fantasy_name: 'Droguería Hofmann',\n        contact_email: 'contacto@hofmann.cl',\n        lead_time_days: 3,\n        contacts: [],\n        categories: ['INSUMOS', 'RETAIL'],\n        payment_terms: 'CONTADO',\n        rating: 3\n    },\n];\n\ninterface PharmaState {\n    // Auth\n    user: EmployeeProfile | null;\n    employees: EmployeeProfile[]; // Store loaded employees\n    login: (pin: string) => boolean;\n    logout: () => void;\n\n    // Data Sync\n    isLoading: boolean;\n    syncData: () => Promise<void>;\n\n    // Inventory\n    inventory: InventoryBatch[];\n    suppliers: Supplier[];\n    supplierDocuments: SupplierDocument[];\n    purchaseOrders: PurchaseOrder[];\n    updateStock: (batchId: string, quantity: number) => void;\n    addStock: (batchId: string, quantity: number, expiry?: number) => void;\n    addNewProduct: (product: InventoryBatch) => void;\n    transferStock: (batchId: string, targetLocation: 'BODEGA_CENTRAL' | 'SUCURSAL_CENTRO' | 'SUCURSAL_NORTE' | 'KIOSCO', quantity: number) => void;\n    addPurchaseOrder: (po: PurchaseOrder) => void;\n    receivePurchaseOrder: (poId: string, receivedItems: { sku: string, received_qty: number }[]) => void;\n\n    // SRM Actions\n    addSupplier: (supplier: Omit<Supplier, 'id'>) => void;\n    updateSupplier: (id: string, data: Partial<Supplier>) => void;\n    addSupplierDocument: (doc: Omit<SupplierDocument, 'id'>) => void;\n\n    // POS & Cart\n    cart: CartItem[];\n    currentCustomer: Customer | null;\n    setCustomer: (customer: Customer | null) => void;\n    addToCart: (batch: InventoryBatch, quantity: number) => void;\n    addManualItem: (item: { description: string, price: number, quantity: number }) => void;\n    removeFromCart: (sku: string) => void;\n    clearCart: () => void;\n    processSale: (paymentMethod: string, customer?: Customer) => void;\n\n    // CRM\n    customers: Customer[];\n    addCustomer: (customer: Omit<Customer, 'id' | 'totalPoints' | 'lastVisit' | 'name' | 'age' | 'health_tags'>) => Customer;\n    updateCustomer: (id: string, data: Partial<Customer>) => void;\n\n    // BI & Reports\n    salesHistory: SaleTransaction[];\n    expenses: Expense[];\n    addExpense: (expense: Omit<Expense, 'id'>) => void;\n\n    // Cash Management\n    currentShift: CashShift | null;\n    cashMovements: CashMovement[];\n    openShift: (amount: number) => void;\n    closeShift: (finalAmount: number) => void;\n    registerCashMovement: (movement: Omit<CashMovement, 'id' | 'timestamp' | 'shift_id' | 'user_id'>) => void;\n    getShiftMetrics: () => {\n        totalSales: number;\n        cashSales: number;\n        cardSales: number;\n        transferSales: number;\n        initialFund: number;\n        totalOutflows: number;\n        expectedCash: number;\n    };\n\n    // Attendance & HR\n    attendanceLogs: AttendanceLog[];\n    registerAttendance: (employeeId: string, type: AttendanceLog['type']) => void;\n    updateEmployeeBiometrics: (employeeId: string, credentialId: string) => void;\n\n    // WMS & Logistics\n    stockTransfers: StockTransfer[];\n    warehouseIncidents: WarehouseIncident[];\n    dispatchTransfer: (transfer: Omit<StockTransfer, 'id' | 'status' | 'timeline'>) => void;\n    receiveTransfer: (transferId: string, incidents?: Omit<WarehouseIncident, 'id' | 'transfer_id' | 'reported_at' | 'status'>[]) => void;\n\n    // Queue\n    tickets: QueueTicket[];\n    generateTicket: (rut?: string) => QueueTicket;\n    callNextTicket: () => QueueTicket | null;\n}\n\nexport const usePharmaStore = create<PharmaState>()(\n    persist(\n        (set, get) => ({\n            // --- Auth ---\n            user: null,\n            employees: [],\n            login: (pin) => {\n                const { employees } = get();\n                const employee = employees.find(e => e.access_pin === pin);\n                if (employee) {\n                    set({ user: employee });\n                    return true;\n                }\n                return false;\n            },\n            logout: () => set({ user: null }),\n\n            // --- Data Sync ---\n            isLoading: false,\n            syncData: async () => {\n                set({ isLoading: true });\n                try {\n                    const [inventory, employees] = await Promise.all([\n                        fetchInventory(),\n                        fetchEmployees()\n                    ]);\n\n                    // Si falla la DB (Safe Mode devuelve []), mantenemos lo que haya o usamos un fallback mínimo si está vacío\n                    if (inventory.length > 0) set({ inventory });\n                    if (employees.length > 0) set({ employees });\n\n                    console.log('Data Synced:', { inventoryCount: inventory.length, employeeCount: employees.length });\n                } catch (error) {\n                    console.error('Sync failed:', error);\n                } finally {\n                    set({ isLoading: false });\n                }\n            },\n\n            // --- Inventory ---\n            inventory: [], // Start empty, load from DB\n            suppliers: MOCK_SUPPLIERS,\n            supplierDocuments: [],\n            purchaseOrders: [],\n            updateStock: (batchId, quantity) => set((state) => ({\n                inventory: state.inventory.map(item =>\n                    item.id === batchId ? { ...item, stock_actual: item.stock_actual + quantity } : item\n                )\n            })),\n            addStock: (batchId, quantity, expiry) => set((state) => ({\n                inventory: state.inventory.map(item =>\n                    item.id === batchId ? {\n                        ...item,\n                        stock_actual: item.stock_actual + quantity,\n                        expiry_date: expiry || item.expiry_date\n                    } : item\n                )\n            })),\n            addNewProduct: (product) => set((state) => ({\n                inventory: [...state.inventory, { ...product, id: `BATCH-${Date.now()}` }]\n            })),\n            transferStock: (batchId, targetLocation, quantity) => set((state) => {\n                const sourceItem = state.inventory.find(i => i.id === batchId);\n                if (!sourceItem || sourceItem.stock_actual < quantity) return state;\n\n                // 1. Deduct from source\n                const updatedInventory = state.inventory.map(i =>\n                    i.id === batchId ? { ...i, stock_actual: i.stock_actual - quantity } : i\n                );\n\n                // 2. Add to target (Find existing batch in target location or create new)\n                // For simplicity in this demo, we'll clone the item with new location\n                // In a real DB, we'd check if SKU exists in target location\n                const existingInTarget = updatedInventory.find(i => i.sku === sourceItem.sku && i.location_id === targetLocation);\n\n                if (existingInTarget) {\n                    existingInTarget.stock_actual += quantity;\n                } else {\n                    updatedInventory.push({\n                        ...sourceItem,\n                        id: `TRF-${Date.now()}`,\n                        location_id: targetLocation,\n                        stock_actual: quantity\n                    });\n                }\n\n                return { inventory: updatedInventory };\n            }),\n            addPurchaseOrder: (po) => set((state) => ({ purchaseOrders: [...state.purchaseOrders, po] })),\n            receivePurchaseOrder: (poId, receivedItems) => set((state) => {\n                // 1. Actualizar estado de la PO\n                const updatedPOs = state.purchaseOrders.map(po =>\n                    po.id === poId ? { ...po, status: 'COMPLETED' as const } : po\n                );\n\n                // 2. Actualizar Inventario\n                const updatedInventory = [...state.inventory];\n                receivedItems.forEach(rec => {\n                    const itemIndex = updatedInventory.findIndex(i => i.sku === rec.sku);\n                    if (itemIndex >= 0) {\n                        updatedInventory[itemIndex] = {\n                            ...updatedInventory[itemIndex],\n                            stock_actual: updatedInventory[itemIndex].stock_actual + rec.received_qty\n                        };\n                    }\n                });\n\n                return { purchaseOrders: updatedPOs, inventory: updatedInventory };\n            }),\n\n            // --- SRM Actions ---\n            addSupplier: (supplierData) => set((state) => ({\n                suppliers: [...state.suppliers, { ...supplierData, id: `SUP-${Date.now()}` }]\n            })),\n            updateSupplier: (id, data) => set((state) => ({\n                suppliers: state.suppliers.map(s => s.id === id ? { ...s, ...data } : s)\n            })),\n            addSupplierDocument: (docData) => set((state) => ({\n                supplierDocuments: [...state.supplierDocuments, { ...docData, id: `DOC-${Date.now()}` }]\n            })),\n\n            // --- POS ---\n            cart: [],\n            currentCustomer: null,\n            setCustomer: (customer) => set({ currentCustomer: customer }),\n            addToCart: (batch, quantity) => set((state) => {\n                const existingItem = state.cart.find(i => i.sku === batch.sku);\n                if (existingItem) {\n                    return {\n                        cart: state.cart.map(i => i.sku === batch.sku ? { ...i, quantity: i.quantity + quantity } : i)\n                    };\n                }\n                return {\n                    cart: [...state.cart, {\n                        id: batch.id,\n                        batch_id: batch.id,\n                        sku: batch.sku,\n                        name: batch.name,\n                        price: batch.price,\n                        quantity: quantity,\n                        allows_commission: batch.allows_commission,\n                        active_ingredients: batch.active_ingredients\n                    }]\n                };\n            }),\n            addManualItem: (item) => set((state) => ({\n                cart: [...state.cart, {\n                    id: 'MANUAL-' + Date.now(),\n                    batch_id: 'MANUAL',\n                    sku: 'MANUAL-SKU', // Generic SKU as requested\n                    name: item.description,\n                    price: item.price,\n                    quantity: item.quantity,\n                    allows_commission: true, // Usually manual items like services allow commission or are neutral\n                    active_ingredients: []\n                }]\n            })),\n            removeFromCart: (sku) => set((state) => ({\n                cart: state.cart.filter(i => i.sku !== sku)\n            })),\n            clearCart: () => set({ cart: [] }),\n            processSale: (paymentMethod, customer) => {\n                const state = get();\n                // 1. Descontar Stock\n                const newInventory = state.inventory.map(item => {\n                    const cartItem = state.cart.find(c => c.sku === item.sku);\n                    if (cartItem) {\n                        return { ...item, stock_actual: item.stock_actual - cartItem.quantity };\n                    }\n                    return item;\n                });\n\n                // Update customer points and last visit if applicable\n                if (customer) {\n                    const pointsEarned = Math.floor(state.cart.reduce((a, b) => a + b.price * b.quantity, 0) * 0.01); // 1% points\n                    state.updateCustomer(customer.id, {\n                        totalPoints: customer.totalPoints + pointsEarned,\n                        lastVisit: Date.now()\n                    });\n                }\n\n                console.log('Venta Procesada:', { items: state.cart, total: state.cart.reduce((a, b) => a + b.price * b.quantity, 0), paymentMethod, customer });\n\n                const saleTransaction: SaleTransaction = {\n                    id: `SALE-${Date.now()}`,\n                    timestamp: Date.now(),\n                    items: state.cart.map(item => ({\n                        batch_id: item.batch_id || 'UNKNOWN',\n                        sku: item.sku,\n                        name: item.name,\n                        price: item.price,\n                        quantity: item.quantity,\n                        allows_commission: item.allows_commission || false,\n                        active_ingredients: item.active_ingredients\n                    })),\n                    total: state.cart.reduce((a, b) => a + b.price * b.quantity, 0),\n                    payment_method: paymentMethod as any,\n                    seller_id: state.user?.id || 'UNKNOWN',\n                    customer: customer || undefined\n                };\n\n                set({\n                    inventory: newInventory,\n                    cart: [],\n                    currentCustomer: null,\n                    salesHistory: [...state.salesHistory, saleTransaction]\n                }); // Clear customer after sale\n            },\n\n            // --- CRM ---\n            customers: [\n                { id: 'C-001', rut: '11.111.111-1', fullName: 'Cliente Frecuente Demo', name: 'Cliente Frecuente Demo', phone: '+56912345678', email: 'demo@cliente.cl', totalPoints: 1500, registrationSource: 'ADMIN', lastVisit: Date.now() - 86400000, age: 45, health_tags: ['HYPERTENSION'] }\n            ],\n            addCustomer: (data) => {\n                const newCustomer: Customer = {\n                    id: `C-${Date.now()}`,\n                    ...data,\n                    name: data.fullName, // Alias\n                    totalPoints: 0,\n                    lastVisit: Date.now(),\n                    age: 0, // Default\n                    health_tags: [] // Default\n                };\n                set((state) => ({ customers: [...state.customers, newCustomer] }));\n                return newCustomer;\n            },\n            updateCustomer: (id, data) => set((state) => ({\n                customers: state.customers.map(c => c.id === id ? { ...c, ...data } : c)\n            })),\n\n            // --- BI & Reports ---\n            salesHistory: [],\n            expenses: [],\n            addExpense: (expense) => set((state) => ({\n                expenses: [...state.expenses, { ...expense, id: `EXP-${Date.now()}` }]\n            })),\n\n            // --- Cash Management ---\n            currentShift: null,\n            cashMovements: [],\n            openShift: (amount) => set((state) => {\n                if (state.currentShift?.status === 'OPEN') return state;\n                const newShift: CashShift = {\n                    id: `SHIFT-${Date.now()}`,\n                    user_id: state.user?.id || 'UNKNOWN',\n                    start_time: Date.now(),\n                    opening_amount: amount,\n                    status: 'OPEN'\n                };\n                return { currentShift: newShift };\n            }),\n            closeShift: (finalAmount) => set((state) => {\n                if (!state.currentShift) return state;\n                const metrics = state.getShiftMetrics();\n                return {\n                    currentShift: {\n                        ...state.currentShift,\n                        end_time: Date.now(),\n                        status: 'CLOSED',\n                        closing_amount: finalAmount,\n                        difference: finalAmount - metrics.expectedCash\n                    }\n                };\n            }),\n            registerCashMovement: (movement) => set((state) => {\n                if (!state.currentShift) return state;\n                const newMovement: CashMovement = {\n                    id: `MOV-${Date.now()}`,\n                    shift_id: state.currentShift.id,\n                    timestamp: Date.now(),\n                    user_id: state.user?.id || 'UNKNOWN',\n                    ...movement\n                };\n                return { cashMovements: [...state.cashMovements, newMovement] };\n            }),\n            getShiftMetrics: () => {\n                const state = get();\n                if (!state.currentShift) return {\n                    totalSales: 0, cashSales: 0, cardSales: 0, transferSales: 0, initialFund: 0, totalOutflows: 0, expectedCash: 0\n                };\n\n                // Filter sales within the current shift\n                const shiftSales = state.salesHistory.filter(s => s.timestamp >= state.currentShift!.start_time && (!state.currentShift!.end_time || s.timestamp <= state.currentShift!.end_time));\n\n                const totalSales = shiftSales.reduce((sum, s) => sum + s.total, 0);\n                const cashSales = shiftSales.filter(s => s.payment_method === 'CASH').reduce((sum, s) => sum + s.total, 0);\n                const cardSales = shiftSales.filter(s => s.payment_method === 'DEBIT' || s.payment_method === 'CREDIT').reduce((sum, s) => sum + s.total, 0);\n                const transferSales = shiftSales.filter(s => s.payment_method === 'TRANSFER').reduce((sum, s) => sum + s.total, 0);\n\n                const initialFund = state.currentShift.opening_amount;\n\n                const shiftMovements = state.cashMovements.filter(m => m.shift_id === state.currentShift!.id);\n                const totalOutflows = shiftMovements.filter(m => m.type === 'OUT' && m.is_cash).reduce((sum, m) => sum + m.amount, 0);\n                const totalInflows = shiftMovements.filter(m => m.type === 'IN' && m.is_cash).reduce((sum, m) => sum + m.amount, 0);\n\n                const expectedCash = initialFund + cashSales + totalInflows - totalOutflows;\n\n                return {\n                    totalSales,\n                    cashSales,\n                    cardSales,\n                    transferSales,\n                    initialFund,\n                    totalOutflows,\n                    expectedCash\n                };\n            },\n\n            // --- Attendance ---\n            attendanceLogs: [],\n            registerAttendance: (employeeId, type) => set((state) => {\n                const now = Date.now();\n                let newStatus: AttendanceStatus = 'OUT';\n\n                if (type === 'CHECK_IN' || type === 'LUNCH_END') newStatus = 'IN';\n                if (type === 'LUNCH_START') newStatus = 'LUNCH';\n                if (type === 'CHECK_OUT') newStatus = 'OUT';\n\n                // Calculate overtime if CHECK_OUT\n                let overtime = 0;\n                if (type === 'CHECK_OUT') {\n                    // Simple logic: find last CHECK_IN today\n                    const todayStart = new Date().setHours(0, 0, 0, 0);\n                    const lastCheckIn = state.attendanceLogs.find(l => l.employee_id === employeeId && l.type === 'CHECK_IN' && l.timestamp >= todayStart);\n\n                    if (lastCheckIn) {\n                        const workedMinutes = (now - lastCheckIn.timestamp) / 1000 / 60;\n                        const contractMinutes = 9 * 60; // 9 hours default\n                        if (workedMinutes > contractMinutes) {\n                            overtime = Math.round(workedMinutes - contractMinutes);\n                        }\n                    }\n                }\n\n                const newLog: AttendanceLog = {\n                    id: `LOG-${now}`,\n                    employee_id: employeeId,\n                    timestamp: now,\n                    type,\n                    overtime_minutes: overtime > 0 ? overtime : undefined\n                };\n\n                return {\n                    attendanceLogs: [...state.attendanceLogs, newLog],\n                    employees: state.employees.map(emp =>\n                        emp.id === employeeId ? { ...emp, current_status: newStatus } : emp\n                    )\n                };\n            }),\n            updateEmployeeBiometrics: (employeeId, credentialId) => set((state) => ({\n                employees: state.employees.map(emp =>\n                    emp.id === employeeId\n                        ? { ...emp, biometric_credentials: [...(emp.biometric_credentials || []), credentialId] }\n                        : emp\n                )\n            })),\n\n            // --- WMS & Logistics ---\n            stockTransfers: [],\n            warehouseIncidents: [],\n            dispatchTransfer: (transferData) => set((state) => {\n                const now = Date.now();\n                const newTransfer: StockTransfer = {\n                    ...transferData,\n                    id: `TRF-${now}`,\n                    status: 'IN_TRANSIT',\n                    timeline: { created_at: now, dispatched_at: now }\n                };\n\n                // Move stock to TRANSIT\n                const updatedInventory = [...state.inventory];\n\n                transferData.items.forEach(item => {\n                    const batchIndex = updatedInventory.findIndex(b => b.id === item.batchId);\n                    if (batchIndex !== -1) {\n                        // Deduct from origin\n                        updatedInventory[batchIndex] = {\n                            ...updatedInventory[batchIndex],\n                            stock_actual: updatedInventory[batchIndex].stock_actual - item.quantity\n                        };\n\n                        // Add to TRANSIT\n                        updatedInventory.push({\n                            ...updatedInventory[batchIndex],\n                            id: `TRANSIT-${item.batchId}-${now}`,\n                            location_id: 'TRANSIT',\n                            stock_actual: item.quantity,\n                            stock_min: 0,\n                            stock_max: 0\n                        });\n                    }\n                });\n\n                return {\n                    stockTransfers: [...state.stockTransfers, newTransfer],\n                    inventory: updatedInventory\n                };\n            }),\n            receiveTransfer: (transferId, incidents) => set((state) => {\n                const now = Date.now();\n                const transfer = state.stockTransfers.find(t => t.id === transferId);\n                if (!transfer) return {};\n\n                let updatedInventory = [...state.inventory];\n                const newIncidents: WarehouseIncident[] = [];\n\n                // Move stock from TRANSIT to Destination\n                transfer.items.forEach(item => {\n                    const transitBatchIndex = updatedInventory.findIndex(b =>\n                        b.sku === item.sku &&\n                        b.location_id === 'TRANSIT' &&\n                        b.stock_actual >= item.quantity\n                    );\n\n                    if (transitBatchIndex !== -1) {\n                        // Remove from TRANSIT\n                        updatedInventory[transitBatchIndex] = {\n                            ...updatedInventory[transitBatchIndex],\n                            stock_actual: updatedInventory[transitBatchIndex].stock_actual - item.quantity\n                        };\n\n                        // Add to Destination\n                        const destBatchIndex = updatedInventory.findIndex(b =>\n                            b.sku === item.sku &&\n                            b.location_id === transfer.destination_location_id\n                        );\n\n                        if (destBatchIndex !== -1) {\n                            updatedInventory[destBatchIndex] = {\n                                ...updatedInventory[destBatchIndex],\n                                stock_actual: updatedInventory[destBatchIndex].stock_actual + item.quantity\n                            };\n                        } else {\n                            // Create new batch at destination\n                            updatedInventory.push({\n                                ...updatedInventory[transitBatchIndex],\n                                id: `BATCH-${now}-${Math.random()}`,\n                                location_id: transfer.destination_location_id,\n                                stock_actual: item.quantity,\n                                stock_min: 10,\n                                stock_max: 100\n                            });\n                        }\n                    }\n                });\n\n                // Register Incidents\n                if (incidents && incidents.length > 0) {\n                    incidents.forEach(inc => {\n                        newIncidents.push({\n                            ...inc,\n                            id: `INC-${now}-${Math.random()}`,\n                            transfer_id: transferId,\n                            status: 'OPEN',\n                            reported_at: now\n                        });\n                    });\n                }\n\n                return {\n                    stockTransfers: state.stockTransfers.map(t =>\n                        t.id === transferId\n                            ? { ...t, status: incidents?.length ? 'DISPUTED' : 'RECEIVED', timeline: { ...t.timeline, received_at: now } }\n                            : t\n                    ),\n                    inventory: updatedInventory,\n                    warehouseIncidents: [...state.warehouseIncidents, ...newIncidents]\n                };\n            }),\n\n            // --- Queue ---\n            tickets: [],\n            generateTicket: (rut) => {\n                const state = get();\n                // Check if customer exists to personalize ticket\n                // const customer = rut ? state.customers.find(c => c.rut === rut) : null;\n\n                const newTicket: QueueTicket = {\n                    id: Math.random().toString(36).substr(2, 9),\n                    number: `A-${String(state.tickets.length + 1).padStart(3, '0')}`,\n                    status: 'WAITING',\n                    rut,\n                    timestamp: Date.now()\n                };\n\n                set((state) => ({ tickets: [...state.tickets, newTicket] }));\n                return newTicket;\n            },\n            callNextTicket: () => {\n                const state = get();\n                const nextTicket = state.tickets.find(t => t.status === 'WAITING');\n                if (nextTicket) {\n                    set((state) => ({\n                        tickets: state.tickets.map(t => t.id === nextTicket.id ? { ...t, status: 'CALLING' } : t)\n                    }));\n                    return nextTicket;\n                }\n                return null;\n            }\n        }),\n        {\n            name: 'pharma-storage',\n            storage: createJSONStorage(() => localStorage),\n            partialize: (state) => ({\n                user: state.user,\n                cart: state.cart,\n                inventory: state.inventory,\n                customers: state.customers,\n                salesHistory: state.salesHistory,\n                expenses: state.expenses,\n                currentShift: state.currentShift,\n                cashMovements: state.cashMovements,\n                attendanceLogs: state.attendanceLogs,\n                employees: state.employees,\n                stockTransfers: state.stockTransfers,\n                warehouseIncidents: state.warehouseIncidents\n            })\n        }\n    )\n);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 734, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/LandingPage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { usePharmaStore } from '../store/useStore';\nimport { ShoppingCart, Truck, Users, Clock, Lock, ArrowRight } from 'lucide-react';\nimport { motion } from 'framer-motion';\n\nconst LandingPage: React.FC = () => {\n    const navigate = useNavigate();\n    const { login, user } = usePharmaStore();\n    const [pin, setPin] = useState('');\n    const [error, setError] = useState('');\n    const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);\n    const [targetRoute, setTargetRoute] = useState('');\n\n    const handleCardClick = (route: string) => {\n        if (user) {\n            navigate(route);\n        } else {\n            setTargetRoute(route);\n            setIsLoginModalOpen(true);\n        }\n    };\n\n    const handleLogin = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (login(pin)) {\n            setIsLoginModalOpen(false);\n            navigate(targetRoute || '/pos');\n        } else {\n            setError('PIN Incorrecto');\n        }\n    };\n\n    const BentoCard = ({ title, icon: Icon, color, route, desc, customOnClick }: any) => (\n        <motion.div\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n            className={`relative overflow-hidden rounded-3xl p-8 cursor-pointer shadow-xl transition-all ${color} text-white group`}\n            onClick={customOnClick || (() => handleCardClick(route))}\n        >\n            <div className=\"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\n                <Icon size={120} />\n            </div>\n            <div className=\"relative z-10 flex flex-col h-full justify-between\">\n                <div>\n                    <div className=\"bg-white/20 w-12 h-12 rounded-2xl flex items-center justify-center mb-4 backdrop-blur-sm\">\n                        <Icon size={24} />\n                    </div>\n                    <h3 className=\"text-2xl font-bold mb-2\">{title}</h3>\n                    <p className=\"text-white/80 text-sm font-medium\">{desc}</p>\n                </div>\n                <div className=\"flex items-center text-sm font-bold mt-4\">\n                    ACCEDER <ArrowRight size={16} className=\"ml-2\" />\n                </div>\n            </div>\n        </motion.div>\n    );\n\n    return (\n        <div className=\"min-h-screen bg-slate-50 flex flex-col items-center justify-center p-6\">\n            <header className=\"mb-12 text-center\">\n                <h1 className=\"text-4xl font-extrabold text-slate-900 tracking-tight mb-2\">\n                    Farmacias <span className=\"text-cyan-600\">Vallenar</span> Suit\n                </h1>\n                <p className=\"text-slate-500 font-medium\">Sistema ERP Clínico Integral v2.1</p>\n            </header>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-7xl w-full\">\n                {/* Kiosco (Público - No requiere login, pero en este flujo lo tratamos como módulo) */}\n                <BentoCard\n                    title=\"Kiosco de Filas\"\n                    icon={Users}\n                    color=\"bg-gradient-to-br from-indigo-500 to-purple-600\"\n                    route=\"/kiosk\"\n                    desc=\"Atención al cliente y tickets\"\n                />\n\n                {/* POS */}\n                <BentoCard\n                    title=\"Punto de Venta\"\n                    icon={ShoppingCart}\n                    color=\"bg-gradient-to-br from-emerald-500 to-teal-600\"\n                    route=\"/pos\"\n                    desc=\"Ventas, Recetas y Caja\"\n                />\n\n                {/* Logística */}\n                <BentoCard\n                    title=\"Cadena de Suministro\"\n                    icon={Truck}\n                    color=\"bg-gradient-to-br from-blue-500 to-cyan-600\"\n                    route=\"/supply\"\n                    desc=\"Inventario y Proveedores\"\n                />\n\n                {/* RRHH */}\n                <BentoCard\n                    title=\"Recursos Humanos\"\n                    icon={Clock}\n                    color=\"bg-gradient-to-br from-orange-400 to-red-500\"\n                    route=\"/hr\"\n                    desc=\"Personal y Asistencia\"\n                />\n            </div>\n\n            {/* Login Modal */}\n            {isLoginModalOpen && (\n                <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n                    <motion.div\n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        className=\"bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md\"\n                    >\n                        <div className=\"text-center mb-8\">\n                            <div className=\"bg-cyan-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4\">\n                                <Lock className=\"text-cyan-700\" size={32} />\n                            </div>\n                            <h2 className=\"text-2xl font-bold text-slate-900\">Acceso Seguro</h2>\n                            <p className=\"text-slate-500\">Ingrese su PIN de funcionario</p>\n                        </div>\n\n                        <form onSubmit={handleLogin} className=\"space-y-6\">\n                            <div>\n                                <input\n                                    type=\"password\"\n                                    maxLength={4}\n                                    className=\"w-full text-center text-4xl tracking-[1em] font-bold py-4 border-b-4 border-slate-200 focus:border-cyan-600 focus:outline-none transition-colors text-slate-800 placeholder-slate-300\"\n                                    placeholder=\"••••\"\n                                    value={pin}\n                                    onChange={(e) => setPin(e.target.value)}\n                                    autoFocus\n                                />\n                            </div>\n\n                            {error && <p className=\"text-red-500 text-center font-medium\">{error}</p>}\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <button\n                                    type=\"button\"\n                                    onClick={() => setIsLoginModalOpen(false)}\n                                    className=\"py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition\"\n                                >\n                                    Cancelar\n                                </button>\n                                <button\n                                    type=\"submit\"\n                                    className=\"py-3 rounded-xl font-bold bg-cyan-600 text-white hover:bg-cyan-700 shadow-lg shadow-cyan-200 transition\"\n                                >\n                                    Ingresar\n                                </button>\n                            </div>\n                        </form>\n\n                        <div className=\"mt-8 text-center text-xs text-slate-400\">\n                            <p>Pines Demo: 1234 (QF), 0000 (Caja), 9999 (Admin)</p>\n                        </div>\n                    </motion.div>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default LandingPage;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1135, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/clinical/ClinicalSidebar.tsx"],"sourcesContent":["\nimport React from 'react';\nimport { AlertTriangle, Clock, RefreshCw, XCircle } from 'lucide-react';\nimport { ClinicalAnalysisResult } from '../../../domain/types';\n\ninterface ClinicalSidebarProps {\n    analysis: ClinicalAnalysisResult | null;\n    lastChecked: number;\n}\n\nconst ClinicalSidebar: React.FC<ClinicalSidebarProps> = ({ analysis, lastChecked }) => {\n    const statusColor = analysis?.status === 'BLOCK' ? 'bg-red-600' : analysis?.status === 'WARNING' ? 'bg-amber-500' : 'bg-emerald-600';\n\n    return (\n        <div className=\"w-full p-4 bg-slate-800 rounded-xl shadow-lg h-full flex flex-col\">\n            <h3 className=\"text-lg font-bold text-cyan-500 mb-4 flex items-center\">\n                <RefreshCw size={16} className=\"mr-2\" /> Agente Clínico IA (Copilot)\n            </h3>\n\n            {/* Indicador de Estado */}\n            <div className={`p-3 rounded-lg text-white ${statusColor} mb-4 flex items-start`}>\n                {analysis?.status === 'BLOCK' && <XCircle size={20} className=\"mt-1 mr-3\" />}\n                {analysis?.status === 'WARNING' && <AlertTriangle size={20} className=\"mt-1 mr-3\" />}\n                <p className=\"text-sm font-semibold\">{analysis?.message || 'Añade items para análisis en tiempo real.'}</p>\n            </div>\n\n            {/* Sugerencias */}\n            {analysis?.suggested_items && analysis.suggested_items.length > 0 && (\n                <div className=\"p-3 bg-slate-700 rounded-lg mt-auto\">\n                    <p className=\"text-xs text-cyan-300 font-semibold mb-1\">Sugerencias (Cross-selling):</p>\n                    <ul className=\"text-sm text-white\">\n                        {analysis.suggested_items.map((item, index) => (\n                            <li key={index} className=\"flex items-center\">\n                                • {item}\n                            </li>\n                        ))}\n                    </ul>\n                </div>\n            )}\n\n            {/* Footer de Trazabilidad */}\n            <div className=\"mt-4 pt-3 border-t border-slate-700\">\n                <p className=\"text-xs text-slate-400 flex items-center\">\n                    <Clock size={12} className=\"mr-1\" /> Último chequeo: {new Date(lastChecked).toLocaleTimeString('es-CL')}\n                </p>\n            </div>\n        </div>\n    );\n};\n\nexport default ClinicalSidebar;\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AAAA;;;AAQA,MAAM,kBAAkD,CAAC,EAAE,QAAQ,EAAE,WAAW,EAAE;IAC9E,MAAM,cAAc,UAAU,WAAW,UAAU,eAAe,UAAU,WAAW,YAAY,iBAAiB;IAEpH,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAG,WAAU;;kCACV,6LAAC,gOAAS;wBAAC,MAAM;wBAAI,WAAU;;;;;;oBAAS;;;;;;;0BAI5C,6LAAC;gBAAI,WAAW,CAAC,0BAA0B,EAAE,YAAY,sBAAsB,CAAC;;oBAC3E,UAAU,WAAW,yBAAW,6LAAC,0NAAO;wBAAC,MAAM;wBAAI,WAAU;;;;;;oBAC7D,UAAU,WAAW,2BAAa,6LAAC,4OAAa;wBAAC,MAAM;wBAAI,WAAU;;;;;;kCACtE,6LAAC;wBAAE,WAAU;kCAAyB,UAAU,WAAW;;;;;;;;;;;;YAI9D,UAAU,mBAAmB,SAAS,eAAe,CAAC,MAAM,GAAG,mBAC5D,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAE,WAAU;kCAA2C;;;;;;kCACxD,6LAAC;wBAAG,WAAU;kCACT,SAAS,eAAe,CAAC,GAAG,CAAC,CAAC,MAAM,sBACjC,6LAAC;gCAAe,WAAU;;oCAAoB;oCACvC;;+BADE;;;;;;;;;;;;;;;;0BASzB,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAE,WAAU;;sCACT,6LAAC,gNAAK;4BAAC,MAAM;4BAAI,WAAU;;;;;;wBAAS;wBAAkB,IAAI,KAAK,aAAa,kBAAkB,CAAC;;;;;;;;;;;;;;;;;;AAKnH;KAtCM;uCAwCS"}},
    {"offset": {"line": 1281, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/logic/clinicalAgent.ts"],"sourcesContent":["import { Customer, SaleItem, ClinicalAnalysisResult, CartItem } from '../types';\n\n// Base de conocimientos simplificada para MVP\nconst CONTRAINDICATIONS = {\n    HYPERTENSION: ['Pseudoefedrina', 'Fenilefrina', 'Sodio'],\n    PREGNANT: ['Ibuprofeno', 'Naproxeno', 'Isotretinoína', 'Warfarina'],\n    DIABETIC: ['Jarabe con Azúcar', 'Dextrometorfano (con azúcar)'],\n};\n\nconst CROSS_SELLING_RULES = [\n    { trigger: 'Antibiótico', suggestion: 'Probiótico (Bioflora/Perenteryl) para proteger flora intestinal.' },\n    { trigger: 'Pañales', suggestion: 'Crema para coceduras (Hipoglós/Pasta Lassar).' },\n    { trigger: 'Cepillo Dental', suggestion: 'Pasta Dental o Hilo Dental.' },\n    { trigger: 'Invierno', suggestion: 'Vitamina C o Propóleo.' }, // Ejemplo estacional\n];\n\nexport class ClinicalAgent {\n    /**\n     * Analiza el carrito en busca de interacciones peligrosas con el perfil del paciente.\n     */\n    static analyzeCart(cart: CartItem[], customer?: Customer): ClinicalAnalysisResult {\n        let result: ClinicalAnalysisResult = { status: 'SAFE', message: 'Análisis Clínico: OK' };\n        const blockingItems: string[] = [];\n        const suggestedItems: string[] = [];\n        // let result: ClinicalAnalysisResult = { status: 'SAFE', message: 'Análisis Clínico: OK' }; // This line was removed in the provided diff\n        // const blockingItems: string[] = []; // This line was removed in the provided diff\n        // const suggestedItems: string[] = []; // This line was removed in the provided diff\n\n        // 1. Análisis de Contraindicaciones (Solo si hay cliente identificado)\n        if (customer) {\n            cart.forEach(item => {\n                // Revisar Hipertensión\n                if (customer.health_tags.includes('HYPERTENSION')) {\n                    const conflict = CONTRAINDICATIONS.HYPERTENSION.find(drug => item.name.includes(drug) || item.active_ingredients?.includes(drug));\n                    if (conflict) {\n                        blockingItems.push(`${item.name} (Contiene ${conflict})`);\n                    }\n                }\n\n                // Revisar Embarazo\n                if (customer.health_tags.includes('PREGNANT')) {\n                    const conflict = CONTRAINDICATIONS.PREGNANT.find(drug => item.name.includes(drug) || item.active_ingredients?.includes(drug));\n                    if (conflict) {\n                        blockingItems.push(`${item.name} (Riesgo en Embarazo: ${conflict})`);\n                    }\n                }\n\n                // Revisar Diabetes\n                if (customer.health_tags.includes('DIABETIC')) {\n                    const conflict = CONTRAINDICATIONS.DIABETIC.find(drug => item.name.includes(drug));\n                    if (conflict) {\n                        blockingItems.push(`${item.name} (No apto para diabéticos)`);\n                    }\n                }\n            });\n        }\n\n        // 2. Lógica de Cross-Selling (Independiente del cliente)\n        cart.forEach(item => {\n            CROSS_SELLING_RULES.forEach(rule => {\n                if (item.name.includes(rule.trigger) || item.active_ingredients?.includes(rule.trigger)) {\n                    if (!suggestedItems.includes(rule.suggestion)) {\n                        suggestedItems.push(rule.suggestion);\n                    }\n                }\n            });\n        });\n\n        // 3. Construir Resultado\n        if (blockingItems.length > 0) {\n            result.status = 'BLOCK';\n            result.message = `⛔ ALERTA DE SEGURIDAD: Interacción detectada.`;\n            result.blocking_items = blockingItems;\n        } else if (suggestedItems.length > 0) {\n            // Si es seguro pero hay sugerencias, cambiamos mensaje (opcional, mantenemos SAFE si no hay warning)\n            result.message = 'Venta Segura. Ver sugerencias.';\n        }\n\n        result.suggested_items = suggestedItems;\n        return result;\n    }\n};\n"],"names":[],"mappings":";;;;AAEA,8CAA8C;AAC9C,MAAM,oBAAoB;IACtB,cAAc;QAAC;QAAkB;QAAe;KAAQ;IACxD,UAAU;QAAC;QAAc;QAAa;QAAiB;KAAY;IACnE,UAAU;QAAC;QAAqB;KAA+B;AACnE;AAEA,MAAM,sBAAsB;IACxB;QAAE,SAAS;QAAe,YAAY;IAAmE;IACzG;QAAE,SAAS;QAAW,YAAY;IAAgD;IAClF;QAAE,SAAS;QAAkB,YAAY;IAA8B;IACvE;QAAE,SAAS;QAAY,YAAY;IAAyB;CAC/D;AAEM,MAAM;IACT;;KAEC,GACD,OAAO,YAAY,IAAgB,EAAE,QAAmB,EAA0B;QAC9E,IAAI,SAAiC;YAAE,QAAQ;YAAQ,SAAS;QAAuB;QACvF,MAAM,gBAA0B,EAAE;QAClC,MAAM,iBAA2B,EAAE;QACnC,0IAA0I;QAC1I,oFAAoF;QACpF,qFAAqF;QAErF,uEAAuE;QACvE,IAAI,UAAU;YACV,KAAK,OAAO,CAAC,CAAA;gBACT,uBAAuB;gBACvB,IAAI,SAAS,WAAW,CAAC,QAAQ,CAAC,iBAAiB;oBAC/C,MAAM,WAAW,kBAAkB,YAAY,CAAC,IAAI,CAAC,CAAA,OAAQ,KAAK,IAAI,CAAC,QAAQ,CAAC,SAAS,KAAK,kBAAkB,EAAE,SAAS;oBAC3H,IAAI,UAAU;wBACV,cAAc,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;oBAC5D;gBACJ;gBAEA,mBAAmB;gBACnB,IAAI,SAAS,WAAW,CAAC,QAAQ,CAAC,aAAa;oBAC3C,MAAM,WAAW,kBAAkB,QAAQ,CAAC,IAAI,CAAC,CAAA,OAAQ,KAAK,IAAI,CAAC,QAAQ,CAAC,SAAS,KAAK,kBAAkB,EAAE,SAAS;oBACvH,IAAI,UAAU;wBACV,cAAc,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC;oBACvE;gBACJ;gBAEA,mBAAmB;gBACnB,IAAI,SAAS,WAAW,CAAC,QAAQ,CAAC,aAAa;oBAC3C,MAAM,WAAW,kBAAkB,QAAQ,CAAC,IAAI,CAAC,CAAA,OAAQ,KAAK,IAAI,CAAC,QAAQ,CAAC;oBAC5E,IAAI,UAAU;wBACV,cAAc,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,0BAA0B,CAAC;oBAC/D;gBACJ;YACJ;QACJ;QAEA,yDAAyD;QACzD,KAAK,OAAO,CAAC,CAAA;YACT,oBAAoB,OAAO,CAAC,CAAA;gBACxB,IAAI,KAAK,IAAI,CAAC,QAAQ,CAAC,KAAK,OAAO,KAAK,KAAK,kBAAkB,EAAE,SAAS,KAAK,OAAO,GAAG;oBACrF,IAAI,CAAC,eAAe,QAAQ,CAAC,KAAK,UAAU,GAAG;wBAC3C,eAAe,IAAI,CAAC,KAAK,UAAU;oBACvC;gBACJ;YACJ;QACJ;QAEA,yBAAyB;QACzB,IAAI,cAAc,MAAM,GAAG,GAAG;YAC1B,OAAO,MAAM,GAAG;YAChB,OAAO,OAAO,GAAG,CAAC,6CAA6C,CAAC;YAChE,OAAO,cAAc,GAAG;QAC5B,OAAO,IAAI,eAAe,MAAM,GAAG,GAAG;YAClC,qGAAqG;YACrG,OAAO,OAAO,GAAG;QACrB;QAEA,OAAO,eAAe,GAAG;QACzB,OAAO;IACX;AACJ"}},
    {"offset": {"line": 1390, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/ClientPanel.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { User, Search, UserPlus, X, Save } from 'lucide-react';\nimport { Customer } from '../../../domain/types';\n\nconst ClientPanel: React.FC = () => {\n    const { currentCustomer, setCustomer, customers, addCustomer } = usePharmaStore();\n    const [rutInput, setRutInput] = useState('');\n    const [isSearching, setIsSearching] = useState(false);\n\n    // Modal State\n    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);\n    const [newClientName, setNewClientName] = useState('');\n    const [newClientPhone, setNewClientPhone] = useState('');\n\n    // Formateador de RUT Chileno\n    const formatRut = (value: string) => {\n        // Eliminar puntos y guión\n        const clean = value.replace(/[^0-9kK]/g, '');\n        if (clean.length <= 1) return clean;\n\n        const body = clean.slice(0, -1);\n        const dv = clean.slice(-1).toUpperCase();\n\n        // Formato con puntos\n        let formattedBody = '';\n        for (let i = body.length - 1, j = 0; i >= 0; i--, j++) {\n            formattedBody = body.charAt(i) + (j > 0 && j % 3 === 0 ? '.' : '') + formattedBody;\n        }\n\n        return `${formattedBody}-${dv}`;\n    };\n\n    const handleRutChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        setRutInput(formatRut(e.target.value));\n    };\n\n    const handleSearch = () => {\n        if (!rutInput) return;\n        setIsSearching(true);\n\n        // Búsqueda Real en Store\n        const found = customers.find(c => c.rut === rutInput);\n\n        if (found) {\n            setCustomer(found);\n        } else {\n            setCustomer(null);\n            // Si no existe, sugerir crear\n        }\n        setIsSearching(false);\n    };\n\n    const handleCreateClient = () => {\n        if (!newClientName) return;\n\n        const newCustomer = addCustomer({\n            rut: rutInput,\n            fullName: newClientName,\n            phone: newClientPhone,\n            registrationSource: 'POS'\n        });\n\n        setCustomer(newCustomer);\n        setIsCreateModalOpen(false);\n        setNewClientName('');\n        setNewClientPhone('');\n    };\n\n    return (\n        <div className=\"bg-white rounded-2xl p-4 shadow-sm border border-slate-200 mb-4\">\n            <h3 className=\"text-sm font-bold text-slate-500 mb-3 flex items-center gap-2\">\n                <User size={16} /> CLIENTE (CRM)\n            </h3>\n\n            {!currentCustomer ? (\n                <div className=\"flex gap-2\">\n                    <div className=\"relative flex-1\">\n                        <input\n                            type=\"text\"\n                            placeholder=\"RUT (12.345.678-K)\"\n                            className=\"w-full pl-3 pr-10 py-2 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none font-mono text-sm\"\n                            value={rutInput}\n                            onChange={handleRutChange}\n                            onKeyDown={(e) => e.key === 'Enter' && handleSearch()}\n                        />\n                        <button\n                            onClick={handleSearch}\n                            className=\"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-cyan-600\"\n                        >\n                            <Search size={18} />\n                        </button>\n                    </div>\n                    {rutInput.length > 8 && !isSearching && !customers.find(c => c.rut === rutInput) && (\n                        <button\n                            onClick={() => setIsCreateModalOpen(true)}\n                            className=\"bg-cyan-100 text-cyan-700 p-2 rounded-xl hover:bg-cyan-200 transition\"\n                            title=\"Crear Cliente Rápido\"\n                        >\n                            <UserPlus size={20} />\n                        </button>\n                    )}\n                </div>\n            ) : (\n                <div className=\"bg-emerald-50 border border-emerald-100 rounded-xl p-3 relative\">\n                    <button\n                        onClick={() => { setCustomer(null); setRutInput(''); }}\n                        className=\"absolute top-2 right-2 text-emerald-400 hover:text-emerald-700\"\n                    >\n                        <X size={16} />\n                    </button>\n\n                    <div className=\"flex items-center gap-3 mb-2\">\n                        <div className=\"w-10 h-10 rounded-full bg-emerald-200 flex items-center justify-center text-emerald-700 font-bold\">\n                            {currentCustomer.fullName.charAt(0)}\n                        </div>\n                        <div>\n                            <h4 className=\"font-bold text-slate-800 text-sm\">{currentCustomer.fullName}</h4>\n                            <p className=\"text-xs text-slate-500 font-mono\">{currentCustomer.rut}</p>\n                        </div>\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                        <span className=\"text-[10px] bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full font-bold border border-amber-200\">\n                            ★ {currentCustomer.totalPoints} pts\n                        </span>\n                        {currentCustomer.health_tags.map(tag => (\n                            <span key={tag} className=\"text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded-full font-bold border border-red-200\">\n                                {tag}\n                            </span>\n                        ))}\n                    </div>\n                </div>\n            )}\n\n            {/* Modal de Creación Rápida */}\n            {isCreateModalOpen && (\n                <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n                    <div className=\"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200\">\n                        <div className=\"p-4 border-b border-slate-100 flex justify-between items-center\">\n                            <h3 className=\"font-bold text-slate-800\">Nuevo Cliente</h3>\n                            <button onClick={() => setIsCreateModalOpen(false)}><X size={20} className=\"text-slate-400\" /></button>\n                        </div>\n                        <div className=\"p-6 space-y-4\">\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1\">RUT</label>\n                                <input type=\"text\" value={rutInput} disabled className=\"w-full p-2 bg-slate-100 rounded-lg border border-slate-200 text-slate-500 font-mono\" />\n                            </div>\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1\">Nombre Completo *</label>\n                                <input\n                                    type=\"text\"\n                                    autoFocus\n                                    className=\"w-full p-2 border-2 border-slate-200 rounded-lg focus:border-cyan-500 focus:outline-none\"\n                                    value={newClientName}\n                                    onChange={(e) => setNewClientName(e.target.value)}\n                                />\n                            </div>\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1\">WhatsApp (Opcional)</label>\n                                <input\n                                    type=\"tel\"\n                                    placeholder=\"+569...\"\n                                    className=\"w-full p-2 border-2 border-slate-200 rounded-lg focus:border-cyan-500 focus:outline-none\"\n                                    value={newClientPhone}\n                                    onChange={(e) => setNewClientPhone(e.target.value)}\n                                />\n                            </div>\n                            <button\n                                onClick={handleCreateClient}\n                                disabled={!newClientName}\n                                className=\"w-full py-3 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition flex items-center justify-center gap-2 disabled:opacity-50\"\n                            >\n                                <Save size={18} /> Guardar Cliente\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default ClientPanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1815, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/PrescriptionModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { FileText, Stethoscope, CheckSquare, AlertTriangle } from 'lucide-react';\n\ninterface PrescriptionModalProps {\n    isOpen: boolean;\n    onConfirm: (data: { folio: string, doctorRut: string }) => void;\n    onCancel: () => void;\n    itemName: string;\n}\n\nconst PrescriptionModal: React.FC<PrescriptionModalProps> = ({ isOpen, onConfirm, onCancel, itemName }) => {\n    const [folio, setFolio] = useState('');\n    const [doctorRut, setDoctorRut] = useState('');\n    const [isArchived, setIsArchived] = useState(false);\n\n    if (!isOpen) return null;\n\n    const isValid = folio.length > 0 && doctorRut.length > 8 && isArchived;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-amber-50 p-6 border-b border-amber-100\">\n                    <h3 className=\"text-xl font-bold text-amber-800 flex items-center gap-2\">\n                        <AlertTriangle className=\"text-amber-600\" /> Receta Retenida\n                    </h3>\n                    <p className=\"text-sm text-amber-700 mt-1\">\n                        La venta de <strong>{itemName}</strong> requiere receta retenida.\n                    </p>\n                </div>\n\n                <div className=\"p-6 space-y-4\">\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-700 mb-1 flex items-center gap-2\">\n                            <FileText size={16} /> Folio Receta\n                        </label>\n                        <input\n                            type=\"text\"\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none\"\n                            placeholder=\"Ej: A-123456\"\n                            value={folio}\n                            onChange={(e) => setFolio(e.target.value)}\n                        />\n                    </div>\n\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-700 mb-1 flex items-center gap-2\">\n                            <Stethoscope size={16} /> RUT Médico Prescriptor\n                        </label>\n                        <input\n                            type=\"text\"\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none\"\n                            placeholder=\"Ej: 11.222.333-4\"\n                            value={doctorRut}\n                            onChange={(e) => setDoctorRut(e.target.value)}\n                        />\n                    </div>\n\n                    <div className=\"bg-slate-50 p-4 rounded-xl border border-slate-200\">\n                        <label className=\"flex items-center gap-3 cursor-pointer\">\n                            <div className={`w-6 h-6 rounded border-2 flex items-center justify-center transition-colors ${isArchived ? 'bg-amber-500 border-amber-500 text-white' : 'border-slate-300 bg-white'}`}>\n                                {isArchived && <CheckSquare size={16} />}\n                            </div>\n                            <input\n                                type=\"checkbox\"\n                                className=\"hidden\"\n                                checked={isArchived}\n                                onChange={(e) => setIsArchived(e.target.checked)}\n                            />\n                            <span className=\"text-sm font-bold text-slate-700\">Receta Física Archivada</span>\n                        </label>\n                        <p className=\"text-xs text-slate-400 mt-2 ml-9\">\n                            Declaro haber recibido y archivado la receta física correspondiente.\n                        </p>\n                    </div>\n\n                    <div className=\"flex gap-3 pt-4\">\n                        <button\n                            onClick={onCancel}\n                            className=\"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl transition\"\n                        >\n                            Cancelar\n                        </button>\n                        <button\n                            onClick={() => isValid && onConfirm({ folio, doctorRut })}\n                            disabled={!isValid}\n                            className=\"flex-1 py-3 bg-amber-600 text-white font-bold rounded-xl hover:bg-amber-700 transition disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-amber-200\"\n                        >\n                            Confirmar\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default PrescriptionModal;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;;;;;AASA,MAAM,oBAAsD,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE;;IAClG,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAE7C,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,UAAU,MAAM,MAAM,GAAG,KAAK,UAAU,MAAM,GAAG,KAAK;IAE5D,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAG,WAAU;;8CACV,6LAAC,4OAAa;oCAAC,WAAU;;;;;;gCAAmB;;;;;;;sCAEhD,6LAAC;4BAAE,WAAU;;gCAA8B;8CAC3B,6LAAC;8CAAQ;;;;;;gCAAkB;;;;;;;;;;;;;8BAI/C,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;;8CACG,6LAAC;oCAAM,WAAU;;sDACb,6LAAC,6NAAQ;4CAAC,MAAM;;;;;;wCAAM;;;;;;;8CAE1B,6LAAC;oCACG,MAAK;oCACL,WAAU;oCACV,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;sCAIhD,6LAAC;;8CACG,6LAAC;oCAAM,WAAU;;sDACb,6LAAC,kOAAW;4CAAC,MAAM;;;;;;wCAAM;;;;;;;8CAE7B,6LAAC;oCACG,MAAK;oCACL,WAAU;oCACV,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;sCAIpD,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAM,WAAU;;sDACb,6LAAC;4CAAI,WAAW,CAAC,4EAA4E,EAAE,aAAa,6CAA6C,6BAA6B;sDACjL,4BAAc,6LAAC,6OAAW;gDAAC,MAAM;;;;;;;;;;;sDAEtC,6LAAC;4CACG,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,OAAO;;;;;;sDAEnD,6LAAC;4CAAK,WAAU;sDAAmC;;;;;;;;;;;;8CAEvD,6LAAC;oCAAE,WAAU;8CAAmC;;;;;;;;;;;;sCAKpD,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCACG,SAAS;oCACT,WAAU;8CACb;;;;;;8CAGD,6LAAC;oCACG,SAAS,IAAM,WAAW,UAAU;4CAAE;4CAAO;wCAAU;oCACvD,UAAU,CAAC;oCACX,WAAU;8CACb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQzB;GArFM;KAAA;uCAuFS"}},
    {"offset": {"line": 2079, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/ManualItemModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { PlusCircle, DollarSign, Package } from 'lucide-react';\n\ninterface ManualItemModalProps {\n    isOpen: boolean;\n    onConfirm: (data: { description: string, price: number, quantity: number }) => void;\n    onClose: () => void;\n}\n\nconst ManualItemModal: React.FC<ManualItemModalProps> = ({ isOpen, onConfirm, onClose }) => {\n    const [description, setDescription] = useState('');\n    const [price, setPrice] = useState('');\n    const [quantity, setQuantity] = useState('1');\n\n    if (!isOpen) return null;\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (description && price) {\n            onConfirm({\n                description,\n                price: parseInt(price),\n                quantity: parseInt(quantity)\n            });\n            // Reset\n            setDescription('');\n            setPrice('');\n            setQuantity('1');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-slate-900 p-4 border-b border-slate-800 text-white\">\n                    <h3 className=\"text-lg font-bold flex items-center gap-2\">\n                        <PlusCircle className=\"text-cyan-400\" /> Ítem Manual / Vario\n                    </h3>\n                </div>\n\n                <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n                    <div>\n                        <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Descripción</label>\n                        <input\n                            type=\"text\"\n                            autoFocus\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                            placeholder=\"Ej: Servicio Inyectable\"\n                            value={description}\n                            onChange={(e) => setDescription(e.target.value)}\n                        />\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Precio Unit.</label>\n                            <div className=\"relative\">\n                                <DollarSign size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" />\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full pl-8 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                                    placeholder=\"0\"\n                                    value={price}\n                                    onChange={(e) => setPrice(e.target.value)}\n                                />\n                            </div>\n                        </div>\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Cantidad</label>\n                            <div className=\"relative\">\n                                <Package size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" />\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full pl-8 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                                    value={quantity}\n                                    onChange={(e) => setQuantity(e.target.value)}\n                                />\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"flex gap-3 pt-4\">\n                        <button\n                            type=\"button\"\n                            onClick={onClose}\n                            className=\"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl transition\"\n                        >\n                            Cancelar\n                        </button>\n                        <button\n                            type=\"submit\"\n                            className=\"flex-1 py-3 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition shadow-lg shadow-cyan-200\"\n                        >\n                            Agregar\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n};\n\nexport default ManualItemModal;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;;;;;AAQA,MAAM,kBAAkD,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE;;IACnF,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IAEzC,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,eAAe,CAAC;QAClB,EAAE,cAAc;QAChB,IAAI,eAAe,OAAO;YACtB,UAAU;gBACN;gBACA,OAAO,SAAS;gBAChB,UAAU,SAAS;YACvB;YACA,QAAQ;YACR,eAAe;YACf,SAAS;YACT,YAAY;QAChB;IACJ;IAEA,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;8BACX,cAAA,6LAAC;wBAAG,WAAU;;0CACV,6LAAC,mOAAU;gCAAC,WAAU;;;;;;4BAAkB;;;;;;;;;;;;8BAIhD,6LAAC;oBAAK,UAAU;oBAAc,WAAU;;sCACpC,6LAAC;;8CACG,6LAAC;oCAAM,WAAU;8CAAwD;;;;;;8CACzE,6LAAC;oCACG,MAAK;oCACL,SAAS;oCACT,WAAU;oCACV,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;sCAItD,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;;sDACG,6LAAC;4CAAM,WAAU;sDAAwD;;;;;;sDACzE,6LAAC;4CAAI,WAAU;;8DACX,6LAAC,mOAAU;oDAAC,MAAM;oDAAI,WAAU;;;;;;8DAChC,6LAAC;oDACG,MAAK;oDACL,WAAU;oDACV,aAAY;oDACZ,OAAO;oDACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;;;8CAIpD,6LAAC;;sDACG,6LAAC;4CAAM,WAAU;sDAAwD;;;;;;sDACzE,6LAAC;4CAAI,WAAU;;8DACX,6LAAC,sNAAO;oDAAC,MAAM;oDAAI,WAAU;;;;;;8DAC7B,6LAAC;oDACG,MAAK;oDACL,WAAU;oDACV,OAAO;oDACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;;;;;;;;;sCAM3D,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCACG,MAAK;oCACL,SAAS;oCACT,WAAU;8CACb;;;;;;8CAGD,6LAAC;oCACG,MAAK;oCACL,WAAU;8CACb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQzB;GA3FM;KAAA;uCA6FS"}},
    {"offset": {"line": 2327, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/CashManagementModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, DollarSign, Camera, AlertTriangle, CheckCircle, TrendingDown, TrendingUp, Lock } from 'lucide-react';\nimport { CashMovementReason } from '../../../domain/types';\n\ninterface CashManagementModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst CashManagementModal: React.FC<CashManagementModalProps> = ({ isOpen, onClose }) => {\n    const { currentShift, openShift, closeShift, registerCashMovement, getShiftMetrics } = usePharmaStore();\n    const [activeTab, setActiveTab] = useState<'OPENING' | 'EXPENSE' | 'CLOSING'>('OPENING');\n\n    // Opening State\n    const [openingAmount, setOpeningAmount] = useState('');\n\n    // Expense State\n    const [expenseAmount, setExpenseAmount] = useState('');\n    const [expenseReason, setExpenseReason] = useState<CashMovementReason>('SUPPLIES');\n    const [expenseDescription, setExpenseDescription] = useState('');\n    const [expenseEvidence, setExpenseEvidence] = useState<string | null>(null);\n\n    // Closing State\n    const [closingAmount, setClosingAmount] = useState('');\n    const [metrics, setMetrics] = useState<any>(null);\n\n    useEffect(() => {\n        if (isOpen) {\n            if (!currentShift || currentShift.status === 'CLOSED') {\n                setActiveTab('OPENING');\n            } else {\n                setActiveTab('EXPENSE'); // Default to expense if open\n                setMetrics(getShiftMetrics());\n            }\n        }\n    }, [isOpen, currentShift]);\n\n    useEffect(() => {\n        if (currentShift?.status === 'OPEN') {\n            const interval = setInterval(() => {\n                setMetrics(getShiftMetrics());\n            }, 1000); // Update metrics every second\n            return () => clearInterval(interval);\n        }\n    }, [currentShift]);\n\n\n    const handleOpenShift = () => {\n        const amount = parseInt(openingAmount);\n        if (isNaN(amount) || amount < 0) return;\n        openShift(amount);\n        setActiveTab('EXPENSE');\n    };\n\n    const handleRegisterExpense = () => {\n        const amount = parseInt(expenseAmount);\n        if (isNaN(amount) || amount <= 0) return;\n        if (!expenseEvidence && expenseDescription.length < 10) return; // Validation rule\n\n        registerCashMovement({\n            type: 'OUT',\n            amount,\n            reason: expenseReason,\n            description: expenseDescription,\n            evidence_url: expenseEvidence || undefined,\n            is_cash: true\n        });\n\n        // Reset form\n        setExpenseAmount('');\n        setExpenseDescription('');\n        setExpenseEvidence(null);\n        alert('Gasto registrado correctamente');\n    };\n\n    const handleCloseShift = () => {\n        const amount = parseInt(closingAmount);\n        if (isNaN(amount) || amount < 0) return;\n\n        if (window.confirm('¿Estás seguro de cerrar la caja? Esta acción no se puede deshacer.')) {\n            closeShift(amount);\n            onClose();\n        }\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <AnimatePresence>\n            <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\"\n            >\n                <motion.div\n                    initial={{ scale: 0.95, opacity: 0 }}\n                    animate={{ scale: 1, opacity: 1 }}\n                    exit={{ scale: 0.95, opacity: 0 }}\n                    className=\"bg-white rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]\"\n                >\n                    {/* Header */}\n                    <div className=\"p-6 border-b border-gray-100 flex justify-between items-center bg-slate-50\">\n                        <div>\n                            <h2 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\n                                <DollarSign className=\"text-blue-600\" />\n                                Gestión de Caja\n                            </h2>\n                            <p className=\"text-sm text-slate-500\">\n                                {currentShift?.status === 'OPEN' ? `Turno Abierto - Inicio: ${new Date(currentShift.start_time).toLocaleTimeString()}` : 'Turno Cerrado'}\n                            </p>\n                        </div>\n                        <button onClick={onClose} className=\"text-slate-400 hover:text-slate-600\">\n                            <X size={24} />\n                        </button>\n                    </div>\n\n                    {/* Tabs (Only visible if shift is open) */}\n                    {currentShift?.status === 'OPEN' && (\n                        <div className=\"flex border-b border-gray-100\">\n                            <button\n                                onClick={() => setActiveTab('EXPENSE')}\n                                className={`flex-1 py-4 text-sm font-semibold transition-colors ${activeTab === 'EXPENSE' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50' : 'text-slate-500 hover:bg-slate-50'}`}\n                            >\n                                Registrar Salida/Gasto\n                            </button>\n                            <button\n                                onClick={() => setActiveTab('CLOSING')}\n                                className={`flex-1 py-4 text-sm font-semibold transition-colors ${activeTab === 'CLOSING' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50' : 'text-slate-500 hover:bg-slate-50'}`}\n                            >\n                                Arqueo y Cierre\n                            </button>\n                        </div>\n                    )}\n\n                    {/* Content */}\n                    <div className=\"p-6 overflow-y-auto flex-1\">\n\n                        {/* A. OPENING */}\n                        {activeTab === 'OPENING' && (\n                            <div className=\"text-center py-8\">\n                                <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-600\">\n                                    <Lock size={40} />\n                                </div>\n                                <h3 className=\"text-2xl font-bold text-slate-800 mb-2\">Apertura de Caja</h3>\n                                <p className=\"text-slate-500 mb-8\">Ingresa el monto de dinero sencillo con el que inicias el turno.</p>\n\n                                <div className=\"max-w-xs mx-auto\">\n                                    <label className=\"block text-sm font-medium text-slate-700 mb-2 text-left\">Monto Inicial</label>\n                                    <div className=\"relative\">\n                                        <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-lg\">$</span>\n                                        <input\n                                            type=\"number\"\n                                            value={openingAmount}\n                                            onChange={(e) => setOpeningAmount(e.target.value)}\n                                            className=\"w-full pl-8 pr-4 py-4 text-2xl font-bold text-slate-800 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all\"\n                                            placeholder=\"0\"\n                                            autoFocus\n                                        />\n                                    </div>\n                                    <button\n                                        onClick={handleOpenShift}\n                                        disabled={!openingAmount}\n                                        className=\"w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold shadow-lg shadow-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all\"\n                                    >\n                                        Abrir Caja\n                                    </button>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* B. EXPENSE */}\n                        {activeTab === 'EXPENSE' && (\n                            <div className=\"space-y-6\">\n                                <div className=\"grid grid-cols-2 gap-6\">\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">Monto a Retirar</label>\n                                        <div className=\"relative\">\n                                            <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\">$</span>\n                                            <input\n                                                type=\"number\"\n                                                value={expenseAmount}\n                                                onChange={(e) => setExpenseAmount(e.target.value)}\n                                                className=\"w-full pl-8 pr-4 py-3 text-lg font-bold text-slate-800 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none\"\n                                                placeholder=\"0\"\n                                            />\n                                        </div>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">Motivo</label>\n                                        <select\n                                            value={expenseReason}\n                                            onChange={(e) => setExpenseReason(e.target.value as CashMovementReason)}\n                                            className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none\"\n                                        >\n                                            <option value=\"SUPPLIES\">Insumos / Gastos Menores</option>\n                                            <option value=\"SERVICES\">Pago Servicios</option>\n                                            <option value=\"WITHDRAWAL\">Retiro de Utilidades</option>\n                                            <option value=\"OTHER\">Otro</option>\n                                        </select>\n                                    </div>\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">Descripción / Justificación</label>\n                                    <textarea\n                                        value={expenseDescription}\n                                        onChange={(e) => setExpenseDescription(e.target.value)}\n                                        className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none h-24 resize-none\"\n                                        placeholder=\"Detalla el gasto (mínimo 10 caracteres si no hay foto)...\"\n                                    />\n                                </div>\n\n                                <div className=\"border-2 border-dashed border-slate-300 rounded-xl p-6 text-center hover:bg-slate-50 transition-colors cursor-pointer relative\">\n                                    <input\n                                        type=\"file\"\n                                        className=\"absolute inset-0 opacity-0 cursor-pointer\"\n                                        onChange={(e) => setExpenseEvidence('https://via.placeholder.com/300')} // Mock upload\n                                    />\n                                    {expenseEvidence ? (\n                                        <div className=\"flex items-center justify-center gap-2 text-green-600 font-medium\">\n                                            <CheckCircle size={20} />\n                                            Evidencia Cargada\n                                        </div>\n                                    ) : (\n                                        <div className=\"flex flex-col items-center gap-2 text-slate-400\">\n                                            <Camera size={32} />\n                                            <span className=\"text-sm font-medium\">Subir Foto Boleta / Comprobante</span>\n                                        </div>\n                                    )}\n                                </div>\n\n                                <button\n                                    onClick={handleRegisterExpense}\n                                    disabled={!expenseAmount || (!expenseEvidence && expenseDescription.length < 10)}\n                                    className=\"w-full bg-red-500 hover:bg-red-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-red-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2\"\n                                >\n                                    <TrendingDown size={20} />\n                                    Registrar Salida de Efectivo\n                                </button>\n                            </div>\n                        )}\n\n                        {/* C. CLOSING (RECONCILIATION) */}\n                        {activeTab === 'CLOSING' && metrics && (\n                            <div className=\"space-y-6\">\n                                {/* Waterfall */}\n                                <div className=\"space-y-3 bg-slate-50 p-6 rounded-2xl border border-slate-100\">\n                                    <div className=\"flex justify-between items-center text-slate-600\">\n                                        <span>(+) Ventas Totales</span>\n                                        <span className=\"font-medium\">${metrics.totalSales.toLocaleString()}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center text-slate-400 text-sm\">\n                                        <span>(-) Tarjetas / Transferencias</span>\n                                        <span>-${(metrics.cardSales + metrics.transferSales).toLocaleString()}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center text-green-600 text-sm\">\n                                        <span>(+) Fondo Inicial</span>\n                                        <span>+${metrics.initialFund.toLocaleString()}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center text-red-500 text-sm\">\n                                        <span>(-) Gastos / Salidas</span>\n                                        <span>-${metrics.totalOutflows.toLocaleString()}</span>\n                                    </div>\n                                    <div className=\"h-px bg-slate-200 my-2\"></div>\n                                    <div className=\"flex justify-between items-center text-xl font-bold text-slate-800\">\n                                        <span>(=) DEBE HABER EN CAJA</span>\n                                        <span>${metrics.expectedCash.toLocaleString()}</span>\n                                    </div>\n                                </div>\n\n                                <div className=\"bg-blue-50 p-6 rounded-2xl border border-blue-100\">\n                                    <label className=\"block text-sm font-bold text-blue-900 mb-2 text-center\">DINERO CONTADO REAL (ARQUEO)</label>\n                                    <div className=\"relative max-w-xs mx-auto\">\n                                        <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-blue-400 text-xl\">$</span>\n                                        <input\n                                            type=\"number\"\n                                            value={closingAmount}\n                                            onChange={(e) => setClosingAmount(e.target.value)}\n                                            className=\"w-full pl-8 pr-4 py-4 text-3xl font-bold text-blue-900 bg-white border-2 border-blue-200 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-400 outline-none text-center\"\n                                            placeholder=\"0\"\n                                        />\n                                    </div>\n\n                                    {closingAmount && (\n                                        <div className={`mt-4 text-center font-bold p-3 rounded-lg ${parseInt(closingAmount) - metrics.expectedCash === 0 ? 'bg-green-100 text-green-700' :\n                                                parseInt(closingAmount) - metrics.expectedCash > 0 ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'\n                                            }`}>\n                                            {parseInt(closingAmount) - metrics.expectedCash === 0 ? 'Cuadratura Perfecta ✨' :\n                                                parseInt(closingAmount) - metrics.expectedCash > 0 ? `Sobrante: +$${(parseInt(closingAmount) - metrics.expectedCash).toLocaleString()}` :\n                                                    `Faltante: -$${Math.abs(parseInt(closingAmount) - metrics.expectedCash).toLocaleString()}`}\n                                        </div>\n                                    )}\n                                </div>\n\n                                <button\n                                    onClick={handleCloseShift}\n                                    disabled={!closingAmount}\n                                    className=\"w-full bg-slate-900 hover:bg-slate-800 text-white py-4 rounded-xl font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2\"\n                                >\n                                    <Lock size={20} />\n                                    Cerrar Turno y Generar Reporte\n                                </button>\n                            </div>\n                        )}\n                    </div>\n                </motion.div>\n            </motion.div>\n        </AnimatePresence>\n    );\n};\n\nexport default CashManagementModal;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;AAQA,MAAM,sBAA0D,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE;;IAChF,MAAM,EAAE,YAAY,EAAE,SAAS,EAAE,UAAU,EAAE,oBAAoB,EAAE,eAAe,EAAE,GAAG,IAAA,6JAAc;IACrG,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAoC;IAE9E,gBAAgB;IAChB,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IAEnD,gBAAgB;IAChB,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAqB;IACvE,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,yKAAQ,EAAC;IAC7D,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAgB;IAEtE,gBAAgB;IAChB,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAM;IAE5C,IAAA,0KAAS;yCAAC;YACN,IAAI,QAAQ;gBACR,IAAI,CAAC,gBAAgB,aAAa,MAAM,KAAK,UAAU;oBACnD,aAAa;gBACjB,OAAO;oBACH,aAAa,YAAY,6BAA6B;oBACtD,WAAW;gBACf;YACJ;QACJ;wCAAG;QAAC;QAAQ;KAAa;IAEzB,IAAA,0KAAS;yCAAC;YACN,IAAI,cAAc,WAAW,QAAQ;gBACjC,MAAM,WAAW;8DAAY;wBACzB,WAAW;oBACf;6DAAG,OAAO,8BAA8B;gBACxC;qDAAO,IAAM,cAAc;;YAC/B;QACJ;wCAAG;QAAC;KAAa;IAGjB,MAAM,kBAAkB;QACpB,MAAM,SAAS,SAAS;QACxB,IAAI,MAAM,WAAW,SAAS,GAAG;QACjC,UAAU;QACV,aAAa;IACjB;IAEA,MAAM,wBAAwB;QAC1B,MAAM,SAAS,SAAS;QACxB,IAAI,MAAM,WAAW,UAAU,GAAG;QAClC,IAAI,CAAC,mBAAmB,mBAAmB,MAAM,GAAG,IAAI,QAAQ,kBAAkB;QAElF,qBAAqB;YACjB,MAAM;YACN;YACA,QAAQ;YACR,aAAa;YACb,cAAc,mBAAmB;YACjC,SAAS;QACb;QAEA,aAAa;QACb,iBAAiB;QACjB,sBAAsB;QACtB,mBAAmB;QACnB,MAAM;IACV;IAEA,MAAM,mBAAmB;QACrB,MAAM,SAAS,SAAS;QACxB,IAAI,MAAM,WAAW,SAAS,GAAG;QAEjC,IAAI,OAAO,OAAO,CAAC,uEAAuE;YACtF,WAAW;YACX;QACJ;IACJ;IAEA,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACI,6LAAC,+MAAe;kBACZ,cAAA,6LAAC,uMAAM,CAAC,GAAG;YACP,SAAS;gBAAE,SAAS;YAAE;YACtB,SAAS;gBAAE,SAAS;YAAE;YACtB,MAAM;gBAAE,SAAS;YAAE;YACnB,WAAU;sBAEV,cAAA,6LAAC,uMAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,OAAO;oBAAM,SAAS;gBAAE;gBACnC,SAAS;oBAAE,OAAO;oBAAG,SAAS;gBAAE;gBAChC,MAAM;oBAAE,OAAO;oBAAM,SAAS;gBAAE;gBAChC,WAAU;;kCAGV,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;;kDACG,6LAAC;wCAAG,WAAU;;0DACV,6LAAC,mOAAU;gDAAC,WAAU;;;;;;4CAAkB;;;;;;;kDAG5C,6LAAC;wCAAE,WAAU;kDACR,cAAc,WAAW,SAAS,CAAC,wBAAwB,EAAE,IAAI,KAAK,aAAa,UAAU,EAAE,kBAAkB,IAAI,GAAG;;;;;;;;;;;;0CAGjI,6LAAC;gCAAO,SAAS;gCAAS,WAAU;0CAChC,cAAA,6LAAC,oMAAC;oCAAC,MAAM;;;;;;;;;;;;;;;;;oBAKhB,cAAc,WAAW,wBACtB,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCACG,SAAS,IAAM,aAAa;gCAC5B,WAAW,CAAC,oDAAoD,EAAE,cAAc,YAAY,2DAA2D,oCAAoC;0CAC9L;;;;;;0CAGD,6LAAC;gCACG,SAAS,IAAM,aAAa;gCAC5B,WAAW,CAAC,oDAAoD,EAAE,cAAc,YAAY,2DAA2D,oCAAoC;0CAC9L;;;;;;;;;;;;kCAOT,6LAAC;wBAAI,WAAU;;4BAGV,cAAc,2BACX,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAI,WAAU;kDACX,cAAA,6LAAC,6MAAI;4CAAC,MAAM;;;;;;;;;;;kDAEhB,6LAAC;wCAAG,WAAU;kDAAyC;;;;;;kDACvD,6LAAC;wCAAE,WAAU;kDAAsB;;;;;;kDAEnC,6LAAC;wCAAI,WAAU;;0DACX,6LAAC;gDAAM,WAAU;0DAA0D;;;;;;0DAC3E,6LAAC;gDAAI,WAAU;;kEACX,6LAAC;wDAAK,WAAU;kEAAkE;;;;;;kEAClF,6LAAC;wDACG,MAAK;wDACL,OAAO;wDACP,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;wDAChD,WAAU;wDACV,aAAY;wDACZ,SAAS;;;;;;;;;;;;0DAGjB,6LAAC;gDACG,SAAS;gDACT,UAAU,CAAC;gDACX,WAAU;0DACb;;;;;;;;;;;;;;;;;;4BAQZ,cAAc,2BACX,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCAAI,WAAU;;0DACX,6LAAC;;kEACG,6LAAC;wDAAM,WAAU;kEAAgD;;;;;;kEACjE,6LAAC;wDAAI,WAAU;;0EACX,6LAAC;gEAAK,WAAU;0EAA0D;;;;;;0EAC1E,6LAAC;gEACG,MAAK;gEACL,OAAO;gEACP,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;gEAChD,WAAU;gEACV,aAAY;;;;;;;;;;;;;;;;;;0DAIxB,6LAAC;;kEACG,6LAAC;wDAAM,WAAU;kEAAgD;;;;;;kEACjE,6LAAC;wDACG,OAAO;wDACP,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;wDAChD,WAAU;;0EAEV,6LAAC;gEAAO,OAAM;0EAAW;;;;;;0EACzB,6LAAC;gEAAO,OAAM;0EAAW;;;;;;0EACzB,6LAAC;gEAAO,OAAM;0EAAa;;;;;;0EAC3B,6LAAC;gEAAO,OAAM;0EAAQ;;;;;;;;;;;;;;;;;;;;;;;;kDAKlC,6LAAC;;0DACG,6LAAC;gDAAM,WAAU;0DAAgD;;;;;;0DACjE,6LAAC;gDACG,OAAO;gDACP,UAAU,CAAC,IAAM,sBAAsB,EAAE,MAAM,CAAC,KAAK;gDACrD,WAAU;gDACV,aAAY;;;;;;;;;;;;kDAIpB,6LAAC;wCAAI,WAAU;;0DACX,6LAAC;gDACG,MAAK;gDACL,WAAU;gDACV,UAAU,CAAC,IAAM,mBAAmB;;;;;;4CAEvC,gCACG,6LAAC;gDAAI,WAAU;;kEACX,6LAAC,6OAAW;wDAAC,MAAM;;;;;;oDAAM;;;;;;yGAI7B,6LAAC;gDAAI,WAAU;;kEACX,6LAAC,mNAAM;wDAAC,MAAM;;;;;;kEACd,6LAAC;wDAAK,WAAU;kEAAsB;;;;;;;;;;;;;;;;;;kDAKlD,6LAAC;wCACG,SAAS;wCACT,UAAU,CAAC,iBAAkB,CAAC,mBAAmB,mBAAmB,MAAM,GAAG;wCAC7E,WAAU;;0DAEV,6LAAC,yOAAY;gDAAC,MAAM;;;;;;4CAAM;;;;;;;;;;;;;4BAOrC,cAAc,aAAa,yBACxB,6LAAC;gCAAI,WAAU;;kDAEX,6LAAC;wCAAI,WAAU;;0DACX,6LAAC;gDAAI,WAAU;;kEACX,6LAAC;kEAAK;;;;;;kEACN,6LAAC;wDAAK,WAAU;;4DAAc;4DAAE,QAAQ,UAAU,CAAC,cAAc;;;;;;;;;;;;;0DAErE,6LAAC;gDAAI,WAAU;;kEACX,6LAAC;kEAAK;;;;;;kEACN,6LAAC;;4DAAK;4DAAG,CAAC,QAAQ,SAAS,GAAG,QAAQ,aAAa,EAAE,cAAc;;;;;;;;;;;;;0DAEvE,6LAAC;gDAAI,WAAU;;kEACX,6LAAC;kEAAK;;;;;;kEACN,6LAAC;;4DAAK;4DAAG,QAAQ,WAAW,CAAC,cAAc;;;;;;;;;;;;;0DAE/C,6LAAC;gDAAI,WAAU;;kEACX,6LAAC;kEAAK;;;;;;kEACN,6LAAC;;4DAAK;4DAAG,QAAQ,aAAa,CAAC,cAAc;;;;;;;;;;;;;0DAEjD,6LAAC;gDAAI,WAAU;;;;;;0DACf,6LAAC;gDAAI,WAAU;;kEACX,6LAAC;kEAAK;;;;;;kEACN,6LAAC;;4DAAK;4DAAE,QAAQ,YAAY,CAAC,cAAc;;;;;;;;;;;;;;;;;;;kDAInD,6LAAC;wCAAI,WAAU;;0DACX,6LAAC;gDAAM,WAAU;0DAAyD;;;;;;0DAC1E,6LAAC;gDAAI,WAAU;;kEACX,6LAAC;wDAAK,WAAU;kEAAiE;;;;;;kEACjF,6LAAC;wDACG,MAAK;wDACL,OAAO;wDACP,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;wDAChD,WAAU;wDACV,aAAY;;;;;;;;;;;;4CAInB,+BACG,6LAAC;gDAAI,WAAW,CAAC,0CAA0C,EAAE,SAAS,iBAAiB,QAAQ,YAAY,KAAK,IAAI,gCAC5G,SAAS,iBAAiB,QAAQ,YAAY,GAAG,IAAI,8BAA8B,2BACrF;0DACD,SAAS,iBAAiB,QAAQ,YAAY,KAAK,IAAI,0BACpD,SAAS,iBAAiB,QAAQ,YAAY,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC,SAAS,iBAAiB,QAAQ,YAAY,EAAE,cAAc,IAAI,GACnI,CAAC,YAAY,EAAE,KAAK,GAAG,CAAC,SAAS,iBAAiB,QAAQ,YAAY,EAAE,cAAc,IAAI;;;;;;;;;;;;kDAK9G,6LAAC;wCACG,SAAS;wCACT,UAAU,CAAC;wCACX,WAAU;;0DAEV,6LAAC,6MAAI;gDAAC,MAAM;;;;;;4CAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUtD;GA7SM;;QACqF,6JAAc;;;KADnG;uCA+SS"}},
    {"offset": {"line": 3126, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/POSMainScreen.tsx"],"sourcesContent":["'use client';\nimport React, { useState, useMemo } from 'react';\nimport { usePharmaStore } from '../store/useStore';\nimport { Search, Plus, X, Tag, CreditCard, Banknote, Smartphone, AlertTriangle, ShoppingCart, PlusCircle, Coins, DollarSign, Lock as LockIcon } from 'lucide-react';\nimport ClinicalSidebar from './clinical/ClinicalSidebar';\nimport { ClinicalAgent } from '../../domain/logic/clinicalAgent';\nimport ClientPanel from './pos/ClientPanel';\nimport PrescriptionModal from './pos/PrescriptionModal';\nimport ManualItemModal from './pos/ManualItemModal';\nimport CashManagementModal from './pos/CashManagementModal';\nimport { CartItem } from '../../domain/types';\n\nconst POSMainScreen: React.FC = () => {\n    const {\n        inventory, cart, addToCart, addManualItem, removeFromCart, clearCart,\n        processSale, currentCustomer, currentShift\n    } = usePharmaStore();\n\n    const total = useMemo(() => cart.reduce((sum, item) => sum + item.price * item.quantity, 0), [cart]);\n    const [searchTerm, setSearchTerm] = useState('');\n    const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false);\n    const [isPrescriptionModalOpen, setIsPrescriptionModalOpen] = useState(false);\n    const [isManualItemModalOpen, setIsManualItemModalOpen] = useState(false);\n    const [isCashModalOpen, setIsCashModalOpen] = useState(false);\n    const [pendingItemForPrescription, setPendingItemForPrescription] = useState<CartItem | null>(null);\n    const [paymentMethod, setPaymentMethod] = useState<'CASH' | 'DEBIT' | 'TRANSFER'>('CASH');\n    const [transferId, setTransferId] = useState('');\n\n    // FEFO Sorting & Filtering\n    const filteredInventory = useMemo(() => {\n        return inventory\n            .filter(item =>\n                item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                item.dci.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                item.sku.toLowerCase().includes(searchTerm.toLowerCase())\n            )\n            .sort((a, b) => a.expiry_date - b.expiry_date); // FEFO: First Expired, First Out\n    }, [inventory, searchTerm]);\n\n    // Clinical Analysis\n    const clinicalAnalysis = ClinicalAgent.analyzeCart(cart, currentCustomer || undefined);\n    const cartTotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);\n\n    // Check for Restricted Items (R/RR/RCH)\n    const isRestricted = (item: CartItem) => {\n        const inventoryItem = inventory.find(i => i.id === item.id);\n        return inventoryItem && (inventoryItem.condition === 'R' || inventoryItem.condition === 'RR' || inventoryItem.condition === 'RCH');\n    };\n    const hasRestrictedItems = cart.some(isRestricted);\n\n    const handlePrePayment = () => {\n        if (hasRestrictedItems) {\n            setIsPrescriptionModalOpen(true);\n        } else {\n            setIsPaymentModalOpen(true);\n        }\n    };\n\n    const handlePrescriptionConfirm = (data: { folio: string, doctorRut: string }) => {\n        setIsPrescriptionModalOpen(false);\n        setIsPaymentModalOpen(true); // Proceed to payment\n        // In a real app, we would store prescription data in the transaction here\n    };\n\n    const handlePayment = () => {\n        if (paymentMethod === 'TRANSFER' && !transferId) {\n            alert('Debe ingresar el ID de transacción');\n            return;\n        }\n        processSale(paymentMethod, currentCustomer || undefined);\n        setIsPaymentModalOpen(false);\n        setTransferId('');\n        alert('¡Venta Exitosa! Boleta generada.');\n    };\n\n    const getExpiryStatus = (timestamp: number) => {\n        const months = (timestamp - Date.now()) / (1000 * 60 * 60 * 24 * 30);\n        if (months < 3) return 'border-amber-400 bg-amber-50';\n        return 'border-slate-100 bg-white';\n    };\n\n    return (\n        <div className=\"grid grid-cols-12 gap-6 h-[calc(100vh-80px)] p-6 bg-slate-100\">\n\n            {/* COL 1: Catálogo (5 cols) */}\n            <div className=\"col-span-5 flex flex-col bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden\">\n                <div className=\"p-6 border-b border-slate-100\">\n                    <h2 className=\"text-xl font-bold text-slate-800 mb-4\">Catálogo</h2>\n                    <div className=\"relative\">\n                        <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\" size={20} />\n                        <input\n                            type=\"text\"\n                            placeholder=\"Buscar por Nombre, SKU o DCI...\"\n                            className=\"w-full pl-12 pr-4 py-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none transition-colors font-medium\"\n                            value={searchTerm}\n                            onChange={(e) => setSearchTerm(e.target.value)}\n                        />\n                    </div>\n                </div>\n\n                <div className=\"flex-1 overflow-y-auto p-6 grid grid-cols-2 gap-4 content-start\">\n                    {filteredInventory.map(item => (\n                        <div\n                            key={item.id}\n                            onClick={() => addToCart(item, 1)}\n                            className={`group p-4 rounded-2xl border hover:shadow-md transition-all cursor-pointer flex flex-col justify-between ${getExpiryStatus(item.expiry_date)}`}\n                        >\n                            <div>\n                                <div className=\"flex justify-between items-start mb-2\">\n                                    <span className={`text-[10px] font-bold px-2 py-1 rounded-full ${item.category === 'MEDICAMENTO' ? 'bg-blue-50 text-blue-600' : 'bg-pink-50 text-pink-600'}`}>\n                                        {item.category.substring(0, 3)}\n                                    </span>\n                                    <span className=\"text-xs font-mono text-slate-400\">{item.sku}</span>\n                                </div>\n                                <h3 className=\"font-bold text-slate-700 leading-tight mb-1 group-hover:text-cyan-700 transition-colors\">{item.name}</h3>\n                                <p className=\"text-xs text-slate-500 mb-3\">{item.dci}</p>\n                                <p className=\"text-[10px] text-slate-400 flex items-center gap-1\">\n                                    <ClockIcon size={10} /> Vence: {new Date(item.expiry_date).toLocaleDateString()}\n                                </p>\n                            </div>\n                            <div className=\"flex justify-between items-end mt-2\">\n                                <span className=\"text-lg font-bold text-slate-900\">${item.price.toLocaleString('es-CL')}</span>\n                                <div className=\"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center group-hover:bg-cyan-600 group-hover:text-white transition-colors\">\n                                    <Plus size={16} />\n                                </div>\n                            </div>\n                        </div>\n                    ))}\n                </div>\n            </div>\n\n            {/* COL 2: Clinical Copilot (3 cols) */}\n            <div className=\"col-span-3 flex flex-col gap-4\">\n                <ClientPanel />\n                <div className=\"flex-1\">\n                    <ClinicalSidebar analysis={clinicalAnalysis} lastChecked={Date.now()} />\n                </div>\n            </div>\n\n            {/* COL 3: Carrito (4 cols) */}\n            <div className=\"col-span-4 flex flex-col bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden\">\n                <div className=\"p-6 bg-slate-50 border-b border-slate-100 flex justify-between items-center\">\n                    <div>\n                        <h2 className=\"text-xl font-bold text-slate-800\">Carrito Actual</h2>\n                        <p className=\"text-sm text-slate-500\">{cart.length} ítems</p>\n                    </div>\n                    <div className=\"flex items-center gap-3\">\n                        <button\n                            onClick={() => setIsCashModalOpen(true)}\n                            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${currentShift?.status === 'OPEN'\n                                ? 'bg-green-100 text-green-700 hover:bg-green-200'\n                                : 'bg-red-100 text-red-700 hover:bg-red-200 animate-pulse'\n                                }`}\n                        >\n                            {currentShift?.status === 'OPEN' ? <DollarSign size={18} /> : <LockIcon size={18} />}\n                            {currentShift?.status === 'OPEN' ? 'Caja Abierta' : 'Caja Cerrada'}\n                        </button>\n\n                        <button\n                            onClick={() => setIsManualItemModalOpen(true)}\n                            className=\"flex items-center gap-2 bg-purple-100 text-purple-700 px-4 py-2 rounded-lg hover:bg-purple-200 font-medium transition-colors\"\n                        >\n                            <Plus size={18} />\n                            Item Manual\n                        </button>\n                    </div>\n                </div>\n\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n                    {cart.length === 0 ? (\n                        <div className=\"h-full flex flex-col items-center justify-center text-slate-400 opacity-50\">\n                            <ShoppingCart size={48} className=\"mb-4\" />\n                            <p>Carrito vacío</p>\n                        </div>\n                    ) : (\n                        cart.map((item, idx) => (\n                            <div key={idx} className=\"flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100\">\n                                <div className=\"flex-1\">\n                                    <h4 className=\"font-bold text-slate-700 text-sm\">{item.name}</h4>\n                                    <div className=\"flex items-center gap-2 mt-1\">\n                                        <span className=\"text-xs text-slate-500\">{item.quantity} x ${item.price.toLocaleString()}</span>\n                                        {item.allows_commission && (\n                                            <span className=\"flex items-center gap-1 text-[10px] bg-emerald-100 text-emerald-700 px-1.5 py-0.5 rounded font-bold border border-emerald-200\" title=\"Comisionable\">\n                                                <Coins size={10} /> COMISIÓN\n                                            </span>\n                                        )}\n                                    </div>\n                                </div>\n                                <div className=\"flex items-center gap-3\">\n                                    <span className=\"font-bold text-slate-900\">${(item.price * item.quantity).toLocaleString()}</span>\n                                    <button onClick={() => removeFromCart(item.sku)} className=\"text-slate-400 hover:text-red-500 transition-colors\">\n                                        <X size={18} />\n                                    </button>\n                                </div>\n                            </div>\n                        ))\n                    )}\n                </div>\n\n                <div className=\"p-6 bg-slate-50 border-t border-slate-200\">\n                    <div className=\"flex justify-between items-end mb-6\">\n                        <span className=\"text-slate-500 font-medium\">Total a Pagar</span>\n                        <span className=\"text-3xl font-extrabold text-slate-900\">${cartTotal.toLocaleString('es-CL')}</span>\n                    </div>\n\n                    <button\n                        onClick={handlePrePayment}\n                        disabled={cart.length === 0 || clinicalAnalysis.status === 'BLOCK'}\n                        className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all flex items-center justify-center gap-2\n                            ${clinicalAnalysis.status === 'BLOCK'\n                                ? 'bg-slate-200 text-slate-400 cursor-not-allowed'\n                                : 'bg-emerald-600 text-white hover:bg-emerald-700 shadow-emerald-200'\n                            }`}\n                    >\n                        {clinicalAnalysis.status === 'BLOCK' ? '⛔ VENTA BLOQUEADA' : 'PAGAR AHORA'}\n                    </button>\n                </div>\n            </div>\n\n            {/* Modals */}\n            <PrescriptionModal\n                isOpen={isPrescriptionModalOpen}\n                onCancel={() => setIsPrescriptionModalOpen(false)}\n                onConfirm={handlePrescriptionConfirm}\n                itemName={pendingItemForPrescription?.name || ''}\n            />\n\n            <ManualItemModal\n                isOpen={isManualItemModalOpen}\n                onClose={() => setIsManualItemModalOpen(false)}\n                onConfirm={(item) => { addManualItem(item); setIsManualItemModalOpen(false); }}\n            />\n\n            <CashManagementModal\n                isOpen={isCashModalOpen}\n                onClose={() => setIsCashModalOpen(false)}\n            />\n\n            {/* Payment Modal */}\n            {isPaymentModalOpen && (\n                <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n                    <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200\">\n                        <div className=\"p-6 border-b border-slate-100 flex justify-between items-center\">\n                            <h3 className=\"text-xl font-bold text-slate-800\">Finalizar Venta</h3>\n                            <button onClick={() => setIsPaymentModalOpen(false)}><X className=\"text-slate-400\" /></button>\n                        </div>\n\n                        <div className=\"p-6\">\n                            <div className=\"grid grid-cols-3 gap-4 mb-8\">\n                                <button\n                                    onClick={() => setPaymentMethod('CASH')}\n                                    className={`p-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all ${paymentMethod === 'CASH' ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-slate-100 text-slate-400'}`}\n                                >\n                                    <Banknote size={24} />\n                                    <span className=\"text-xs font-bold\">EFECTIVO</span>\n                                </button>\n                                <button\n                                    onClick={() => setPaymentMethod('DEBIT')}\n                                    className={`p-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all ${paymentMethod === 'DEBIT' ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-100 text-slate-400'}`}\n                                >\n                                    <CreditCard size={24} />\n                                    <span className=\"text-xs font-bold\">TARJETA</span>\n                                </button>\n                                <button\n                                    onClick={() => setPaymentMethod('TRANSFER')}\n                                    className={`p-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all ${paymentMethod === 'TRANSFER' ? 'border-purple-500 bg-purple-50 text-purple-700' : 'border-slate-100 text-slate-400'}`}\n                                >\n                                    <Smartphone size={24} />\n                                    <span className=\"text-xs font-bold\">TRANSF.</span>\n                                </button>\n                            </div>\n\n                            {paymentMethod === 'TRANSFER' && (\n                                <div className=\"mb-6 animate-in fade-in slide-in-from-top-2\">\n                                    <label className=\"block text-sm font-bold text-slate-700 mb-2\">ID de Transacción</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-3 border-2 border-slate-300 rounded-xl focus:border-purple-500 focus:outline-none\"\n                                        placeholder=\"Ej: 12345678\"\n                                        value={transferId}\n                                        onChange={(e) => setTransferId(e.target.value)}\n                                    />\n                                    <p className=\"text-xs text-slate-400 mt-2 flex items-center\"><AlertTriangle size={12} className=\"mr-1\" /> Verifique el comprobante antes de confirmar.</p>\n                                </div>\n                            )}\n\n                            <button\n                                onClick={handlePayment}\n                                className=\"w-full py-4 bg-slate-900 text-white rounded-xl font-bold hover:bg-slate-800 transition-colors\"\n                            >\n                                Confirmar Pago (${cartTotal.toLocaleString()})\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n\n// Helper Icon\nconst ClockIcon = ({ size }: { size: number }) => (\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\" />\n        <polyline points=\"12 6 12 12 16 14\" />\n    </svg>\n);\n\nexport default POSMainScreen;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3994, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/logic/purchasingAgent.ts"],"sourcesContent":["import { InventoryBatch, PurchaseOrder, Supplier } from '../types';\n\nexport const PurchasingAgent = {\n    /**\n     * Calcula la velocidad de venta diaria (Mock simple para MVP).\n     * En producción, esto vendría de un análisis histórico de transacciones.\n     */\n    calculateDailyVelocity(sku: string): number {\n        // Simulación: Genera un número entre 0.5 y 5 unidades diarias\n        // Usamos el SKU para que sea determinista (mismo SKU siempre da mismo resultado)\n        const hash = sku.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);\n        return (hash % 10) / 2 + 0.5;\n    },\n\n    /**\n     * Genera sugerencias de reabastecimiento agrupadas por proveedor.\n     * Regla: Si Stock Actual < (Velocidad * LeadTime * 1.5 SafetyFactor), pedir para cubrir 15 días.\n     */\n    generateSuggestions(inventory: InventoryBatch[], suppliers: Supplier[]): PurchaseOrder[] {\n        const suggestions: PurchaseOrder[] = [];\n        const itemsBySupplier: { [supplierId: string]: any[] } = {};\n\n        inventory.forEach(item => {\n            const velocity = this.calculateDailyVelocity(item.sku);\n            const supplier = suppliers.find(s => s.id === item.supplier_id);\n            const leadTime = supplier ? supplier.lead_time_days : 3; // Default 3 días\n\n            const safetyStock = velocity * leadTime * 1.5;\n            // 3. Check for expiring batches (FEFO)\n            const expiringBatches = inventory.filter(b =>\n                b.sku === item.sku &&\n                b.expiry_date < Date.now() + (90 * 24 * 60 * 60 * 1000)\n            );\n\n            if (expiringBatches.length > 0) {\n                suggestions.push({\n                    id: `PO-${Date.now()}-${item.sku}`,\n                    supplier_id: 'SUP-001', // Default\n                    items: [{\n                        sku: item.sku,\n                        name: item.name,\n                        quantity: Math.max(50, Math.ceil(velocity * 30)), // Buy for 30 days\n                        cost_price: item.price * 0.6\n                    }],\n                    status: 'DRAFT',\n                    created_at: Date.now(),\n                    total_estimated: 0\n                });\n            }\n            const reorderPoint = safetyStock;\n\n            if (item.stock_actual <= reorderPoint) {\n                const supplierId = item.supplier_id || 'SUP-001';\n                if (!itemsBySupplier[supplierId]) {\n                    itemsBySupplier[supplierId] = [];\n                }\n                itemsBySupplier[supplierId].push({\n                    sku: item.sku,\n                    name: item.name,\n                    quantity: Math.max(50, Math.ceil(velocity * 15)), // Buy for 15 days\n                    cost_price: item.price * 0.6\n                });\n            }\n        });// Convertir agrupación a objetos PurchaseOrder\n        Object.keys(itemsBySupplier).forEach(supplierId => {\n            suggestions.push({\n                id: `PO-SUG-${Date.now()}-${supplierId.substring(0, 3)}`,\n                supplier_id: supplierId,\n                created_at: Date.now(),\n                status: 'SUGGESTED',\n                items: itemsBySupplier[supplierId],\n                total_estimated: 0 // Se calcularía con costos reales\n            });\n        });\n\n        return suggestions;\n    }\n};\n"],"names":[],"mappings":";;;;AAEO,MAAM,kBAAkB;IAC3B;;;KAGC,GACD,wBAAuB,GAAW;QAC9B,8DAA8D;QAC9D,iFAAiF;QACjF,MAAM,OAAO,IAAI,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,UAAU,CAAC,IAAI;QAC3E,OAAO,AAAC,OAAO,KAAM,IAAI;IAC7B;IAEA;;;KAGC,GACD,qBAAoB,SAA2B,EAAE,SAAqB;QAClE,MAAM,cAA+B,EAAE;QACvC,MAAM,kBAAmD,CAAC;QAE1D,UAAU,OAAO,CAAC,CAAA;YACd,MAAM,WAAW,IAAI,CAAC,sBAAsB,CAAC,KAAK,GAAG;YACrD,MAAM,WAAW,UAAU,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,KAAK,WAAW;YAC9D,MAAM,WAAW,WAAW,SAAS,cAAc,GAAG,GAAG,iBAAiB;YAE1E,MAAM,cAAc,WAAW,WAAW;YAC1C,uCAAuC;YACvC,MAAM,kBAAkB,UAAU,MAAM,CAAC,CAAA,IACrC,EAAE,GAAG,KAAK,KAAK,GAAG,IAClB,EAAE,WAAW,GAAG,KAAK,GAAG,KAAM,KAAK,KAAK,KAAK,KAAK;YAGtD,IAAI,gBAAgB,MAAM,GAAG,GAAG;gBAC5B,YAAY,IAAI,CAAC;oBACb,IAAI,CAAC,GAAG,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,GAAG,EAAE;oBAClC,aAAa;oBACb,OAAO;wBAAC;4BACJ,KAAK,KAAK,GAAG;4BACb,MAAM,KAAK,IAAI;4BACf,UAAU,KAAK,GAAG,CAAC,IAAI,KAAK,IAAI,CAAC,WAAW;4BAC5C,YAAY,KAAK,KAAK,GAAG;wBAC7B;qBAAE;oBACF,QAAQ;oBACR,YAAY,KAAK,GAAG;oBACpB,iBAAiB;gBACrB;YACJ;YACA,MAAM,eAAe;YAErB,IAAI,KAAK,YAAY,IAAI,cAAc;gBACnC,MAAM,aAAa,KAAK,WAAW,IAAI;gBACvC,IAAI,CAAC,eAAe,CAAC,WAAW,EAAE;oBAC9B,eAAe,CAAC,WAAW,GAAG,EAAE;gBACpC;gBACA,eAAe,CAAC,WAAW,CAAC,IAAI,CAAC;oBAC7B,KAAK,KAAK,GAAG;oBACb,MAAM,KAAK,IAAI;oBACf,UAAU,KAAK,GAAG,CAAC,IAAI,KAAK,IAAI,CAAC,WAAW;oBAC5C,YAAY,KAAK,KAAK,GAAG;gBAC7B;YACJ;QACJ,IAAG,+CAA+C;QAClD,OAAO,IAAI,CAAC,iBAAiB,OAAO,CAAC,CAAA;YACjC,YAAY,IAAI,CAAC;gBACb,IAAI,CAAC,OAAO,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,WAAW,SAAS,CAAC,GAAG,IAAI;gBACxD,aAAa;gBACb,YAAY,KAAK,GAAG;gBACpB,QAAQ;gBACR,OAAO,eAAe,CAAC,WAAW;gBAClC,iBAAiB,EAAE,kCAAkC;YACzD;QACJ;QAEA,OAAO;IACX;AACJ"}},
    {"offset": {"line": 4072, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/scm/BlindReceptionModal.tsx"],"sourcesContent":["\nimport React, { useState } from 'react';\nimport { Truck, Lock, Save } from 'lucide-react';\nimport { PurchaseOrder } from '../../../domain/types';\n\ninterface BlindReceptionModalProps {\n    order: PurchaseOrder;\n    onReceive: (order: PurchaseOrder, receivedItems: { sku: string; receivedQty: number }[]) => void;\n    onClose: () => void;\n}\n\nconst BlindReceptionModal: React.FC<BlindReceptionModalProps> = ({ order, onReceive, onClose }) => {\n    const [receivedQuantities, setReceivedQuantities] = useState<{ [sku: string]: number }>({});\n\n    const handleInputChange = (sku: string, value: string) => {\n        setReceivedQuantities(prev => ({\n            ...prev,\n            [sku]: parseInt(value) || 0\n        }));\n    };\n\n    const totalReceived = order.items.reduce((sum, item) => sum + (receivedQuantities[item.sku] || 0), 0);\n\n    // Comprobar si todas las cantidades han sido ingresadas manualmente\n    const isComplete = order.items.every(item => receivedQuantities[item.sku] !== undefined && receivedQuantities[item.sku] >= 0);\n\n    const inputStyle = \"w-full py-2 border-2 border-slate-400 rounded-lg text-center font-semibold text-lg text-slate-900\";\n\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white p-8 rounded-xl w-full max-w-2xl shadow-2xl\">\n                <h3 className=\"text-2xl font-bold text-slate-900 mb-6 flex items-center\">\n                    <Truck className=\"mr-3\" /> Recepción Ciega de Orden #{order.id}\n                </h3>\n\n                <p className=\"text-red-600 font-semibold mb-4 flex items-center\">\n                    <Lock size={18} className=\"mr-2\" /> La cantidad esperada (Expected Qty) NO es visible. Debe contar manualmente.\n                </p>\n\n                <div className=\"max-h-80 overflow-y-auto space-y-4 pr-2\">\n                    {order.items.map((item) => (\n                        <div key={item.sku} className=\"flex items-center justify-between border-b pb-3\">\n                            <p className=\"font-semibold text-slate-700 w-1/2\">{item.name}</p>\n                            <div className=\"w-1/3 ml-4\">\n                                <input\n                                    type=\"number\"\n                                    placeholder=\"Cantidad Real Recibida\"\n                                    className={inputStyle}\n                                    value={receivedQuantities[item.sku] || ''}\n                                    onChange={(e) => handleInputChange(item.sku, e.target.value)}\n                                />\n                            </div>\n                        </div>\n                    ))}\n                </div>\n\n                <div className=\"mt-8 pt-4 border-t border-slate-200\">\n                    <p className=\"text-xl font-bold text-slate-900 mb-4\">Total de Unidades Contadas: {totalReceived}</p>\n                    <button\n                        className=\"w-full py-3 bg-cyan-700 text-white font-bold rounded-xl hover:bg-cyan-800 transition disabled:opacity-50 flex items-center justify-center\"\n                        onClick={() => isComplete && onReceive(order, Object.entries(receivedQuantities).map(([sku, receivedQty]) => ({ sku, receivedQty })))}\n                        disabled={!isComplete}\n                    >\n                        <Save size={20} className=\"mr-2\" /> Confirmar Recepción Ciega\n                    </button>\n                    <button className=\"mt-2 w-full py-2 text-slate-600 hover:text-slate-900 transition\" onClick={onClose}>Cancelar</button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default BlindReceptionModal;\n"],"names":[],"mappings":";;;;;AACA;AACA;AAAA;AAAA;;;;;AASA,MAAM,sBAA0D,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE,OAAO,EAAE;;IAC1F,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,yKAAQ,EAA4B,CAAC;IAEzF,MAAM,oBAAoB,CAAC,KAAa;QACpC,sBAAsB,CAAA,OAAQ,CAAC;gBAC3B,GAAG,IAAI;gBACP,CAAC,IAAI,EAAE,SAAS,UAAU;YAC9B,CAAC;IACL;IAEA,MAAM,gBAAgB,MAAM,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,CAAC,kBAAkB,CAAC,KAAK,GAAG,CAAC,IAAI,CAAC,GAAG;IAEnG,oEAAoE;IACpE,MAAM,aAAa,MAAM,KAAK,CAAC,KAAK,CAAC,CAAA,OAAQ,kBAAkB,CAAC,KAAK,GAAG,CAAC,KAAK,aAAa,kBAAkB,CAAC,KAAK,GAAG,CAAC,IAAI;IAE3H,MAAM,aAAa;IAGnB,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAG,WAAU;;sCACV,6LAAC,gNAAK;4BAAC,WAAU;;;;;;wBAAS;wBAA4B,MAAM,EAAE;;;;;;;8BAGlE,6LAAC;oBAAE,WAAU;;sCACT,6LAAC,6MAAI;4BAAC,MAAM;4BAAI,WAAU;;;;;;wBAAS;;;;;;;8BAGvC,6LAAC;oBAAI,WAAU;8BACV,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,qBACd,6LAAC;4BAAmB,WAAU;;8CAC1B,6LAAC;oCAAE,WAAU;8CAAsC,KAAK,IAAI;;;;;;8CAC5D,6LAAC;oCAAI,WAAU;8CACX,cAAA,6LAAC;wCACG,MAAK;wCACL,aAAY;wCACZ,WAAW;wCACX,OAAO,kBAAkB,CAAC,KAAK,GAAG,CAAC,IAAI;wCACvC,UAAU,CAAC,IAAM,kBAAkB,KAAK,GAAG,EAAE,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;2BAR7D,KAAK,GAAG;;;;;;;;;;8BAe1B,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAE,WAAU;;gCAAwC;gCAA6B;;;;;;;sCAClF,6LAAC;4BACG,WAAU;4BACV,SAAS,IAAM,cAAc,UAAU,OAAO,OAAO,OAAO,CAAC,oBAAoB,GAAG,CAAC,CAAC,CAAC,KAAK,YAAY,GAAK,CAAC;wCAAE;wCAAK;oCAAY,CAAC;4BAClI,UAAU,CAAC;;8CAEX,6LAAC,6MAAI;oCAAC,MAAM;oCAAI,WAAU;;;;;;gCAAS;;;;;;;sCAEvC,6LAAC;4BAAO,WAAU;4BAAkE,SAAS;sCAAS;;;;;;;;;;;;;;;;;;;;;;;AAK1H;GA5DM;KAAA;uCA8DS"}},
    {"offset": {"line": 4257, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/SupplyChainPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { usePharmaStore } from '../store/useStore';\nimport { PurchasingAgent } from '../../domain/logic/purchasingAgent';\nimport { Package, Truck, CheckCircle, AlertCircle, Plus } from 'lucide-react';\nimport BlindReceptionModal from '../components/scm/BlindReceptionModal';\n\nconst SupplyChainPage: React.FC = () => {\n    const { inventory, suppliers, purchaseOrders, addPurchaseOrder, receivePurchaseOrder } = usePharmaStore();\n    const [isReceptionModalOpen, setIsReceptionModalOpen] = useState(false);\n    const [selectedOrder, setSelectedOrder] = useState<any>(null);\n\n    // Run Purchasing Agent on mount\n    useEffect(() => {\n        const suggestions = PurchasingAgent.generateSuggestions(inventory, suppliers);\n        // In a real app, we would diff this with existing POs to avoid duplicates\n        // For MVP, we just log them or add them if empty\n        if (purchaseOrders.length === 0 && suggestions.length > 0) {\n            suggestions.forEach(po => addPurchaseOrder(po));\n        }\n    }, []);\n\n    const KanbanColumn = ({ title, status, color, icon: Icon }: any) => {\n        const orders = purchaseOrders.filter(po => po.status === status);\n\n        return (\n            <div className=\"flex-1 min-w-[300px] bg-slate-100 rounded-3xl p-4 flex flex-col h-full\">\n                <div className={`flex items-center gap-2 mb-4 px-2 ${color}`}>\n                    <Icon size={20} />\n                    <h3 className=\"font-bold text-slate-700\">{title}</h3>\n                    <span className=\"ml-auto bg-white/50 px-2 py-1 rounded-full text-xs font-bold\">{orders.length}</span>\n                </div>\n\n                <div className=\"flex-1 overflow-y-auto space-y-3\">\n                    {orders.map(po => (\n                        <div key={po.id} className=\"bg-white p-4 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition-all cursor-pointer\">\n                            <div className=\"flex justify-between items-start mb-2\">\n                                <span className=\"text-xs font-mono text-slate-400\">{po.id}</span>\n                                <span className=\"text-xs font-bold text-slate-600\">{new Date(po.created_at).toLocaleDateString()}</span>\n                            </div>\n                            <h4 className=\"font-bold text-slate-800 mb-1\">{suppliers.find(s => s.id === po.supplier_id)?.name || 'Proveedor Desconocido'}</h4>\n                            <p className=\"text-sm text-slate-500 mb-3\">{po.items.length} Items</p>\n\n                            {status === 'SENT' && (\n                                <button\n                                    onClick={() => { setSelectedOrder(po); setIsReceptionModalOpen(true); }}\n                                    className=\"w-full py-2 bg-blue-600 text-white rounded-lg text-xs font-bold hover:bg-blue-700 transition\"\n                                >\n                                    RECEPCIONAR\n                                </button>\n                            )}\n                        </div>\n                    ))}\n                </div>\n            </div>\n        );\n    };\n\n    return (\n        <div className=\"h-screen p-6 bg-slate-50 flex flex-col\">\n            <header className=\"mb-8 flex justify-between items-center\">\n                <div>\n                    <h1 className=\"text-3xl font-extrabold text-slate-900\">Cadena de Suministro</h1>\n                    <p className=\"text-slate-500\">Gestión Inteligente de Abastecimiento</p>\n                </div>\n                <button className=\"flex items-center gap-2 px-6 py-3 bg-slate-900 text-white rounded-xl font-bold hover:bg-slate-800 transition shadow-lg\">\n                    <Plus size={20} /> Nueva Orden Manual\n                </button>\n            </header>\n\n            <div className=\"flex-1 flex gap-6 overflow-x-auto pb-4\">\n                <KanbanColumn title=\"Sugerido (IA)\" status=\"SUGGESTED\" color=\"text-purple-600\" icon={AlertCircle} />\n                <KanbanColumn title=\"Borrador\" status=\"DRAFT\" color=\"text-slate-600\" icon={Package} />\n                <KanbanColumn title=\"Enviado\" status=\"SENT\" color=\"text-blue-600\" icon={Truck} />\n                <KanbanColumn title=\"Completado\" status=\"COMPLETED\" color=\"text-emerald-600\" icon={CheckCircle} />\n            </div>\n\n            {isReceptionModalOpen && selectedOrder && (\n                <BlindReceptionModal\n                    order={selectedOrder}\n                    onClose={() => setIsReceptionModalOpen(false)}\n                    onReceive={(order, items) => {\n                        receivePurchaseOrder(order.id, items.map(i => ({ sku: i.sku, received_qty: i.receivedQty })));\n                        setIsReceptionModalOpen(false);\n                    }}\n                />\n            )}\n        </div>\n    );\n};\n\nexport default SupplyChainPage;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4552, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/AccessControlPage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { User, Clock, Coffee, LogOut, CheckCircle } from 'lucide-react';\nimport { motion } from 'framer-motion';\n\n// Mock Employees for Attendance Wall\nconst EMPLOYEES = [\n    { id: '1', name: 'Juan Pérez', role: 'QF', avatar: 'JP' },\n    { id: '2', name: 'María González', role: 'Caja', avatar: 'MG' },\n    { id: '3', name: 'Carlos Boss', role: 'Admin', avatar: 'CB' },\n    { id: '4', name: 'Ana Roja', role: 'Bodega', avatar: 'AR' },\n];\n\nconst AccessControlPage: React.FC = () => {\n    const [selectedEmployee, setSelectedEmployee] = useState<any>(null);\n    const [pin, setPin] = useState('');\n    const [status, setStatus] = useState<'IDLE' | 'SUCCESS'>('IDLE');\n    const [actionType, setActionType] = useState('');\n\n    const handlePinSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        // Mock validation\n        if (pin.length === 4) {\n            setStatus('SUCCESS');\n            setTimeout(() => {\n                setStatus('IDLE');\n                setSelectedEmployee(null);\n                setPin('');\n                setActionType('');\n            }, 3000);\n        }\n    };\n\n    const handleAction = (type: string) => {\n        setActionType(type);\n    };\n\n    return (\n        <div className=\"min-h-screen bg-slate-900 flex items-center justify-center p-8\">\n            <div className=\"w-full max-w-5xl\">\n                <header className=\"text-center mb-12\">\n                    <h1 className=\"text-4xl font-extrabold text-white mb-2\">Control de Asistencia</h1>\n                    <p className=\"text-slate-400 text-xl\">{new Date().toLocaleDateString('es-CL', { weekday: 'long', day: 'numeric', month: 'long' })}</p>\n                    <p className=\"text-cyan-400 text-3xl font-mono font-bold mt-2\">\n                        {new Date().toLocaleTimeString('es-CL', { hour: '2-digit', minute: '2-digit' })}\n                    </p>\n                </header>\n\n                {!selectedEmployee ? (\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6\">\n                        {EMPLOYEES.map(emp => (\n                            <motion.button\n                                key={emp.id}\n                                whileHover={{ scale: 1.05 }}\n                                whileTap={{ scale: 0.95 }}\n                                onClick={() => setSelectedEmployee(emp)}\n                                className=\"bg-slate-800 rounded-3xl p-8 flex flex-col items-center gap-4 hover:bg-slate-700 transition border border-slate-700 hover:border-cyan-500 group\"\n                            >\n                                <div className=\"w-24 h-24 rounded-full bg-slate-600 flex items-center justify-center text-2xl font-bold text-white group-hover:bg-cyan-600 transition-colors\">\n                                    {emp.avatar}\n                                </div>\n                                <div className=\"text-center\">\n                                    <h3 className=\"text-xl font-bold text-white\">{emp.name}</h3>\n                                    <p className=\"text-slate-400\">{emp.role}</p>\n                                </div>\n                            </motion.button>\n                        ))}\n                    </div>\n                ) : (\n                    <motion.div\n                        initial={{ opacity: 0, scale: 0.9 }}\n                        animate={{ opacity: 1, scale: 1 }}\n                        className=\"bg-white rounded-[3rem] p-12 max-w-2xl mx-auto shadow-2xl\"\n                    >\n                        {status === 'SUCCESS' ? (\n                            <div className=\"text-center py-12\">\n                                <CheckCircle size={80} className=\"text-emerald-500 mx-auto mb-6\" />\n                                <h2 className=\"text-3xl font-bold text-slate-900 mb-2\">¡Marca Registrada!</h2>\n                                <p className=\"text-xl text-slate-500\">Hola {selectedEmployee.name}, que tengas un buen turno.</p>\n                            </div>\n                        ) : (\n                            <>\n                                <div className=\"flex items-center gap-6 mb-8 pb-8 border-b border-slate-100\">\n                                    <div className=\"w-20 h-20 rounded-full bg-cyan-600 flex items-center justify-center text-2xl font-bold text-white\">\n                                        {selectedEmployee.avatar}\n                                    </div>\n                                    <div>\n                                        <h2 className=\"text-3xl font-bold text-slate-900\">{selectedEmployee.name}</h2>\n                                        <button onClick={() => setSelectedEmployee(null)} className=\"text-slate-400 hover:text-slate-600 font-medium\">\n                                            Cambiar Usuario\n                                        </button>\n                                    </div>\n                                </div>\n\n                                {!actionType ? (\n                                    <div className=\"grid grid-cols-2 gap-4\">\n                                        <button onClick={() => handleAction('IN')} className=\"p-6 bg-emerald-50 rounded-2xl border-2 border-emerald-100 hover:border-emerald-500 flex flex-col items-center gap-2 transition\">\n                                            <Clock size={32} className=\"text-emerald-600\" />\n                                            <span className=\"font-bold text-emerald-800\">ENTRADA</span>\n                                        </button>\n                                        <button onClick={() => handleAction('OUT')} className=\"p-6 bg-red-50 rounded-2xl border-2 border-red-100 hover:border-red-500 flex flex-col items-center gap-2 transition\">\n                                            <LogOut size={32} className=\"text-red-600\" />\n                                            <span className=\"font-bold text-red-800\">SALIDA</span>\n                                        </button>\n                                        <button onClick={() => handleAction('BREAK')} className=\"col-span-2 p-6 bg-orange-50 rounded-2xl border-2 border-orange-100 hover:border-orange-500 flex flex-col items-center gap-2 transition\">\n                                            <Coffee size={32} className=\"text-orange-600\" />\n                                            <span className=\"font-bold text-orange-800\">COLACIÓN</span>\n                                        </button>\n                                    </div>\n                                ) : (\n                                    <form onSubmit={handlePinSubmit}>\n                                        <h3 className=\"text-center text-xl font-bold text-slate-700 mb-6\">Ingrese su PIN para confirmar</h3>\n                                        <input\n                                            type=\"password\"\n                                            maxLength={4}\n                                            autoFocus\n                                            className=\"w-full text-center text-5xl tracking-[1em] font-bold py-6 border-b-4 border-slate-200 focus:border-cyan-600 focus:outline-none mb-8\"\n                                            value={pin}\n                                            onChange={(e) => setPin(e.target.value)}\n                                        />\n                                        <div className=\"grid grid-cols-2 gap-4\">\n                                            <button type=\"button\" onClick={() => setActionType('')} className=\"py-4 rounded-xl font-bold text-slate-500 bg-slate-100\">\n                                                Volver\n                                            </button>\n                                            <button type=\"submit\" className=\"py-4 rounded-xl font-bold text-white bg-cyan-600 hover:bg-cyan-700 shadow-lg\">\n                                                Confirmar\n                                            </button>\n                                        </div>\n                                    </form>\n                                )}\n                            </>\n                        )}\n                    </motion.div>\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default AccessControlPage;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4981, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/infrastructure/biometrics/WebAuthnService.ts"],"sourcesContent":["// src/infrastructure/biometrics/WebAuthnService.ts\n\nexport class WebAuthnService {\n\n    // Simula el registro de una credencial biométrica\n    static async registerCredential(userId: string): Promise<{ success: boolean; credentialId?: string; message: string }> {\n        return new Promise((resolve) => {\n            console.log(`[WebAuthn] Iniciando registro para usuario: ${userId}`);\n\n            // Simular espera del usuario tocando el sensor\n            setTimeout(() => {\n                const mockCredentialId = `cred-${userId}-${Date.now()}`;\n                console.log(`[WebAuthn] Credencial creada: ${mockCredentialId}`);\n                resolve({\n                    success: true,\n                    credentialId: mockCredentialId,\n                    message: 'Huella registrada correctamente.'\n                });\n            }, 2000); // 2 segundos de \"escaneo\"\n        });\n    }\n\n    // Simula la verificación de una credencial\n    static async verifyCredential(userId: string): Promise<{ success: boolean; message: string }> {\n        return new Promise((resolve) => {\n            console.log(`[WebAuthn] Solicitando verificación para usuario: ${userId}`);\n\n            // Simular interacción\n            setTimeout(() => {\n                // En un caso real, aquí se validaría la firma criptográfica\n                const isSuccess = Math.random() > 0.1; // 90% de éxito simulado\n\n                if (isSuccess) {\n                    console.log(`[WebAuthn] Verificación exitosa.`);\n                    resolve({ success: true, message: 'Identidad verificada.' });\n                } else {\n                    console.warn(`[WebAuthn] Fallo en verificación.`);\n                    resolve({ success: false, message: 'No se reconoció la huella. Intente nuevamente.' });\n                }\n            }, 1500);\n        });\n    }\n\n    static isAvailable(): boolean {\n        // En un entorno real, verificaríamos window.PublicKeyCredential\n        return true;\n    }\n}\n"],"names":[],"mappings":"AAAA,mDAAmD;;;;;AAE5C,MAAM;IAET,kDAAkD;IAClD,aAAa,mBAAmB,MAAc,EAAyE;QACnH,OAAO,IAAI,QAAQ,CAAC;YAChB,QAAQ,GAAG,CAAC,CAAC,4CAA4C,EAAE,QAAQ;YAEnE,+CAA+C;YAC/C,WAAW;gBACP,MAAM,mBAAmB,CAAC,KAAK,EAAE,OAAO,CAAC,EAAE,KAAK,GAAG,IAAI;gBACvD,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,kBAAkB;gBAC/D,QAAQ;oBACJ,SAAS;oBACT,cAAc;oBACd,SAAS;gBACb;YACJ,GAAG,OAAO,0BAA0B;QACxC;IACJ;IAEA,2CAA2C;IAC3C,aAAa,iBAAiB,MAAc,EAAkD;QAC1F,OAAO,IAAI,QAAQ,CAAC;YAChB,QAAQ,GAAG,CAAC,CAAC,kDAAkD,EAAE,QAAQ;YAEzE,sBAAsB;YACtB,WAAW;gBACP,4DAA4D;gBAC5D,MAAM,YAAY,KAAK,MAAM,KAAK,KAAK,wBAAwB;gBAE/D,IAAI,WAAW;oBACX,QAAQ,GAAG,CAAC,CAAC,gCAAgC,CAAC;oBAC9C,QAAQ;wBAAE,SAAS;wBAAM,SAAS;oBAAwB;gBAC9D,OAAO;oBACH,QAAQ,IAAI,CAAC,CAAC,iCAAiC,CAAC;oBAChD,QAAQ;wBAAE,SAAS;wBAAO,SAAS;oBAAiD;gBACxF;YACJ,GAAG;QACP;IACJ;IAEA,OAAO,cAAuB;QAC1B,gEAAgE;QAChE,OAAO;IACX;AACJ"}},
    {"offset": {"line": 5039, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/HRPage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../store/useStore';\nimport { Users, DollarSign, Calculator, Search, Plus, Trash2, Edit, FileText, Fingerprint, CheckCircle, AlertTriangle } from 'lucide-react';\nimport { EmployeeProfile, Role } from '../../domain/types';\nimport { WebAuthnService } from '../../infrastructure/biometrics/WebAuthnService';\n\nconst HRPage: React.FC = () => {\n    const { employees, updateEmployeeBiometrics } = usePharmaStore();\n    const [activeTab, setActiveTab] = useState<'DIRECTORY' | 'SIMULATOR'>('DIRECTORY');\n    const [simulatorData, setSimulatorData] = useState({ base: 500000, gratification: 0, commission: 0 });\n    const [searchTerm, setSearchTerm] = useState('');\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [editingEmployee, setEditingEmployee] = useState<EmployeeProfile | null>(null);\n\n    // Biometric Enrollment State\n    const [isEnrollmentModalOpen, setIsEnrollmentModalOpen] = useState(false);\n    const [enrollmentEmployee, setEnrollmentEmployee] = useState<EmployeeProfile | null>(null);\n    const [enrollmentStatus, setEnrollmentStatus] = useState<'IDLE' | 'SCANNING' | 'SUCCESS' | 'ERROR'>('IDLE');\n\n    const handleEnrollment = async () => {\n        if (!enrollmentEmployee) return;\n        setEnrollmentStatus('SCANNING');\n\n        const result = await WebAuthnService.registerCredential(enrollmentEmployee.id);\n\n        if (result.success && result.credentialId) {\n            updateEmployeeBiometrics(enrollmentEmployee.id, result.credentialId);\n            setEnrollmentStatus('SUCCESS');\n            setTimeout(() => {\n                setIsEnrollmentModalOpen(false);\n                setEnrollmentStatus('IDLE');\n                setEnrollmentEmployee(null);\n            }, 2000);\n        } else {\n            setEnrollmentStatus('ERROR');\n        }\n    };\n    const calculateSalary = () => {\n        const base = Number(simulatorData.base);\n        const grat = Math.min(base * 0.25, 158333); // Tope legal aprox\n        const comm = Number(simulatorData.commission);\n        const taxable = base + grat + comm;\n        const health = taxable * 0.07;\n        const pension = taxable * 0.11; // Promedio AFP\n        const liquid = taxable - health - pension;\n        return { taxable, health, pension, liquid, grat };\n    };\n\n    const simulation = calculateSalary();\n\n    return (\n        <div className=\"p-6 bg-slate-50 min-h-screen\">\n            <header className=\"mb-8\">\n                <h1 className=\"text-3xl font-extrabold text-slate-900\">Recursos Humanos</h1>\n                <p className=\"text-slate-500\">Gestión de Personal y Remuneraciones</p>\n            </header>\n\n            <div className=\"flex gap-4 mb-8\">\n                <button\n                    onClick={() => setActiveTab('DIRECTORY')}\n                    className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition ${activeTab === 'DIRECTORY' ? 'bg-blue-600 text-white shadow-lg shadow-blue-200' : 'bg-white text-slate-500 hover:bg-slate-50'}`}\n                >\n                    <Users size={20} /> Directorio\n                </button>\n                <button\n                    onClick={() => setActiveTab('SIMULATOR')}\n                    className={`px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition ${activeTab === 'SIMULATOR' ? 'bg-slate-900 text-white shadow-lg' : 'bg-white text-slate-500 hover:bg-slate-100'}`}\n                >\n                    <Calculator size={20} /> Simulador Sueldo\n                </button>\n            </div>\n\n            {activeTab === 'DIRECTORY' && (\n                <div className=\"bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden\">\n                    <div className=\"p-6 border-b border-slate-100 flex justify-between items-center\">\n                        <h2 className=\"text-xl font-bold text-slate-800\">Colaboradores Activos</h2>\n                        <div className=\"relative\">\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\n                            <input type=\"text\" placeholder=\"Buscar...\" className=\"pl-10 pr-4 py-2 bg-slate-50 rounded-lg border border-slate-200 focus:outline-none focus:border-cyan-500\" />\n                        </div>\n                    </div>\n                    <table className=\"w-full text-left\">\n                        <thead className=\"bg-slate-50 text-slate-500 font-bold text-sm\">\n                            <tr>\n                                <th className=\"p-6\">Nombre</th>\n                                <th className=\"p-6\">Cargo</th>\n                                <th className=\"p-6\">Contrato</th>\n                                <th className=\"p-6\">Sueldo Base</th>\n                                <th className=\"p-6\">Acciones</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-gray-100\">\n                            {employees.map((emp) => (\n                                <tr key={emp.id} className=\"hover:bg-slate-50 transition\">\n                                    <td className=\"p-6\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold\">\n                                                {emp.name.charAt(0)}\n                                            </div>\n                                            <div>\n                                                <div className=\"font-bold text-slate-800\">{emp.name}</div>\n                                                <div className=\"text-xs text-slate-400\">{emp.rut}</div>\n                                            </div>\n                                        </div>\n                                    </td>\n                                    <td className=\"p-6\">\n                                        <span className=\"px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-xs font-bold\">{emp.role}</span>\n                                    </td>\n                                    <td className=\"p-6 text-slate-500\">{emp.status}</td>\n                                    <td className=\"p-6 font-mono text-slate-600\">${emp.labor_data.base_salary.toLocaleString()}</td>\n                                    <td className=\"p-6\">\n                                        <div className=\"flex gap-2 mt-4\">\n                                            <button\n                                                onClick={() => { setEditingEmployee(emp); setIsModalOpen(true); }}\n                                                className=\"flex-1 bg-slate-100 text-slate-600 py-2 rounded-lg text-sm font-bold hover:bg-slate-200 transition\"\n                                            >\n                                                Editar\n                                            </button>\n                                            <button\n                                                onClick={() => { setEnrollmentEmployee(emp); setIsEnrollmentModalOpen(true); }}\n                                                className={`flex-1 py-2 rounded-lg text-sm font-bold transition flex items-center justify-center gap-2 ${emp.biometric_credentials?.length\n                                                    ? 'bg-green-100 text-green-700 hover:bg-green-200'\n                                                    : 'bg-blue-100 text-blue-700 hover:bg-blue-200'\n                                                    }`}\n                                            >\n                                                <Fingerprint size={16} />\n                                                {emp.biometric_credentials?.length ? 'Huella OK' : 'Enrolar'}\n                                            </button>\n                                        </div>\n                                    </td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n            )}\n\n            {activeTab === 'SIMULATOR' && (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                    <div className=\"bg-white p-8 rounded-3xl shadow-sm border border-slate-200\">\n                        <h3 className=\"text-xl font-bold text-slate-800 mb-6\">Parámetros</h3>\n                        <div className=\"space-y-4\">\n                            <div>\n                                <label className=\"block text-sm font-bold text-slate-700 mb-2\">Sueldo Base</label>\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                                    value={simulatorData.base}\n                                    onChange={(e) => setSimulatorData({ ...simulatorData, base: Number(e.target.value) })}\n                                />\n                            </div>\n                            <div>\n                                <label className=\"block text-sm font-bold text-slate-700 mb-2\">Comisiones Estimadas</label>\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                                    value={simulatorData.commission}\n                                    onChange={(e) => setSimulatorData({ ...simulatorData, commission: Number(e.target.value) })}\n                                />\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"bg-slate-900 p-8 rounded-3xl text-white shadow-xl\">\n                        <h3 className=\"text-xl font-bold mb-6 flex items-center gap-2\"><DollarSign /> Resultado Simulado</h3>\n\n                        <div className=\"space-y-4\">\n                            <div className=\"flex justify-between text-slate-400\">\n                                <span>Sueldo Base</span>\n                                <span>${simulatorData.base.toLocaleString()}</span>\n                            </div>\n                            <div className=\"flex justify-between text-slate-400\">\n                                <span>Gratificación (Tope)</span>\n                                <span>${Math.round(simulation.grat).toLocaleString()}</span>\n                            </div>\n                            <div className=\"flex justify-between text-slate-400\">\n                                <span>Comisiones</span>\n                                <span>${simulatorData.commission.toLocaleString()}</span>\n                            </div>\n                            <div className=\"h-px bg-slate-700 my-4\" />\n                            <div className=\"flex justify-between text-emerald-400 font-bold text-lg\">\n                                <span>Total Haberes</span>\n                                <span>${Math.round(simulation.taxable).toLocaleString()}</span>\n                            </div>\n                            <div className=\"flex justify-between text-red-400 text-sm\">\n                                <span>Descuentos Legales (~18%)</span>\n                                <span>-${Math.round(simulation.health + simulation.pension).toLocaleString()}</span>\n                            </div>\n                            <div className=\"h-px bg-slate-700 my-4\" />\n                            <div className=\"flex justify-between text-3xl font-extrabold\">\n                                <span>Líquido a Pagar</span>\n                                <span>${Math.round(simulation.liquid).toLocaleString()}</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n            {/* Enrollment Modal */}\n            {isEnrollmentModalOpen && enrollmentEmployee && (\n                <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n                    <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden p-8 text-center\">\n                        <div className=\"w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6 text-blue-600\">\n                            <Fingerprint size={40} />\n                        </div>\n                        <h3 className=\"text-2xl font-bold text-slate-800 mb-2\">Registro Biométrico</h3>\n                        <p className=\"text-slate-500 mb-8\">\n                            Solicita a <strong>{enrollmentEmployee.name}</strong> que coloque su dedo en el lector para vincular su huella.\n                        </p>\n\n                        {enrollmentStatus === 'IDLE' && (\n                            <button\n                                onClick={handleEnrollment}\n                                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold shadow-lg shadow-blue-200 transition-all\"\n                            >\n                                Iniciar Escaneo\n                            </button>\n                        )}\n\n                        {enrollmentStatus === 'SCANNING' && (\n                            <div className=\"flex flex-col items-center gap-4 py-4\">\n                                <div className=\"w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin\"></div>\n                                <span className=\"font-bold text-blue-600\">Escaneando...</span>\n                            </div>\n                        )}\n\n                        {enrollmentStatus === 'SUCCESS' && (\n                            <div className=\"flex flex-col items-center gap-4 py-4\">\n                                <CheckCircle size={48} className=\"text-green-500\" />\n                                <span className=\"font-bold text-green-600\">¡Huella Registrada!</span>\n                            </div>\n                        )}\n\n                        {enrollmentStatus === 'ERROR' && (\n                            <div className=\"flex flex-col items-center gap-4 py-4\">\n                                <AlertTriangle size={48} className=\"text-red-500\" />\n                                <span className=\"font-bold text-red-600\">Error al escanear. Intente nuevamente.</span>\n                                <button\n                                    onClick={() => setEnrollmentStatus('IDLE')}\n                                    className=\"text-slate-500 underline mt-2\"\n                                >\n                                    Reintentar\n                                </button>\n                            </div>\n                        )}\n\n                        <button\n                            onClick={() => { setIsEnrollmentModalOpen(false); setEnrollmentStatus('IDLE'); }}\n                            className=\"mt-6 text-slate-400 hover:text-slate-600 font-medium\"\n                        >\n                            Cancelar\n                        </button>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default HRPage;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5924, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/SettingsPage.tsx"],"sourcesContent":["import React from 'react';\nimport { Settings, User, Shield, Save } from 'lucide-react';\n\nconst SettingsPage: React.FC = () => {\n    return (\n        <div className=\"p-6 bg-slate-50 min-h-screen\">\n            <header className=\"mb-8\">\n                <h1 className=\"text-3xl font-extrabold text-slate-900\">Configuración</h1>\n                <p className=\"text-slate-500\">Administración del Sistema</p>\n            </header>\n\n            <div className=\"bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden max-w-4xl\">\n                <div className=\"p-6 border-b border-slate-100\">\n                    <h2 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\n                        <User size={20} /> Gestión de Usuarios\n                    </h2>\n                </div>\n\n                <div className=\"p-8\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n                        <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-2\">Nombre Completo</label>\n                            <input\n                                type=\"text\"\n                                className=\"w-full p-3 border-2 border-slate-300 rounded-xl focus:border-cyan-600 focus:outline-none font-medium\"\n                                placeholder=\"Ej: Juan Pérez\"\n                            />\n                        </div>\n                        <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-2\">RUT</label>\n                            <input\n                                type=\"text\"\n                                className=\"w-full p-3 border-2 border-slate-300 rounded-xl focus:border-cyan-600 focus:outline-none font-medium\"\n                                placeholder=\"11.111.111-1\"\n                            />\n                        </div>\n                        <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-2\">Rol</label>\n                            <select className=\"w-full p-3 border-2 border-slate-300 rounded-xl focus:border-cyan-600 focus:outline-none font-medium bg-white\">\n                                <option>Cajero/a</option>\n                                <option>Químico Farmacéutico (QF)</option>\n                                <option>Administrador</option>\n                                <option>Bodega</option>\n                            </select>\n                        </div>\n                        <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-2\">PIN de Acceso (4 dígitos)</label>\n                            <input\n                                type=\"password\"\n                                maxLength={4}\n                                className=\"w-full p-3 border-2 border-slate-300 rounded-xl focus:border-cyan-600 focus:outline-none font-medium tracking-widest\"\n                                placeholder=\"••••\"\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"flex justify-end\">\n                        <button className=\"px-8 py-3 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition shadow-lg flex items-center gap-2\">\n                            <Save size={20} /> Guardar Usuario\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default SettingsPage;\n"],"names":[],"mappings":";;;;;AACA;AAAA;;;AAEA,MAAM,eAAyB;IAC3B,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAO,WAAU;;kCACd,6LAAC;wBAAG,WAAU;kCAAyC;;;;;;kCACvD,6LAAC;wBAAE,WAAU;kCAAiB;;;;;;;;;;;;0BAGlC,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAI,WAAU;kCACX,cAAA,6LAAC;4BAAG,WAAU;;8CACV,6LAAC,6MAAI;oCAAC,MAAM;;;;;;gCAAM;;;;;;;;;;;;kCAI1B,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;;0DACG,6LAAC;gDAAM,WAAU;0DAA8C;;;;;;0DAC/D,6LAAC;gDACG,MAAK;gDACL,WAAU;gDACV,aAAY;;;;;;;;;;;;kDAGpB,6LAAC;;0DACG,6LAAC;gDAAM,WAAU;0DAA8C;;;;;;0DAC/D,6LAAC;gDACG,MAAK;gDACL,WAAU;gDACV,aAAY;;;;;;;;;;;;kDAGpB,6LAAC;;0DACG,6LAAC;gDAAM,WAAU;0DAA8C;;;;;;0DAC/D,6LAAC;gDAAO,WAAU;;kEACd,6LAAC;kEAAO;;;;;;kEACR,6LAAC;kEAAO;;;;;;kEACR,6LAAC;kEAAO;;;;;;kEACR,6LAAC;kEAAO;;;;;;;;;;;;;;;;;;kDAGhB,6LAAC;;0DACG,6LAAC;gDAAM,WAAU;0DAA8C;;;;;;0DAC/D,6LAAC;gDACG,MAAK;gDACL,WAAW;gDACX,WAAU;gDACV,aAAY;;;;;;;;;;;;;;;;;;0CAKxB,6LAAC;gCAAI,WAAU;0CACX,cAAA,6LAAC;oCAAO,WAAU;;sDACd,6LAAC,6MAAI;4CAAC,MAAM;;;;;;wCAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO9C;KA9DM;uCAgES"}},
    {"offset": {"line": 6184, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/ClientsPage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../store/useStore';\nimport { Search, User, MessageCircle, Star, Calendar } from 'lucide-react';\n\nconst ClientsPage: React.FC = () => {\n    const { customers } = usePharmaStore();\n    const [searchTerm, setSearchTerm] = useState('');\n\n    const filteredCustomers = customers.filter(c =>\n        c.fullName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        c.rut.includes(searchTerm) ||\n        (c.phone && c.phone.includes(searchTerm))\n    );\n\n    const openWhatsApp = (phone?: string) => {\n        if (!phone) return;\n        const cleanPhone = phone.replace(/[^0-9]/g, '');\n        window.open(`https://wa.me/${cleanPhone}`, '_blank');\n    };\n\n    return (\n        <div className=\"p-6 bg-slate-50 min-h-screen\">\n            <header className=\"mb-8 flex justify-between items-center\">\n                <div>\n                    <h1 className=\"text-3xl font-extrabold text-slate-900\">Directorio de Clientes</h1>\n                    <p className=\"text-slate-500\">CRM & Fidelización</p>\n                </div>\n                <div className=\"bg-white p-4 rounded-2xl shadow-sm border border-slate-200 flex gap-4\">\n                    <div className=\"text-center\">\n                        <p className=\"text-xs font-bold text-slate-400 uppercase\">Total Clientes</p>\n                        <p className=\"text-2xl font-extrabold text-slate-900\">{customers.length}</p>\n                    </div>\n                    <div className=\"w-px bg-slate-200\" />\n                    <div className=\"text-center\">\n                        <p className=\"text-xs font-bold text-slate-400 uppercase\">Nuevos (Mes)</p>\n                        <p className=\"text-2xl font-extrabold text-emerald-600\">\n                            {customers.filter(c => new Date(c.lastVisit).getMonth() === new Date().getMonth()).length}\n                        </p>\n                    </div>\n                </div>\n            </header>\n\n            <div className=\"bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden\">\n                <div className=\"p-6 border-b border-slate-100\">\n                    <div className=\"relative max-w-md\">\n                        <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\" size={20} />\n                        <input\n                            type=\"text\"\n                            placeholder=\"Buscar por RUT, Nombre o Teléfono...\"\n                            className=\"w-full pl-12 pr-4 py-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none transition-colors font-medium\"\n                            value={searchTerm}\n                            onChange={(e) => setSearchTerm(e.target.value)}\n                        />\n                    </div>\n                </div>\n\n                <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-left\">\n                        <thead className=\"bg-slate-50 text-slate-500 font-bold text-sm\">\n                            <tr>\n                                <th className=\"p-6\">Cliente</th>\n                                <th className=\"p-6\">Contacto</th>\n                                <th className=\"p-6\">Puntos</th>\n                                <th className=\"p-6\">Origen</th>\n                                <th className=\"p-6\">Última Visita</th>\n                                <th className=\"p-6\">Acciones</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-slate-100\">\n                            {filteredCustomers.map(customer => (\n                                <tr key={customer.id} className=\"hover:bg-slate-50 transition\">\n                                    <td className=\"p-6\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white font-bold\">\n                                                {customer.fullName.charAt(0)}\n                                            </div>\n                                            <div>\n                                                <p className=\"font-bold text-slate-800\">{customer.fullName}</p>\n                                                <p className=\"text-xs text-slate-500 font-mono\">{customer.rut}</p>\n                                            </div>\n                                        </div>\n                                    </td>\n                                    <td className=\"p-6 text-slate-600\">\n                                        {customer.phone || '-'}\n                                    </td>\n                                    <td className=\"p-6\">\n                                        <div className=\"flex items-center gap-1 text-amber-600 font-bold\">\n                                            <Star size={16} fill=\"currentColor\" />\n                                            {customer.totalPoints}\n                                        </div>\n                                    </td>\n                                    <td className=\"p-6\">\n                                        <span className={`px-3 py-1 rounded-full text-xs font-bold border ${customer.registrationSource === 'KIOSK' ? 'bg-purple-50 text-purple-600 border-purple-200' :\n                                                customer.registrationSource === 'POS' ? 'bg-blue-50 text-blue-600 border-blue-200' :\n                                                    'bg-slate-100 text-slate-600 border-slate-200'\n                                            }`}>\n                                            {customer.registrationSource}\n                                        </span>\n                                    </td>\n                                    <td className=\"p-6 text-slate-500 text-sm\">\n                                        <div className=\"flex items-center gap-2\">\n                                            <Calendar size={14} />\n                                            {new Date(customer.lastVisit).toLocaleDateString()}\n                                        </div>\n                                    </td>\n                                    <td className=\"p-6\">\n                                        {customer.phone && (\n                                            <button\n                                                onClick={() => openWhatsApp(customer.phone)}\n                                                className=\"p-2 bg-emerald-100 text-emerald-600 rounded-lg hover:bg-emerald-200 transition\"\n                                                title=\"Abrir WhatsApp\"\n                                            >\n                                                <MessageCircle size={20} />\n                                            </button>\n                                        )}\n                                    </td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default ClientsPage;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6617, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/StockEntryModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { Scan, PackagePlus, Save, X, Search, AlertTriangle } from 'lucide-react';\nimport { InventoryBatch, DrugCategory, SaleCondition } from '../../../domain/types';\n\ninterface StockEntryModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst StockEntryModal: React.FC<StockEntryModalProps> = ({ isOpen, onClose }) => {\n    const { inventory, addStock, addNewProduct } = usePharmaStore();\n    const [mode, setMode] = useState<'SCAN' | 'NEW'>('SCAN');\n    const [skuInput, setSkuInput] = useState('');\n    const [foundProduct, setFoundProduct] = useState<InventoryBatch | null>(null);\n\n    // Form States\n    const [qty, setQty] = useState('');\n    const [expiry, setExpiry] = useState('');\n    const [newProduct, setNewProduct] = useState<Partial<InventoryBatch>>({\n        category: 'MEDICAMENTO',\n        condition: 'VD',\n        is_bioequivalent: false,\n        allows_commission: false,\n        location_id: 'BODEGA_CENTRAL'\n    });\n\n    if (!isOpen) return null;\n\n    const handleScan = () => {\n        const product = inventory.find(i => i.sku === skuInput);\n        if (product) {\n            setFoundProduct(product);\n            setMode('SCAN');\n        } else {\n            setFoundProduct(null);\n            setNewProduct(prev => ({ ...prev, sku: skuInput }));\n            setMode('NEW');\n        }\n    };\n\n    const handleQuickEntry = () => {\n        if (foundProduct && qty && expiry) {\n            addStock(foundProduct.id, parseInt(qty), new Date(expiry).getTime());\n            onClose();\n            reset();\n        }\n    };\n\n    const handleNewProductSubmit = () => {\n        if (newProduct.name && newProduct.sku && qty) {\n            addNewProduct({\n                ...newProduct,\n                stock_actual: parseInt(qty),\n                expiry_date: new Date(expiry).getTime(),\n                active_ingredients: [], // Default\n                stock_min: 10,\n                stock_max: 100,\n                cost_price: 0 // Default\n            } as InventoryBatch);\n            onClose();\n            reset();\n        }\n    };\n\n    const reset = () => {\n        setSkuInput('');\n        setFoundProduct(null);\n        setQty('');\n        setExpiry('');\n        setMode('SCAN');\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-slate-900 p-6 border-b border-slate-800 flex justify-between items-center\">\n                    <h3 className=\"text-xl font-bold text-white flex items-center gap-2\">\n                        {mode === 'SCAN' ? <Scan className=\"text-cyan-400\" /> : <PackagePlus className=\"text-emerald-400\" />}\n                        {mode === 'SCAN' ? 'Recepción Rápida' : 'Alta de Producto Nuevo'}\n                    </h3>\n                    <button onClick={onClose} className=\"text-slate-400 hover:text-white\"><X /></button>\n                </div>\n\n                <div className=\"p-6\">\n                    {/* Search Bar */}\n                    <div className=\"flex gap-2 mb-6\">\n                        <div className=\"relative flex-1\">\n                            <Scan className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={20} />\n                            <input\n                                type=\"text\"\n                                autoFocus\n                                placeholder=\"Escanear Código de Barras / SKU...\"\n                                className=\"w-full pl-10 pr-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none font-mono text-lg\"\n                                value={skuInput}\n                                onChange={(e) => setSkuInput(e.target.value)}\n                                onKeyDown={(e) => e.key === 'Enter' && handleScan()}\n                            />\n                        </div>\n                        <button\n                            onClick={handleScan}\n                            className=\"bg-slate-100 text-slate-600 px-4 rounded-xl font-bold hover:bg-slate-200\"\n                        >\n                            <Search />\n                        </button>\n                    </div>\n\n                    {mode === 'SCAN' && foundProduct && (\n                        <div className=\"bg-cyan-50 border border-cyan-100 rounded-2xl p-4 mb-6 flex items-start gap-4\">\n                            <div className=\"w-16 h-16 bg-white rounded-xl flex items-center justify-center text-2xl shadow-sm\">💊</div>\n                            <div>\n                                <h4 className=\"font-bold text-slate-800 text-lg\">{foundProduct.name}</h4>\n                                <p className=\"text-slate-500 text-sm\">{foundProduct.dci}</p>\n                                <div className=\"flex gap-2 mt-2\">\n                                    <span className=\"text-xs font-bold bg-white px-2 py-1 rounded border border-cyan-200 text-cyan-700\">Stock: {foundProduct.stock_actual}</span>\n                                    <span className=\"text-xs font-bold bg-white px-2 py-1 rounded border border-cyan-200 text-cyan-700\">{foundProduct.location_id}</span>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n\n                    {mode === 'SCAN' && foundProduct && (\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1\">Cantidad a Ingresar</label>\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none text-xl font-bold\"\n                                    value={qty}\n                                    onChange={(e) => setQty(e.target.value)}\n                                />\n                            </div>\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1\">Vencimiento</label>\n                                <input\n                                    type=\"date\"\n                                    className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                                    value={expiry}\n                                    onChange={(e) => setExpiry(e.target.value)}\n                                />\n                            </div>\n                            <button\n                                onClick={handleQuickEntry}\n                                className=\"col-span-2 py-4 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition shadow-lg shadow-cyan-200 mt-2\"\n                            >\n                                INGRESAR STOCK\n                            </button>\n                        </div>\n                    )}\n\n                    {mode === 'NEW' && (\n                        <div className=\"space-y-4 animate-in fade-in slide-in-from-bottom-4\">\n                            <div className=\"bg-amber-50 p-3 rounded-xl border border-amber-100 flex items-center gap-2 text-amber-700 text-sm mb-4\">\n                                <AlertTriangle size={16} />\n                                Producto no encontrado. Complete la ficha para dar de alta.\n                            </div>\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div className=\"col-span-2\">\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Nombre Comercial</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.name || ''}\n                                        onChange={(e) => setNewProduct({ ...newProduct, name: e.target.value })}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Principio Activo (DCI)</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.dci || ''}\n                                        onChange={(e) => setNewProduct({ ...newProduct, dci: e.target.value })}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Laboratorio</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.laboratory || ''}\n                                        onChange={(e) => setNewProduct({ ...newProduct, laboratory: e.target.value })}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Categoría</label>\n                                    <select\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.category}\n                                        onChange={(e) => setNewProduct({ ...newProduct, category: e.target.value as DrugCategory })}\n                                    >\n                                        <option value=\"MEDICAMENTO\">Medicamento</option>\n                                        <option value=\"INSUMO_MEDICO\">Insumo Médico</option>\n                                        <option value=\"COSMETICO\">Cosmético</option>\n                                        <option value=\"SUPLEMENTO\">Suplemento</option>\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Condición Venta</label>\n                                    <select\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.condition}\n                                        onChange={(e) => setNewProduct({ ...newProduct, condition: e.target.value as SaleCondition })}\n                                    >\n                                        <option value=\"VD\">Venta Directa</option>\n                                        <option value=\"R\">Receta Simple</option>\n                                        <option value=\"RR\">Receta Retenida</option>\n                                        <option value=\"RCH\">Receta Cheque</option>\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Precio Venta</label>\n                                    <input\n                                        type=\"number\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.price || ''}\n                                        onChange={(e) => setNewProduct({ ...newProduct, price: parseInt(e.target.value) })}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Ubicación</label>\n                                    <select\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.location_id}\n                                        onChange={(e) => setNewProduct({ ...newProduct, location_id: e.target.value as any })}\n                                    >\n                                        <option value=\"BODEGA_CENTRAL\">Bodega Central</option>\n                                        <option value=\"SUCURSAL_CENTRO\">Sucursal Centro</option>\n                                    </select>\n                                </div>\n                            </div>\n\n                            <div className=\"grid grid-cols-2 gap-4 pt-4 border-t border-slate-100\">\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Cantidad Inicial</label>\n                                    <input\n                                        type=\"number\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg font-bold\"\n                                        value={qty}\n                                        onChange={(e) => setQty(e.target.value)}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Vencimiento</label>\n                                    <input\n                                        type=\"date\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={expiry}\n                                        onChange={(e) => setExpiry(e.target.value)}\n                                    />\n                                </div>\n                            </div>\n\n                            <button\n                                onClick={handleNewProductSubmit}\n                                className=\"w-full py-4 bg-emerald-600 text-white font-bold rounded-xl hover:bg-emerald-700 transition shadow-lg shadow-emerald-200\"\n                            >\n                                CREAR PRODUCTO\n                            </button>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default StockEntryModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7364, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/StockTransferModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { ArrowRightLeft, MapPin, Box, Search } from 'lucide-react';\nimport { InventoryBatch } from '../../../domain/types';\n\ninterface StockTransferModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst StockTransferModal: React.FC<StockTransferModalProps> = ({ isOpen, onClose }) => {\n    const { inventory, transferStock } = usePharmaStore();\n    const [searchTerm, setSearchTerm] = useState('');\n    const [selectedProduct, setSelectedProduct] = useState<InventoryBatch | null>(null);\n    const [qty, setQty] = useState('');\n    const [targetLocation, setTargetLocation] = useState('SUCURSAL_CENTRO');\n\n    if (!isOpen) return null;\n\n    const filteredInventory = inventory.filter(i =>\n        i.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        i.sku.includes(searchTerm)\n    );\n\n    const handleTransfer = () => {\n        if (selectedProduct && qty) {\n            transferStock(selectedProduct.id, targetLocation as any, parseInt(qty));\n            onClose();\n            setSearchTerm('');\n            setSelectedProduct(null);\n            setQty('');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-slate-900 p-6 border-b border-slate-800 text-white\">\n                    <h3 className=\"text-xl font-bold flex items-center gap-2\">\n                        <ArrowRightLeft className=\"text-purple-400\" /> Transferencia de Stock\n                    </h3>\n                </div>\n\n                <div className=\"p-6 space-y-6\">\n                    {/* 1. Select Product */}\n                    {!selectedProduct ? (\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 mb-2 uppercase\">1. Buscar Producto (Origen)</label>\n                            <div className=\"relative mb-4\">\n                                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\n                                <input\n                                    type=\"text\"\n                                    autoFocus\n                                    placeholder=\"Nombre o SKU...\"\n                                    className=\"w-full pl-10 pr-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none\"\n                                    value={searchTerm}\n                                    onChange={(e) => setSearchTerm(e.target.value)}\n                                />\n                            </div>\n                            <div className=\"h-48 overflow-y-auto border border-slate-100 rounded-xl bg-slate-50 p-2 space-y-2\">\n                                {filteredInventory.map(item => (\n                                    <div\n                                        key={item.id}\n                                        onClick={() => setSelectedProduct(item)}\n                                        className=\"p-3 bg-white rounded-lg border border-slate-200 hover:border-purple-400 cursor-pointer transition flex justify-between items-center\"\n                                    >\n                                        <div>\n                                            <p className=\"font-bold text-sm text-slate-800\">{item.name}</p>\n                                            <p className=\"text-xs text-slate-500\">{item.location_id}</p>\n                                        </div>\n                                        <span className=\"bg-slate-100 text-slate-600 px-2 py-1 rounded text-xs font-bold\">Stock: {item.stock_actual}</span>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"bg-purple-50 border border-purple-100 rounded-xl p-4 flex justify-between items-center\">\n                            <div>\n                                <h4 className=\"font-bold text-purple-900\">{selectedProduct.name}</h4>\n                                <p className=\"text-xs text-purple-700\">Origen: {selectedProduct.location_id}</p>\n                            </div>\n                            <button onClick={() => setSelectedProduct(null)} className=\"text-xs font-bold text-purple-500 hover:text-purple-700\">CAMBIAR</button>\n                        </div>\n                    )}\n\n                    {/* 2. Transfer Details */}\n                    {selectedProduct && (\n                        <div className=\"grid grid-cols-2 gap-4 animate-in fade-in slide-in-from-bottom-2\">\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Destino</label>\n                                <div className=\"relative\">\n                                    <MapPin className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n                                    <select\n                                        className=\"w-full pl-9 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none appearance-none bg-white\"\n                                        value={targetLocation}\n                                        onChange={(e) => setTargetLocation(e.target.value)}\n                                    >\n                                        <option value=\"SUCURSAL_CENTRO\">Sucursal Centro</option>\n                                        <option value=\"SUCURSAL_NORTE\">Sucursal Norte</option>\n                                        <option value=\"BODEGA_CENTRAL\">Bodega Central</option>\n                                        <option value=\"KIOSCO\">Kiosco</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Cantidad</label>\n                                <div className=\"relative\">\n                                    <Box className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n                                    <input\n                                        type=\"number\"\n                                        className=\"w-full pl-9 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none\"\n                                        max={selectedProduct.stock_actual}\n                                        value={qty}\n                                        onChange={(e) => setQty(e.target.value)}\n                                    />\n                                </div>\n                                <p className=\"text-[10px] text-right text-slate-400 mt-1\">Máx: {selectedProduct.stock_actual}</p>\n                            </div>\n                        </div>\n                    )}\n\n                    <div className=\"flex gap-3 pt-4\">\n                        <button onClick={onClose} className=\"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl transition\">Cancelar</button>\n                        <button\n                            onClick={handleTransfer}\n                            disabled={!selectedProduct || !qty || parseInt(qty) > (selectedProduct?.stock_actual || 0)}\n                            className=\"flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition shadow-lg shadow-purple-200 disabled:opacity-50\"\n                        >\n                            Transferir\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default StockTransferModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7773, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/InventoryPage.tsx"],"sourcesContent":["import React, { useState, useMemo } from 'react';\nimport { usePharmaStore } from '../store/useStore';\nimport { Search, Filter, Plus, ArrowRightLeft, Package, AlertTriangle, Snowflake, Lock, Pill } from 'lucide-react';\nimport StockEntryModal from '../components/inventory/StockEntryModal';\nimport StockTransferModal from '../components/inventory/StockTransferModal';\n\nconst InventoryPage: React.FC = () => {\n    const { inventory } = usePharmaStore();\n    const [searchTerm, setSearchTerm] = useState('');\n    const [activeTab, setActiveTab] = useState<'MEDS' | 'RETAIL' | 'CONTROLLED'>('MEDS');\n    const [isEntryModalOpen, setIsEntryModalOpen] = useState(false);\n    const [isTransferModalOpen, setIsTransferModalOpen] = useState(false);\n\n    // Smart Filters\n    const [filters, setFilters] = useState({\n        coldChain: false,\n        expiring: false,\n        critical: false\n    });\n\n    const filteredInventory = useMemo(() => {\n        return inventory.filter(item => {\n            // 1. Text Search\n            const matchesSearch =\n                item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                item.sku.includes(searchTerm) ||\n                item.dci.toLowerCase().includes(searchTerm.toLowerCase());\n\n            if (!matchesSearch) return false;\n\n            // 2. Tab Filter\n            if (activeTab === 'MEDS' && item.category !== 'MEDICAMENTO') return false;\n            if (activeTab === 'RETAIL' && item.category === 'MEDICAMENTO') return false;\n            if (activeTab === 'CONTROLLED' && !['R', 'RR', 'RCH'].includes(item.condition)) return false;\n\n            // 3. Smart Filters\n            // Note: Assuming we had a cold_chain flag, but we don't in types yet. Using category for demo logic if needed.\n            // For now, we'll skip coldChain filter logic as it's not in types, or infer it.\n\n            if (filters.expiring) {\n                const monthsUntilExpiry = (item.expiry_date - Date.now()) / (1000 * 60 * 60 * 24 * 30);\n                if (monthsUntilExpiry > 6) return false;\n            }\n\n            if (filters.critical) {\n                if (item.stock_actual > item.stock_min) return false;\n            }\n\n            return true;\n        });\n    }, [inventory, searchTerm, activeTab, filters]);\n\n    const getStockStatus = (item: any) => {\n        if (item.stock_actual <= 0) return 'bg-red-100 text-red-700 border-red-200';\n        if (item.stock_actual <= item.stock_min) return 'bg-amber-100 text-amber-700 border-amber-200';\n        return 'bg-emerald-100 text-emerald-700 border-emerald-200';\n    };\n\n    return (\n        <div className=\"p-6 bg-slate-50 min-h-screen\">\n            {/* Header */}\n            <header className=\"mb-8 flex justify-between items-end\">\n                <div>\n                    <h1 className=\"text-3xl font-extrabold text-slate-900 flex items-center gap-3\">\n                        <Package className=\"text-cyan-600\" /> Maestro de Inventario\n                    </h1>\n                    <p className=\"text-slate-500 mt-1\">WMS & Control de Stock</p>\n                </div>\n                <div className=\"flex gap-3\">\n                    <button\n                        onClick={() => setIsTransferModalOpen(true)}\n                        className=\"px-6 py-3 bg-white text-slate-700 font-bold rounded-xl border border-slate-200 hover:bg-slate-50 transition flex items-center gap-2\"\n                    >\n                        <ArrowRightLeft size={18} /> Transferir\n                    </button>\n                    <button\n                        onClick={() => setIsEntryModalOpen(true)}\n                        className=\"px-6 py-3 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition shadow-lg shadow-cyan-200 flex items-center gap-2\"\n                    >\n                        <Plus size={18} /> Ingreso / Alta\n                    </button>\n                </div>\n            </header>\n\n            {/* Tabs & Filters */}\n            <div className=\"bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden mb-6\">\n                <div className=\"border-b border-slate-100 flex\">\n                    <button\n                        onClick={() => setActiveTab('MEDS')}\n                        className={`flex-1 py-4 text-sm font-bold border-b-2 transition-colors ${activeTab === 'MEDS' ? 'border-cyan-500 text-cyan-700 bg-cyan-50' : 'border-transparent text-slate-500 hover:text-slate-700'}`}\n                    >\n                        💊 MEDICAMENTOS\n                    </button>\n                    <button\n                        onClick={() => setActiveTab('RETAIL')}\n                        className={`flex-1 py-4 text-sm font-bold border-b-2 transition-colors ${activeTab === 'RETAIL' ? 'border-pink-500 text-pink-700 bg-pink-50' : 'border-transparent text-slate-500 hover:text-slate-700'}`}\n                    >\n                        🛍️ RETAIL\n                    </button>\n                    <button\n                        onClick={() => setActiveTab('CONTROLLED')}\n                        className={`flex-1 py-4 text-sm font-bold border-b-2 transition-colors ${activeTab === 'CONTROLLED' ? 'border-purple-500 text-purple-700 bg-purple-50' : 'border-transparent text-slate-500 hover:text-slate-700'}`}\n                    >\n                        🔒 CONTROLADOS\n                    </button>\n                </div>\n\n                <div className=\"p-4 flex gap-4 items-center bg-slate-50/50\">\n                    <div className=\"relative flex-1\">\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\n                        <input\n                            type=\"text\"\n                            placeholder=\"Buscar por SKU, Nombre, DCI...\"\n                            className=\"w-full pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                            value={searchTerm}\n                            onChange={(e) => setSearchTerm(e.target.value)}\n                        />\n                    </div>\n                    <div className=\"flex gap-2\">\n                        <button\n                            onClick={() => setFilters(f => ({ ...f, expiring: !f.expiring }))}\n                            className={`px-3 py-2 rounded-lg text-xs font-bold border flex items-center gap-2 transition ${filters.expiring ? 'bg-amber-100 text-amber-700 border-amber-200' : 'bg-white text-slate-500 border-slate-200'}`}\n                        >\n                            <AlertTriangle size={14} /> Por Vencer\n                        </button>\n                        <button\n                            onClick={() => setFilters(f => ({ ...f, critical: !f.critical }))}\n                            className={`px-3 py-2 rounded-lg text-xs font-bold border flex items-center gap-2 transition ${filters.critical ? 'bg-red-100 text-red-700 border-red-200' : 'bg-white text-slate-500 border-slate-200'}`}\n                        >\n                            <Filter size={14} /> Stock Crítico\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            {/* Data Grid */}\n            <div className=\"bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden\">\n                <table className=\"w-full text-left\">\n                    <thead className=\"bg-slate-50 text-slate-500 font-bold text-xs uppercase tracking-wider\">\n                        <tr>\n                            <th className=\"p-4\">Producto</th>\n                            <th className=\"p-4\">Condición</th>\n                            <th className=\"p-4\">Ubicación</th>\n                            <th className=\"p-4\">Vencimiento</th>\n                            <th className=\"p-4 text-right\">Stock</th>\n                            <th className=\"p-4 text-right\">Precio</th>\n                        </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-slate-100 text-sm\">\n                        {filteredInventory.map(item => (\n                            <tr key={item.id} className=\"hover:bg-slate-50 transition group\">\n                                <td className=\"p-4\">\n                                    <div className=\"font-bold text-slate-800\">{item.name}</div>\n                                    <div className=\"text-xs text-slate-500 font-mono\">{item.sku} • {item.dci}</div>\n                                </td>\n                                <td className=\"p-4\">\n                                    <div className=\"flex gap-1\">\n                                        {item.is_bioequivalent && <span title=\"Bioequivalente\" className=\"p-1 bg-yellow-100 text-yellow-700 rounded\"><Pill size={14} /></span>}\n                                        {['R', 'RR', 'RCH'].includes(item.condition) && <span title=\"Receta Retenida\" className=\"p-1 bg-purple-100 text-purple-700 rounded\"><Lock size={14} /></span>}\n                                        {/* Placeholder for Cold Chain if added later */}\n                                    </div>\n                                </td>\n                                <td className=\"p-4 text-slate-600\">\n                                    <span className=\"px-2 py-1 bg-slate-100 rounded text-xs font-bold\">{item.location_id}</span>\n                                </td>\n                                <td className=\"p-4\">\n                                    <span className={`${(item.expiry_date - Date.now()) < (1000 * 60 * 60 * 24 * 30 * 3) ? 'text-red-600 font-bold' : 'text-slate-600'}`}>\n                                        {new Date(item.expiry_date).toLocaleDateString()}\n                                    </span>\n                                </td>\n                                <td className=\"p-4 text-right\">\n                                    <span className={`px-2 py-1 rounded text-xs font-bold border ${getStockStatus(item)}`}>\n                                        {item.stock_actual} un.\n                                    </span>\n                                </td>\n                                <td className=\"p-4 text-right font-mono font-bold text-slate-700\">\n                                    ${item.price.toLocaleString()}\n                                </td>\n                            </tr>\n                        ))}\n                    </tbody>\n                </table>\n                {filteredInventory.length === 0 && (\n                    <div className=\"p-12 text-center text-slate-400\">\n                        <Package size={48} className=\"mx-auto mb-4 opacity-50\" />\n                        <p>No se encontraron productos con los filtros actuales.</p>\n                    </div>\n                )}\n            </div>\n\n            {/* Modals */}\n            <StockEntryModal isOpen={isEntryModalOpen} onClose={() => setIsEntryModalOpen(false)} />\n            <StockTransferModal isOpen={isTransferModalOpen} onClose={() => setIsTransferModalOpen(false)} />\n        </div>\n    );\n};\n\nexport default InventoryPage;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8371, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/analytics/FinancialService.ts"],"sourcesContent":["import { SaleTransaction, Expense, InventoryBatch, EmployeeProfile } from '../types';\n\nexport class FinancialService {\n\n    static filterByDateRange<T extends { date?: number; timestamp?: number }>(\n        items: T[],\n        start: Date,\n        end: Date\n    ): T[] {\n        const startTime = start.getTime();\n        const endTime = end.getTime();\n        return items.filter(item => {\n            const time = item.date || item.timestamp || 0;\n            return time >= startTime && time <= endTime;\n        });\n    }\n\n    static getSalesSummary(sales: SaleTransaction[]) {\n        let grossSales = 0;\n        let netSales = 0; // Ventas menos IVA (aprox 19%)\n        let paymentMethods = {\n            CASH: 0,\n            DEBIT: 0,\n            CREDIT: 0,\n            TRANSFER: 0\n        };\n\n        sales.forEach(sale => {\n            grossSales += sale.total;\n            paymentMethods[sale.payment_method] = (paymentMethods[sale.payment_method] || 0) + sale.total;\n        });\n\n        netSales = Math.round(grossSales / 1.19);\n\n        return {\n            grossSales,\n            netSales,\n            paymentMethods\n        };\n    }\n\n    static getExpensesSummary(expenses: Expense[]) {\n        let totalExpenses = 0;\n        let deductibleExpenses = 0;\n        let nonDeductibleExpenses = 0;\n        let byCategory: Record<string, number> = {};\n\n        expenses.forEach(expense => {\n            totalExpenses += expense.amount;\n            if (expense.is_deductible) {\n                deductibleExpenses += expense.amount;\n            } else {\n                nonDeductibleExpenses += expense.amount;\n            }\n            byCategory[expense.category] = (byCategory[expense.category] || 0) + expense.amount;\n        });\n\n        return {\n            totalExpenses,\n            deductibleExpenses,\n            nonDeductibleExpenses,\n            byCategory\n        };\n    }\n\n    static calculateEBITDA(grossSales: number, totalExpenses: number) {\n        // Simplificación: EBITDA = Ventas - Gastos (sin considerar depreciación/amortización por ahora)\n        return grossSales - totalExpenses;\n    }\n\n    static getTaxCompliance(sales: SaleTransaction[], expenses: Expense[], ppmRate: number = 0.015) {\n        const salesSummary = this.getSalesSummary(sales);\n        const expensesSummary = this.getExpensesSummary(expenses);\n\n        const debitFiscal = salesSummary.grossSales - salesSummary.netSales; // IVA Ventas\n        // Asumimos que el 100% de los gastos deducibles tienen IVA recuperable para simplificar, \n        // o deberíamos filtrar solo facturas de compra.\n        // Refinamiento: Solo gastos con document_type === 'FACTURA' generan crédito fiscal.\n        const facturaExpenses = expenses.filter(e => e.document_type === 'FACTURA');\n        const creditFiscal = Math.round(facturaExpenses.reduce((sum, e) => sum + e.amount, 0) * 0.19 / 1.19); // Extraer IVA de monto bruto\n\n        const ivaToPay = Math.max(0, debitFiscal - creditFiscal);\n        const ppm = Math.round(salesSummary.netSales * ppmRate);\n\n        return {\n            debitFiscal,\n            creditFiscal,\n            ivaToPay,\n            ppm,\n            nonDeductibleWarning: expensesSummary.nonDeductibleExpenses\n        };\n    }\n\n    static getLaborCosts(employees: EmployeeProfile[]) {\n        let totalSalaries = 0;\n        let totalSocialLaws = 0; // Aprox 20% sobre imponible (simplificado)\n        let totalCost = 0;\n\n        employees.forEach(emp => {\n            if (emp.status === 'ACTIVE') {\n                const salary = emp.labor_data.base_salary;\n                totalSalaries += salary;\n                // Estimación costo empresa: Sueldo Líquido + ~20-25% leyes sociales\n                // Aquí usamos base_salary como \"Sueldo Base Imponible\"\n                const socialLaws = Math.round(salary * 0.22);\n                totalSocialLaws += socialLaws;\n                totalCost += salary + socialLaws;\n            }\n        });\n\n        return {\n            totalSalaries,\n            totalSocialLaws,\n            totalCost\n        };\n    }\n}\n"],"names":[],"mappings":";;;;AAEO,MAAM;IAET,OAAO,kBACH,KAAU,EACV,KAAW,EACX,GAAS,EACN;QACH,MAAM,YAAY,MAAM,OAAO;QAC/B,MAAM,UAAU,IAAI,OAAO;QAC3B,OAAO,MAAM,MAAM,CAAC,CAAA;YAChB,MAAM,OAAO,KAAK,IAAI,IAAI,KAAK,SAAS,IAAI;YAC5C,OAAO,QAAQ,aAAa,QAAQ;QACxC;IACJ;IAEA,OAAO,gBAAgB,KAAwB,EAAE;QAC7C,IAAI,aAAa;QACjB,IAAI,WAAW,GAAG,+BAA+B;QACjD,IAAI,iBAAiB;YACjB,MAAM;YACN,OAAO;YACP,QAAQ;YACR,UAAU;QACd;QAEA,MAAM,OAAO,CAAC,CAAA;YACV,cAAc,KAAK,KAAK;YACxB,cAAc,CAAC,KAAK,cAAc,CAAC,GAAG,CAAC,cAAc,CAAC,KAAK,cAAc,CAAC,IAAI,CAAC,IAAI,KAAK,KAAK;QACjG;QAEA,WAAW,KAAK,KAAK,CAAC,aAAa;QAEnC,OAAO;YACH;YACA;YACA;QACJ;IACJ;IAEA,OAAO,mBAAmB,QAAmB,EAAE;QAC3C,IAAI,gBAAgB;QACpB,IAAI,qBAAqB;QACzB,IAAI,wBAAwB;QAC5B,IAAI,aAAqC,CAAC;QAE1C,SAAS,OAAO,CAAC,CAAA;YACb,iBAAiB,QAAQ,MAAM;YAC/B,IAAI,QAAQ,aAAa,EAAE;gBACvB,sBAAsB,QAAQ,MAAM;YACxC,OAAO;gBACH,yBAAyB,QAAQ,MAAM;YAC3C;YACA,UAAU,CAAC,QAAQ,QAAQ,CAAC,GAAG,CAAC,UAAU,CAAC,QAAQ,QAAQ,CAAC,IAAI,CAAC,IAAI,QAAQ,MAAM;QACvF;QAEA,OAAO;YACH;YACA;YACA;YACA;QACJ;IACJ;IAEA,OAAO,gBAAgB,UAAkB,EAAE,aAAqB,EAAE;QAC9D,gGAAgG;QAChG,OAAO,aAAa;IACxB;IAEA,OAAO,iBAAiB,KAAwB,EAAE,QAAmB,EAAE,UAAkB,KAAK,EAAE;QAC5F,MAAM,eAAe,IAAI,CAAC,eAAe,CAAC;QAC1C,MAAM,kBAAkB,IAAI,CAAC,kBAAkB,CAAC;QAEhD,MAAM,cAAc,aAAa,UAAU,GAAG,aAAa,QAAQ,EAAE,aAAa;QAClF,0FAA0F;QAC1F,gDAAgD;QAChD,oFAAoF;QACpF,MAAM,kBAAkB,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,aAAa,KAAK;QACjE,MAAM,eAAe,KAAK,KAAK,CAAC,gBAAgB,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,MAAM,EAAE,KAAK,OAAO,OAAO,6BAA6B;QAEnI,MAAM,WAAW,KAAK,GAAG,CAAC,GAAG,cAAc;QAC3C,MAAM,MAAM,KAAK,KAAK,CAAC,aAAa,QAAQ,GAAG;QAE/C,OAAO;YACH;YACA;YACA;YACA;YACA,sBAAsB,gBAAgB,qBAAqB;QAC/D;IACJ;IAEA,OAAO,cAAc,SAA4B,EAAE;QAC/C,IAAI,gBAAgB;QACpB,IAAI,kBAAkB,GAAG,2CAA2C;QACpE,IAAI,YAAY;QAEhB,UAAU,OAAO,CAAC,CAAA;YACd,IAAI,IAAI,MAAM,KAAK,UAAU;gBACzB,MAAM,SAAS,IAAI,UAAU,CAAC,WAAW;gBACzC,iBAAiB;gBACjB,oEAAoE;gBACpE,uDAAuD;gBACvD,MAAM,aAAa,KAAK,KAAK,CAAC,SAAS;gBACvC,mBAAmB;gBACnB,aAAa,SAAS;YAC1B;QACJ;QAEA,OAAO;YACH;YACA;YACA;QACJ;IACJ;AACJ"}},
    {"offset": {"line": 8477, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/ReportsPage.tsx"],"sourcesContent":["import React, { useState, useMemo } from 'react';\nimport { usePharmaStore } from '../store/useStore';\nimport { FinancialService } from '../../domain/analytics/FinancialService';\nimport {\n    BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,\n    PieChart, Pie, Cell, LineChart, Line, ComposedChart, Area\n} from 'recharts';\nimport { Download, Calendar, DollarSign, Users, Package, FileText, TrendingUp, AlertTriangle } from 'lucide-react';\nimport * as XLSX from 'xlsx';\nimport { format } from 'date-fns';\nimport { es } from 'date-fns/locale';\n\n// --- Components ---\n\nconst KPICard = ({ title, value, subtext, icon: Icon, color }: any) => (\n    <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-start justify-between\">\n        <div>\n            <p className=\"text-sm font-medium text-gray-500 mb-1\">{title}</p>\n            <h3 className=\"text-2xl font-bold text-gray-900\">{value}</h3>\n            {subtext && <p className={`text-xs mt-2 ${color === 'red' ? 'text-red-500' : 'text-green-500'}`}>{subtext}</p>}\n        </div>\n        <div className={`p-3 rounded-xl ${color === 'blue' ? 'bg-blue-50 text-blue-600' : color === 'green' ? 'bg-green-50 text-green-600' : 'bg-purple-50 text-purple-600'}`}>\n            <Icon size={24} />\n        </div>\n    </div>\n);\n\nconst ReportsPage: React.FC = () => {\n    const { salesHistory, expenses, employees, inventory } = usePharmaStore();\n    const [dateRange, setDateRange] = useState<{ start: Date, end: Date, label: string }>({\n        start: new Date(new Date().setHours(0, 0, 0, 0)),\n        end: new Date(new Date().setHours(23, 59, 59, 999)),\n        label: 'Hoy'\n    });\n    const [activeTab, setActiveTab] = useState<'FINANCE' | 'TAX' | 'HR' | 'INVENTORY'>('FINANCE');\n\n    // --- Data Aggregation ---\n    const filteredSales = useMemo(() => FinancialService.filterByDateRange(salesHistory, dateRange.start, dateRange.end), [salesHistory, dateRange]);\n    const filteredExpenses = useMemo(() => FinancialService.filterByDateRange(expenses, dateRange.start, dateRange.end), [expenses, dateRange]);\n\n    const salesSummary = useMemo(() => FinancialService.getSalesSummary(filteredSales), [filteredSales]);\n    const expensesSummary = useMemo(() => FinancialService.getExpensesSummary(filteredExpenses), [filteredExpenses]);\n    const taxData = useMemo(() => FinancialService.getTaxCompliance(filteredSales, filteredExpenses), [filteredSales, filteredExpenses]);\n    const laborData = useMemo(() => FinancialService.getLaborCosts(employees), [employees]);\n\n    // --- Charts Data ---\n    const paymentMethodsData = Object.entries(salesSummary.paymentMethods).map(([name, value]) => ({ name, value }));\n    const expensesByCategoryData = Object.entries(expensesSummary.byCategory).map(([name, value]) => ({ name, value }));\n    const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8'];\n\n    // --- Handlers ---\n    const handlePresetChange = (preset: string) => {\n        const now = new Date();\n        let start = new Date();\n        let end = new Date();\n\n        switch (preset) {\n            case 'HOY':\n                start.setHours(0, 0, 0, 0);\n                end.setHours(23, 59, 59, 999);\n                break;\n            case 'AYER':\n                start.setDate(now.getDate() - 1);\n                start.setHours(0, 0, 0, 0);\n                end.setDate(now.getDate() - 1);\n                end.setHours(23, 59, 59, 999);\n                break;\n            case 'ESTA_SEMANA':\n                const day = now.getDay() || 7;\n                if (day !== 1) start.setHours(-24 * (day - 1));\n                start.setHours(0, 0, 0, 0);\n                end.setHours(23, 59, 59, 999);\n                break;\n            case 'ESTE_MES':\n                start = new Date(now.getFullYear(), now.getMonth(), 1);\n                end = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);\n                break;\n        }\n        setDateRange({ start, end, label: preset });\n    };\n\n    const handleDownloadReport = () => {\n        const wb = XLSX.utils.book_new();\n\n        // 1. Libro Ventas\n        const salesSheet = XLSX.utils.json_to_sheet(filteredSales.map(s => ({\n            ID: s.id,\n            Fecha: new Date(s.timestamp).toLocaleString(),\n            Total: s.total,\n            Metodo: s.payment_method,\n            Vendedor: s.seller_id\n        })));\n        XLSX.utils.book_append_sheet(wb, salesSheet, \"Libro Ventas\");\n\n        // 2. Libro Compras (Gastos)\n        const expensesSheet = XLSX.utils.json_to_sheet(filteredExpenses.map(e => ({\n            Descripcion: e.description,\n            Monto: e.amount,\n            Categoria: e.category,\n            Fecha: new Date(e.date).toLocaleDateString(),\n            Deducible: e.is_deductible ? 'SI' : 'NO',\n            Documento: e.document_type\n        })));\n        XLSX.utils.book_append_sheet(wb, expensesSheet, \"Gastos & Compras\");\n\n        // 3. Resumen\n        const summaryData = [\n            { Concepto: 'Ventas Brutas', Valor: salesSummary.grossSales },\n            { Concepto: 'Ventas Netas', Valor: salesSummary.netSales },\n            { Concepto: 'Gastos Totales', Valor: expensesSummary.totalExpenses },\n            { Concepto: 'IVA Débito', Valor: taxData.debitFiscal },\n            { Concepto: 'IVA Crédito', Valor: taxData.creditFiscal },\n            { Concepto: 'A Pagar (Estimado)', Valor: taxData.ivaToPay }\n        ];\n        const summarySheet = XLSX.utils.json_to_sheet(summaryData);\n        XLSX.utils.book_append_sheet(wb, summarySheet, \"Resumen Financiero\");\n\n        XLSX.writeFile(wb, `Reporte_Farmacia_${format(new Date(), 'yyyy-MM-dd')}.xlsx`);\n    };\n\n    return (\n        <div className=\"min-h-screen bg-gray-50 p-8 font-sans text-gray-800\">\n            {/* --- Header & Controls --- */}\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4\">\n                <div>\n                    <h1 className=\"text-3xl font-bold text-gray-900 tracking-tight\">Centro de Inteligencia (BI)</h1>\n                    <p className=\"text-gray-500 mt-1\">Visión estratégica y control financiero total.</p>\n                </div>\n\n                <div className=\"flex items-center gap-3 bg-white p-1.5 rounded-xl shadow-sm border border-gray-200\">\n                    {['HOY', 'AYER', 'ESTA_SEMANA', 'ESTE_MES'].map(preset => (\n                        <button\n                            key={preset}\n                            onClick={() => handlePresetChange(preset)}\n                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${dateRange.label === preset\n                                    ? 'bg-blue-600 text-white shadow-md'\n                                    : 'text-gray-600 hover:bg-gray-100'\n                                }`}\n                        >\n                            {preset.replace('_', ' ')}\n                        </button>\n                    ))}\n                    <div className=\"h-6 w-px bg-gray-300 mx-1\"></div>\n                    <button className=\"flex items-center gap-2 px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm font-medium\">\n                        <Calendar size={16} />\n                        <span>Personalizado</span>\n                    </button>\n                </div>\n\n                <button\n                    onClick={handleDownloadReport}\n                    className=\"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl shadow-lg shadow-green-200 transition-all transform hover:-translate-y-0.5 font-semibold\"\n                >\n                    <Download size={20} />\n                    <span>Descargar Pack Mensual</span>\n                </button>\n            </div>\n\n            {/* --- Tabs --- */}\n            <div className=\"flex gap-6 border-b border-gray-200 mb-8\">\n                {[\n                    { id: 'FINANCE', label: 'Finanzas & Cashflow', icon: DollarSign },\n                    { id: 'TAX', label: 'Cumplimiento Tributario', icon: FileText },\n                    { id: 'HR', label: 'RR.HH. & Dotación', icon: Users },\n                    { id: 'INVENTORY', label: 'Movimientos Bodega', icon: Package },\n                ].map(tab => (\n                    <button\n                        key={tab.id}\n                        onClick={() => setActiveTab(tab.id as any)}\n                        className={`flex items-center gap-2 pb-4 px-2 text-sm font-semibold transition-all relative ${activeTab === tab.id ? 'text-blue-600' : 'text-gray-400 hover:text-gray-600'\n                            }`}\n                    >\n                        <tab.icon size={18} />\n                        {tab.label}\n                        {activeTab === tab.id && (\n                            <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-blue-600 rounded-t-full\" />\n                        )}\n                    </button>\n                ))}\n            </div>\n\n            {/* --- Content --- */}\n            <div className=\"space-y-8\">\n\n                {/* 1. FINANCE TAB */}\n                {activeTab === 'FINANCE' && (\n                    <>\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n                            <KPICard\n                                title=\"Ventas Brutas\"\n                                value={`$${salesSummary.grossSales.toLocaleString()}`}\n                                subtext={`${filteredSales.length} transacciones`}\n                                icon={TrendingUp}\n                                color=\"blue\"\n                            />\n                            <KPICard\n                                title=\"Ventas Netas\"\n                                value={`$${salesSummary.netSales.toLocaleString()}`}\n                                subtext=\"Excluye IVA\"\n                                icon={DollarSign}\n                                color=\"green\"\n                            />\n                            <KPICard\n                                title=\"Gastos Totales\"\n                                value={`$${expensesSummary.totalExpenses.toLocaleString()}`}\n                                subtext=\"Operativos + RRHH\"\n                                icon={AlertTriangle}\n                                color=\"red\"\n                            />\n                            <KPICard\n                                title=\"EBITDA (Est.)\"\n                                value={`$${(salesSummary.netSales - expensesSummary.totalExpenses).toLocaleString()}`}\n                                subtext=\"Margen Operativo\"\n                                icon={TrendingUp}\n                                color=\"purple\"\n                            />\n                        </div>\n\n                        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                            {/* Income Breakdown */}\n                            <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-gray-100\">\n                                <h3 className=\"text-lg font-bold text-gray-900 mb-6\">Desglose de Ingresos</h3>\n                                <div className=\"h-80\">\n                                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                        <PieChart>\n                                            <Pie\n                                                data={paymentMethodsData}\n                                                cx=\"50%\"\n                                                cy=\"50%\"\n                                                innerRadius={60}\n                                                outerRadius={100}\n                                                fill=\"#8884d8\"\n                                                paddingAngle={5}\n                                                dataKey=\"value\"\n                                            >\n                                                {paymentMethodsData.map((entry, index) => (\n                                                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                                                ))}\n                                            </Pie>\n                                            <Tooltip formatter={(value: number) => `$${value.toLocaleString()}`} />\n                                            <Legend />\n                                        </PieChart>\n                                    </ResponsiveContainer>\n                                </div>\n                            </div>\n\n                            {/* Expenses Breakdown */}\n                            <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-gray-100\">\n                                <h3 className=\"text-lg font-bold text-gray-900 mb-6\">Estructura de Gastos</h3>\n                                <div className=\"h-80\">\n                                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                        <BarChart data={expensesByCategoryData} layout=\"vertical\">\n                                            <CartesianGrid strokeDasharray=\"3 3\" horizontal={false} />\n                                            <XAxis type=\"number\" hide />\n                                            <YAxis dataKey=\"name\" type=\"category\" width={100} tick={{ fontSize: 12 }} />\n                                            <Tooltip formatter={(value: number) => `$${value.toLocaleString()}`} />\n                                            <Bar dataKey=\"value\" fill=\"#FF8042\" radius={[0, 4, 4, 0]} barSize={30} />\n                                        </BarChart>\n                                    </ResponsiveContainer>\n                                </div>\n                            </div>\n                        </div>\n                    </>\n                )}\n\n                {/* 2. TAX TAB */}\n                {activeTab === 'TAX' && (\n                    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                        <div className=\"lg:col-span-2 bg-white p-8 rounded-2xl shadow-sm border border-gray-100\">\n                            <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2\">\n                                <FileText className=\"text-blue-600\" />\n                                Simulador F29 (IVA)\n                            </h3>\n\n                            <div className=\"space-y-6\">\n                                <div className=\"flex justify-between items-center p-4 bg-green-50 rounded-xl border border-green-100\">\n                                    <div>\n                                        <p className=\"text-sm font-medium text-green-800\">Débito Fiscal (IVA Ventas)</p>\n                                        <p className=\"text-xs text-green-600\">Generado por ventas con boleta/factura</p>\n                                    </div>\n                                    <span className=\"text-2xl font-bold text-green-700\">+ ${taxData.debitFiscal.toLocaleString()}</span>\n                                </div>\n\n                                <div className=\"flex justify-between items-center p-4 bg-red-50 rounded-xl border border-red-100\">\n                                    <div>\n                                        <p className=\"text-sm font-medium text-red-800\">Crédito Fiscal (IVA Compras)</p>\n                                        <p className=\"text-xs text-red-600\">Solo compras con FACTURA</p>\n                                    </div>\n                                    <span className=\"text-2xl font-bold text-red-700\">- ${taxData.creditFiscal.toLocaleString()}</span>\n                                </div>\n\n                                <div className=\"h-px bg-gray-200 my-4\"></div>\n\n                                <div className=\"flex justify-between items-center p-6 bg-gray-900 rounded-xl text-white shadow-lg\">\n                                    <div>\n                                        <p className=\"text-sm font-medium text-gray-400\">IVA a Pagar (Estimado)</p>\n                                        <p className=\"text-xs text-gray-500\">A pagar el día 20 del mes siguiente</p>\n                                    </div>\n                                    <span className=\"text-4xl font-bold\">${taxData.ivaToPay.toLocaleString()}</span>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"space-y-6\">\n                            <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-gray-100\">\n                                <h3 className=\"text-lg font-bold text-gray-900 mb-4\">PPM Estimado</h3>\n                                <p className=\"text-sm text-gray-500 mb-4\">Pago Provisional Mensual (1.5% Ventas Netas)</p>\n                                <div className=\"text-3xl font-bold text-blue-600 mb-2\">${taxData.ppm.toLocaleString()}</div>\n                                <div className=\"w-full bg-gray-100 rounded-full h-2\">\n                                    <div className=\"bg-blue-600 h-2 rounded-full\" style={{ width: '15%' }}></div>\n                                </div>\n                            </div>\n\n                            <div className=\"bg-orange-50 p-6 rounded-2xl border border-orange-100\">\n                                <div className=\"flex items-start gap-3\">\n                                    <AlertTriangle className=\"text-orange-600 shrink-0\" />\n                                    <div>\n                                        <h4 className=\"font-bold text-orange-800\">Alerta de Gastos No Deducibles</h4>\n                                        <p className=\"text-sm text-orange-700 mt-1\">\n                                            Tienes <strong>${taxData.nonDeductibleWarning.toLocaleString()}</strong> en gastos sin respaldo tributario (boletas o sin documento). Esto aumenta tu base imponible artificialmente.\n                                        </p>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* 3. HR TAB */}\n                {activeTab === 'HR' && (\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                        <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-gray-100\">\n                            <h3 className=\"text-lg font-bold text-gray-900 mb-6\">Costo Empresa Real</h3>\n                            <div className=\"space-y-4\">\n                                <div className=\"flex justify-between items-center\">\n                                    <span className=\"text-gray-600\">Sueldos Líquidos + Retenciones</span>\n                                    <span className=\"font-semibold\">${laborData.totalSalaries.toLocaleString()}</span>\n                                </div>\n                                <div className=\"flex justify-between items-center\">\n                                    <span className=\"text-gray-600\">Aporte Patronal (SIS, Cesantía, Mutual)</span>\n                                    <span className=\"font-semibold text-red-600\">+ ${laborData.totalSocialLaws.toLocaleString()}</span>\n                                </div>\n                                <div className=\"h-px bg-gray-200\"></div>\n                                <div className=\"flex justify-between items-center text-lg font-bold\">\n                                    <span>Costo Total Nómina</span>\n                                    <span>${laborData.totalCost.toLocaleString()}</span>\n                                </div>\n                            </div>\n                            <div className=\"mt-6 p-4 bg-blue-50 rounded-xl text-sm text-blue-700\">\n                                💡 El costo real de tu equipo es un <strong>~22%</strong> mayor a la suma de los sueldos imponibles.\n                            </div>\n                        </div>\n\n                        <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-gray-100\">\n                            <h3 className=\"text-lg font-bold text-gray-900 mb-6\">Dotación Activa</h3>\n                            <div className=\"space-y-4\">\n                                {employees.map(emp => (\n                                    <div key={emp.id} className=\"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <div className=\"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-bold\">\n                                                {emp.name.charAt(0)}\n                                            </div>\n                                            <div>\n                                                <p className=\"font-medium text-gray-900\">{emp.name}</p>\n                                                <p className=\"text-xs text-gray-500\">{emp.role}</p>\n                                            </div>\n                                        </div>\n                                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${emp.status === 'ACTIVE' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>\n                                            {emp.status}\n                                        </span>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* 4. INVENTORY TAB */}\n                {activeTab === 'INVENTORY' && (\n                    <div className=\"bg-white p-8 rounded-2xl shadow-sm border border-gray-100 text-center py-20\">\n                        <Package size={64} className=\"mx-auto text-gray-300 mb-4\" />\n                        <h3 className=\"text-xl font-bold text-gray-900\">Análisis de Inventario en Desarrollo</h3>\n                        <p className=\"text-gray-500 mt-2 max-w-md mx-auto\">\n                            Próximamente podrás ver el balance de masas, rotación de stock y análisis de mermas detallado aquí.\n                        </p>\n                    </div>\n                )}\n\n            </div>\n        </div>\n    );\n};\n\nexport default ReportsPage;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9708, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/AttendanceKioskPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { usePharmaStore } from '../store/useStore';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Lock, User, Clock, Fingerprint, LogOut, CheckCircle, AlertTriangle, Coffee, ArrowRight } from 'lucide-react';\nimport { WebAuthnService } from '../../infrastructure/biometrics/WebAuthnService';\nimport { EmployeeProfile, AttendanceStatus } from '../../domain/types';\n\nconst AttendanceKioskPage: React.FC = () => {\n    const { employees, registerAttendance, user } = usePharmaStore();\n    const [isLocked, setIsLocked] = useState(true);\n    const [selectedEmployee, setSelectedEmployee] = useState<EmployeeProfile | null>(null);\n    const [authMethod, setAuthMethod] = useState<'PIN' | 'BIOMETRIC' | null>(null);\n    const [pin, setPin] = useState('');\n    const [message, setMessage] = useState<{ text: string, type: 'success' | 'error' } | null>(null);\n\n    // --- Activation Logic ---\n    const handleUnlock = () => {\n        const password = prompt(\"Ingrese contraseña de GERENTE para activar el Kiosco:\");\n        if (password === 'admin123') { // Hardcoded for demo\n            setIsLocked(false);\n        } else {\n            alert(\"Contraseña incorrecta\");\n        }\n    };\n\n    // --- Authentication Logic ---\n    const handlePinSubmit = () => {\n        if (!selectedEmployee) return;\n        if (pin === selectedEmployee.access_pin) {\n            handleAttendanceAction();\n        } else {\n            setMessage({ text: 'PIN Incorrecto', type: 'error' });\n            setPin('');\n        }\n    };\n\n    const handleBiometricAuth = async () => {\n        if (!selectedEmployee) return;\n        setMessage({ text: 'Coloque su dedo en el sensor...', type: 'success' });\n\n        const result = await WebAuthnService.verifyCredential(selectedEmployee.id);\n        if (result.success) {\n            handleAttendanceAction();\n        } else {\n            setMessage({ text: result.message, type: 'error' });\n        }\n    };\n\n    const handleAttendanceAction = () => {\n        if (!selectedEmployee) return;\n\n        let action: 'CHECK_IN' | 'CHECK_OUT' | 'LUNCH_START' | 'LUNCH_END' = 'CHECK_IN';\n        const status = selectedEmployee.current_status || 'OUT';\n\n        // Determine next logical action\n        if (status === 'OUT') action = 'CHECK_IN';\n        if (status === 'IN') {\n            // Ask user preference in a real app, here we toggle for simplicity or show options\n            // For this MVP, if IN, we show options in the UI before this function is called, \n            // BUT since we are inside the auth flow, let's assume we need to know what they want to do.\n            // Let's simplify: If IN, default to CHECK_OUT, but we should probably have selected the action BEFORE auth.\n            // REFACTOR: Let's select action AFTER auth for security, or select action THEN auth.\n            // Standard Kiosk: Select User -> Auth -> Select Action (if multiple available) or Auto-Action.\n        }\n\n        // Since we need to support multiple actions from IN state (Lunch vs Out), \n        // we will show an Action Selection screen AFTER successful auth.\n        setAuthMethod(null); // Close auth modal\n        // We need a new state for \"Authenticated Employee\"\n    };\n\n    // Refactored Flow:\n    // 1. Select Employee\n    // 2. Authenticate (PIN/Bio)\n    // 3. Show Actions based on current status\n\n    const [authenticatedEmployee, setAuthenticatedEmployee] = useState<EmployeeProfile | null>(null);\n\n    const onAuthSuccess = () => {\n        setAuthenticatedEmployee(selectedEmployee);\n        setSelectedEmployee(null);\n        setAuthMethod(null);\n        setPin('');\n        setMessage(null);\n    };\n\n    const processAction = (type: 'CHECK_IN' | 'CHECK_OUT' | 'LUNCH_START' | 'LUNCH_END') => {\n        if (!authenticatedEmployee) return;\n        registerAttendance(authenticatedEmployee.id, type);\n\n        setMessage({ text: `Marcaje registrado: ${type}`, type: 'success' });\n\n        setTimeout(() => {\n            setAuthenticatedEmployee(null);\n            setMessage(null);\n        }, 3000);\n    };\n\n    // --- Renders ---\n\n    if (isLocked) {\n        return (\n            <div className=\"min-h-screen bg-slate-900 flex flex-col items-center justify-center text-white p-4\">\n                <Lock size={64} className=\"mb-6 text-slate-500\" />\n                <h1 className=\"text-3xl font-bold mb-2\">Terminal Bloqueado</h1>\n                <p className=\"text-slate-400 mb-8 text-center max-w-md\">\n                    Este dispositivo no está activo como Kiosco de Asistencia.\n                    Se requiere autorización de un Gerente para activarlo.\n                </p>\n                <button\n                    onClick={handleUnlock}\n                    className=\"bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-bold transition-all\"\n                >\n                    Activar Terminal\n                </button>\n            </div>\n        );\n    }\n\n    if (authenticatedEmployee) {\n        return (\n            <div className=\"min-h-screen bg-slate-50 flex flex-col items-center justify-center p-4\">\n                <div className=\"bg-white p-8 rounded-3xl shadow-xl max-w-lg w-full text-center\">\n                    <div className=\"w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600 font-bold text-3xl\">\n                        {authenticatedEmployee.name.charAt(0)}\n                    </div>\n                    <h2 className=\"text-2xl font-bold text-slate-800 mb-1\">Hola, {authenticatedEmployee.name}</h2>\n                    <p className=\"text-slate-500 mb-8\">Selecciona tu marcaje</p>\n\n                    <div className=\"grid gap-4\">\n                        {authenticatedEmployee.current_status === 'OUT' && (\n                            <button\n                                onClick={() => processAction('CHECK_IN')}\n                                className=\"bg-green-500 hover:bg-green-600 text-white p-6 rounded-2xl font-bold text-xl flex items-center justify-center gap-3 transition-all\"\n                            >\n                                <LogOut className=\"rotate-180\" /> ENTRADA\n                            </button>\n                        )}\n\n                        {(authenticatedEmployee.current_status === 'IN' || authenticatedEmployee.current_status === 'LUNCH') && (\n                            <>\n                                {authenticatedEmployee.current_status === 'IN' && (\n                                    <button\n                                        onClick={() => processAction('LUNCH_START')}\n                                        className=\"bg-amber-500 hover:bg-amber-600 text-white p-6 rounded-2xl font-bold text-xl flex items-center justify-center gap-3 transition-all\"\n                                    >\n                                        <Coffee /> SALIDA A COLACIÓN\n                                    </button>\n                                )}\n\n                                {authenticatedEmployee.current_status === 'LUNCH' && (\n                                    <button\n                                        onClick={() => processAction('LUNCH_END')}\n                                        className=\"bg-blue-500 hover:bg-blue-600 text-white p-6 rounded-2xl font-bold text-xl flex items-center justify-center gap-3 transition-all\"\n                                    >\n                                        <ArrowRight /> VUELTA DE COLACIÓN\n                                    </button>\n                                )}\n\n                                {authenticatedEmployee.current_status === 'IN' && (\n                                    <button\n                                        onClick={() => processAction('CHECK_OUT')}\n                                        className=\"bg-red-500 hover:bg-red-600 text-white p-6 rounded-2xl font-bold text-xl flex items-center justify-center gap-3 transition-all\"\n                                    >\n                                        <LogOut /> FIN DE JORNADA\n                                    </button>\n                                )}\n                            </>\n                        )}\n                    </div>\n\n                    <button\n                        onClick={() => setAuthenticatedEmployee(null)}\n                        className=\"mt-8 text-slate-400 hover:text-slate-600 font-medium\"\n                    >\n                        Cancelar\n                    </button>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen bg-slate-100 flex flex-col\">\n            {/* Header */}\n            <div className=\"bg-white p-6 shadow-sm flex justify-between items-center\">\n                <div className=\"flex items-center gap-3\">\n                    <Clock className=\"text-blue-600\" size={32} />\n                    <div>\n                        <h1 className=\"text-xl font-bold text-slate-800\">Control de Asistencia</h1>\n                        <p className=\"text-sm text-slate-500\">{new Date().toLocaleDateString()} - {new Date().toLocaleTimeString()}</p>\n                    </div>\n                </div>\n                <button onClick={() => setIsLocked(true)} className=\"text-slate-400 hover:text-red-500\">\n                    <Lock size={20} />\n                </button>\n            </div>\n\n            {/* Employee Grid */}\n            <div className=\"flex-1 p-6 overflow-y-auto\">\n                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6\">\n                    {employees.map(emp => (\n                        <motion.button\n                            key={emp.id}\n                            whileHover={{ scale: 1.02 }}\n                            whileTap={{ scale: 0.98 }}\n                            onClick={() => { setSelectedEmployee(emp); setAuthMethod('BIOMETRIC'); }}\n                            className=\"bg-white p-6 rounded-2xl shadow-sm hover:shadow-md transition-all flex flex-col items-center text-center relative overflow-hidden\"\n                        >\n                            {/* Status Indicator */}\n                            <div className={`absolute top-4 right-4 w-4 h-4 rounded-full ${emp.current_status === 'IN' ? 'bg-green-500 animate-pulse' :\n                                    emp.current_status === 'LUNCH' ? 'bg-amber-500' : 'bg-slate-300'\n                                }`} />\n\n                            <div className=\"w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mb-4 text-slate-500 font-bold text-2xl\">\n                                {emp.name.charAt(0)}\n                            </div>\n                            <h3 className=\"font-bold text-slate-800 text-lg\">{emp.name}</h3>\n                            <p className=\"text-sm text-slate-500\">{emp.role}</p>\n                            <span className={`mt-3 px-3 py-1 rounded-full text-xs font-bold ${emp.current_status === 'IN' ? 'bg-green-100 text-green-700' :\n                                    emp.current_status === 'LUNCH' ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-500'\n                                }`}>\n                                {emp.current_status === 'IN' ? 'TRABAJANDO' :\n                                    emp.current_status === 'LUNCH' ? 'EN COLACIÓN' : 'FUERA'}\n                            </span>\n                        </motion.button>\n                    ))}\n                </div>\n            </div>\n\n            {/* Auth Modal */}\n            <AnimatePresence>\n                {selectedEmployee && authMethod && (\n                    <motion.div\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        exit={{ opacity: 0 }}\n                        className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\"\n                    >\n                        <motion.div\n                            initial={{ scale: 0.9 }}\n                            animate={{ scale: 1 }}\n                            exit={{ scale: 0.9 }}\n                            className=\"bg-white rounded-3xl p-8 max-w-md w-full relative\"\n                        >\n                            <button\n                                onClick={() => { setSelectedEmployee(null); setAuthMethod(null); setPin(''); setMessage(null); }}\n                                className=\"absolute top-4 right-4 text-slate-400 hover:text-slate-600\"\n                            >\n                                <LogOut size={24} />\n                            </button>\n\n                            <div className=\"text-center mb-8\">\n                                <div className=\"w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600 font-bold text-2xl\">\n                                    {selectedEmployee.name.charAt(0)}\n                                </div>\n                                <h3 className=\"text-xl font-bold text-slate-800\">Hola, {selectedEmployee.name}</h3>\n                                <p className=\"text-slate-500\">Verifica tu identidad para continuar</p>\n                            </div>\n\n                            {message && (\n                                <div className={`mb-6 p-4 rounded-xl text-center font-bold ${message.type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'\n                                    }`}>\n                                    {message.text}\n                                </div>\n                            )}\n\n                            {authMethod === 'BIOMETRIC' ? (\n                                <div className=\"space-y-6\">\n                                    <button\n                                        onClick={handleBiometricAuth}\n                                        className=\"w-full py-8 border-2 border-dashed border-blue-300 bg-blue-50 rounded-2xl flex flex-col items-center gap-3 hover:bg-blue-100 transition-colors group\"\n                                    >\n                                        <Fingerprint size={48} className=\"text-blue-500 group-hover:scale-110 transition-transform\" />\n                                        <span className=\"font-bold text-blue-700\">Tocar Sensor de Huella</span>\n                                    </button>\n\n                                    <div className=\"relative\">\n                                        <div className=\"absolute inset-0 flex items-center\"><div className=\"w-full border-t border-slate-200\"></div></div>\n                                        <div className=\"relative flex justify-center text-sm\"><span className=\"px-2 bg-white text-slate-500\">O usa tu PIN</span></div>\n                                    </div>\n\n                                    <button\n                                        onClick={() => setAuthMethod('PIN')}\n                                        className=\"w-full py-3 text-slate-600 font-bold hover:bg-slate-50 rounded-xl transition-colors\"\n                                    >\n                                        Ingresar PIN Manualmente\n                                    </button>\n                                </div>\n                            ) : (\n                                <div className=\"space-y-6\">\n                                    <div>\n                                        <label className=\"block text-sm font-bold text-slate-700 mb-2\">Ingresa tu PIN de 4 dígitos</label>\n                                        <input\n                                            type=\"password\"\n                                            maxLength={4}\n                                            value={pin}\n                                            onChange={(e) => setPin(e.target.value)}\n                                            className=\"w-full text-center text-4xl tracking-widest font-bold py-4 border-2 border-slate-200 rounded-xl focus:border-blue-500 outline-none\"\n                                            placeholder=\"••••\"\n                                            autoFocus\n                                        />\n                                    </div>\n                                    <button\n                                        onClick={() => {\n                                            if (pin === selectedEmployee.access_pin) {\n                                                onAuthSuccess();\n                                            } else {\n                                                setMessage({ text: 'PIN Incorrecto', type: 'error' });\n                                                setPin('');\n                                            }\n                                        }}\n                                        className=\"w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold shadow-lg shadow-blue-200 transition-all\"\n                                    >\n                                        Confirmar PIN\n                                    </button>\n                                    <button\n                                        onClick={() => setAuthMethod('BIOMETRIC')}\n                                        className=\"w-full py-3 text-slate-600 font-bold hover:bg-slate-50 rounded-xl transition-colors\"\n                                    >\n                                        Volver a Huella Digital\n                                    </button>\n                                </div>\n                            )}\n                        </motion.div>\n                    </motion.div>\n                )}\n            </AnimatePresence>\n        </div>\n    );\n};\n\nexport default AttendanceKioskPage;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10416, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/WarehouseOps.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../store/useStore';\nimport { Package, Truck, ArrowRight, CheckCircle, AlertTriangle, Search, Filter, FileText, Camera } from 'lucide-react';\nimport { StockTransfer, WarehouseIncident } from '../../domain/types';\n\nexport const WarehouseOps = () => {\n    const {\n        inventory,\n        stockTransfers,\n        dispatchTransfer,\n        receiveTransfer,\n        suppliers,\n        addPurchaseOrder,\n        receivePurchaseOrder\n    } = usePharmaStore();\n\n    const [activeTab, setActiveTab] = useState<'INBOUND' | 'OUTBOUND' | 'TRANSIT' | 'REVERSE'>('INBOUND');\n    const [searchTerm, setSearchTerm] = useState('');\n    const [selectedTransfer, setSelectedTransfer] = useState<StockTransfer | null>(null);\n\n    // --- MOCK DATA FOR UI DEV ---\n    // In a real app, these would come from the store or API\n\n    return (\n        <div className=\"p-6 space-y-6\">\n            <div className=\"flex justify-between items-center\">\n                <h1 className=\"text-2xl font-bold text-gray-800 flex items-center gap-2\">\n                    <Package className=\"w-8 h-8 text-blue-600\" />\n                    Operaciones Logísticas (WMS)\n                </h1>\n                <div className=\"flex gap-2\">\n                    <button className=\"px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 flex items-center gap-2\">\n                        <FileText className=\"w-4 h-4\" />\n                        Reportes\n                    </button>\n                    <button className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2\">\n                        <Truck className=\"w-4 h-4\" />\n                        Nueva Orden\n                    </button>\n                </div>\n            </div>\n\n            {/* Tabs */}\n            <div className=\"flex gap-4 border-b border-gray-200\">\n                <button\n                    onClick={() => setActiveTab('INBOUND')}\n                    className={`pb-3 px-4 font-medium flex items-center gap-2 ${activeTab === 'INBOUND' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500 hover:text-gray-700'}`}\n                >\n                    <ArrowRight className=\"w-4 h-4 rotate-90\" />\n                    Recepción (Inbound)\n                </button>\n                <button\n                    onClick={() => setActiveTab('OUTBOUND')}\n                    className={`pb-3 px-4 font-medium flex items-center gap-2 ${activeTab === 'OUTBOUND' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500 hover:text-gray-700'}`}\n                >\n                    <ArrowRight className=\"w-4 h-4 -rotate-90\" />\n                    Despacho (Outbound)\n                </button>\n                <button\n                    onClick={() => setActiveTab('TRANSIT')}\n                    className={`pb-3 px-4 font-medium flex items-center gap-2 ${activeTab === 'TRANSIT' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500 hover:text-gray-700'}`}\n                >\n                    <Truck className=\"w-4 h-4\" />\n                    En Tránsito\n                    {stockTransfers.filter(t => t.status === 'IN_TRANSIT').length > 0 && (\n                        <span className=\"bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded-full\">\n                            {stockTransfers.filter(t => t.status === 'IN_TRANSIT').length}\n                        </span>\n                    )}\n                </button>\n                <button\n                    onClick={() => setActiveTab('REVERSE')}\n                    className={`pb-3 px-4 font-medium flex items-center gap-2 ${activeTab === 'REVERSE' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500 hover:text-gray-700'}`}\n                >\n                    <AlertTriangle className=\"w-4 h-4\" />\n                    Logística Inversa\n                </button>\n            </div>\n\n            {/* Search & Filter Bar */}\n            <div className=\"flex gap-4 bg-white p-4 rounded-xl shadow-sm border border-gray-100\">\n                <div className=\"relative flex-1\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5\" />\n                    <input\n                        type=\"text\"\n                        placeholder=\"Buscar por SKU, Lote, Orden o Proveedor...\"\n                        className=\"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                    />\n                </div>\n                <button className=\"px-4 py-2 border border-gray-200 rounded-lg hover:bg-gray-50 flex items-center gap-2 text-gray-600\">\n                    <Filter className=\"w-4 h-4\" />\n                    Filtros\n                </button>\n            </div>\n\n            {/* Content Area */}\n            <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 min-h-[400px] p-6\">\n                {activeTab === 'INBOUND' && <InboundView />}\n                {activeTab === 'OUTBOUND' && <OutboundView />}\n                {activeTab === 'TRANSIT' && <TransitView transfers={stockTransfers} onReceive={receiveTransfer} />}\n                {activeTab === 'REVERSE' && <ReverseLogisticsView />}\n            </div>\n        </div>\n    );\n};\n\n// --- Sub-components (Placeholders for now, will expand) ---\n\nconst InboundView = () => (\n    <div className=\"text-center py-12 text-gray-500\">\n        <Package className=\"w-12 h-12 mx-auto mb-4 text-gray-300\" />\n        <h3 className=\"text-lg font-medium text-gray-900\">Recepción de Mercadería</h3>\n        <p>Gestione la recepción de órdenes de compra y devoluciones.</p>\n        <button className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\">\n            Ingresar Recepción Manual\n        </button>\n    </div>\n);\n\nconst OutboundView = () => (\n    <div className=\"text-center py-12 text-gray-500\">\n        <Truck className=\"w-12 h-12 mx-auto mb-4 text-gray-300\" />\n        <h3 className=\"text-lg font-medium text-gray-900\">Despacho y Transferencias</h3>\n        <p>Cree transferencias entre sucursales o devoluciones a proveedores.</p>\n        <button className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\">\n            Nueva Transferencia\n        </button>\n    </div>\n);\n\nconst TransitView = ({ transfers, onReceive }: { transfers: StockTransfer[], onReceive: any }) => {\n    const inTransit = transfers.filter(t => t.status === 'IN_TRANSIT');\n\n    if (inTransit.length === 0) {\n        return (\n            <div className=\"text-center py-12 text-gray-500\">\n                <CheckCircle className=\"w-12 h-12 mx-auto mb-4 text-green-500\" />\n                <h3 className=\"text-lg font-medium text-gray-900\">Todo al día</h3>\n                <p>No hay mercadería en tránsito actualmente.</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-4\">\n            {inTransit.map(transfer => (\n                <div key={transfer.id} className=\"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow\">\n                    <div className=\"flex justify-between items-start mb-4\">\n                        <div>\n                            <div className=\"flex items-center gap-2\">\n                                <span className=\"font-bold text-lg text-gray-900\">{transfer.id}</span>\n                                <span className=\"px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full font-medium\">En Tránsito</span>\n                            </div>\n                            <p className=\"text-sm text-gray-500 mt-1\">\n                                Origen: <span className=\"font-medium text-gray-700\">{transfer.origin_location_id}</span>\n                                <ArrowRight className=\"w-3 h-3 inline mx-2\" />\n                                Destino: <span className=\"font-medium text-gray-700\">{transfer.destination_location_id}</span>\n                            </p>\n                        </div>\n                        <div className=\"text-right text-sm text-gray-500\">\n                            <p>Enviado: {new Date(transfer.timeline.dispatched_at!).toLocaleDateString()}</p>\n                            <p>{transfer.items.length} Items</p>\n                        </div>\n                    </div>\n\n                    <div className=\"bg-gray-50 rounded p-3 mb-4\">\n                        <h4 className=\"text-xs font-semibold text-gray-500 uppercase mb-2\">Contenido</h4>\n                        <ul className=\"space-y-1\">\n                            {transfer.items.map((item, idx) => (\n                                <li key={idx} className=\"text-sm flex justify-between\">\n                                    <span>{item.sku}</span>\n                                    <span className=\"font-medium\">x{item.quantity}</span>\n                                </li>\n                            ))}\n                        </ul>\n                    </div>\n\n                    <div className=\"flex justify-end gap-2\">\n                        <button className=\"px-3 py-1.5 text-sm border border-gray-300 rounded hover:bg-gray-50 text-gray-600\">\n                            Ver Documentos\n                        </button>\n                        <button\n                            onClick={() => onReceive(transfer.id)}\n                            className=\"px-3 py-1.5 text-sm bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-1\"\n                        >\n                            <CheckCircle className=\"w-3 h-3\" />\n                            Recepcionar\n                        </button>\n                    </div>\n                </div>\n            ))}\n        </div>\n    );\n};\n\nconst ReverseLogisticsView = () => (\n    <div className=\"text-center py-12 text-gray-500\">\n        <AlertTriangle className=\"w-12 h-12 mx-auto mb-4 text-orange-400\" />\n        <h3 className=\"text-lg font-medium text-gray-900\">Logística Inversa</h3>\n        <p>Gestión de mermas, vencidos y devoluciones de clientes.</p>\n    </div>\n);\n"],"names":[],"mappings":"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"}}]
}