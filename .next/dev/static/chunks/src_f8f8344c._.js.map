{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/actions/sync.ts"],"sourcesContent":["'use server';\n\nimport { query } from '../lib/db';\nimport { InventoryBatch, EmployeeProfile } from '../domain/types';\n\nexport async function fetchInventory(): Promise<InventoryBatch[]> {\n    try {\n        const res = await query('SELECT * FROM productos');\n\n        // Map DB columns to Domain Type\n        // Assuming DB columns might be snake_case or slightly different. \n        // We map what we can and default the rest for safety.\n        return res.rows.map((row: any) => ({\n            id: row.id?.toString() || `PROD-${Math.random()}`,\n            sku: row.sku || row.codigo || 'UNKNOWN',\n            name: row.nombre || row.name || 'Sin Nombre',\n            dci: row.dci || row.principio_activo || '',\n            // lot_number is removed as per new mapping, if needed, add back with a default\n            expiry_date: row.vencimiento ? new Date(row.vencimiento).getTime() : Date.now() + 31536000000,\n            category: (row.category || row.categoria) as any, // Use row.category if available, fallback to row.categoria\n            condition: (row.sale_condition || row.condicion_venta) as any, // Map DB column to new field name, fallback to old DB field\n            // storage_condition is removed as per new mapping, if needed, add back with a default\n            allows_commission: row.allows_commission || row.permite_comision || false,\n            active_ingredients: row.active_ingredients || row.principios_activos ? (Array.isArray(row.principios_activos) ? row.principios_activos : [row.principios_activos]) : [],\n            is_bioequivalent: row.is_bioequivalent || row.es_bioequivalente || false,\n            stock_actual: Number(row.stock_actual || row.stock) || 0,\n            stock_min: Number(row.stock_min || row.stock_min) || 5,\n            stock_max: Number(row.stock_max) || 100, // New field\n            price: Number(row.price || row.precio) || 0,\n            cost_price: Number(row.cost_price) || 0, // New field\n            supplier_id: row.supplier_id || row.proveedor_id || 'SUP-001',\n            location_id: row.location_id || 'BODEGA_CENTRAL' // New field with default\n        }));\n    } catch (error) {\n        console.error('Error fetching inventory:', error);\n        return [];\n    }\n}\n\nexport async function fetchEmployees(): Promise<EmployeeProfile[]> {\n    try {\n        const res = await query('SELECT * FROM users');\n\n        return res.rows.map((row: any) => ({\n            id: row.id?.toString() || `EMP-${Math.random()}`,\n            rut: row.rut || 'SIN-RUT',\n            name: row.name || 'Usuario Sistema',\n            role: row.role || 'CASHIER',\n            access_pin: row.pin || '0000',\n            status: row.status || 'ACTIVE',\n            current_status: 'OUT',\n            job_title: 'CAJERO_VENDEDOR', // Default for sync\n            labor_data: {\n                base_salary: 500000,\n                afp: 'MODELO',\n                isapre: 'FONASA',\n                contract_hours: 45\n            }\n        }));\n    } catch (error) {\n        console.error('Error fetching employees:', error);\n        return [];\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAKsB,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/actions/sync.ts"],"sourcesContent":["'use server';\n\nimport { query } from '../lib/db';\nimport { InventoryBatch, EmployeeProfile } from '../domain/types';\n\nexport async function fetchInventory(): Promise<InventoryBatch[]> {\n    try {\n        const res = await query('SELECT * FROM productos');\n\n        // Map DB columns to Domain Type\n        // Assuming DB columns might be snake_case or slightly different. \n        // We map what we can and default the rest for safety.\n        return res.rows.map((row: any) => ({\n            id: row.id?.toString() || `PROD-${Math.random()}`,\n            sku: row.sku || row.codigo || 'UNKNOWN',\n            name: row.nombre || row.name || 'Sin Nombre',\n            dci: row.dci || row.principio_activo || '',\n            // lot_number is removed as per new mapping, if needed, add back with a default\n            expiry_date: row.vencimiento ? new Date(row.vencimiento).getTime() : Date.now() + 31536000000,\n            category: (row.category || row.categoria) as any, // Use row.category if available, fallback to row.categoria\n            condition: (row.sale_condition || row.condicion_venta) as any, // Map DB column to new field name, fallback to old DB field\n            // storage_condition is removed as per new mapping, if needed, add back with a default\n            allows_commission: row.allows_commission || row.permite_comision || false,\n            active_ingredients: row.active_ingredients || row.principios_activos ? (Array.isArray(row.principios_activos) ? row.principios_activos : [row.principios_activos]) : [],\n            is_bioequivalent: row.is_bioequivalent || row.es_bioequivalente || false,\n            stock_actual: Number(row.stock_actual || row.stock) || 0,\n            stock_min: Number(row.stock_min || row.stock_min) || 5,\n            stock_max: Number(row.stock_max) || 100, // New field\n            price: Number(row.price || row.precio) || 0,\n            cost_price: Number(row.cost_price) || 0, // New field\n            supplier_id: row.supplier_id || row.proveedor_id || 'SUP-001',\n            location_id: row.location_id || 'BODEGA_CENTRAL' // New field with default\n        }));\n    } catch (error) {\n        console.error('Error fetching inventory:', error);\n        return [];\n    }\n}\n\nexport async function fetchEmployees(): Promise<EmployeeProfile[]> {\n    try {\n        const res = await query('SELECT * FROM users');\n\n        return res.rows.map((row: any) => ({\n            id: row.id?.toString() || `EMP-${Math.random()}`,\n            rut: row.rut || 'SIN-RUT',\n            name: row.name || 'Usuario Sistema',\n            role: row.role || 'CASHIER',\n            access_pin: row.pin || '0000',\n            status: row.status || 'ACTIVE',\n            current_status: 'OUT',\n            job_title: 'CAJERO_VENDEDOR', // Default for sync\n            labor_data: {\n                base_salary: 500000,\n                afp: 'MODELO',\n                isapre: 'FONASA',\n                contract_hours: 45\n            }\n        }));\n    } catch (error) {\n        console.error('Error fetching employees:', error);\n        return [];\n    }\n}\n"],"names":[],"mappings":";;;;;;;IAuCsB,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/logic/clinicalAgent.ts"],"sourcesContent":["import { Customer, SaleItem, ClinicalAnalysisResult, CartItem, InventoryBatch } from '../types';\n\n// Base de conocimientos simplificada para MVP\nconst CONTRAINDICATIONS = {\n    HYPERTENSION: ['Pseudoefedrina', 'Fenilefrina', 'Sodio'],\n    PREGNANT: ['Ibuprofeno', 'Naproxeno', 'Isotretino√≠na', 'Warfarina'],\n    DIABETIC: ['Jarabe con Az√∫car', 'Dextrometorfano (con az√∫car)'],\n};\n\nconst SYMPTOM_MAP: Record<string, string[]> = {\n    'dolor': ['ANALGESICO', 'ANTIINFLAMATORIO'],\n    'cabeza': ['PARACETAMOL', 'IBUPROFENO', 'MIGRA√ëA'],\n    'fiebre': ['PARACETAMOL', 'ANTIPIRETICO'],\n    'estomago': ['VIADIL', 'OMEPRAZOL', 'PROBIOTICO', 'SAL DE FRUTA'],\n    'tos': ['JARABE', 'ANTITUSIVO', 'EXPECTORANTE'],\n    'alergia': ['LORATADINA', 'CETIRIZINA', 'ANTIHISTAMINICO'],\n    'herida': ['POVIDONA', 'PARCHE', 'GASA', 'CICATRIZANTE']\n};\n\nconst CROSS_SELLING_RULES = [\n    { trigger: 'Antibi√≥tico', suggestion: 'Probi√≥tico (Bioflora/Perenteryl) para proteger flora intestinal.' },\n    { trigger: 'Pa√±ales', suggestion: 'Crema para coceduras (Hipogl√≥s/Pasta Lassar).' },\n    { trigger: 'Cepillo Dental', suggestion: 'Pasta Dental o Hilo Dental.' },\n    { trigger: 'Invierno', suggestion: 'Vitamina C o Prop√≥leo.' }, // Ejemplo estacional\n];\n\nexport class ClinicalAgent {\n    /**\n     * Busca productos en el inventario basados en s√≠ntomas.\n     */\n    static searchBySymptom(query: string, inventory: InventoryBatch[]): InventoryBatch[] {\n        const lowerQuery = query.toLowerCase();\n        let keywords: string[] = [];\n\n        // 1. Identificar palabras clave del mapa de s√≠ntomas\n        Object.entries(SYMPTOM_MAP).forEach(([symptom, tags]) => {\n            if (lowerQuery.includes(symptom)) {\n                keywords = [...keywords, ...tags];\n            }\n        });\n\n        // Si no hay coincidencias en el mapa, usamos la query directa como keyword\n        if (keywords.length === 0) {\n            keywords = [lowerQuery];\n        }\n\n        // 2. Filtrar inventario\n        return inventory.filter(item => {\n            if (item.stock_actual <= 0) return false; // Solo con stock\n\n            const itemText = `${item.name} ${item.dci} ${item.category}`.toLowerCase();\n            // Coincidencia si alguna keyword est√° en el texto del item\n            return keywords.some(keyword => itemText.includes(keyword.toLowerCase()));\n        });\n    }\n\n    /**\n     * Analiza el carrito en busca de interacciones peligrosas con el perfil del paciente.\n     */\n    static analyzeCart(cart: CartItem[], customer?: Customer): ClinicalAnalysisResult {\n        let result: ClinicalAnalysisResult = { status: 'SAFE', message: 'An√°lisis Cl√≠nico: OK' };\n        const blockingItems: string[] = [];\n        const suggestedItems: string[] = [];\n        // let result: ClinicalAnalysisResult = { status: 'SAFE', message: 'An√°lisis Cl√≠nico: OK' }; // This line was removed in the provided diff\n        // const blockingItems: string[] = []; // This line was removed in the provided diff\n        // const suggestedItems: string[] = []; // This line was removed in the provided diff\n\n        // 1. An√°lisis de Contraindicaciones (Solo si hay cliente identificado)\n        if (customer) {\n            cart.forEach(item => {\n                // Revisar Hipertensi√≥n\n                if (customer.health_tags.includes('HYPERTENSION')) {\n                    const conflict = CONTRAINDICATIONS.HYPERTENSION.find(drug => item.name.includes(drug) || item.active_ingredients?.includes(drug));\n                    if (conflict) {\n                        blockingItems.push(`${item.name} (Contiene ${conflict})`);\n                    }\n                }\n\n                // Revisar Embarazo\n                if (customer.health_tags.includes('PREGNANT')) {\n                    const conflict = CONTRAINDICATIONS.PREGNANT.find(drug => item.name.includes(drug) || item.active_ingredients?.includes(drug));\n                    if (conflict) {\n                        blockingItems.push(`${item.name} (Riesgo en Embarazo: ${conflict})`);\n                    }\n                }\n\n                // Revisar Diabetes\n                if (customer.health_tags.includes('DIABETIC')) {\n                    const conflict = CONTRAINDICATIONS.DIABETIC.find(drug => item.name.includes(drug));\n                    if (conflict) {\n                        blockingItems.push(`${item.name} (No apto para diab√©ticos)`);\n                    }\n                }\n            });\n        }\n\n        // 2. L√≥gica de Cross-Selling (Independiente del cliente)\n        cart.forEach(item => {\n            CROSS_SELLING_RULES.forEach(rule => {\n                if (item.name.includes(rule.trigger) || item.active_ingredients?.includes(rule.trigger)) {\n                    if (!suggestedItems.includes(rule.suggestion)) {\n                        suggestedItems.push(rule.suggestion);\n                    }\n                }\n            });\n        });\n\n        // 3. Construir Resultado\n        if (blockingItems.length > 0) {\n            result.status = 'BLOCK';\n            result.message = `‚õî ALERTA DE SEGURIDAD: Interacci√≥n detectada.`;\n            result.blocking_items = blockingItems;\n        } else if (suggestedItems.length > 0) {\n            // Si es seguro pero hay sugerencias, cambiamos mensaje (opcional, mantenemos SAFE si no hay warning)\n            result.message = 'Venta Segura. Ver sugerencias.';\n        }\n\n        result.suggested_items = suggestedItems;\n        return result;\n    }\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/security/roles.ts"],"sourcesContent":["import { EmployeeProfile } from '../types';\n\nexport type Role = 'MANAGER' | 'ADMIN' | 'CASHIER' | 'WAREHOUSE' | 'QF';\n\nexport type Permission =\n    | 'MANAGE_USERS'        // Create/Edit/Delete users, View Salaries\n    | 'VIEW_HR'             // View HR module\n    | 'MANAGE_INVENTORY'    // Create/Edit/Delete products\n    | 'VIEW_INVENTORY'      // View stock\n    | 'ADJUST_STOCK'        // WMS operations\n    | 'PROCESS_SALE'        // POS access\n    | 'VOID_SALE'           // Void transaction (Requires Override)\n    | 'MANAGE_SHIFTS'       // Open/Close shifts, view cash flow\n    | 'VIEW_REPORTS'        // BI Reports\n    | 'MANAGE_SUPPLIERS';   // SRM\n\nexport const ROLES: Record<Role, string> = {\n    MANAGER: 'Gerente General',\n    ADMIN: 'Administrador',\n    CASHIER: 'Cajero',\n    WAREHOUSE: 'Bodeguero',\n    QF: 'Qu√≠mico Farmac√©utico'\n};\n\nconst ROLE_PERMISSIONS: Record<Role, Permission[]> = {\n    MANAGER: [\n        'MANAGE_USERS', 'VIEW_HR', 'MANAGE_INVENTORY', 'VIEW_INVENTORY',\n        'ADJUST_STOCK', 'PROCESS_SALE', 'VOID_SALE', 'MANAGE_SHIFTS',\n        'VIEW_REPORTS', 'MANAGE_SUPPLIERS'\n    ],\n    ADMIN: [\n        'MANAGE_INVENTORY', 'VIEW_INVENTORY', 'ADJUST_STOCK', 'PROCESS_SALE',\n        'VOID_SALE', 'MANAGE_SHIFTS', 'VIEW_REPORTS', 'MANAGE_SUPPLIERS'\n    ],\n    QF: [\n        'MANAGE_INVENTORY', 'VIEW_INVENTORY', 'ADJUST_STOCK', 'PROCESS_SALE',\n        'VOID_SALE', 'MANAGE_SHIFTS', 'VIEW_REPORTS', 'MANAGE_SUPPLIERS'\n    ],\n    CASHIER: [\n        'PROCESS_SALE', 'VIEW_INVENTORY'\n    ],\n    WAREHOUSE: [\n        'VIEW_INVENTORY', 'ADJUST_STOCK', 'MANAGE_SUPPLIERS'\n    ]\n};\n\nexport const hasPermission = (user: EmployeeProfile | null, permission: Permission): boolean => {\n    if (!user) return false;\n\n    // Check Role Permissions\n    const rolePermissions = ROLE_PERMISSIONS[user.role as Role] || [];\n    if (rolePermissions.includes(permission)) return true;\n\n    // Check Custom Module Permissions (if any)\n    if (user.allowed_modules?.includes(permission)) return true;\n\n    return false;\n};\n\nexport const canOverride = (user: EmployeeProfile): boolean => {\n    return user.role === 'MANAGER' || user.role === 'ADMIN' || user.role === 'QF';\n};\n"],"names":[],"mappings":";;;;;;;;AAgBO,MAAM,QAA8B;IACvC,SAAS;IACT,OAAO;IACP,SAAS;IACT,WAAW;IACX,IAAI;AACR;AAEA,MAAM,mBAA+C;IACjD,SAAS;QACL;QAAgB;QAAW;QAAoB;QAC/C;QAAgB;QAAgB;QAAa;QAC7C;QAAgB;KACnB;IACD,OAAO;QACH;QAAoB;QAAkB;QAAgB;QACtD;QAAa;QAAiB;QAAgB;KACjD;IACD,IAAI;QACA;QAAoB;QAAkB;QAAgB;QACtD;QAAa;QAAiB;QAAgB;KACjD;IACD,SAAS;QACL;QAAgB;KACnB;IACD,WAAW;QACP;QAAkB;QAAgB;KACrC;AACL;AAEO,MAAM,gBAAgB,CAAC,MAA8B;IACxD,IAAI,CAAC,MAAM,OAAO;IAElB,yBAAyB;IACzB,MAAM,kBAAkB,gBAAgB,CAAC,KAAK,IAAI,CAAS,IAAI,EAAE;IACjE,IAAI,gBAAgB,QAAQ,CAAC,aAAa,OAAO;IAEjD,2CAA2C;IAC3C,IAAI,KAAK,eAAe,EAAE,SAAS,aAAa,OAAO;IAEvD,OAAO;AACX;AAEO,MAAM,cAAc,CAAC;IACxB,OAAO,KAAK,IAAI,KAAK,aAAa,KAAK,IAAI,KAAK,WAAW,KAAK,IAAI,KAAK;AAC7E"}},
    {"offset": {"line": 285, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/services/PrinterService.ts"],"sourcesContent":["import { SaleTransaction, CashMovement, QueueTicket, PrinterConfig } from '../types';\n\nexport class PrinterService {\n    static async printTicket(sale: SaleTransaction, config: PrinterConfig) {\n        if (!config.auto_print_sale) return;\n\n        console.log('üñ®Ô∏è PRINTING TICKET:', sale.id);\n        console.log('HEADER:', config.header_text);\n        console.log('ITEMS:', sale.items.length);\n        console.log('FOOTER:', config.footer_text);\n\n        // In a real app, this would talk to a thermal printer API (WebUSB, QZ Tray, etc.)\n        // For now, we simulate with a window alert or just console\n        // alert(`üñ®Ô∏è Imprimiendo Boleta #${sale.id}`);\n\n        // Check for fractional items and print labels (Art. 40 B)\n        const fractionalItems = sale.items.filter(item => item.is_fractional);\n        if (fractionalItems.length > 0) {\n            console.log('‚úÇÔ∏è DETECTED FRACTIONAL ITEMS:', fractionalItems.length);\n            fractionalItems.forEach(item => {\n                this.printFractionalLabel(item, config);\n            });\n        }\n    }\n\n    static async printFractionalLabel(item: any, config: PrinterConfig) {\n        console.log('üè∑Ô∏è PRINTING LABEL (ART 40 B):', item.name);\n        console.log('   Pac: ', item.original_name);\n        console.log('   Cant:', item.quantity);\n        console.log('   QF Supervisor: Javiera Rojas (DT)'); // Mocked for now, should come from store\n        console.log('   Registro ISP: F-2244/19'); // Mocked, should come from item\n        console.log('   \"Para mayor informaci√≥n consulte a su prescriptor o farmac√©utico.\"');\n        // Simulate label printing\n    }\n\n    static async printVoucher(movement: CashMovement, config: PrinterConfig) {\n        if (!config.auto_print_cash) return;\n\n        console.log('üñ®Ô∏è PRINTING VOUCHER:', movement.id);\n        console.log('TYPE:', movement.type);\n        console.log('AMOUNT:', movement.amount);\n\n        // alert(`üñ®Ô∏è Imprimiendo Comprobante de ${movement.type}`);\n    }\n\n    static async printQueueTicket(ticket: QueueTicket, config: PrinterConfig) {\n        if (!config.auto_print_queue) return;\n\n        console.log('üñ®Ô∏è PRINTING QUEUE TICKET:', ticket.number);\n        console.log('BRANCH:', ticket.branch_id);\n\n        // alert(`üñ®Ô∏è Imprimiendo Turno ${ticket.number}`);\n    }\n}\n"],"names":[],"mappings":";;;;AAEO,MAAM;IACT,aAAa,YAAY,IAAqB,EAAE,MAAqB,EAAE;QACnE,IAAI,CAAC,OAAO,eAAe,EAAE;QAE7B,QAAQ,GAAG,CAAC,wBAAwB,KAAK,EAAE;QAC3C,QAAQ,GAAG,CAAC,WAAW,OAAO,WAAW;QACzC,QAAQ,GAAG,CAAC,UAAU,KAAK,KAAK,CAAC,MAAM;QACvC,QAAQ,GAAG,CAAC,WAAW,OAAO,WAAW;QAEzC,kFAAkF;QAClF,2DAA2D;QAC3D,+CAA+C;QAE/C,0DAA0D;QAC1D,MAAM,kBAAkB,KAAK,KAAK,CAAC,MAAM,CAAC,CAAA,OAAQ,KAAK,aAAa;QACpE,IAAI,gBAAgB,MAAM,GAAG,GAAG;YAC5B,QAAQ,GAAG,CAAC,iCAAiC,gBAAgB,MAAM;YACnE,gBAAgB,OAAO,CAAC,CAAA;gBACpB,IAAI,CAAC,oBAAoB,CAAC,MAAM;YACpC;QACJ;IACJ;IAEA,aAAa,qBAAqB,IAAS,EAAE,MAAqB,EAAE;QAChE,QAAQ,GAAG,CAAC,kCAAkC,KAAK,IAAI;QACvD,QAAQ,GAAG,CAAC,YAAY,KAAK,aAAa;QAC1C,QAAQ,GAAG,CAAC,YAAY,KAAK,QAAQ;QACrC,QAAQ,GAAG,CAAC,yCAAyC,yCAAyC;QAC9F,QAAQ,GAAG,CAAC,+BAA+B,gCAAgC;QAC3E,QAAQ,GAAG,CAAC;IACZ,0BAA0B;IAC9B;IAEA,aAAa,aAAa,QAAsB,EAAE,MAAqB,EAAE;QACrE,IAAI,CAAC,OAAO,eAAe,EAAE;QAE7B,QAAQ,GAAG,CAAC,yBAAyB,SAAS,EAAE;QAChD,QAAQ,GAAG,CAAC,SAAS,SAAS,IAAI;QAClC,QAAQ,GAAG,CAAC,WAAW,SAAS,MAAM;IAEtC,4DAA4D;IAChE;IAEA,aAAa,iBAAiB,MAAmB,EAAE,MAAqB,EAAE;QACtE,IAAI,CAAC,OAAO,gBAAgB,EAAE;QAE9B,QAAQ,GAAG,CAAC,8BAA8B,OAAO,MAAM;QACvD,QAAQ,GAAG,CAAC,WAAW,OAAO,SAAS;IAEvC,mDAAmD;IACvD;AACJ"}},
    {"offset": {"line": 338, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/logic/sii_dte.ts"],"sourcesContent":["import { SaleTransaction } from '../types';\n\nexport type DteGenerationResult = {\n    shouldGenerate: boolean;\n    status: 'CONFIRMED_DTE' | 'FISCALIZED_BY_VOUCHER';\n    message: string;\n};\n\nexport const shouldGenerateDTE = (paymentMethod: SaleTransaction['payment_method']): DteGenerationResult => {\n    if (paymentMethod === 'CASH' || paymentMethod === 'TRANSFER') {\n        return {\n            shouldGenerate: true,\n            status: 'CONFIRMED_DTE',\n            message: 'Generando Boleta Electr√≥nica (SII)'\n        };\n    } else {\n        // DEBIT or CREDIT\n        return {\n            shouldGenerate: false,\n            status: 'FISCALIZED_BY_VOUCHER',\n            message: 'Venta fiscalizada mediante Voucher (Transbank/Getnet)'\n        };\n    }\n};\n"],"names":[],"mappings":";;;;AAQO,MAAM,oBAAoB,CAAC;IAC9B,IAAI,kBAAkB,UAAU,kBAAkB,YAAY;QAC1D,OAAO;YACH,gBAAgB;YAChB,QAAQ;YACR,SAAS;QACb;IACJ,OAAO;QACH,kBAAkB;QAClB,OAAO;YACH,gBAAgB;YAChB,QAAQ;YACR,SAAS;QACb;IACJ;AACJ"}},
    {"offset": {"line": 365, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/logic/productDisplay.ts"],"sourcesContent":["import { InventoryBatch } from '../types';\n\nexport const formatProductLabel = (product: InventoryBatch): string => {\n    // Format: [NOMBRE] - [DCI] [CONCENTRACION] - [FORMATO] x[UNIDADES] ([LAB])\n    // Example: \"Panadol - Paracetamol 500mg - Comprimidos x16 (GlaxoSmithKline)\"\n\n    const name = product.name;\n    const dci = product.dci;\n    const concentration = product.concentration;\n    const format = product.format;\n    const units = product.unit_count;\n    const lab = product.laboratory;\n\n    return `${name} - ${dci} ${concentration} - ${format} x${units} (${lab})`;\n};\n\nexport const calculatePricePerUnit = (product: InventoryBatch): number => {\n    if (!product.unit_count || product.unit_count === 0) return 0;\n    return product.price / product.unit_count;\n};\n"],"names":[],"mappings":";;;;;;AAEO,MAAM,qBAAqB,CAAC;IAC/B,2EAA2E;IAC3E,6EAA6E;IAE7E,MAAM,OAAO,QAAQ,IAAI;IACzB,MAAM,MAAM,QAAQ,GAAG;IACvB,MAAM,gBAAgB,QAAQ,aAAa;IAC3C,MAAM,SAAS,QAAQ,MAAM;IAC7B,MAAM,QAAQ,QAAQ,UAAU;IAChC,MAAM,MAAM,QAAQ,UAAU;IAE9B,OAAO,GAAG,KAAK,GAAG,EAAE,IAAI,CAAC,EAAE,cAAc,GAAG,EAAE,OAAO,EAAE,EAAE,MAAM,EAAE,EAAE,IAAI,CAAC,CAAC;AAC7E;AAEO,MAAM,wBAAwB,CAAC;IAClC,IAAI,CAAC,QAAQ,UAAU,IAAI,QAAQ,UAAU,KAAK,GAAG,OAAO;IAC5D,OAAO,QAAQ,KAAK,GAAG,QAAQ,UAAU;AAC7C"}},
    {"offset": {"line": 393, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/logic/purchasingAgent.ts"],"sourcesContent":["import { InventoryBatch, PurchaseOrder, Supplier } from '../types';\n\nexport const PurchasingAgent = {\n    /**\n     * Calcula la velocidad de venta diaria (Mock simple para MVP).\n     * En producci√≥n, esto vendr√≠a de un an√°lisis hist√≥rico de transacciones.\n     */\n    /**\n     * Calcula la velocidad de venta diaria basada en un periodo.\n     */\n    calculateVelocity(sku: string, period: 'LAST_7_DAYS' | 'LAST_30_DAYS' | 'LAST_TRIMESTER' | 'LAST_SEMESTER' | 'LAST_YEAR'): number {\n        // Simulaci√≥n: Genera un n√∫mero base\n        const hash = sku.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);\n        let baseVelocity = (hash % 10) / 2 + 0.5;\n\n        // Ajuste por periodo (Simulaci√≥n de estacionalidad)\n        switch (period) {\n            case 'LAST_7_DAYS': return baseVelocity * 1.2; // Pico reciente\n            case 'LAST_30_DAYS': return baseVelocity; // Normal\n            case 'LAST_TRIMESTER': return baseVelocity * 0.9; // Estabilizado\n            case 'LAST_SEMESTER': return baseVelocity * 0.8; // Largo plazo\n            case 'LAST_YEAR': return baseVelocity * 0.7; // Anual\n            default: return baseVelocity;\n        }\n    },\n\n    /**\n     * Calcula cu√°ntos d√≠as durar√° el stock actual.\n     */\n    calculateCoverage(stock: number, velocity: number): number {\n        if (velocity <= 0) return 999; // Cobertura infinita\n        return Math.round(stock / velocity);\n    },\n\n    /**\n     * Genera sugerencias de reabastecimiento agrupadas por proveedor.\n     */\n    generateSuggestions(\n        inventory: InventoryBatch[],\n        suppliers: Supplier[],\n        period: 'LAST_7_DAYS' | 'LAST_30_DAYS' | 'LAST_TRIMESTER' | 'LAST_SEMESTER' | 'LAST_YEAR' = 'LAST_30_DAYS'\n    ): PurchaseOrder[] {\n        const suggestions: PurchaseOrder[] = [];\n        const itemsBySupplier: { [supplierId: string]: any[] } = {};\n\n        inventory.forEach(item => {\n            const velocity = this.calculateVelocity(item.sku, period);\n            const coverage = this.calculateCoverage(item.stock_actual, velocity);\n\n            // Configurable Target Days (Default 30)\n            const targetDays = 30;\n\n            // F√≥rmula: (velocity * targetDays) - currentStock\n            const suggestedQty = Math.ceil((velocity * targetDays) - item.stock_actual);\n\n            // Determine Status based on Coverage\n            let status: 'CRITICAL' | 'LOW' | 'EXCESS' | 'OK' = 'OK';\n            if (coverage < 7) status = 'CRITICAL';\n            else if (coverage < 15) status = 'LOW';\n            else if (coverage > 90) status = 'EXCESS';\n\n            // Add to list if suggestion > 0 OR if it's critical/low/excess (to show visibility)\n            // User requested: \"Si el resultado es negativo (tengo de sobra), la sugerencia es 0.\"\n            const finalSuggestion = Math.max(0, suggestedQty);\n\n            // We include items that need attention (Critical/Low) or have suggestions\n            if (finalSuggestion > 0 || status === 'CRITICAL' || status === 'LOW' || status === 'EXCESS') {\n                const supplierId = item.supplier_id || 'SUP-001';\n                if (!itemsBySupplier[supplierId]) {\n                    itemsBySupplier[supplierId] = [];\n                }\n\n                itemsBySupplier[supplierId].push({\n                    sku: item.sku,\n                    name: item.name,\n                    quantity: finalSuggestion,\n                    cost_price: item.price * 0.6, // Costo estimado\n                    current_stock: item.stock_actual,\n                    velocity: velocity.toFixed(2),\n                    coverage: coverage,\n                    status: status\n                });\n            }\n        });// Convertir agrupaci√≥n a objetos PurchaseOrder\n        Object.keys(itemsBySupplier).forEach(supplierId => {\n            suggestions.push({\n                id: `PO-SUG-${Date.now()}-${supplierId.substring(0, 3)}`,\n                supplier_id: supplierId,\n                created_at: Date.now(),\n                status: 'SUGGESTED',\n                items: itemsBySupplier[supplierId],\n                total_estimated: 0 // Se calcular√≠a con costos reales\n            });\n        });\n\n        return suggestions;\n    }\n};\n"],"names":[],"mappings":";;;;AAEO,MAAM,kBAAkB;IAC3B;;;KAGC,GACD;;KAEC,GACD,mBAAkB,GAAW,EAAE,MAAyF;QACpH,oCAAoC;QACpC,MAAM,OAAO,IAAI,KAAK,CAAC,IAAI,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,UAAU,CAAC,IAAI;QAC3E,IAAI,eAAe,AAAC,OAAO,KAAM,IAAI;QAErC,oDAAoD;QACpD,OAAQ;YACJ,KAAK;gBAAe,OAAO,eAAe,KAAK,gBAAgB;YAC/D,KAAK;gBAAgB,OAAO,cAAc,SAAS;YACnD,KAAK;gBAAkB,OAAO,eAAe,KAAK,eAAe;YACjE,KAAK;gBAAiB,OAAO,eAAe,KAAK,cAAc;YAC/D,KAAK;gBAAa,OAAO,eAAe,KAAK,QAAQ;YACrD;gBAAS,OAAO;QACpB;IACJ;IAEA;;KAEC,GACD,mBAAkB,KAAa,EAAE,QAAgB;QAC7C,IAAI,YAAY,GAAG,OAAO,KAAK,qBAAqB;QACpD,OAAO,KAAK,KAAK,CAAC,QAAQ;IAC9B;IAEA;;KAEC,GACD,qBACI,SAA2B,EAC3B,SAAqB,EACrB,SAA4F,cAAc;QAE1G,MAAM,cAA+B,EAAE;QACvC,MAAM,kBAAmD,CAAC;QAE1D,UAAU,OAAO,CAAC,CAAA;YACd,MAAM,WAAW,IAAI,CAAC,iBAAiB,CAAC,KAAK,GAAG,EAAE;YAClD,MAAM,WAAW,IAAI,CAAC,iBAAiB,CAAC,KAAK,YAAY,EAAE;YAE3D,wCAAwC;YACxC,MAAM,aAAa;YAEnB,kDAAkD;YAClD,MAAM,eAAe,KAAK,IAAI,CAAC,AAAC,WAAW,aAAc,KAAK,YAAY;YAE1E,qCAAqC;YACrC,IAAI,SAA+C;YACnD,IAAI,WAAW,GAAG,SAAS;iBACtB,IAAI,WAAW,IAAI,SAAS;iBAC5B,IAAI,WAAW,IAAI,SAAS;YAEjC,oFAAoF;YACpF,sFAAsF;YACtF,MAAM,kBAAkB,KAAK,GAAG,CAAC,GAAG;YAEpC,0EAA0E;YAC1E,IAAI,kBAAkB,KAAK,WAAW,cAAc,WAAW,SAAS,WAAW,UAAU;gBACzF,MAAM,aAAa,KAAK,WAAW,IAAI;gBACvC,IAAI,CAAC,eAAe,CAAC,WAAW,EAAE;oBAC9B,eAAe,CAAC,WAAW,GAAG,EAAE;gBACpC;gBAEA,eAAe,CAAC,WAAW,CAAC,IAAI,CAAC;oBAC7B,KAAK,KAAK,GAAG;oBACb,MAAM,KAAK,IAAI;oBACf,UAAU;oBACV,YAAY,KAAK,KAAK,GAAG;oBACzB,eAAe,KAAK,YAAY;oBAChC,UAAU,SAAS,OAAO,CAAC;oBAC3B,UAAU;oBACV,QAAQ;gBACZ;YACJ;QACJ,IAAG,+CAA+C;QAClD,OAAO,IAAI,CAAC,iBAAiB,OAAO,CAAC,CAAA;YACjC,YAAY,IAAI,CAAC;gBACb,IAAI,CAAC,OAAO,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,WAAW,SAAS,CAAC,GAAG,IAAI;gBACxD,aAAa;gBACb,YAAY,KAAK,GAAG;gBACpB,QAAQ;gBACR,OAAO,eAAe,CAAC,WAAW;gBAClC,iBAAiB,EAAE,kCAAkC;YACzD;QACJ;QAEA,OAAO;IACX;AACJ"}},
    {"offset": {"line": 487, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/logic/sii/crypto.ts"],"sourcesContent":["/**\n * SII Cryptography Service\n * \n * IMPORTANT: This service requires the following npm packages:\n * - node-forge (for PFX parsing and signing)\n * - xml-crypto (for XML-DSig)\n * - xmldom (for XML parsing)\n * \n * Install with: npm install node-forge xml-crypto @xmldom/xmldom\n * \n * This is a STRUCTURE/STUB. The actual cryptographic implementation\n * requires careful testing against SII specifications.\n */\n\n// TODO: Install dependencies\n// import * as forge from 'node-forge';\n// import { SignedXml } from 'xml-crypto';\n// import { DOMParser } from '@xmldom/xmldom';\n\nexport interface SignatureResult {\n    success: boolean;\n    signedXml?: string;\n    error?: string;\n}\n\n/**\n * Sign an XML document with a PFX certificate\n * @param xmlBody - The XML document to sign (as string)\n * @param pfxBase64 - The PFX certificate in base64 format\n * @param password - The certificate password\n * @returns SignatureResult with the signed XML or error\n */\nexport async function signXML(\n    xmlBody: string,\n    pfxBase64: string,\n    password: string\n): Promise<SignatureResult> {\n    try {\n        // TODO: Implement actual signing logic\n        // 1. Decode base64 PFX\n        // const pfxDer = forge.util.decode64(pfxBase64);\n        // const pfxAsn1 = forge.asn1.fromDer(pfxDer);\n        // const pkcs12 = forge.pkcs12.pkcs12FromAsn1(pfxAsn1, password);\n\n        // 2. Extract private key and certificate\n        // const bags = pkcs12.getBags({ bagType: forge.pki.oids.certBag });\n        // const cert = bags[forge.pki.oids.certBag][0].cert;\n        // const keyBags = pkcs12.getBags({ bagType: forge.pki.oids.pkcs8ShroudedKeyBag });\n        // const privateKey = keyBags[forge.pki.oids.pkcs8ShroudedKeyBag][0].key;\n\n        // 3. Sign XML according to SII specs\n        // const sig = new SignedXml();\n        // sig.addReference(\"//*[local-name(.)='Documento']\", [\"...transforms...\"], \"...\");\n        // sig.signingKey = privateKey;\n        // sig.computeSignature(xmlBody);\n\n        // STUB: Return mock signed XML for now\n        console.warn('‚ö†Ô∏è  Using STUB XML signing. Implement real signing before production!');\n\n        return {\n            success: true,\n            signedXml: `<!--MOCK_SIGNED-->${xmlBody}`\n        };\n\n    } catch (error) {\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Unknown error during signing'\n        };\n    }\n}\n\n/**\n * Validate a PFX certificate\n * @param pfxBase64 - The PFX certificate in base64\n * @param password - The certificate password\n * @returns Information about the certificate or error\n */\nexport async function validateCertificate(\n    pfxBase64: string,\n    password: string\n): Promise<{\n    valid: boolean;\n    commonName?: string;\n    expiryDate?: Date;\n    error?: string;\n}> {\n    try {\n        // TODO: Implement certificate validation\n        // const pfxDer = forge.util.decode64(pfxBase64);\n        // const pfxAsn1 = forge.asn1.fromDer(pfxDer);\n        // const pkcs12 = forge.pkcs12.pkcs12FromAsn1(pfxAsn1, password);\n        // const bags = pkcs12.getBags({ bagType: forge.pki.oids.certBag });\n        // const cert = bags[forge.pki.oids.certBag][0].cert;\n\n        // STUB: Return mock validation\n        console.warn('‚ö†Ô∏è  Using STUB certificate validation.');\n\n        return {\n            valid: true,\n            commonName: 'DEMO CERTIFICATE',\n            expiryDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000) // 1 year from now\n        };\n\n    } catch (error) {\n        return {\n            valid: false,\n            error: error instanceof Error ? error.message : 'Invalid certificate or password'\n        };\n    }\n}\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;CAYC,GAED,6BAA6B;AAC7B,uCAAuC;AACvC,0CAA0C;AAC1C,8CAA8C;;;;;;;AAevC,eAAe,QAClB,OAAe,EACf,SAAiB,EACjB,QAAgB;IAEhB,IAAI;QACA,uCAAuC;QACvC,uBAAuB;QACvB,iDAAiD;QACjD,8CAA8C;QAC9C,iEAAiE;QAEjE,yCAAyC;QACzC,oEAAoE;QACpE,qDAAqD;QACrD,mFAAmF;QACnF,yEAAyE;QAEzE,qCAAqC;QACrC,+BAA+B;QAC/B,mFAAmF;QACnF,+BAA+B;QAC/B,iCAAiC;QAEjC,uCAAuC;QACvC,QAAQ,IAAI,CAAC;QAEb,OAAO;YACH,SAAS;YACT,WAAW,CAAC,kBAAkB,EAAE,SAAS;QAC7C;IAEJ,EAAE,OAAO,OAAO;QACZ,OAAO;YACH,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD;IACJ;AACJ;AAQO,eAAe,oBAClB,SAAiB,EACjB,QAAgB;IAOhB,IAAI;QACA,yCAAyC;QACzC,iDAAiD;QACjD,8CAA8C;QAC9C,iEAAiE;QACjE,oEAAoE;QACpE,qDAAqD;QAErD,+BAA+B;QAC/B,QAAQ,IAAI,CAAC;QAEb,OAAO;YACH,OAAO;YACP,YAAY;YACZ,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,MAAM,KAAK,KAAK,KAAK,MAAM,kBAAkB;QACnF;IAEJ,EAAE,OAAO,OAAO;QACZ,OAAO;YACH,OAAO;YACP,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD;IACJ;AACJ"}},
    {"offset": {"line": 568, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/analytics/FinancialService.ts"],"sourcesContent":["import { SaleTransaction, Expense, InventoryBatch, EmployeeProfile } from '../types';\n\nexport interface DateRange {\n    from: Date;\n    to: Date;\n}\n\nexport interface FinancialMetrics {\n    totalSales: number;\n    totalExpenses: number;\n    netProfit: number;\n    grossMargin: number;\n    transactionCount: number;\n    averageTicket: number;\n}\n\nexport interface TopProduct {\n    sku: string;\n    name: string;\n    quantity: number;\n    revenue: number;\n}\n\nexport class FinancialService {\n\n    static filterByDateRange<T extends { date?: number; timestamp?: number }>(\n        items: T[],\n        start: Date,\n        end: Date\n    ): T[] {\n        const startTime = start.getTime();\n        const endTime = end.getTime();\n        return items.filter(item => {\n            const time = item.date || item.timestamp || 0;\n            return time >= startTime && time <= endTime;\n        });\n    }\n\n    static getSalesSummary(sales: SaleTransaction[]) {\n        let grossSales = 0;\n        let netSales = 0; // Ventas menos IVA (aprox 19%)\n        let paymentMethods = {\n            CASH: 0,\n            DEBIT: 0,\n            CREDIT: 0,\n            TRANSFER: 0\n        };\n\n        sales.forEach(sale => {\n            grossSales += sale.total;\n            paymentMethods[sale.payment_method] = (paymentMethods[sale.payment_method] || 0) + sale.total;\n        });\n\n        netSales = Math.round(grossSales / 1.19);\n\n        return {\n            grossSales,\n            netSales,\n            paymentMethods\n        };\n    }\n\n    static getExpensesSummary(expenses: Expense[]) {\n        let totalExpenses = 0;\n        let deductibleExpenses = 0;\n        let nonDeductibleExpenses = 0;\n        let byCategory: Record<string, number> = {};\n\n        expenses.forEach(expense => {\n            totalExpenses += expense.amount;\n            if (expense.is_deductible) {\n                deductibleExpenses += expense.amount;\n            } else {\n                nonDeductibleExpenses += expense.amount;\n            }\n            byCategory[expense.category] = (byCategory[expense.category] || 0) + expense.amount;\n        });\n\n        return {\n            totalExpenses,\n            deductibleExpenses,\n            nonDeductibleExpenses,\n            byCategory\n        };\n    }\n\n    static calculateEBITDA(grossSales: number, totalExpenses: number) {\n        // Simplificaci√≥n: EBITDA = Ventas - Gastos (sin considerar depreciaci√≥n/amortizaci√≥n por ahora)\n        return grossSales - totalExpenses;\n    }\n\n    static getTaxCompliance(sales: SaleTransaction[], expenses: Expense[], ppmRate: number = 0.015) {\n        const salesSummary = this.getSalesSummary(sales);\n        const expensesSummary = this.getExpensesSummary(expenses);\n\n        const debitFiscal = salesSummary.grossSales - salesSummary.netSales; // IVA Ventas\n        const facturaExpenses = expenses.filter(e => e.document_type === 'FACTURA');\n        const creditFiscal = Math.round(facturaExpenses.reduce((sum, e) => sum + e.amount, 0) * 0.19 / 1.19);\n\n        const ivaToPay = Math.max(0, debitFiscal - creditFiscal);\n        const ppm = Math.round(salesSummary.netSales * ppmRate);\n\n        return {\n            debitFiscal,\n            creditFiscal,\n            ivaToPay,\n            ppm,\n            nonDeductibleWarning: expensesSummary.nonDeductibleExpenses\n        };\n    }\n\n    static getLaborCosts(employees: EmployeeProfile[]) {\n        let totalSalaries = 0;\n        let totalSocialLaws = 0;\n        let totalCost = 0;\n\n        employees.forEach(emp => {\n            if (emp.status === 'ACTIVE') {\n                const salary = emp.base_salary || 0;\n                totalSalaries += salary;\n                const socialLaws = Math.round(salary * 0.22);\n                totalSocialLaws += socialLaws;\n                totalCost += salary + socialLaws;\n            }\n        });\n\n        return {\n            totalSalaries,\n            totalSocialLaws,\n            totalCost\n        };\n    }\n\n    /**\n     * Calculate comprehensive financial metrics for a date range\n     */\n    static calculateMetrics(\n        sales: SaleTransaction[],\n        expenses: Expense[],\n        dateRange: DateRange\n    ): FinancialMetrics {\n        const filteredSales = this.filterByDateRange(sales, dateRange.from, dateRange.to);\n        const filteredExpenses = this.filterByDateRange(expenses, dateRange.from, dateRange.to);\n\n        const totalSales = filteredSales.reduce((sum, s) => sum + s.total, 0);\n        const totalCost = filteredSales.reduce((sum, s) =>\n            sum + s.items.reduce((itemSum, item) =>\n                itemSum + (item.cost_price || 0) * item.quantity, 0\n            ), 0\n        );\n        const totalExpenses = filteredExpenses.reduce((sum, e) => sum + e.amount, 0);\n\n        const grossProfit = totalSales - totalCost;\n        const netProfit = grossProfit - totalExpenses;\n        const grossMargin = totalSales > 0 ? (grossProfit / totalSales) * 100 : 0;\n\n        return {\n            totalSales,\n            totalExpenses,\n            netProfit,\n            grossMargin,\n            transactionCount: filteredSales.length,\n            averageTicket: filteredSales.length > 0 ? totalSales / filteredSales.length : 0\n        };\n    }\n\n    /**\n     * Get top selling products\n     */\n    static getTopProducts(\n        sales: SaleTransaction[],\n        dateRange: DateRange,\n        limit: number = 10\n    ): TopProduct[] {\n        const filteredSales = this.filterByDateRange(sales, dateRange.from, dateRange.to);\n        const productMap = new Map<string, TopProduct>();\n\n        filteredSales.forEach(sale => {\n            sale.items.forEach(item => {\n                const existing = productMap.get(item.sku);\n                if (existing) {\n                    existing.quantity += item.quantity;\n                    existing.revenue += item.price * item.quantity;\n                } else {\n                    productMap.set(item.sku, {\n                        sku: item.sku,\n                        name: item.name,\n                        quantity: item.quantity,\n                        revenue: item.price * item.quantity\n                    });\n                }\n            });\n        });\n\n        return Array.from(productMap.values())\n            .sort((a, b) => b.revenue - a.revenue)\n            .slice(0, limit);\n    }\n\n    /**\n     * Get daily sales data for charts\n     */\n    static getDailySales(\n        sales: SaleTransaction[],\n        dateRange: DateRange\n    ): Array<{ date: string; sales: number; transactions: number }> {\n        const filteredSales = this.filterByDateRange(sales, dateRange.from, dateRange.to);\n        const dailyMap = new Map<string, { sales: number; transactions: number }>();\n\n        filteredSales.forEach(sale => {\n            const date = new Date(sale.timestamp).toISOString().split('T')[0];\n            const existing = dailyMap.get(date);\n            if (existing) {\n                existing.sales += sale.total;\n                existing.transactions += 1;\n            } else {\n                dailyMap.set(date, { sales: sale.total, transactions: 1 });\n            }\n        });\n\n        return Array.from(dailyMap.entries())\n            .map(([date, data]) => ({ date, ...data }))\n            .sort((a, b) => a.date.localeCompare(b.date));\n    }\n\n    /**\n     * Calculate inventory value\n     */\n    static calculateInventoryValue(inventory: InventoryBatch[]): number {\n        return inventory.reduce((sum, item) =>\n            sum + (item.cost_price * item.stock_actual), 0\n        );\n    }\n\n    /**\n     * Get low stock items\n     */\n    static getLowStockItems(inventory: InventoryBatch[]): InventoryBatch[] {\n        return inventory.filter(item =>\n            item.stock_actual <= item.stock_min && item.stock_actual > 0\n        ).sort((a, b) =>\n            (a.stock_actual / a.stock_min) - (b.stock_actual / b.stock_min)\n        );\n    }\n\n    /**\n     * Get expired or near-expiry items\n     */\n    static getExpiringItems(\n        inventory: InventoryBatch[],\n        daysThreshold: number = 30\n    ): InventoryBatch[] {\n        const now = Date.now();\n        const threshold = now + (daysThreshold * 24 * 60 * 60 * 1000);\n\n        return inventory.filter(item =>\n            item.expiry_date && item.expiry_date <= threshold && item.expiry_date >= now\n        ).sort((a, b) => (a.expiry_date || 0) - (b.expiry_date || 0));\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 752, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/infrastructure/biometrics/WebAuthnService.ts"],"sourcesContent":["// src/infrastructure/biometrics/WebAuthnService.ts\n\nexport class WebAuthnService {\n\n    // Simula el registro de una credencial biom√©trica\n    static async registerCredential(userId: string): Promise<{ success: boolean; credentialId?: string; message: string }> {\n        return new Promise((resolve) => {\n            console.log(`[WebAuthn] Iniciando registro para usuario: ${userId}`);\n\n            // Simular espera del usuario tocando el sensor\n            setTimeout(() => {\n                const mockCredentialId = `cred-${userId}-${Date.now()}`;\n                console.log(`[WebAuthn] Credencial creada: ${mockCredentialId}`);\n                resolve({\n                    success: true,\n                    credentialId: mockCredentialId,\n                    message: 'Huella registrada correctamente.'\n                });\n            }, 2000); // 2 segundos de \"escaneo\"\n        });\n    }\n\n    // Simula la verificaci√≥n de una credencial\n    static async verifyCredential(userId: string): Promise<{ success: boolean; message: string }> {\n        return new Promise((resolve) => {\n            console.log(`[WebAuthn] Solicitando verificaci√≥n para usuario: ${userId}`);\n\n            // Simular interacci√≥n\n            setTimeout(() => {\n                // En un caso real, aqu√≠ se validar√≠a la firma criptogr√°fica\n                const isSuccess = Math.random() > 0.1; // 90% de √©xito simulado\n\n                if (isSuccess) {\n                    console.log(`[WebAuthn] Verificaci√≥n exitosa.`);\n                    resolve({ success: true, message: 'Identidad verificada.' });\n                } else {\n                    console.warn(`[WebAuthn] Fallo en verificaci√≥n.`);\n                    resolve({ success: false, message: 'No se reconoci√≥ la huella. Intente nuevamente.' });\n                }\n            }, 1500);\n        });\n    }\n\n    static isAvailable(): boolean {\n        // En un entorno real, verificar√≠amos window.PublicKeyCredential\n        return true;\n    }\n}\n"],"names":[],"mappings":"AAAA,mDAAmD;;;;;AAE5C,MAAM;IAET,kDAAkD;IAClD,aAAa,mBAAmB,MAAc,EAAyE;QACnH,OAAO,IAAI,QAAQ,CAAC;YAChB,QAAQ,GAAG,CAAC,CAAC,4CAA4C,EAAE,QAAQ;YAEnE,+CAA+C;YAC/C,WAAW;gBACP,MAAM,mBAAmB,CAAC,KAAK,EAAE,OAAO,CAAC,EAAE,KAAK,GAAG,IAAI;gBACvD,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,kBAAkB;gBAC/D,QAAQ;oBACJ,SAAS;oBACT,cAAc;oBACd,SAAS;gBACb;YACJ,GAAG,OAAO,0BAA0B;QACxC;IACJ;IAEA,2CAA2C;IAC3C,aAAa,iBAAiB,MAAc,EAAkD;QAC1F,OAAO,IAAI,QAAQ,CAAC;YAChB,QAAQ,GAAG,CAAC,CAAC,kDAAkD,EAAE,QAAQ;YAEzE,sBAAsB;YACtB,WAAW;gBACP,4DAA4D;gBAC5D,MAAM,YAAY,KAAK,MAAM,KAAK,KAAK,wBAAwB;gBAE/D,IAAI,WAAW;oBACX,QAAQ,GAAG,CAAC,CAAC,gCAAgC,CAAC;oBAC9C,QAAQ;wBAAE,SAAS;wBAAM,SAAS;oBAAwB;gBAC9D,OAAO;oBACH,QAAQ,IAAI,CAAC,CAAC,iCAAiC,CAAC;oBAChD,QAAQ;wBAAE,SAAS;wBAAO,SAAS;oBAAiD;gBACxF;YACJ,GAAG;QACP;IACJ;IAEA,OAAO,cAAuB;QAC1B,gEAAgE;QAChE,OAAO;IACX;AACJ"}},
    {"offset": {"line": 810, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/App.tsx"],"sourcesContent":["'use client';\nimport React, { useEffect } from 'react';\nimport { BrowserRouter, Routes, Route, Navigate, useLocation, Link } from 'react-router-dom';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { LayoutDashboard, ShoppingCart, Users, Settings, LogOut, Menu, X, Stethoscope, Package, Briefcase, BarChart3, Truck, UserCircle, Clock, Building2, MapPin } from 'lucide-react';\nimport { usePharmaStore } from './presentation/store/useStore';\nimport { Toaster } from 'sonner';\n\n// Components\nimport LocationSelector from './presentation/components/layout/LocationSelector';\nimport NotificationCenter from './presentation/components/ui/NotificationCenter';\n\n// Pages\nimport LandingPage from './presentation/pages/LandingPage';\nimport DashboardPage from './presentation/pages/DashboardPage';\nimport POSMainScreen from './presentation/components/POSMainScreen';\nimport SupplyChainPage from './presentation/pages/SupplyChainPage';\nimport QueueKioskPage from './presentation/pages/QueueKioskPage';\nimport AccessControlPage from './presentation/pages/AccessControlPage';\nimport HRPage from './presentation/pages/HRPage';\nimport SettingsPage from './presentation/pages/SettingsPage';\nimport ClientsPage from './presentation/pages/ClientsPage';\nimport InventoryPage from './presentation/pages/InventoryPage';\nimport ReportsPage from './presentation/pages/ReportsPage';\nimport AttendanceKioskPage from './presentation/pages/AttendanceKioskPage';\nimport { WarehouseOps } from './presentation/pages/WarehouseOps';\nimport { SuppliersPage } from './presentation/pages/SuppliersPage';\nimport { SupplierProfile } from './presentation/pages/SupplierProfile';\nimport NetworkPage from './presentation/pages/NetworkPage';\nimport PriceCheckPage from './presentation/pages/PriceCheckPage';\n\nconst SidebarLayout = ({ children }: { children: React.ReactNode }) => {\n    const { user, logout } = usePharmaStore();\n    const location = useLocation();\n    const [isMobileMenuOpen, setIsMobileMenuOpen] = React.useState(false);\n\n    const menuItems = [\n        // { icon: LayoutDashboard, label: 'Dashboard', path: '/dashboard', roles: ['MANAGER', 'QF'] }, // Removed per user request\n        { icon: ShoppingCart, label: 'Punto de Venta', path: '/pos', roles: ['CASHIER', 'QF', 'MANAGER'] },\n        { icon: Package, label: 'Inventario', path: '/inventory', roles: ['WAREHOUSE', 'MANAGER', 'QF'] },\n        { icon: Truck, label: 'Operaciones WMS', path: '/warehouse', roles: ['WAREHOUSE', 'MANAGER', 'QF'] },\n        { icon: Building2, label: 'Proveedores', path: '/suppliers', roles: ['MANAGER', 'QF', 'WAREHOUSE'] },\n        { icon: BarChart3, label: 'Reportes & BI', path: '/reports', roles: ['MANAGER', 'QF'] },\n        { icon: Truck, label: 'Abastecimiento', path: '/supply-chain', roles: ['WAREHOUSE', 'MANAGER'] },\n        { icon: UserCircle, label: 'Clientes (CRM)', path: '/clients', roles: ['MANAGER', 'QF', 'CASHIER'] },\n        { icon: Users, label: 'Recursos Humanos', path: '/hr', roles: ['MANAGER'] },\n        { icon: MapPin, label: 'Gesti√≥n de Red', path: '/network', roles: ['MANAGER'] },\n        { icon: Clock, label: 'Control Asistencia', path: '/access', roles: ['MANAGER'] },\n        { icon: Settings, label: 'Configuraci√≥n', path: '/settings', roles: ['MANAGER'] },\n    ];\n\n    const filteredMenu = menuItems.filter(item => user && item.roles.includes(user.role));\n\n    return (\n        <div className=\"flex h-screen bg-slate-100 overflow-hidden\">\n            {/* Sidebar */}\n            <aside className={`fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 text-white transform transition-transform duration-300 ease-in-out ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 shadow-2xl`}>\n                <div className=\"p-6 flex justify-between items-center\">\n                    <div>\n                        <h1 className=\"text-xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500\">\n                            Farmacias Vallenar\n                        </h1>\n                        <p className=\"text-xs text-slate-400 mt-1\">Sistema ERP Cl√≠nico Integral v2.1</p>\n                    </div>\n                    <button onClick={() => setIsMobileMenuOpen(false)} className=\"md:hidden text-slate-400 hover:text-white\">\n                        <X size={24} />\n                    </button>\n                </div>\n\n                <nav className=\"mt-6 px-4 space-y-2\">\n                    {filteredMenu.map((item) => (\n                        <Link\n                            key={item.path}\n                            to={item.path}\n                            onClick={() => setIsMobileMenuOpen(false)}\n                            className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${location.pathname === item.path ? 'bg-cyan-600 text-white shadow-lg shadow-cyan-900/50' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}\n                        >\n                            <item.icon size={20} />\n                            <span className=\"font-medium\">{item.label}</span>\n                        </Link>\n                    ))}\n                </nav>\n\n                <div className=\"absolute bottom-0 left-0 w-full p-4 bg-slate-950\">\n                    <div className=\"flex items-center gap-3 mb-4 px-2\">\n                        <div className=\"w-10 h-10 rounded-full bg-cyan-900 flex items-center justify-center text-cyan-400 font-bold border border-cyan-700\">\n                            {user?.name.charAt(0)}\n                        </div>\n                        <div className=\"overflow-hidden\">\n                            <p className=\"text-sm font-bold text-white truncate\">{user?.name}</p>\n                            <p className=\"text-xs text-slate-500 truncate\">{user?.role}</p>\n                        </div>\n                    </div>\n                    <button\n                        onClick={logout}\n                        className=\"w-full flex items-center justify-center gap-2 py-2 rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white transition-colors text-sm font-bold\"\n                    >\n                        <LogOut size={16} /> Cerrar Sesi√≥n\n                    </button>\n                </div>\n            </aside>\n\n            {/* Main Content */}\n            <main className=\"flex-1 flex flex-col h-full overflow-hidden relative\">\n                {/* Mobile Header */}\n                <header className=\"md:hidden bg-white p-4 shadow-sm flex justify-between items-center z-40\">\n                    <button onClick={() => setIsMobileMenuOpen(true)} className=\"text-slate-600\">\n                        <Menu size={24} />\n                    </button>\n                    <span className=\"font-bold text-slate-800\">Farmacias Vallenar</span>\n                    <LocationSelector />\n                </header>\n\n                {/* Desktop Header with Location Selector */}\n                <header className=\"hidden md:flex bg-white px-6 py-3 shadow-sm justify-end items-center z-40 gap-4\">\n                    <NotificationCenter />\n                    <LocationSelector />\n                </header>\n\n                <div className=\"flex-1 overflow-auto\">\n                    <AnimatePresence mode=\"wait\">\n                        <motion.div\n                            key={location.pathname}\n                            initial={{ opacity: 0, y: 10 }}\n                            animate={{ opacity: 1, y: 0 }}\n                            exit={{ opacity: 0, y: -10 }}\n                            transition={{ duration: 0.2 }}\n                            className=\"h-full\"\n                        >\n                            {children}\n                        </motion.div>\n                    </AnimatePresence>\n                </div>\n            </main>\n        </div>\n    );\n};\n\nconst ProtectedRoute = ({ children }: { children: React.ReactNode }) => {\n    const { user } = usePharmaStore();\n    if (!user) return <Navigate to=\"/\" replace />;\n    return <SidebarLayout>{children}</SidebarLayout>;\n};\n\nconst App: React.FC = () => {\n    const { syncData } = usePharmaStore();\n\n    useEffect(() => {\n        syncData();\n    }, []);\n\n    return (\n        <BrowserRouter>\n            <Toaster position=\"top-center\" richColors />\n            <Routes>\n                {/* Public Routes */}\n                <Route path=\"/\" element={<LandingPage />} />\n                <Route path=\"/kiosk\" element={<AttendanceKioskPage />} />\n                <Route path=\"/access\" element={<AccessControlPage />} />\n                <Route path=\"/queue\" element={<QueueKioskPage />} />\n                <Route path=\"/price-check\" element={<PriceCheckPage />} />\n\n                {/* Protected Routes */}\n                <Route path=\"/dashboard\" element={<ProtectedRoute><DashboardPage /></ProtectedRoute>} />\n                <Route path=\"/pos\" element={<ProtectedRoute><POSMainScreen /></ProtectedRoute>} />\n                <Route path=\"/inventory\" element={<ProtectedRoute><InventoryPage /></ProtectedRoute>} />\n                <Route path=\"/warehouse\" element={<ProtectedRoute><WarehouseOps /></ProtectedRoute>} />\n                <Route path=\"/suppliers\" element={<ProtectedRoute><SuppliersPage /></ProtectedRoute>} />\n                <Route path=\"/suppliers/:id\" element={<ProtectedRoute><SupplierProfile /></ProtectedRoute>} />\n                <Route path=\"/reports\" element={<ProtectedRoute><ReportsPage /></ProtectedRoute>} />\n                <Route path=\"/supply-chain\" element={<ProtectedRoute><SupplyChainPage /></ProtectedRoute>} />\n                <Route path=\"/clients\" element={<ProtectedRoute><ClientsPage /></ProtectedRoute>} />\n                <Route path=\"/hr\" element={<ProtectedRoute><HRPage /></ProtectedRoute>} />\n                <Route path=\"/network\" element={<ProtectedRoute><NetworkPage /></ProtectedRoute>} />\n                <Route path=\"/settings\" element={<ProtectedRoute><SettingsPage /></ProtectedRoute>} />\n                <Route path=\"/admin\" element={<Navigate to=\"/dashboard\" replace />} />\n\n                <Route path=\"*\" element={<Navigate to=\"/\" replace />} />\n            </Routes>\n        </BrowserRouter>\n    );\n};\n\nexport default App;\n"],"names":[],"mappings":"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"}}]
}