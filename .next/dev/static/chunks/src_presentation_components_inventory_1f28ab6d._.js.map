{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/StockEntryModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { X, ScanBarcode, Save, Package, Calendar, AlertTriangle, CheckCircle2 } from 'lucide-react';\nimport { InventoryBatch } from '../../../domain/types';\nimport { usePharmaStore } from '../../store/useStore';\nimport { toast } from 'sonner';\n\ninterface StockEntryModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst StockEntryModal: React.FC<StockEntryModalProps> = ({ isOpen, onClose }) => {\n    const { inventory, updateStock, addNewProduct } = usePharmaStore();\n    const [activeTab, setActiveTab] = useState<'SCAN' | 'CREATE'>('SCAN');\n    const [step, setStep] = useState<'SCAN' | 'DETAILS' | 'NEW_PRODUCT'>('SCAN');\n    const [scannedSku, setScannedSku] = useState('');\n    const [selectedProduct, setSelectedProduct] = useState<InventoryBatch | null>(null);\n\n    // Agile Fields\n    const [lot, setLot] = useState('');\n    const [expiry, setExpiry] = useState('');\n    const [quantity, setQuantity] = useState('');\n\n    // New Product Fields\n    const [newProductData, setNewProductData] = useState<Partial<InventoryBatch>>({});\n\n    const scanInputRef = useRef<HTMLInputElement>(null);\n    const lotInputRef = useRef<HTMLInputElement>(null);\n    const expiryInputRef = useRef<HTMLInputElement>(null);\n    const qtyInputRef = useRef<HTMLInputElement>(null);\n\n    useEffect(() => {\n        if (isOpen) {\n            resetFlow();\n        }\n    }, [isOpen]);\n\n    const resetFlow = () => {\n        setStep('SCAN');\n        setScannedSku('');\n        setSelectedProduct(null);\n        setLot('');\n        setExpiry('');\n        setQuantity('');\n        setNewProductData({});\n        if (activeTab === 'SCAN') {\n            setTimeout(() => scanInputRef.current?.focus(), 100);\n        }\n    };\n\n    const handleScan = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!scannedSku) return;\n\n        const product = inventory.find(p => p.sku === scannedSku);\n        if (product) {\n            setSelectedProduct(product);\n            setStep('DETAILS');\n            setTimeout(() => lotInputRef.current?.focus(), 100);\n            toast.success('Producto Identificado');\n        } else {\n            setNewProductData({ sku: scannedSku });\n            setStep('NEW_PRODUCT');\n            toast.info('Producto Nuevo Detectado');\n        }\n    };\n\n    const handleQuickSave = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!selectedProduct || !quantity) return;\n\n        // Parse Expiry (DDMMAA -> Timestamp)\n        let expiryTimestamp = Date.now();\n        if (expiry.length === 6) {\n            const day = parseInt(expiry.substring(0, 2));\n            const month = parseInt(expiry.substring(2, 4)) - 1;\n            const year = 2000 + parseInt(expiry.substring(4, 6));\n            expiryTimestamp = new Date(year, month, day).getTime();\n        }\n\n        // Update Stock (In a real app, this would create a batch entry)\n        updateStock(selectedProduct.id, parseInt(quantity));\n\n        toast.success(`Ingresadas ${quantity} un. de ${selectedProduct.name}`);\n        resetFlow();\n    };\n\n    const handleNewProductSave = (e: React.FormEvent) => {\n        e.preventDefault();\n        // Validate mandatory fields\n        if (!newProductData.name || !newProductData.dci || !newProductData.isp_register) {\n            toast.error('Faltan campos obligatorios');\n            return;\n        }\n\n        const newProduct: InventoryBatch = {\n            id: `BATCH-${Date.now()}`,\n            sku: scannedSku,\n            name: newProductData.name!,\n            dci: newProductData.dci!,\n            laboratory: newProductData.laboratory || 'GENERICO',\n            isp_register: newProductData.isp_register!,\n            format: newProductData.format || 'Comprimido',\n            units_per_box: Number(newProductData.units_per_package) || 1,\n            is_bioequivalent: newProductData.bioequivalent || false,\n\n            // Legacy / Aliases\n            active_ingredient: newProductData.dci!,\n            unit_format_string: newProductData.unit_format_string || 'Unidad',\n            units_per_package: Number(newProductData.units_per_package) || 1,\n            bioequivalent: newProductData.bioequivalent || false,\n            bioequivalent_status: newProductData.bioequivalent ? 'BIOEQUIVALENTE' : 'NO_BIOEQUIVALENTE',\n\n            price: Number(newProductData.price) || 0,\n            cost_price: Number(newProductData.cost_price) || 0,\n\n            // Advanced Financials\n            cost_net: Number(newProductData.cost_price) || 0,\n            tax_percent: 19,\n            price_sell_box: Number(newProductData.price) || 0,\n            price_sell_unit: Number(newProductData.price_sell_unit) || 0,\n\n            stock_actual: Number(quantity) || 0,\n            stock_min: 10,\n            stock_max: 100,\n            expiry_date: Date.now(), // Should parse expiry\n            location_id: 'BODEGA_CENTRAL',\n            condition: 'VD',\n            category: newProductData.category || 'MEDICAMENTO',\n            allows_commission: false,\n            active_ingredients: [newProductData.dci!],\n            is_generic: false,\n            concentration: newProductData.concentration || '',\n            unit_count: Number(newProductData.units_per_package) || 1,\n            aisle: newProductData.aisle || '' // Added Location/Aisle\n        };\n\n        addNewProduct(newProduct);\n        toast.success('Producto Creado e Ingresado');\n        resetFlow();\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden\">\n                {/* Header */}\n                <div className=\"bg-slate-900 p-6 flex justify-between items-center text-white\">\n                    <div className=\"flex items-center gap-3\">\n                        <Package className=\"text-cyan-400\" size={28} />\n                        <div>\n                            <h2 className=\"text-xl font-bold\">Ingreso Rápido de Stock</h2>\n                            <p className=\"text-slate-400 text-sm\">WMS Ágil - Bodega Central</p>\n                        </div>\n                    </div>\n                    <button onClick={onClose} className=\"text-slate-400 hover:text-white\"><X /></button>\n                </div>\n\n                {/* Tabs */}\n                <div className=\"flex border-b border-slate-100\">\n                    <button\n                        onClick={() => { setActiveTab('SCAN'); resetFlow(); }}\n                        className={`flex-1 py-4 font-bold text-sm transition-colors ${activeTab === 'SCAN' ? 'text-cyan-600 border-b-2 border-cyan-600 bg-cyan-50' : 'text-slate-500 hover:bg-slate-50'}`}\n                    >\n                        Escaneo Rápido (Stock)\n                    </button>\n                    <button\n                        onClick={() => { setActiveTab('CREATE'); setStep('NEW_PRODUCT'); }}\n                        className={`flex-1 py-4 font-bold text-sm transition-colors ${activeTab === 'CREATE' ? 'text-amber-600 border-b-2 border-amber-600 bg-amber-50' : 'text-slate-500 hover:bg-slate-50'}`}\n                    >\n                        Crear Producto Maestro\n                    </button>\n                </div>\n                {/* Content */}\n                <div className=\"p-6 max-h-[80vh] overflow-y-auto custom-scrollbar\">\n                    {step === 'SCAN' && (\n                        <div className=\"flex flex-col items-center justify-center py-12\">\n                            <div className=\"w-24 h-24 bg-cyan-50 rounded-full flex items-center justify-center mb-6 animate-pulse\">\n                                <ScanBarcode className=\"text-cyan-500\" size={48} />\n                            </div>\n                            <h3 className=\"text-2xl font-bold text-slate-800 mb-2\">Escanea un Producto</h3>\n                            <p className=\"text-slate-500 mb-8 text-center max-w-xs\">\n                                Escanea el código de barras o escribe el SKU para identificar o crear un producto.\n                            </p>\n\n                            <form onSubmit={handleScan} className=\"w-full max-w-md relative\">\n                                <input\n                                    ref={scanInputRef}\n                                    type=\"text\"\n                                    className=\"w-full pl-6 pr-12 py-4 text-xl font-mono bg-slate-50 border-2 border-slate-200 rounded-2xl focus:border-cyan-500 focus:outline-none transition-all text-center uppercase\"\n                                    placeholder=\"EAN / SKU...\"\n                                    value={scannedSku}\n                                    onChange={e => setScannedSku(e.target.value.toUpperCase())}\n                                />\n                                <button\n                                    type=\"submit\"\n                                    className=\"absolute right-3 top-1/2 -translate-y-1/2 p-2 bg-cyan-500 text-white rounded-xl hover:bg-cyan-600 transition\"\n                                >\n                                    <ScanBarcode size={20} />\n                                </button>\n                            </form>\n                        </div>\n                    )}\n\n                    {step === 'DETAILS' && selectedProduct && (\n                        <div className=\"space-y-6\">\n                            <div className=\"bg-cyan-50 p-4 rounded-2xl border border-cyan-100 flex gap-4 items-center\">\n                                <div className=\"w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-sm\">\n                                    <Package className=\"text-cyan-600\" />\n                                </div>\n                                <div>\n                                    <h3 className=\"font-bold text-slate-800 text-lg\">{selectedProduct.name}</h3>\n                                    <p className=\"text-slate-500 text-sm font-mono\">{selectedProduct.sku}</p>\n                                </div>\n                            </div>\n\n                            <form onSubmit={handleQuickSave} className=\"grid grid-cols-2 gap-4\">\n                                <div className=\"col-span-2\">\n                                    <label className=\"block text-sm font-bold text-slate-700 mb-1\">Cantidad a Ingresar</label>\n                                    <input\n                                        ref={qtyInputRef}\n                                        type=\"number\"\n                                        className=\"w-full p-4 text-2xl font-bold text-center border-2 border-slate-200 rounded-xl focus:border-cyan-500 outline-none\"\n                                        value={quantity}\n                                        onChange={e => setQuantity(e.target.value)}\n                                        placeholder=\"0\"\n                                        autoFocus\n                                    />\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">N° Lote (Opcional)</label>\n                                    <input\n                                        ref={lotInputRef}\n                                        type=\"text\"\n                                        className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                        value={lot}\n                                        onChange={e => setLot(e.target.value)}\n                                        placeholder=\"LOTE-001\"\n                                    />\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Vencimiento (DDMMAA)</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                        value={expiry}\n                                        onChange={e => setExpiry(e.target.value)}\n                                        placeholder=\"311225\"\n                                        maxLength={6}\n                                    />\n                                </div>\n\n                                <button\n                                    type=\"submit\"\n                                    className=\"col-span-2 py-4 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition flex items-center justify-center gap-2 mt-4\"\n                                >\n                                    <Save size={20} /> Confirmar Ingreso\n                                </button>\n                            </form>\n                        </div>\n                    )}\n\n                    {step === 'NEW_PRODUCT' && (\n                        <form onSubmit={handleNewProductSave} className=\"space-y-8\">\n                            {/* 1. Identificación & Ubicación */}\n                            <section>\n                                <h4 className=\"text-sm font-bold text-cyan-600 uppercase tracking-wider mb-4 border-b border-cyan-100 pb-2\">\n                                    1. Identificación y Ubicación\n                                </h4>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div className=\"col-span-2\">\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Nombre Comercial *</label>\n                                        <input\n                                            type=\"text\"\n                                            required\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-bold text-lg focus:border-cyan-500 outline-none\"\n                                            value={newProductData.name || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, name: e.target.value })}\n                                            placeholder=\"Ej: PARACETAMOL 500MG\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Categoría</label>\n                                        <input\n                                            list=\"categories\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl focus:border-cyan-500 outline-none\"\n                                            value={newProductData.category || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, category: e.target.value })}\n                                            placeholder=\"Seleccionar o Escribir...\"\n                                        />\n                                        <datalist id=\"categories\">\n                                            <option value=\"MEDICAMENTO\" />\n                                            <option value=\"INSUMO_MEDICO\" />\n                                            <option value=\"RETAIL_BELLEZA\" />\n                                            <option value=\"SUPLEMENTO\" />\n                                        </datalist>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Ubicación Física *</label>\n                                        <input\n                                            type=\"text\"\n                                            required\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl focus:border-cyan-500 outline-none\"\n                                            value={newProductData.aisle || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, aisle: e.target.value })}\n                                            placeholder=\"Ej: Estante A1 / Pasillo 3\"\n                                        />\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* 2. Datos Sanitarios */}\n                            <section>\n                                <h4 className=\"text-sm font-bold text-cyan-600 uppercase tracking-wider mb-4 border-b border-cyan-100 pb-2\">\n                                    2. Datos Sanitarios (Seremi)\n                                </h4>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div className=\"col-span-2\">\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Principio Activo (DCI) *</label>\n                                        <input\n                                            type=\"text\"\n                                            required\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl focus:border-cyan-500 outline-none\"\n                                            value={newProductData.dci || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, dci: e.target.value })}\n                                            placeholder=\"Ej: PARACETAMOL\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Laboratorio</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                            value={newProductData.laboratory || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, laboratory: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Registro ISP *</label>\n                                        <input\n                                            type=\"text\"\n                                            required\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                            value={newProductData.isp_register || ''}\n                                            onChange={e => setNewProductData({ ...newProductData, isp_register: e.target.value })}\n                                        />\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* 3. Precios y Costos */}\n                            <section>\n                                <h4 className=\"text-sm font-bold text-cyan-600 uppercase tracking-wider mb-4 border-b border-cyan-100 pb-2\">\n                                    3. Estructura de Precios\n                                </h4>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Precio Venta (Caja)</label>\n                                        <div className=\"relative\">\n                                            <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\">$</span>\n                                            <input\n                                                type=\"number\"\n                                                className=\"w-full pl-6 p-3 border border-slate-200 rounded-xl font-bold text-lg\"\n                                                value={newProductData.price || ''}\n                                                onChange={e => {\n                                                    const price = parseInt(e.target.value) || 0;\n                                                    const units = newProductData.units_per_package || 1;\n                                                    setNewProductData({\n                                                        ...newProductData,\n                                                        price,\n                                                        price_sell_box: price,\n                                                        price_sell_unit: Math.round(price / units)\n                                                    });\n                                                }}\n                                            />\n                                        </div>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Unidades por Caja</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                            value={newProductData.units_per_package || ''}\n                                            onChange={e => {\n                                                const units = parseInt(e.target.value) || 1;\n                                                const price = newProductData.price || 0;\n                                                setNewProductData({\n                                                    ...newProductData,\n                                                    units_per_package: units,\n                                                    price_sell_unit: Math.round(price / units)\n                                                });\n                                            }}\n                                            placeholder=\"1\"\n                                        />\n                                    </div>\n                                    <div className=\"col-span-2\">\n                                        <div className=\"p-3 bg-slate-100 rounded-xl flex justify-between items-center\">\n                                            <span className=\"text-xs font-bold text-slate-500\">Costo Unitario Calculado:</span>\n                                            <span className=\"font-mono font-bold text-slate-700\">\n                                                ${(newProductData.price_sell_unit || 0).toLocaleString()} c/u\n                                            </span>\n                                        </div>\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* 4. Lote Inicial */}\n                            <section>\n                                <h4 className=\"text-sm font-bold text-cyan-600 uppercase tracking-wider mb-4 border-b border-cyan-100 pb-2\">\n                                    4. Lote Inicial (Opcional)\n                                </h4>\n                                <div className=\"grid grid-cols-3 gap-4\">\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">N° Lote</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                            value={lot}\n                                            onChange={e => setLot(e.target.value)}\n                                            placeholder=\"LOTE-001\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Vencimiento</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                            value={expiry}\n                                            onChange={e => setExpiry(e.target.value)}\n                                            placeholder=\"DDMMAA\"\n                                            maxLength={6}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Stock Inicial</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-bold\"\n                                            value={quantity}\n                                            onChange={e => setQuantity(e.target.value)}\n                                            placeholder=\"0\"\n                                        />\n                                    </div>\n                                </div>\n                            </section>\n\n                            <button\n                                type=\"submit\"\n                                className=\"w-full py-4 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition shadow-lg shadow-cyan-200 flex items-center justify-center gap-2\"\n                            >\n                                <Save size={20} /> Crear Producto Maestro\n                            </button>\n                        </form>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default StockEntryModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1083, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/StockTransferModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { ArrowRightLeft, MapPin, Box, Search } from 'lucide-react';\nimport { InventoryBatch } from '../../../domain/types';\n\ninterface StockTransferModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst StockTransferModal: React.FC<StockTransferModalProps> = ({ isOpen, onClose }) => {\n    const { inventory, transferStock } = usePharmaStore();\n    const [searchTerm, setSearchTerm] = useState('');\n    const [selectedProduct, setSelectedProduct] = useState<InventoryBatch | null>(null);\n    const [qty, setQty] = useState('');\n    const [targetLocation, setTargetLocation] = useState('SUCURSAL_CENTRO');\n\n    if (!isOpen) return null;\n\n    const filteredInventory = inventory.filter(i =>\n        i.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        i.sku.includes(searchTerm)\n    );\n\n    const handleTransfer = () => {\n        if (selectedProduct && qty) {\n            transferStock(selectedProduct.id, targetLocation as any, parseInt(qty));\n            onClose();\n            setSearchTerm('');\n            setSelectedProduct(null);\n            setQty('');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-slate-900 p-6 border-b border-slate-800 text-white\">\n                    <h3 className=\"text-xl font-bold flex items-center gap-2\">\n                        <ArrowRightLeft className=\"text-purple-400\" /> Transferencia de Stock\n                    </h3>\n                </div>\n\n                <div className=\"p-6 space-y-6\">\n                    {/* 1. Select Product */}\n                    {!selectedProduct ? (\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 mb-2 uppercase\">1. Buscar Producto (Origen)</label>\n                            <div className=\"relative mb-4\">\n                                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\n                                <input\n                                    type=\"text\"\n                                    autoFocus\n                                    placeholder=\"Nombre o SKU...\"\n                                    className=\"w-full pl-10 pr-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none\"\n                                    value={searchTerm}\n                                    onChange={(e) => setSearchTerm(e.target.value)}\n                                />\n                            </div>\n                            <div className=\"h-48 overflow-y-auto border border-slate-100 rounded-xl bg-slate-50 p-2 space-y-2\">\n                                {filteredInventory.map(item => (\n                                    <div\n                                        key={item.id}\n                                        onClick={() => setSelectedProduct(item)}\n                                        className=\"p-3 bg-white rounded-lg border border-slate-200 hover:border-purple-400 cursor-pointer transition flex justify-between items-center\"\n                                    >\n                                        <div>\n                                            <p className=\"font-bold text-sm text-slate-800\">{item.name}</p>\n                                            <p className=\"text-xs text-slate-500\">{item.location_id}</p>\n                                        </div>\n                                        <span className=\"bg-slate-100 text-slate-600 px-2 py-1 rounded text-xs font-bold\">Stock: {item.stock_actual}</span>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"bg-purple-50 border border-purple-100 rounded-xl p-4 flex justify-between items-center\">\n                            <div>\n                                <h4 className=\"font-bold text-purple-900\">{selectedProduct.name}</h4>\n                                <p className=\"text-xs text-purple-700\">Origen: {selectedProduct.location_id}</p>\n                            </div>\n                            <button onClick={() => setSelectedProduct(null)} className=\"text-xs font-bold text-purple-500 hover:text-purple-700\">CAMBIAR</button>\n                        </div>\n                    )}\n\n                    {/* 2. Transfer Details */}\n                    {selectedProduct && (\n                        <div className=\"grid grid-cols-2 gap-4 animate-in fade-in slide-in-from-bottom-2\">\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Destino</label>\n                                <div className=\"relative\">\n                                    <MapPin className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n                                    <select\n                                        className=\"w-full pl-9 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none appearance-none bg-white\"\n                                        value={targetLocation}\n                                        onChange={(e) => setTargetLocation(e.target.value)}\n                                    >\n                                        <option value=\"SUCURSAL_CENTRO\">Sucursal Centro</option>\n                                        <option value=\"SUCURSAL_NORTE\">Sucursal Norte</option>\n                                        <option value=\"BODEGA_CENTRAL\">Bodega Central</option>\n                                        <option value=\"KIOSCO\">Kiosco</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Cantidad</label>\n                                <div className=\"relative\">\n                                    <Box className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n                                    <input\n                                        type=\"number\"\n                                        className=\"w-full pl-9 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none\"\n                                        max={selectedProduct.stock_actual}\n                                        value={qty}\n                                        onChange={(e) => setQty(e.target.value)}\n                                    />\n                                </div>\n                                <p className=\"text-[10px] text-right text-slate-400 mt-1\">Máx: {selectedProduct.stock_actual}</p>\n                            </div>\n                        </div>\n                    )}\n\n                    <div className=\"flex gap-3 pt-4\">\n                        <button onClick={onClose} className=\"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl transition\">Cancelar</button>\n                        <button\n                            onClick={handleTransfer}\n                            disabled={!selectedProduct || !qty || parseInt(qty) > (selectedProduct?.stock_actual || 0)}\n                            className=\"flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition shadow-lg shadow-purple-200 disabled:opacity-50\"\n                        >\n                            Transferir\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default StockTransferModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1492, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/InventoryEditModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { X, Save, Thermometer, AlertTriangle, Tag, Package, DollarSign, Activity, Barcode, Syringe, Calendar, Trash2, Plus, Edit2 } from 'lucide-react';\nimport { InventoryBatch } from '../../../domain/types';\nimport { usePharmaStore } from '../../store/useStore';\nimport { toast } from 'sonner';\n\ninterface InventoryEditModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    product: InventoryBatch | null;\n}\n\nconst InventoryEditModal: React.FC<InventoryEditModalProps> = ({ isOpen, onClose, product }) => {\n    const { updateProduct, inventory, updateBatchDetails, addNewProduct } = usePharmaStore();\n    const [formData, setFormData] = useState<Partial<InventoryBatch>>({});\n    const [activeBatches, setActiveBatches] = useState<InventoryBatch[]>([]);\n    const [newTag, setNewTag] = useState('');\n\n    useEffect(() => {\n        if (product) {\n            setFormData({\n                ...product,\n                contraindications: product.contraindications || [],\n                therapeutic_tags: product.therapeutic_tags || []\n            });\n            // Filter batches for this product (assuming SKU is the grouper)\n            setActiveBatches(inventory.filter(i => i.sku === product.sku && i.stock_actual > 0));\n        }\n    }, [product, inventory]);\n\n    if (!isOpen || !product) return null;\n\n    const handleSave = () => {\n        if (product.id) {\n            // Update the main product (and potentially all batches if we want to sync shared data)\n            // For now, we update the specific batch passed as \"product\"\n            updateProduct(product.id, formData);\n\n            // In a real \"Master Product\" scenario, we might want to update ALL batches with shared data\n            // inventory.filter(i => i.sku === product.sku).forEach(b => updateProduct(b.id, formData));\n\n            toast.success('Producto actualizado correctamente');\n            onClose();\n        }\n    };\n\n    const handleBatchUpdate = (batchId: string, field: keyof InventoryBatch, value: any) => {\n        updateBatchDetails(product.id, batchId, { [field]: value });\n        toast.success('Lote actualizado');\n    };\n\n    const handleAddBatch = () => {\n        const newBatch: InventoryBatch = {\n            ...product,\n            id: `NEW-${Date.now()}`, // Temporary ID\n            stock_actual: 0,\n            expiry_date: Date.now() + 31536000000, // +1 year\n            location_id: 'BODEGA_CENTRAL',\n            aisle: '',\n            cost_net: 0,\n            tax_percent: 19,\n            price_sell_box: 0,\n            price_sell_unit: 0,\n            price: 0,\n            cost_price: 0\n        };\n        addNewProduct(newBatch); // Using addNewProduct as \"addBatch\" effectively\n        toast.success('Nuevo lote creado');\n    };\n\n    const handleMermarBatch = (batchId: string) => {\n        if (confirm('¿Estás seguro de dar de baja este lote? El stock quedará en 0.')) {\n            updateBatchDetails(product.id, batchId, { stock_actual: 0 });\n            toast.success('Lote dado de baja');\n        }\n    };\n\n    const handleAddTag = (e: React.KeyboardEvent) => {\n        if (e.key === 'Enter' && newTag.trim()) {\n            e.preventDefault();\n            const currentTags = formData.therapeutic_tags || [];\n            if (!currentTags.includes(newTag.trim().toUpperCase())) {\n                setFormData({\n                    ...formData,\n                    therapeutic_tags: [...currentTags, newTag.trim().toUpperCase()]\n                });\n            }\n            setNewTag('');\n        }\n    };\n\n    const removeTag = (tagToRemove: string) => {\n        setFormData({\n            ...formData,\n            therapeutic_tags: (formData.therapeutic_tags || []).filter(tag => tag !== tagToRemove)\n        });\n    };\n\n    const toggleContraindication = (ci: string) => {\n        const current = formData.contraindications || [];\n        if (current.includes(ci)) {\n            setFormData({ ...formData, contraindications: current.filter(c => c !== ci) });\n        } else {\n            setFormData({ ...formData, contraindications: [...current, ci] });\n        }\n    };\n\n    // SEREMI Calculation\n    const pricePerUnit = formData.price && formData.units_per_package\n        ? Math.round(formData.price / formData.units_per_package)\n        : 0;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-5xl h-[90vh] flex flex-col animate-in fade-in zoom-in duration-200\">\n                {/* Header */}\n                <div className=\"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 rounded-t-3xl\">\n                    <div>\n                        <h2 className=\"text-2xl font-bold text-slate-800 flex items-center gap-2\">\n                            <Package className=\"text-cyan-600\" />\n                            Gestor Maestro de Producto\n                        </h2>\n                        <p className=\"text-slate-500 text-sm\">{product.name} ({product.sku})</p>\n                    </div>\n                    <div className=\"flex gap-2\">\n                        <button\n                            onClick={handleSave}\n                            className=\"px-6 py-2 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition flex items-center gap-2 shadow-lg shadow-cyan-200\"\n                        >\n                            <Save size={18} /> Guardar Cambios\n                        </button>\n                        <button onClick={onClose} className=\"p-2 hover:bg-slate-200 rounded-full transition-colors\">\n                            <X size={24} className=\"text-slate-400\" />\n                        </button>\n                    </div>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-y-auto p-8 bg-slate-50/30\">\n                    <div className=\"grid grid-cols-12 gap-8\">\n\n                        {/* Left Column: Master Data */}\n                        <div className=\"col-span-12 lg:col-span-7 space-y-6\">\n\n                            {/* 1. IDENTIFICACIÓN RÁPIDA (NEW) */}\n                            <section className=\"bg-white p-6 rounded-2xl shadow-sm border border-slate-100\">\n                                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <Tag size={16} /> Identificación Rápida\n                                </h3>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Código de Barras (EAN)</label>\n                                        <div className=\"relative\">\n                                            <Barcode className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\n                                            <input\n                                                type=\"text\"\n                                                className=\"w-full pl-10 p-3 border border-slate-200 rounded-xl font-mono text-slate-700 focus:border-cyan-500 focus:outline-none bg-slate-50\"\n                                                value={formData.barcode || ''}\n                                                onChange={e => setFormData({ ...formData, barcode: e.target.value })}\n                                                placeholder=\"Escanea aquí...\"\n                                            />\n                                        </div>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Vía de Administración</label>\n                                        <div className=\"relative\">\n                                            <Syringe className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\n                                            <select\n                                                className=\"w-full pl-10 p-3 border border-slate-200 rounded-xl font-bold text-slate-700 focus:border-cyan-500 focus:outline-none appearance-none bg-white\"\n                                                value={formData.administration_route || ''}\n                                                onChange={e => setFormData({ ...formData, administration_route: e.target.value as any })}\n                                            >\n                                                <option value=\"\">Seleccionar...</option>\n                                                <option value=\"ORAL\">Oral</option>\n                                                <option value=\"TOPICA\">Tópica</option>\n                                                <option value=\"OFTALMICA\">Oftálmica</option>\n                                                <option value=\"NASAL\">Nasal</option>\n                                                <option value=\"RECTAL\">Rectal</option>\n                                                <option value=\"VAGINAL\">Vaginal</option>\n                                                <option value=\"PARENTERAL\">Parenteral (Inyectable)</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* 2. DATOS SANITARIOS (SEREMI) */}\n                            <section className=\"bg-amber-50 p-6 rounded-2xl border border-amber-100 shadow-sm\">\n                                <h3 className=\"text-sm font-bold text-amber-700 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <AlertTriangle size={16} /> Datos Sanitarios (Norma Seremi)\n                                </h3>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div className=\"col-span-2\">\n                                        <label className=\"block text-xs font-bold text-amber-800/60 mb-1\">Principio Activo (DCI)</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-amber-200 rounded-xl font-bold text-slate-700 focus:border-amber-500 focus:outline-none bg-white\"\n                                            value={formData.dci || ''}\n                                            onChange={e => setFormData({ ...formData, dci: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-amber-800/60 mb-1\">Laboratorio</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-amber-200 rounded-xl font-bold bg-white\"\n                                            value={formData.laboratory || ''}\n                                            onChange={e => setFormData({ ...formData, laboratory: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-amber-800/60 mb-1\">Registro ISP</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-amber-200 rounded-xl font-mono text-sm bg-white\"\n                                            value={formData.isp_register || ''}\n                                            onChange={e => setFormData({ ...formData, isp_register: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-amber-800/60 mb-1\">Unidades por Caja</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-amber-200 rounded-xl font-mono bg-white\"\n                                            value={formData.units_per_package || 1}\n                                            onChange={e => setFormData({ ...formData, units_per_package: parseInt(e.target.value) })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-amber-800/60 mb-1\">Precio Unitario Calc.</label>\n                                        <div className=\"w-full p-3 bg-amber-100/50 border border-amber-200 rounded-xl font-mono font-bold text-amber-800\">\n                                            ${pricePerUnit}\n                                        </div>\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* 3. DATOS COMERCIALES */}\n                            <section className=\"bg-white p-6 rounded-2xl shadow-sm border border-slate-100\">\n                                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <DollarSign size={16} /> Datos Comerciales\n                                </h3>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div className=\"col-span-2\">\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Nombre Comercial</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-bold text-slate-700 focus:border-cyan-500 focus:outline-none\"\n                                            value={formData.name || ''}\n                                            onChange={e => setFormData({ ...formData, name: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Precio Venta</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                            value={formData.price || 0}\n                                            onChange={e => setFormData({ ...formData, price: Number(e.target.value) })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Costo Neto</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                            value={formData.cost_price || 0}\n                                            onChange={e => setFormData({ ...formData, cost_price: Number(e.target.value) })}\n                                        />\n                                    </div>\n                                </div>\n                            </section>\n                        </div>\n\n                        {/* Right Column: Batch Management & Tags */}\n                        <div className=\"col-span-12 lg:col-span-5 space-y-6\">\n\n                            {/* 4. GESTIÓN DE LOTES (CRITICAL) */}\n                            <section className=\"bg-blue-50 p-6 rounded-2xl shadow-sm border border-blue-100\">\n                                <div className=\"flex justify-between items-center mb-6\">\n                                    <h3 className=\"text-sm font-bold text-blue-800 uppercase tracking-wider flex items-center gap-2\">\n                                        <Package size={16} className=\"text-blue-600\" /> Existencias Físicas (Lotes)\n                                    </h3>\n                                    <button\n                                        onClick={handleAddBatch}\n                                        className=\"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold rounded-lg transition flex items-center gap-1 shadow-sm\"\n                                    >\n                                        <Plus size={14} /> Nuevo Lote\n                                    </button>\n                                </div>\n\n                                <div className=\"space-y-3 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar\">\n                                    {activeBatches.map(batch => (\n                                        <div key={batch.id} className=\"bg-white p-4 rounded-xl border border-blue-200 shadow-sm hover:border-blue-300 transition-colors\">\n                                            <div className=\"flex justify-between items-start mb-3\">\n                                                <div className=\"flex-1\">\n                                                    <label className=\"text-[10px] font-bold text-slate-400 uppercase\">N° Lote</label>\n                                                    <input\n                                                        type=\"text\"\n                                                        value={batch.id} // Usually Batch Number is separate, but using ID for now\n                                                        readOnly\n                                                        className=\"block w-full text-sm font-bold text-slate-700 bg-transparent outline-none\"\n                                                    />\n                                                </div>\n                                                <button\n                                                    onClick={() => handleMermarBatch(batch.id)}\n                                                    className=\"text-slate-300 hover:text-red-500 transition-colors\"\n                                                    title=\"Dar de baja\"\n                                                >\n                                                    <Trash2 size={16} />\n                                                </button>\n                                            </div>\n\n                                            <div className=\"grid grid-cols-2 gap-3 mb-3\">\n                                                <div>\n                                                    <label className=\"flex items-center gap-1 text-[10px] font-bold text-slate-400 uppercase mb-1\">\n                                                        <Calendar size={10} /> Vencimiento\n                                                    </label>\n                                                    <input\n                                                        type=\"date\"\n                                                        value={new Date(batch.expiry_date).toISOString().split('T')[0]}\n                                                        onChange={e => handleBatchUpdate(batch.id, 'expiry_date', new Date(e.target.value).getTime())}\n                                                        className=\"w-full p-2 bg-slate-50 border border-slate-100 rounded-lg text-xs font-bold text-slate-600\"\n                                                    />\n                                                </div>\n                                                <div>\n                                                    <label className=\"flex items-center gap-1 text-[10px] font-bold text-slate-400 uppercase mb-1\">\n                                                        <Package size={10} /> Stock\n                                                    </label>\n                                                    <input\n                                                        type=\"number\"\n                                                        value={batch.stock_actual}\n                                                        onChange={e => handleBatchUpdate(batch.id, 'stock_actual', parseInt(e.target.value))}\n                                                        className=\"w-full p-2 bg-slate-50 border border-slate-100 rounded-lg text-xs font-bold text-slate-600\"\n                                                    />\n                                                </div>\n                                            </div>\n\n                                            <div>\n                                                <label className=\"text-[10px] font-bold text-slate-400 uppercase mb-1 block\">Ubicación</label>\n                                                <input\n                                                    type=\"text\"\n                                                    value={batch.aisle || ''}\n                                                    onChange={e => handleBatchUpdate(batch.id, 'aisle', e.target.value)}\n                                                    placeholder=\"Ej: Estante A1\"\n                                                    className=\"w-full p-2 bg-slate-50 border border-slate-100 rounded-lg text-xs text-slate-600\"\n                                                />\n                                            </div>\n                                        </div>\n                                    ))}\n\n                                    {activeBatches.length === 0 && (\n                                        <div className=\"text-center py-8 text-slate-400 text-sm italic\">\n                                            No hay lotes activos para este producto.\n                                        </div>\n                                    )}\n                                </div>\n                            </section>\n\n                            {/* Tags */}\n                            <section className=\"bg-white p-6 rounded-2xl shadow-sm border border-slate-100\">\n                                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <Activity size={16} /> Etiquetas Terapéuticas\n                                </h3>\n                                <div className=\"flex flex-wrap gap-2 mb-3\">\n                                    {formData.therapeutic_tags?.map(tag => (\n                                        <span key={tag} className=\"px-3 py-1 bg-cyan-50 text-cyan-700 rounded-full text-xs font-bold flex items-center gap-1\">\n                                            {tag}\n                                            <button onClick={() => removeTag(tag)} className=\"hover:text-cyan-900\"><X size={12} /></button>\n                                        </span>\n                                    ))}\n                                </div>\n                                <input\n                                    type=\"text\"\n                                    className=\"w-full p-3 border border-slate-200 rounded-xl text-sm\"\n                                    placeholder=\"Escribe y presiona Enter...\"\n                                    value={newTag}\n                                    onChange={e => setNewTag(e.target.value)}\n                                    onKeyDown={handleAddTag}\n                                />\n                            </section>\n\n                            <section className=\"bg-red-50 p-6 rounded-2xl border border-red-100\">\n                                <h3 className=\"text-sm font-bold text-red-400 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <AlertTriangle size={16} /> Contraindicaciones\n                                </h3>\n                                <div className=\"space-y-2\">\n                                    {['EMBARAZO', 'LACTANCIA', 'HIPERTENSION', 'DIABETES', 'ULCERA'].map(ci => (\n                                        <label key={ci} className=\"flex items-center gap-2 cursor-pointer hover:bg-red-100/50 p-2 rounded-lg transition\">\n                                            <input\n                                                type=\"checkbox\"\n                                                className=\"w-4 h-4 text-red-500 rounded focus:ring-red-400\"\n                                                checked={formData.contraindications?.includes(ci) || false}\n                                                onChange={() => toggleContraindication(ci)}\n                                            />\n                                            <span className=\"text-sm font-bold text-red-800\">{ci}</span>\n                                        </label>\n                                    ))}\n                                </div>\n                            </section>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default InventoryEditModal;\n"],"names":[],"mappings":"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"}}]
}