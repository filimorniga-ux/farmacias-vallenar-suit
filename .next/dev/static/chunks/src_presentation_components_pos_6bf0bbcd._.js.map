{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/PrescriptionModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { FileText, Stethoscope, CheckSquare, AlertTriangle } from 'lucide-react';\n\ninterface PrescriptionModalProps {\n    isOpen: boolean;\n    onConfirm: (data: { folio: string, doctorRut: string }) => void;\n    onCancel: () => void;\n    itemName: string;\n}\n\nconst PrescriptionModal: React.FC<PrescriptionModalProps> = ({ isOpen, onConfirm, onCancel, itemName }) => {\n    const [folio, setFolio] = useState('');\n    const [doctorRut, setDoctorRut] = useState('');\n    const [isArchived, setIsArchived] = useState(false);\n\n    if (!isOpen) return null;\n\n    const isValid = folio.length > 0 && doctorRut.length > 8 && isArchived;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-amber-50 p-6 border-b border-amber-100\">\n                    <h3 className=\"text-xl font-bold text-amber-800 flex items-center gap-2\">\n                        <AlertTriangle className=\"text-amber-600\" /> Receta Retenida\n                    </h3>\n                    <p className=\"text-sm text-amber-700 mt-1\">\n                        La venta de <strong>{itemName}</strong> requiere receta retenida.\n                    </p>\n                </div>\n\n                <div className=\"p-6 space-y-4\">\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-700 mb-1 flex items-center gap-2\">\n                            <FileText size={16} /> Folio Receta\n                        </label>\n                        <input\n                            type=\"text\"\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none\"\n                            placeholder=\"Ej: A-123456\"\n                            value={folio}\n                            onChange={(e) => setFolio(e.target.value)}\n                        />\n                    </div>\n\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-700 mb-1 flex items-center gap-2\">\n                            <Stethoscope size={16} /> RUT M√©dico Prescriptor\n                        </label>\n                        <input\n                            type=\"text\"\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none\"\n                            placeholder=\"Ej: 11.222.333-4\"\n                            value={doctorRut}\n                            onChange={(e) => setDoctorRut(e.target.value)}\n                        />\n                    </div>\n\n                    <div className=\"bg-slate-50 p-4 rounded-xl border border-slate-200\">\n                        <label className=\"flex items-center gap-3 cursor-pointer\">\n                            <div className={`w-6 h-6 rounded border-2 flex items-center justify-center transition-colors ${isArchived ? 'bg-amber-500 border-amber-500 text-white' : 'border-slate-300 bg-white'}`}>\n                                {isArchived && <CheckSquare size={16} />}\n                            </div>\n                            <input\n                                type=\"checkbox\"\n                                className=\"hidden\"\n                                checked={isArchived}\n                                onChange={(e) => setIsArchived(e.target.checked)}\n                            />\n                            <span className=\"text-sm font-bold text-slate-700\">Receta F√≠sica Archivada</span>\n                        </label>\n                        <p className=\"text-xs text-slate-400 mt-2 ml-9\">\n                            Declaro haber recibido y archivado la receta f√≠sica correspondiente.\n                        </p>\n                    </div>\n\n                    <div className=\"flex flex-col gap-3 pt-4\">\n                        <div className=\"flex gap-3\">\n                            <button\n                                onClick={onCancel}\n                                className=\"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl transition\"\n                            >\n                                Cancelar\n                            </button>\n                            <button\n                                onClick={() => isValid && onConfirm({ folio, doctorRut })}\n                                disabled={!isValid}\n                                className=\"flex-1 py-3 bg-amber-600 text-white font-bold rounded-xl hover:bg-amber-700 transition disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-amber-200\"\n                            >\n                                Confirmar\n                            </button>\n                        </div>\n                        <button\n                            onClick={() => onConfirm({ folio: 'PENDIENTE_VALIDACION', doctorRut: 'VALIDACION_MANUAL' })}\n                            className=\"w-full py-2 text-xs font-bold text-slate-400 hover:text-slate-600 transition uppercase tracking-wider\"\n                        >\n                            Omitir / Validar Manualmente\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default PrescriptionModal;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;;;;;AASA,MAAM,oBAAsD,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE;;IAClG,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAE7C,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,UAAU,MAAM,MAAM,GAAG,KAAK,UAAU,MAAM,GAAG,KAAK;IAE5D,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAG,WAAU;;8CACV,6LAAC,4OAAa;oCAAC,WAAU;;;;;;gCAAmB;;;;;;;sCAEhD,6LAAC;4BAAE,WAAU;;gCAA8B;8CAC3B,6LAAC;8CAAQ;;;;;;gCAAkB;;;;;;;;;;;;;8BAI/C,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;;8CACG,6LAAC;oCAAM,WAAU;;sDACb,6LAAC,6NAAQ;4CAAC,MAAM;;;;;;wCAAM;;;;;;;8CAE1B,6LAAC;oCACG,MAAK;oCACL,WAAU;oCACV,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;sCAIhD,6LAAC;;8CACG,6LAAC;oCAAM,WAAU;;sDACb,6LAAC,kOAAW;4CAAC,MAAM;;;;;;wCAAM;;;;;;;8CAE7B,6LAAC;oCACG,MAAK;oCACL,WAAU;oCACV,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;sCAIpD,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAM,WAAU;;sDACb,6LAAC;4CAAI,WAAW,CAAC,4EAA4E,EAAE,aAAa,6CAA6C,6BAA6B;sDACjL,4BAAc,6LAAC,6OAAW;gDAAC,MAAM;;;;;;;;;;;sDAEtC,6LAAC;4CACG,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,OAAO;;;;;;sDAEnD,6LAAC;4CAAK,WAAU;sDAAmC;;;;;;;;;;;;8CAEvD,6LAAC;oCAAE,WAAU;8CAAmC;;;;;;;;;;;;sCAKpD,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CACG,SAAS;4CACT,WAAU;sDACb;;;;;;sDAGD,6LAAC;4CACG,SAAS,IAAM,WAAW,UAAU;oDAAE;oDAAO;gDAAU;4CACvD,UAAU,CAAC;4CACX,WAAU;sDACb;;;;;;;;;;;;8CAIL,6LAAC;oCACG,SAAS,IAAM,UAAU;4CAAE,OAAO;4CAAwB,WAAW;wCAAoB;oCACzF,WAAU;8CACb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQzB;GA7FM;KAAA;uCA+FS"}},
    {"offset": {"line": 289, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/ManualItemModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { PlusCircle, DollarSign, Package } from 'lucide-react';\n\ninterface ManualItemModalProps {\n    isOpen: boolean;\n    onConfirm: (data: { description: string, price: number, quantity: number }) => void;\n    onClose: () => void;\n}\n\nconst ManualItemModal: React.FC<ManualItemModalProps> = ({ isOpen, onConfirm, onClose }) => {\n    const [description, setDescription] = useState('');\n    const [price, setPrice] = useState('');\n    const [quantity, setQuantity] = useState('1');\n\n    if (!isOpen) return null;\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (description && price) {\n            onConfirm({\n                description,\n                price: parseInt(price),\n                quantity: parseInt(quantity)\n            });\n            // Reset\n            setDescription('');\n            setPrice('');\n            setQuantity('1');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-slate-900 p-4 border-b border-slate-800 text-white\">\n                    <h3 className=\"text-lg font-bold flex items-center gap-2\">\n                        <PlusCircle className=\"text-cyan-400\" /> √çtem Manual / Vario\n                    </h3>\n                </div>\n\n                <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n                    <div>\n                        <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Descripci√≥n</label>\n                        <input\n                            type=\"text\"\n                            autoFocus\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                            placeholder=\"Ej: Servicio Inyectable\"\n                            value={description}\n                            onChange={(e) => setDescription(e.target.value)}\n                        />\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Precio Unit.</label>\n                            <div className=\"relative\">\n                                <DollarSign size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" />\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full pl-8 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                                    placeholder=\"0\"\n                                    value={price}\n                                    onChange={(e) => setPrice(e.target.value)}\n                                />\n                            </div>\n                        </div>\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Cantidad</label>\n                            <div className=\"relative\">\n                                <Package size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" />\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full pl-8 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                                    value={quantity}\n                                    onChange={(e) => setQuantity(e.target.value)}\n                                />\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"flex gap-3 pt-4\">\n                        <button\n                            type=\"button\"\n                            onClick={onClose}\n                            className=\"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl transition\"\n                        >\n                            Cancelar\n                        </button>\n                        <button\n                            type=\"submit\"\n                            className=\"flex-1 py-3 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition shadow-lg shadow-cyan-200\"\n                        >\n                            Agregar\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n};\n\nexport default ManualItemModal;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;;;;;AAQA,MAAM,kBAAkD,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE;;IACnF,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IAEzC,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,eAAe,CAAC;QAClB,EAAE,cAAc;QAChB,IAAI,eAAe,OAAO;YACtB,UAAU;gBACN;gBACA,OAAO,SAAS;gBAChB,UAAU,SAAS;YACvB;YACA,QAAQ;YACR,eAAe;YACf,SAAS;YACT,YAAY;QAChB;IACJ;IAEA,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;8BACX,cAAA,6LAAC;wBAAG,WAAU;;0CACV,6LAAC,mOAAU;gCAAC,WAAU;;;;;;4BAAkB;;;;;;;;;;;;8BAIhD,6LAAC;oBAAK,UAAU;oBAAc,WAAU;;sCACpC,6LAAC;;8CACG,6LAAC;oCAAM,WAAU;8CAAwD;;;;;;8CACzE,6LAAC;oCACG,MAAK;oCACL,SAAS;oCACT,WAAU;oCACV,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;sCAItD,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;;sDACG,6LAAC;4CAAM,WAAU;sDAAwD;;;;;;sDACzE,6LAAC;4CAAI,WAAU;;8DACX,6LAAC,mOAAU;oDAAC,MAAM;oDAAI,WAAU;;;;;;8DAChC,6LAAC;oDACG,MAAK;oDACL,WAAU;oDACV,aAAY;oDACZ,OAAO;oDACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;;;8CAIpD,6LAAC;;sDACG,6LAAC;4CAAM,WAAU;sDAAwD;;;;;;sDACzE,6LAAC;4CAAI,WAAU;;8DACX,6LAAC,sNAAO;oDAAC,MAAM;oDAAI,WAAU;;;;;;8DAC7B,6LAAC;oDACG,MAAK;oDACL,WAAU;oDACV,OAAO;oDACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;;;;;;;;;sCAM3D,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCACG,MAAK;oCACL,SAAS;oCACT,WAAU;8CACb;;;;;;8CAGD,6LAAC;oCACG,MAAK;oCACL,WAAU;8CACb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQzB;GA3FM;KAAA;uCA6FS"}},
    {"offset": {"line": 537, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/CashManagementModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, DollarSign, Camera, AlertTriangle, CheckCircle, TrendingDown, TrendingUp, Lock, ChevronDown, ChevronUp } from 'lucide-react';\nimport { CashMovementReason } from '../../../domain/types';\nimport { SupervisorOverrideModal } from '../security/SupervisorOverrideModal';\n\ninterface CashManagementModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst CashManagementModal: React.FC<CashManagementModalProps> = ({ isOpen, onClose }) => {\n    const { currentShift, openShift, closeShift, registerCashMovement, getShiftMetrics } = usePharmaStore();\n    const [activeTab, setActiveTab] = useState<'OPENING' | 'EXPENSE' | 'CLOSING'>('OPENING');\n\n    // Security State\n    const [isSupervisorModalOpen, setIsSupervisorModalOpen] = useState(false);\n    const [supervisorAction, setSupervisorAction] = useState<'OPEN' | 'CLOSE' | 'AUDIT' | null>(null);\n    const [isAuditVisible, setIsAuditVisible] = useState(false);\n\n    // Opening State\n    const [openingAmount, setOpeningAmount] = useState('');\n\n    // Expense State\n    const [expenseAmount, setExpenseAmount] = useState('');\n    const [expenseReason, setExpenseReason] = useState<CashMovementReason>('SUPPLIES');\n    const [expenseDescription, setExpenseDescription] = useState('');\n    const [expenseEvidence, setExpenseEvidence] = useState<string | null>(null);\n\n    // Closing State\n    const [closingAmount, setClosingAmount] = useState('');\n    const [metrics, setMetrics] = useState<any>(null);\n    const [expandedSection, setExpandedSection] = useState<'TRANSFER' | 'CARD' | null>(null);\n\n    useEffect(() => {\n        if (isOpen) {\n            if (!currentShift || currentShift.status === 'CLOSED') {\n                setActiveTab('OPENING');\n                setIsAuditVisible(false);\n            } else {\n                setActiveTab('EXPENSE'); // Default to expense if open\n                setMetrics(getShiftMetrics());\n                setIsAuditVisible(false); // Reset audit visibility on open\n            }\n        }\n    }, [isOpen, currentShift]);\n\n    useEffect(() => {\n        if (currentShift?.status === 'OPEN') {\n            const interval = setInterval(() => {\n                setMetrics(getShiftMetrics());\n            }, 1000); // Update metrics every second\n            return () => clearInterval(interval);\n        }\n    }, [currentShift]);\n\n\n    const handleOpenShiftRequest = () => {\n        const amount = parseInt(openingAmount);\n        if (isNaN(amount) || amount < 0) return;\n        setSupervisorAction('OPEN');\n        setIsSupervisorModalOpen(true);\n    };\n\n    const handleCloseShiftRequest = () => {\n        const amount = parseInt(closingAmount);\n        if (isNaN(amount) || amount < 0) return;\n        setSupervisorAction('CLOSE');\n        setIsSupervisorModalOpen(true);\n    };\n\n    const handleAuditRequest = () => {\n        setSupervisorAction('AUDIT');\n        setIsSupervisorModalOpen(true);\n    };\n\n    const handleSupervisorAuthorize = (authorizedBy: string) => {\n        if (supervisorAction === 'OPEN') {\n            const amount = parseInt(openingAmount);\n            openShift(amount, authorizedBy);\n            setActiveTab('EXPENSE');\n        } else if (supervisorAction === 'CLOSE') {\n            const amount = parseInt(closingAmount);\n            closeShift(amount, authorizedBy);\n            onClose();\n        } else if (supervisorAction === 'AUDIT') {\n            setIsAuditVisible(true);\n            setActiveTab('CLOSING'); // Switch to closing tab to see metrics\n        }\n        setIsSupervisorModalOpen(false);\n        setSupervisorAction(null);\n    };\n\n    const handleRegisterExpense = () => {\n        const amount = parseInt(expenseAmount);\n        if (isNaN(amount) || amount <= 0) return;\n        if (!expenseEvidence && expenseDescription.length < 10) return; // Validation rule\n\n        registerCashMovement({\n            type: 'OUT',\n            amount,\n            reason: expenseReason,\n            description: expenseDescription,\n            evidence_url: expenseEvidence || undefined,\n            is_cash: true\n        });\n\n        // Reset form\n        setExpenseAmount('');\n        setExpenseDescription('');\n        setExpenseEvidence(null);\n        alert('Gasto registrado correctamente');\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <>\n            <AnimatePresence>\n                <motion.div\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    exit={{ opacity: 0 }}\n                    className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\"\n                >\n                    <motion.div\n                        initial={{ scale: 0.95, opacity: 0 }}\n                        animate={{ scale: 1, opacity: 1 }}\n                        exit={{ scale: 0.95, opacity: 0 }}\n                        className=\"bg-white rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]\"\n                    >\n                        {/* Header */}\n                        <div className=\"p-6 border-b border-gray-100 flex justify-between items-center bg-slate-50\">\n                            <div>\n                                <h2 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\n                                    <DollarSign className=\"text-blue-600\" />\n                                    Gesti√≥n de Caja\n                                </h2>\n                                <p className=\"text-sm text-slate-500\">\n                                    {currentShift?.status === 'OPEN' ? `Turno #${currentShift.shiftNumber} - Abierto` : 'Caja Cerrada'}\n                                </p>\n                            </div>\n                            <button onClick={onClose} className=\"text-slate-400 hover:text-slate-600\">\n                                <X size={24} />\n                            </button>\n                        </div>\n\n                        {/* Tabs (Only visible if shift is open) */}\n                        {currentShift?.status === 'OPEN' && (\n                            <div className=\"flex border-b border-gray-100\">\n                                <button\n                                    onClick={() => setActiveTab('EXPENSE')}\n                                    className={`flex-1 py-4 text-sm font-semibold transition-colors ${activeTab === 'EXPENSE' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50' : 'text-slate-500 hover:bg-slate-50'}`}\n                                >\n                                    Registrar Salida/Gasto\n                                </button>\n                                <button\n                                    onClick={() => setActiveTab('CLOSING')}\n                                    className={`flex-1 py-4 text-sm font-semibold transition-colors ${activeTab === 'CLOSING' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50' : 'text-slate-500 hover:bg-slate-50'}`}\n                                >\n                                    Arqueo y Cierre\n                                </button>\n                            </div>\n                        )}\n\n                        {/* Content */}\n                        <div className=\"p-6 overflow-y-auto flex-1\">\n\n                            {/* A. OPENING */}\n                            {activeTab === 'OPENING' && (\n                                <div className=\"text-center py-8\">\n                                    <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-600\">\n                                        <Lock size={40} />\n                                    </div>\n                                    <h3 className=\"text-2xl font-bold text-slate-800 mb-2\">Apertura de Caja</h3>\n                                    <p className=\"text-slate-500 mb-8\">Ingresa el monto de dinero sencillo con el que inicias el turno.</p>\n\n                                    <div className=\"max-w-xs mx-auto\">\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-2 text-left\">Monto Inicial</label>\n                                        <div className=\"relative\">\n                                            <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-lg\">$</span>\n                                            <input\n                                                type=\"number\"\n                                                value={openingAmount}\n                                                onChange={(e) => setOpeningAmount(e.target.value)}\n                                                className=\"w-full pl-8 pr-4 py-4 text-2xl font-bold text-slate-800 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all\"\n                                                placeholder=\"0\"\n                                                autoFocus\n                                            />\n                                        </div>\n                                        <button\n                                            onClick={handleOpenShiftRequest}\n                                            disabled={!openingAmount}\n                                            className=\"w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold shadow-lg shadow-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all\"\n                                        >\n                                            Solicitar Apertura (Supervisor)\n                                        </button>\n                                    </div>\n                                </div>\n                            )}\n\n                            {/* B. EXPENSE */}\n                            {activeTab === 'EXPENSE' && (\n                                <div className=\"space-y-6\">\n                                    <div className=\"grid grid-cols-2 gap-6\">\n                                        <div>\n                                            <label className=\"block text-sm font-medium text-slate-700 mb-2\">Monto a Retirar</label>\n                                            <div className=\"relative\">\n                                                <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\">$</span>\n                                                <input\n                                                    type=\"number\"\n                                                    value={expenseAmount}\n                                                    onChange={(e) => setExpenseAmount(e.target.value)}\n                                                    className=\"w-full pl-8 pr-4 py-3 text-lg font-bold text-slate-800 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none\"\n                                                    placeholder=\"0\"\n                                                />\n                                            </div>\n                                        </div>\n                                        <div>\n                                            <label className=\"block text-sm font-medium text-slate-700 mb-2\">Motivo</label>\n                                            <select\n                                                value={expenseReason}\n                                                onChange={(e) => setExpenseReason(e.target.value as CashMovementReason)}\n                                                className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none\"\n                                            >\n                                                <option value=\"SUPPLIES\">Insumos / Gastos Menores</option>\n                                                <option value=\"SERVICES\">Pago Servicios</option>\n                                                <option value=\"WITHDRAWAL\">Retiro de Utilidades</option>\n                                                <option value=\"OTHER\">Otro</option>\n                                            </select>\n                                        </div>\n                                    </div>\n\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">Descripci√≥n / Justificaci√≥n</label>\n                                        <textarea\n                                            value={expenseDescription}\n                                            onChange={(e) => setExpenseDescription(e.target.value)}\n                                            className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none h-24 resize-none\"\n                                            placeholder=\"Detalla el gasto (m√≠nimo 10 caracteres si no hay foto)...\"\n                                        />\n                                    </div>\n\n                                    <div className=\"border-2 border-dashed border-slate-300 rounded-xl p-6 text-center hover:bg-slate-50 transition-colors cursor-pointer relative\">\n                                        <input\n                                            type=\"file\"\n                                            className=\"absolute inset-0 opacity-0 cursor-pointer\"\n                                            onChange={(e) => setExpenseEvidence('https://via.placeholder.com/300')} // Mock upload\n                                        />\n                                        {expenseEvidence ? (\n                                            <div className=\"flex items-center justify-center gap-2 text-green-600 font-medium\">\n                                                <CheckCircle size={20} />\n                                                Evidencia Cargada\n                                            </div>\n                                        ) : (\n                                            <div className=\"flex flex-col items-center gap-2 text-slate-400\">\n                                                <Camera size={32} />\n                                                <span className=\"text-sm font-medium\">Subir Foto Boleta / Comprobante</span>\n                                            </div>\n                                        )}\n                                    </div>\n\n                                    <button\n                                        onClick={handleRegisterExpense}\n                                        disabled={!expenseAmount || (!expenseEvidence && expenseDescription.length < 10)}\n                                        className=\"w-full bg-red-500 hover:bg-red-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-red-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2\"\n                                    >\n                                        <TrendingDown size={20} />\n                                        Registrar Salida de Efectivo\n                                    </button>\n                                </div>\n                            )}\n\n                            {/* C. CLOSING (RECONCILIATION) */}\n                            {activeTab === 'CLOSING' && metrics && (\n                                <div className=\"space-y-6\">\n                                    {/* Waterfall */}\n                                    <div className=\"space-y-3 bg-slate-50 p-6 rounded-2xl border border-slate-100 relative overflow-hidden\">\n                                        {!isAuditVisible && (\n                                            <div className=\"absolute inset-0 bg-slate-100/80 backdrop-blur-sm flex items-center justify-center z-10\">\n                                                <button\n                                                    onClick={handleAuditRequest}\n                                                    className=\"bg-white text-blue-600 px-6 py-3 rounded-xl font-bold shadow-lg border border-blue-100 flex items-center gap-2 hover:bg-blue-50 transition-colors\"\n                                                >\n                                                    <Lock size={18} />\n                                                    Revelar Totales (Supervisor)\n                                                </button>\n                                            </div>\n                                        )}\n\n                                        <div className=\"flex justify-between items-center text-slate-600\">\n                                            <span>(+) Ventas Totales</span>\n                                            <span className=\"font-medium\">${metrics.totalSales.toLocaleString()}</span>\n                                        </div>\n\n                                        {/* Transfer Accordion */}\n                                        <div className=\"border border-slate-200 rounded-lg overflow-hidden\">\n                                            <button\n                                                onClick={() => setExpandedSection(expandedSection === 'TRANSFER' ? null : 'TRANSFER')}\n                                                className=\"w-full flex justify-between items-center p-3 bg-slate-50 hover:bg-slate-100 transition-colors\"\n                                            >\n                                                <div className=\"flex items-center gap-2 text-purple-600 font-medium text-sm\">\n                                                    <ChevronDown size={16} className={`transition-transform ${expandedSection === 'TRANSFER' ? 'rotate-180' : ''}`} />\n                                                    üì± Transferencias ({metrics.transferCount})\n                                                </div>\n                                                <span className=\"font-bold text-slate-700\">-${metrics.transferSales.toLocaleString()}</span>\n                                            </button>\n                                            {expandedSection === 'TRANSFER' && (\n                                                <div className=\"bg-white p-3 text-xs max-h-40 overflow-y-auto\">\n                                                    <table className=\"w-full text-left\">\n                                                        <thead className=\"text-slate-400 border-b border-slate-100\">\n                                                            <tr>\n                                                                <th className=\"pb-2\">Hora</th>\n                                                                <th className=\"pb-2\">Folio</th>\n                                                                <th className=\"pb-2 text-right\">Monto</th>\n                                                            </tr>\n                                                        </thead>\n                                                        <tbody className=\"divide-y divide-slate-50\">\n                                                            {metrics.transferSalesList?.map((sale: any) => (\n                                                                <tr key={sale.id}>\n                                                                    <td className=\"py-2 text-slate-500\">{new Date(sale.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</td>\n                                                                    <td className=\"py-2 font-mono text-slate-600\">{sale.transfer_id || 'PENDIENTE'}</td>\n                                                                    <td className=\"py-2 text-right font-bold text-slate-800\">${sale.total.toLocaleString()}</td>\n                                                                </tr>\n                                                            ))}\n                                                        </tbody>\n                                                    </table>\n                                                </div>\n                                            )}\n                                        </div>\n\n                                        {/* Card Accordion */}\n                                        <div className=\"border border-slate-200 rounded-lg overflow-hidden\">\n                                            <button\n                                                onClick={() => setExpandedSection(expandedSection === 'CARD' ? null : 'CARD')}\n                                                className=\"w-full flex justify-between items-center p-3 bg-slate-50 hover:bg-slate-100 transition-colors\"\n                                            >\n                                                <div className=\"flex items-center gap-2 text-blue-600 font-medium text-sm\">\n                                                    <ChevronDown size={16} className={`transition-transform ${expandedSection === 'CARD' ? 'rotate-180' : ''}`} />\n                                                    üí≥ Tarjetas ({metrics.cardCount})\n                                                </div>\n                                                <span className=\"font-bold text-slate-700\">-${metrics.cardSales.toLocaleString()}</span>\n                                            </button>\n                                            {expandedSection === 'CARD' && (\n                                                <div className=\"bg-white p-3 text-xs max-h-40 overflow-y-auto\">\n                                                    <div className=\"space-y-2\">\n                                                        {metrics.cardSalesList?.map((sale: any) => (\n                                                            <div key={sale.id} className=\"flex justify-between items-center py-1 border-b border-slate-50 last:border-0\">\n                                                                <span className=\"text-slate-500\">{new Date(sale.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>\n                                                                <span className=\"font-bold text-slate-800\">${sale.total.toLocaleString()}</span>\n                                                            </div>\n                                                        ))}\n                                                    </div>\n                                                </div>\n                                            )}\n                                        </div>\n\n                                        <div className=\"flex justify-between items-center text-green-600 text-sm mt-2\">\n                                            <span>(+) Fondo Inicial</span>\n                                            <span>+${metrics.initialFund.toLocaleString()}</span>\n                                        </div>\n                                        <div className=\"flex justify-between items-center text-red-500 text-sm\">\n                                            <span>(-) Gastos / Salidas</span>\n                                            <span>-${metrics.totalOutflows.toLocaleString()}</span>\n                                        </div>\n                                        <div className=\"h-px bg-slate-200 my-2\"></div>\n                                        <div className=\"flex justify-between items-center text-xl font-bold text-slate-800\">\n                                            <span>(=) DEBE HABER EN CAJA</span>\n                                            <span>${metrics.expectedCash.toLocaleString()}</span>\n                                        </div>\n                                    </div>\n\n                                    <div className=\"bg-blue-50 p-6 rounded-2xl border border-blue-100\">\n                                        <label className=\"block text-sm font-bold text-blue-900 mb-2 text-center\">DINERO CONTADO REAL (ARQUEO)</label>\n                                        <div className=\"relative max-w-xs mx-auto\">\n                                            <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-blue-400 text-xl\">$</span>\n                                            <input\n                                                type=\"number\"\n                                                value={closingAmount}\n                                                onChange={(e) => setClosingAmount(e.target.value)}\n                                                className=\"w-full pl-8 pr-4 py-4 text-3xl font-bold text-blue-900 bg-white border-2 border-blue-200 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-400 outline-none text-center\"\n                                                placeholder=\"0\"\n                                            />\n                                        </div>\n\n                                        {closingAmount && isAuditVisible && (\n                                            <div className={`mt-4 text-center font-bold p-3 rounded-lg ${parseInt(closingAmount) - metrics.expectedCash === 0 ? 'bg-green-100 text-green-700' :\n                                                parseInt(closingAmount) - metrics.expectedCash > 0 ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'\n                                                }`}>\n                                                {parseInt(closingAmount) - metrics.expectedCash === 0 ? 'Cuadratura Perfecta ‚ú®' :\n                                                    parseInt(closingAmount) - metrics.expectedCash > 0 ? `Sobrante: +$${(parseInt(closingAmount) - metrics.expectedCash).toLocaleString()}` :\n                                                        `Faltante: -$${Math.abs(parseInt(closingAmount) - metrics.expectedCash).toLocaleString()}`}\n                                            </div>\n                                        )}\n                                    </div>\n\n                                    <button\n                                        onClick={handleCloseShiftRequest}\n                                        disabled={!closingAmount}\n                                        className=\"w-full bg-slate-900 hover:bg-slate-800 text-white py-4 rounded-xl font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2\"\n                                    >\n                                        <Lock size={20} />\n                                        Cerrar Turno y Generar Reporte\n                                    </button>\n                                </div>\n                            )}\n                        </div>\n                    </motion.div>\n                </motion.div>\n            </AnimatePresence>\n\n            <SupervisorOverrideModal\n                isOpen={isSupervisorModalOpen}\n                onClose={() => setIsSupervisorModalOpen(false)}\n                onAuthorize={handleSupervisorAuthorize}\n                actionDescription={\n                    supervisorAction === 'OPEN' ? 'Autorizar APERTURA de turno' :\n                        supervisorAction === 'CLOSE' ? 'Autorizar CIERRE de turno' :\n                            'Autorizar ARQUEO (Ver Totales)'\n                }\n            />\n        </>\n    );\n};\n\nexport default CashManagementModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1622, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/CashOutModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { X, DollarSign, AlertTriangle, Lock } from 'lucide-react';\nimport { PrinterService } from '../../../domain/services/PrinterService';\nimport { toast } from 'sonner';\n\ninterface CashOutModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst CashOutModal: React.FC<CashOutModalProps> = ({ isOpen, onClose }) => {\n    const { registerCashMovement, employees, currentShift, printerConfig } = usePharmaStore();\n\n    const [amount, setAmount] = useState('');\n    const [description, setDescription] = useState('');\n    const [type, setType] = useState<'GASTO' | 'RETIRO' | 'ADELANTO'>('GASTO');\n    const [pin, setPin] = useState('');\n    const [error, setError] = useState('');\n\n    if (!isOpen) return null;\n\n    const handleSave = () => {\n        if (!amount || !description || !pin) {\n            setError('Todos los campos son obligatorios');\n            return;\n        }\n\n        // Validate PIN (Manager/Admin only)\n        const supervisor = employees.find(e => (e.role === 'MANAGER' || e.role === 'ADMIN') && e.access_pin === pin);\n\n        if (!supervisor) {\n            setError('PIN no autorizado o incorrecto');\n            return;\n        }\n\n        if (!currentShift) {\n            setError('No hay turno de caja abierto');\n            return;\n        }\n\n        // Register Movement\n        const movement = {\n            type: 'OUT' as const,\n            amount: Number(amount),\n            description: `[${type}] ${description} (Auth: ${supervisor.name})`,\n            reason: (type === 'RETIRO' || type === 'ADELANTO' ? 'WITHDRAWAL' : 'SUPPLIES') as any,\n            is_cash: true\n        };\n\n        registerCashMovement(movement);\n\n        // ...\n\n        // Auto-Print\n        PrinterService.printVoucher({\n            ...movement,\n            id: `MOV-${Date.now()}`,\n            timestamp: Date.now(),\n            shift_id: currentShift.id,\n            user_id: supervisor.id\n        }, printerConfig);\n\n        toast.success('Retiro registrado y caj√≥n abierto.');\n        onClose();\n\n        // Reset form\n        setAmount('');\n        setDescription('');\n        setPin('');\n        setError('');\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50\">\n                    <h3 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\n                        <DollarSign className=\"text-red-500\" /> Retiro de Caja\n                    </h3>\n                    <button onClick={onClose}><X className=\"text-slate-400 hover:text-slate-600\" /></button>\n                </div>\n\n                <div className=\"p-6 space-y-4\">\n                    {/* Type Selector */}\n                    <div className=\"grid grid-cols-3 gap-2\">\n                        {(['GASTO', 'RETIRO', 'ADELANTO'] as const).map((t) => (\n                            <button\n                                key={t}\n                                onClick={() => setType(t)}\n                                className={`py-2 px-1 rounded-xl text-xs font-bold border-2 transition-all ${type === t\n                                    ? 'border-red-500 bg-red-50 text-red-700'\n                                    : 'border-slate-100 text-slate-400 hover:bg-slate-50'\n                                    }`}\n                            >\n                                {t}\n                            </button>\n                        ))}\n                    </div>\n\n                    {/* Amount */}\n                    <div>\n                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Monto a Retirar</label>\n                        <div className=\"relative\">\n                            <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold\">$</span>\n                            <input\n                                type=\"number\"\n                                className=\"w-full pl-8 pr-4 py-3 border-2 border-slate-200 rounded-xl font-bold text-xl focus:border-red-500 focus:outline-none\"\n                                placeholder=\"0\"\n                                value={amount}\n                                onChange={(e) => setAmount(e.target.value)}\n                            />\n                        </div>\n                    </div>\n\n                    {/* Description */}\n                    <div>\n                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Motivo / Descripci√≥n</label>\n                        <textarea\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-red-500 focus:outline-none text-sm\"\n                            rows={2}\n                            placeholder=\"Ej: Compra de art√≠culos de aseo...\"\n                            value={description}\n                            onChange={(e) => setDescription(e.target.value)}\n                        />\n                    </div>\n\n                    {/* Security PIN */}\n                    <div className=\"bg-red-50 p-4 rounded-xl border border-red-100\">\n                        <div className=\"flex items-center gap-2 mb-2 text-red-800 font-bold text-xs uppercase tracking-wider\">\n                            <Lock size={12} /> Autorizaci√≥n Requerida\n                        </div>\n                        <input\n                            type=\"password\"\n                            maxLength={4}\n                            className=\"w-full p-3 border-2 border-red-200 rounded-xl font-bold text-center tracking-[1em] focus:border-red-500 focus:outline-none bg-white\"\n                            placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                            value={pin}\n                            onChange={(e) => {\n                                setPin(e.target.value);\n                                setError('');\n                            }}\n                        />\n                        <p className=\"text-[10px] text-red-600/70 text-center mt-2\">PIN de Gerente o Administrador</p>\n                    </div>\n\n                    {error && (\n                        <div className=\"flex items-center gap-2 text-red-600 text-xs font-bold bg-red-50 p-3 rounded-lg\">\n                            <AlertTriangle size={16} /> {error}\n                        </div>\n                    )}\n\n                    <button\n                        onClick={handleSave}\n                        className=\"w-full py-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg shadow-red-200\"\n                    >\n                        Confirmar Retiro\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default CashOutModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1941, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/QuickFractionModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { X, Scissors, Calculator } from 'lucide-react';\nimport { InventoryBatch, Customer } from '../../../domain/types';\nimport { usePharmaStore } from '../../store/useStore';\n\ninterface QuickFractionModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    product: InventoryBatch | null;\n    onConfirm: (quantity: number, price: number) => void;\n}\n\nconst QuickFractionModal: React.FC<QuickFractionModalProps> = ({ isOpen, onClose, product, onConfirm }) => {\n    const [quantity, setQuantity] = useState<string>('');\n    const inputRef = useRef<HTMLInputElement>(null);\n    const { currentCustomer } = usePharmaStore();\n\n    useEffect(() => {\n        if (isOpen) {\n            setQuantity('');\n            setTimeout(() => {\n                inputRef.current?.focus();\n            }, 100);\n        }\n    }, [isOpen]);\n\n    if (!isOpen || !product) return null;\n\n    const qty = parseInt(quantity) || 0;\n    const unitPrice = product.fractional_price || Math.ceil(product.price / (product.units_per_box || 1));\n    const totalPrice = qty * unitPrice;\n\n    const handleConfirm = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (qty > 0) {\n            onConfirm(qty, totalPrice);\n            onClose();\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200\">\n                {/* Header */}\n                <div className=\"bg-gradient-to-r from-blue-600 to-cyan-600 p-6 text-white flex justify-between items-center\">\n                    <div className=\"flex items-center gap-3\">\n                        <div className=\"bg-white/20 p-2 rounded-xl\">\n                            <Scissors size={24} />\n                        </div>\n                        <div>\n                            <h3 className=\"text-xl font-bold\">Venta Fraccionada</h3>\n                            <p className=\"text-blue-100 text-sm font-medium\">Art. 19 A - Venta por Unidad</p>\n                        </div>\n                    </div>\n                    <button onClick={onClose} className=\"text-white/80 hover:text-white hover:bg-white/10 p-2 rounded-full transition\">\n                        <X size={24} />\n                    </button>\n                </div>\n\n                <div className=\"p-8\">\n                    {/* Product Info */}\n                    <div className=\"mb-8 text-center\">\n                        <h4 className=\"text-lg font-bold text-slate-800 mb-1\">{product.name}</h4>\n                        <p className=\"text-slate-500 text-sm mb-4\">{product.dci} - {product.laboratory}</p>\n                        <div className=\"inline-flex items-center gap-2 bg-blue-50 text-blue-700 px-4 py-2 rounded-full font-bold text-sm\">\n                            <span>Precio Unitario: ${unitPrice.toLocaleString()}</span>\n                        </div>\n                    </div>\n\n                    <form onSubmit={handleConfirm}>\n                        <div className=\"mb-8\">\n                            <label className=\"block text-center text-sm font-bold text-slate-500 mb-3 uppercase tracking-wider\">\n                                ¬øCu√°ntas unidades?\n                            </label>\n                            <div className=\"relative max-w-[200px] mx-auto\">\n                                <input\n                                    ref={inputRef}\n                                    type=\"number\"\n                                    min=\"1\"\n                                    className=\"w-full text-center text-5xl font-black text-slate-800 border-b-4 border-blue-500 focus:outline-none focus:border-cyan-400 py-2 bg-transparent placeholder-slate-200\"\n                                    placeholder=\"0\"\n                                    value={quantity}\n                                    onChange={(e) => setQuantity(e.target.value)}\n                                />\n                            </div>\n                        </div>\n\n                        {/* Calculation Preview */}\n                        <div className=\"bg-slate-50 rounded-2xl p-6 mb-8 flex items-center justify-between border border-slate-100\">\n                            <div className=\"flex items-center gap-3 text-slate-400\">\n                                <Calculator size={20} />\n                                <span className=\"font-medium text-lg\">{qty} x ${unitPrice.toLocaleString()}</span>\n                            </div>\n                            <div className=\"text-right\">\n                                <p className=\"text-xs font-bold text-slate-400 uppercase mb-1\">Total a Cobrar</p>\n                                <p className=\"text-3xl font-black text-slate-900\">${totalPrice.toLocaleString()}</p>\n                            </div>\n                        </div>\n\n                        {/* Customer Info (Read Only) */}\n                        {currentCustomer ? (\n                            <div className=\"mb-6 bg-emerald-50 border border-emerald-100 p-3 rounded-xl flex items-center gap-3 text-emerald-700 text-sm font-bold\">\n                                <div className=\"w-2 h-2 rounded-full bg-emerald-500\" />\n                                Cliente: {currentCustomer.fullName}\n                            </div>\n                        ) : (\n                            <div className=\"mb-6 bg-slate-50 border border-slate-100 p-3 rounded-xl text-center text-slate-400 text-xs\">\n                                Sin cliente asignado (Venta Gen√©rica)\n                            </div>\n                        )}\n\n                        <button\n                            type=\"submit\"\n                            disabled={qty <= 0}\n                            className=\"w-full py-4 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-lg\"\n                        >\n                            <Scissors size={20} />\n                            Agregar al Carrito\n                        </button>\n                    </form>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default QuickFractionModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2300, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/CustomerCaptureModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { User, UserPlus, ArrowRight, X, Check } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\ninterface CustomerCaptureModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onConfirm: (customerRut: string) => void;\n    onSkip: () => void;\n}\n\nconst CustomerCaptureModal: React.FC<CustomerCaptureModalProps> = ({ isOpen, onClose, onConfirm, onSkip }) => {\n    const { customers, addCustomer } = usePharmaStore();\n    const [rut, setRut] = useState('');\n    const [name, setName] = useState('');\n    const [phone, setPhone] = useState('');\n    const [isNewCustomer, setIsNewCustomer] = useState(false);\n    const [foundCustomer, setFoundCustomer] = useState<any>(null);\n    const inputRef = useRef<HTMLInputElement>(null);\n\n    useEffect(() => {\n        if (isOpen) {\n            setRut('');\n            setName('');\n            setPhone('');\n            setIsNewCustomer(false);\n            setFoundCustomer(null);\n            setTimeout(() => inputRef.current?.focus(), 100);\n        }\n    }, [isOpen]);\n\n    // Keyboard Shortcuts\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if (!isOpen) return;\n            if (e.key === 'Escape') onSkip();\n        };\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [isOpen, onSkip]);\n\n    const formatRut = (value: string) => {\n        const clean = value.replace(/[^0-9kK]/g, '');\n        if (clean.length <= 1) return clean;\n        const body = clean.slice(0, -1);\n        const dv = clean.slice(-1).toUpperCase();\n        let formattedBody = '';\n        for (let i = body.length - 1, j = 0; i >= 0; i--, j++) {\n            formattedBody = body.charAt(i) + (j > 0 && j % 3 === 0 ? '.' : '') + formattedBody;\n        }\n        return `${formattedBody}-${dv}`;\n    };\n\n    const handleRutChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const val = formatRut(e.target.value);\n        setRut(val);\n\n        // Real-time search\n        if (val.length >= 8) {\n            const existing = customers.find(c => c.rut === val);\n            if (existing) {\n                setFoundCustomer(existing);\n                setIsNewCustomer(false);\n            } else {\n                setFoundCustomer(null);\n                // If it looks like a complete RUT, assume new\n                if (val.length >= 9) setIsNewCustomer(true);\n            }\n        } else {\n            setFoundCustomer(null);\n            setIsNewCustomer(false);\n        }\n    };\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (foundCustomer) {\n            onConfirm(foundCustomer.rut);\n        } else if (isNewCustomer && name) {\n            // Register new\n            const newCust = addCustomer({\n                rut,\n                fullName: name,\n                phone,\n                registrationSource: 'POS'\n            });\n            onConfirm(newCust.rut);\n        }\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/70 backdrop-blur-sm z-[60] flex items-center justify-center p-4\">\n            <motion.div\n                initial={{ scale: 0.9, opacity: 0 }}\n                animate={{ scale: 1, opacity: 1 }}\n                className=\"bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden\"\n            >\n                <div className=\"p-6 bg-slate-900 text-white flex justify-between items-center\">\n                    <h3 className=\"text-xl font-bold flex items-center gap-2\">\n                        <User className=\"text-cyan-400\" /> ¬øA qui√©n vendemos?\n                    </h3>\n                    <button onClick={onSkip} className=\"text-slate-400 hover:text-white text-xs font-bold uppercase tracking-wider\">\n                        Omitir (ESC)\n                    </button>\n                </div>\n\n                <form onSubmit={handleSubmit} className=\"p-8\">\n                    <div className=\"mb-6\">\n                        <label className=\"block text-sm font-bold text-slate-600 mb-2\">RUT del Cliente</label>\n                        <input\n                            ref={inputRef}\n                            type=\"text\"\n                            value={rut}\n                            onChange={handleRutChange}\n                            className=\"w-full p-4 text-3xl font-mono font-bold border-2 border-slate-200 rounded-2xl focus:border-cyan-500 focus:outline-none text-center uppercase\"\n                            placeholder=\"12.345.678-K\"\n                            maxLength={12}\n                        />\n                    </div>\n\n                    <AnimatePresence mode=\"wait\">\n                        {foundCustomer && (\n                            <motion.div\n                                initial={{ opacity: 0, y: 10 }}\n                                animate={{ opacity: 1, y: 0 }}\n                                className=\"bg-emerald-50 border border-emerald-200 rounded-xl p-4 mb-6 flex items-center gap-4\"\n                            >\n                                <div className=\"w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-600\">\n                                    <Check size={24} />\n                                </div>\n                                <div>\n                                    <p className=\"text-emerald-800 font-bold text-lg\">{foundCustomer.fullName}</p>\n                                    <p className=\"text-emerald-600 text-sm\">Cliente Registrado</p>\n                                </div>\n                            </motion.div>\n                        )}\n\n                        {isNewCustomer && !foundCustomer && (\n                            <motion.div\n                                initial={{ opacity: 0, height: 0 }}\n                                animate={{ opacity: 1, height: 'auto' }}\n                                className=\"space-y-4 mb-6 overflow-hidden\"\n                            >\n                                <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-3 text-blue-800 text-sm font-bold flex items-center gap-2\">\n                                    <UserPlus size={16} /> Cliente Nuevo - Registro R√°pido\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Nombre Completo *</label>\n                                    <input\n                                        type=\"text\"\n                                        required\n                                        value={name}\n                                        onChange={(e) => setName(e.target.value)}\n                                        className=\"w-full p-3 border-2 border-slate-200 rounded-xl font-bold focus:border-blue-500 focus:outline-none\"\n                                        placeholder=\"Ej: Juan P√©rez\"\n                                        autoFocus\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Tel√©fono (Opcional)</label>\n                                    <input\n                                        type=\"tel\"\n                                        value={phone}\n                                        onChange={(e) => setPhone(e.target.value)}\n                                        className=\"w-full p-3 border-2 border-slate-200 rounded-xl font-bold focus:border-blue-500 focus:outline-none\"\n                                        placeholder=\"+569...\"\n                                    />\n                                </div>\n                            </motion.div>\n                        )}\n                    </AnimatePresence>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <button\n                            type=\"button\"\n                            onClick={onSkip}\n                            className=\"py-4 rounded-xl font-bold text-slate-500 hover:bg-slate-100 border-2 border-transparent hover:border-slate-200 transition-all\"\n                        >\n                            Omitir\n                        </button>\n                        <button\n                            type=\"submit\"\n                            disabled={!foundCustomer && (!isNewCustomer || !name)}\n                            className=\"py-4 rounded-xl font-bold bg-cyan-600 text-white hover:bg-cyan-700 shadow-lg shadow-cyan-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\n                        >\n                            {foundCustomer ? 'Confirmar' : 'Registrar'} <ArrowRight size={20} />\n                        </button>\n                    </div>\n                </form>\n            </motion.div>\n        </div>\n    );\n};\n\nexport default CustomerCaptureModal;\n"],"names":[],"mappings":"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"}}]
}