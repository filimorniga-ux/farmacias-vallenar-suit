{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/domain/services/TigerDataService.ts"],"sourcesContent":["import { SaleTransaction, InventoryBatch, EmployeeProfile, CashMovement, Expense } from '../types';\n\n/**\n * TigerDataService - Abstraction layer for data persistence\n * \n * This service simulates API calls to Tiger Data with network latency.\n * Functions are prepared for future integration with real API endpoints.\n * \n * Current Mode: SIMULATION (using setTimeout)\n * Future Mode: Replace with fetch/axios calls to Tiger Data API\n */\n\nconst SIMULATE_NETWORK_DELAY = 800; // ms\nconst SIMULATE_FAILURE_RATE = 0.05; // 5% chance of simulated failure\n\n// Simulated in-memory storage (will be replaced by real DB)\nlet inMemoryStorage = {\n    sales: [] as SaleTransaction[],\n    cashMovements: [] as CashMovement[],\n    expenses: [] as Expense[],\n    products: [] as InventoryBatch[],\n    employees: [] as EmployeeProfile[]\n};\n\n/**\n * Simulate network delay and potential failures\n */\nconst simulateNetworkCall = async <T>(\n    operation: () => T,\n    operationName: string\n): Promise<T> => {\n    return new Promise((resolve, reject) => {\n        setTimeout(() => {\n            // Simulate random network failures\n            if (Math.random() < SIMULATE_FAILURE_RATE) {\n                console.error(`‚ùå [Tiger Data] ${operationName} failed (simulated network error)`);\n                reject(new Error(`Network error: ${operationName} failed`));\n                return;\n            }\n\n            try {\n                const result = operation();\n                console.log(`‚úÖ [Tiger Data] ${operationName} successful`);\n                resolve(result);\n            } catch (error) {\n                console.error(`‚ùå [Tiger Data] ${operationName} error:`, error);\n                reject(error);\n            }\n        }, SIMULATE_NETWORK_DELAY);\n    });\n};\n\nexport const TigerDataService = {\n    /**\n     * 1. Fetch Products Catalog for POS\n     * @param locationId - Branch/warehouse location ID\n     * @returns Promise<InventoryBatch[]>\n     * \n     * Future: GET /api/inventory?location={locationId}\n     */\n    fetchProducts: async (locationId: string): Promise<InventoryBatch[]> => {\n        return simulateNetworkCall(() => {\n            // Filter products by location\n            const products = inMemoryStorage.products.filter(\n                p => p.location_id === locationId || p.location_id === 'ALL'\n            );\n\n            console.log(`üì¶ [Tiger Data] Fetched ${products.length} products for location: ${locationId}`);\n            return products;\n        }, 'fetchProducts');\n    },\n\n    /**\n     * 2. Save Sale Transaction (CRITICAL)\n     * @param saleData - Complete sale transaction\n     * @param locationId - Branch where sale occurred\n     * @returns Promise<{ success: boolean; transactionId: string }>\n     * \n     * Future: POST /api/sales\n     */\n    saveSaleTransaction: async (\n        saleData: SaleTransaction,\n        locationId: string\n    ): Promise<{ success: boolean; transactionId: string }> => {\n        return simulateNetworkCall(() => {\n            // Validate sale data\n            if (!saleData.items || saleData.items.length === 0) {\n                throw new Error('Sale must have at least one item');\n            }\n\n            if (saleData.total <= 0) {\n                throw new Error('Sale total must be greater than 0');\n            }\n\n            // Add location metadata\n            const enrichedSale: SaleTransaction = {\n                ...saleData,\n                branch_id: locationId,\n                timestamp: Date.now()\n            };\n\n            // Save to in-memory storage (simulates DB write)\n            inMemoryStorage.sales.push(enrichedSale);\n\n            console.log(`üí∞ [Tiger Data] Sale saved: $${saleData.total.toLocaleString('es-CL')} | Items: ${saleData.items.length} | Payment: ${saleData.payment_method}`);\n\n            return {\n                success: true,\n                transactionId: enrichedSale.id\n            };\n        }, 'saveSaleTransaction');\n    },\n\n    /**\n     * 3. Save Cash Movement (Expenses, Withdrawals, Advances)\n     * @param movement - Cash movement data\n     * @returns Promise<{ success: boolean; movementId: string }>\n     * \n     * Future: POST /api/cash-movements\n     */\n    saveCashMovement: async (\n        movement: CashMovement\n    ): Promise<{ success: boolean; movementId: string }> => {\n        return simulateNetworkCall(() => {\n            // Validate movement\n            if (movement.amount <= 0) {\n                throw new Error('Movement amount must be greater than 0');\n            }\n\n            // Save to in-memory storage\n            inMemoryStorage.cashMovements.push(movement);\n\n            console.log(`üíµ [Tiger Data] Cash movement saved: ${movement.type} | $${movement.amount.toLocaleString('es-CL')}`);\n\n            return {\n                success: true,\n                movementId: movement.id\n            };\n        }, 'saveCashMovement');\n    },\n\n    /**\n     * 4. Save Expense\n     * @param expense - Expense data\n     * @returns Promise<{ success: boolean; expenseId: string }>\n     * \n     * Future: POST /api/expenses\n     */\n    saveExpense: async (\n        expense: Expense\n    ): Promise<{ success: boolean; expenseId: string }> => {\n        return simulateNetworkCall(() => {\n            // Save to in-memory storage\n            inMemoryStorage.expenses.push(expense);\n\n            console.log(`üìù [Tiger Data] Expense saved: ${expense.category} | $${expense.amount.toLocaleString('es-CL')}`);\n\n            return {\n                success: true,\n                expenseId: expense.id\n            };\n        }, 'saveExpense');\n    },\n\n    /**\n     * 5. Fetch Employees (for Login & HR)\n     * @returns Promise<EmployeeProfile[]>\n     * \n     * Future: GET /api/employees\n     */\n    fetchEmployees: async (): Promise<EmployeeProfile[]> => {\n        return simulateNetworkCall(() => {\n            console.log(`üë• [Tiger Data] Fetched ${inMemoryStorage.employees.length} employees`);\n            return inMemoryStorage.employees;\n        }, 'fetchEmployees');\n    },\n\n    /**\n     * 6. Fetch Sales History\n     * @param locationId - Optional location filter\n     * @param startDate - Optional start date filter\n     * @param endDate - Optional end date filter\n     * @returns Promise<SaleTransaction[]>\n     * \n     * Future: GET /api/sales?location={locationId}&start={startDate}&end={endDate}\n     */\n    fetchSalesHistory: async (\n        locationId?: string,\n        startDate?: number,\n        endDate?: number\n    ): Promise<SaleTransaction[]> => {\n        return simulateNetworkCall(() => {\n            let sales = inMemoryStorage.sales;\n\n            // Apply filters\n            if (locationId) {\n                sales = sales.filter(s => s.branch_id === locationId);\n            }\n\n            if (startDate) {\n                sales = sales.filter(s => s.timestamp >= startDate);\n            }\n\n            if (endDate) {\n                sales = sales.filter(s => s.timestamp <= endDate);\n            }\n\n            console.log(`üìä [Tiger Data] Fetched ${sales.length} sales transactions`);\n            return sales;\n        }, 'fetchSalesHistory');\n    },\n\n    /**\n     * 7. Update Inventory Stock\n     * @param productId - Product ID\n     * @param quantity - Quantity to add/subtract\n     * @param operation - 'ADD' or 'SUBTRACT'\n     * @returns Promise<{ success: boolean }>\n     * \n     * Future: PATCH /api/inventory/{productId}\n     */\n    updateInventoryStock: async (\n        productId: string,\n        quantity: number,\n        operation: 'ADD' | 'SUBTRACT'\n    ): Promise<{ success: boolean }> => {\n        return simulateNetworkCall(() => {\n            const product = inMemoryStorage.products.find(p => p.id === productId);\n\n            if (!product) {\n                throw new Error(`Product not found: ${productId}`);\n            }\n\n            if (operation === 'SUBTRACT') {\n                if (product.stock_actual < quantity) {\n                    throw new Error(`Insufficient stock for ${product.name}`);\n                }\n                product.stock_actual -= quantity;\n            } else {\n                product.stock_actual += quantity;\n            }\n\n            console.log(`üì¶ [Tiger Data] Stock updated: ${product.name} | ${operation} ${quantity} | New stock: ${product.stock_actual}`);\n\n            return { success: true };\n        }, 'updateInventoryStock');\n    },\n\n    /**\n     * UTILITY: Initialize in-memory storage with data from store\n     * This is a temporary method for the simulation phase\n     */\n    initializeStorage: (data: {\n        products?: InventoryBatch[];\n        employees?: EmployeeProfile[];\n        sales?: SaleTransaction[];\n        cashMovements?: CashMovement[];\n        expenses?: Expense[];\n    }) => {\n        if (data.products) inMemoryStorage.products = data.products;\n        if (data.employees) inMemoryStorage.employees = data.employees;\n        if (data.sales) inMemoryStorage.sales = data.sales;\n        if (data.cashMovements) inMemoryStorage.cashMovements = data.cashMovements;\n        if (data.expenses) inMemoryStorage.expenses = data.expenses;\n\n        console.log('üîÑ [Tiger Data] Storage initialized with local data');\n    },\n\n    /**\n     * UTILITY: Get current storage state (for debugging)\n     */\n    getStorageState: () => {\n        return {\n            salesCount: inMemoryStorage.sales.length,\n            productsCount: inMemoryStorage.products.length,\n            employeesCount: inMemoryStorage.employees.length,\n            cashMovementsCount: inMemoryStorage.cashMovements.length,\n            expensesCount: inMemoryStorage.expenses.length\n        };\n    }\n};\n\n/**\n * Configuration for future API integration\n * \n * When ready to connect to real Tiger Data API:\n * 1. Replace simulateNetworkCall with actual fetch/axios calls\n * 2. Update API_BASE_URL with production endpoint\n * 3. Add authentication headers\n * 4. Handle real error responses\n */\nexport const TigerDataConfig = {\n    API_BASE_URL: process.env.REACT_APP_TIGER_DATA_URL || 'http://localhost:3001/api',\n    API_TIMEOUT: 10000, // 10 seconds\n    RETRY_ATTEMPTS: 3,\n    ENABLE_CACHE: true,\n    CACHE_DURATION: 5 * 60 * 1000 // 5 minutes\n};\n"],"names":[],"mappings":"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"}}]
}