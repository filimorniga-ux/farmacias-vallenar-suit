{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/store/useStore.ts"],"sourcesContent":["\nimport { create } from 'zustand';\nimport { persist, createJSONStorage } from 'zustand/middleware';\nimport {\n    InventoryBatch, EmployeeProfile, SaleItem, Customer, QueueTicket, Supplier, PurchaseOrder, CartItem, SaleTransaction, Expense, CashShift, CashMovement, CashMovementReason, AttendanceLog,\n    SupplierDocument,\n    PrinterConfig,\n    SiiConfiguration,\n    SiiCaf,\n    DteDocument,\n    DteTipo,\n    Promotion,\n    GiftCard,\n    LoyaltyReward,\n    Shipment,\n    StockTransfer,\n    WarehouseIncident,\n    AttendanceStatus,\n    AttendanceType\n} from '../../domain/types';\nimport { fetchInventory, fetchEmployees } from '../../actions/sync';\n\n// --- DATOS REALES FARMACIAS VALLENAR ---\nconst MOCK_INVENTORY: InventoryBatch[] = [\n    // --- TOP VENTAS & CRÃ“NICOS ---\n    {\n        id: 'P001', sku: '780001', name: 'PARACETAMOL 500MG', dci: 'PARACETAMOL', laboratory: 'Mintlab', condition: 'VD',\n        is_bioequivalent: true, bioequivalent_status: 'BIOEQUIVALENTE', location_id: 'SUCURSAL_CENTRO', aisle: 'GÃ“NDOLA',\n        stock_actual: 2000, stock_min: 200, stock_max: 3000, expiry_date: new Date('2026-12-01').getTime(),\n        price: 990, cost_price: 400,\n        cost_net: 336, tax_percent: 19, price_sell_box: 990, price_sell_unit: 62,\n        category: 'MEDICAMENTO', allows_commission: false, active_ingredients: ['Paracetamol'], therapeutic_tags: ['DOLOR', 'FIEBRE', 'CABEZA'],\n        storage_condition: 'AMBIENTE', concentration: '500mg', format: 'Comprimido', unit_count: 16, is_generic: true,\n        isp_register: 'F-1234/20', units_per_box: 16, unit_format_string: 'Comprimidos', price_per_unit: 62\n    },\n    {\n        id: 'P002', sku: '780002', name: 'LOSARTÃN 50MG', dci: 'LOSARTÃN POTÃSICO', laboratory: 'Lab Chile', condition: 'R',\n        is_bioequivalent: true, bioequivalent_status: 'BIOEQUIVALENTE', location_id: 'SUCURSAL_CENTRO', aisle: 'ESTANTE A1',\n        stock_actual: 500, stock_min: 100, stock_max: 800, expiry_date: new Date('2025-06-01').getTime(),\n        price: 2990, cost_price: 1000,\n        cost_net: 840, tax_percent: 19, price_sell_box: 2990, price_sell_unit: 100,\n        category: 'MEDICAMENTO', allows_commission: false, active_ingredients: ['LosartÃ¡n PotÃ¡sico'], therapeutic_tags: ['HIPERTENSION', 'CORAZON'],\n        contraindications: ['EMBARAZO'], storage_condition: 'AMBIENTE', concentration: '50mg', format: 'Comprimido', unit_count: 30, is_generic: true,\n        isp_register: 'F-9988/21', units_per_box: 30, unit_format_string: 'Comprimidos', price_per_unit: 100\n    },\n    {\n        id: 'P003', sku: '780003', name: 'IBUPROFENO 600MG', dci: 'IBUPROFENO', laboratory: 'Lab Chile', condition: 'VD',\n        is_bioequivalent: true, bioequivalent_status: 'BIOEQUIVALENTE', location_id: 'SUCURSAL_CENTRO', aisle: 'ESTANTE A2',\n        stock_actual: 800, stock_min: 100, stock_max: 1200, expiry_date: new Date('2026-01-01').getTime(),\n        price: 1990, cost_price: 600,\n        cost_net: 504, tax_percent: 19, price_sell_box: 1990, price_sell_unit: 100,\n        category: 'MEDICAMENTO', allows_commission: false, active_ingredients: ['Ibuprofeno'], therapeutic_tags: ['DOLOR', 'INFLAMACION', 'CABEZA'],\n        contraindications: ['ULCERA', 'EMBARAZO'], storage_condition: 'AMBIENTE', concentration: '600mg', format: 'Comprimido', unit_count: 20, is_generic: true,\n        isp_register: 'F-5544/19', units_per_box: 20, unit_format_string: 'Comprimidos', price_per_unit: 100\n    },\n    {\n        id: 'P004', sku: '780004', name: 'EUTIROX 100MCG', dci: 'LEVOTIROXINA', laboratory: 'Merck', condition: 'R',\n        is_bioequivalent: false, bioequivalent_status: 'NO_BIOEQUIVALENTE', location_id: 'SUCURSAL_CENTRO', aisle: 'ESTANTE B1',\n        stock_actual: 150, stock_min: 30, stock_max: 300, expiry_date: new Date('2025-10-01').getTime(),\n        price: 8500, cost_price: 3500,\n        cost_net: 2941, tax_percent: 19, price_sell_box: 8500, price_sell_unit: 170,\n        category: 'MEDICAMENTO', allows_commission: false, active_ingredients: ['Levotiroxina'], therapeutic_tags: ['TIROIDES'],\n        storage_condition: 'AMBIENTE', concentration: '100mcg', format: 'Comprimido', unit_count: 50, is_generic: false,\n        isp_register: 'F-2211/18', units_per_box: 50, unit_format_string: 'Comprimidos', price_per_unit: 170\n    },\n\n    // --- RETAIL & COMISIONABLES ---\n    {\n        id: 'R001', sku: 'RET-01', name: 'MAAM CREMA PRENATAL', dci: 'N/A', laboratory: 'Milab', brand: 'Maam', condition: 'VD',\n        is_bioequivalent: false, bioequivalent_status: 'NO_BIOEQUIVALENTE', location_id: 'SUCURSAL_CENTRO', aisle: 'BELLEZA',\n        stock_actual: 40, stock_min: 10, stock_max: 80, expiry_date: new Date('2027-01-01').getTime(),\n        price: 15847, cost_price: 8000,\n        cost_net: 6722, tax_percent: 19, price_sell_box: 15847, price_sell_unit: 15847,\n        category: 'RETAIL_BELLEZA', allows_commission: true, active_ingredients: [], image_url: '/images/maam.jpg',\n        storage_condition: 'AMBIENTE', concentration: 'N/A', format: 'Crema', unit_count: 1, is_generic: false,\n        isp_register: 'N/A', units_per_box: 1, unit_format_string: 'Unidad', price_per_unit: 15847\n    }\n];\n\nconst MOCK_EMPLOYEES: EmployeeProfile[] = [\n    {\n        id: 'EMP-001',\n        rut: '11.111.111-1',\n        name: 'Miguel PÃ©rez',\n        role: 'MANAGER',\n        access_pin: '9080',\n        status: 'ACTIVE',\n        current_status: 'OUT',\n        base_location_id: 'SUCURSAL_CENTRO',\n        assigned_location_id: 'SUCURSAL_CENTRO',\n        job_title: 'GERENTE_GENERAL',\n        base_salary: 2500000,\n        weekly_hours: 44,\n        pension_fund: 'HABITAT',\n        health_system: 'ISAPRE',\n        mutual_safety: 'ACHS',\n        allowed_modules: ['POS', 'INVENTORY', 'HR', 'REPORTS', 'SUPPLIERS']\n    },\n    {\n        id: 'EMP-002',\n        rut: '22.222.222-2',\n        name: 'Javiera Rojas',\n        role: 'QF',\n        access_pin: '9080',\n        status: 'ACTIVE',\n        current_status: 'OUT',\n        base_location_id: 'SUCURSAL_CENTRO',\n        assigned_location_id: 'SUCURSAL_CENTRO',\n        job_title: 'DIRECTOR_TECNICO',\n        base_salary: 1800000,\n        weekly_hours: 44,\n        pension_fund: 'MODELO',\n        health_system: 'FONASA',\n        allowed_modules: ['POS', 'INVENTORY', 'REPORTS', 'SUPPLIERS']\n    },\n    {\n        id: 'EMP-003',\n        rut: '33.333.333-3',\n        name: 'Camila Cajera',\n        role: 'CASHIER',\n        access_pin: '9080',\n        status: 'ACTIVE',\n        current_status: 'OUT',\n        base_location_id: 'SUCURSAL_CENTRO',\n        assigned_location_id: 'SUCURSAL_CENTRO',\n        job_title: 'CAJERO_VENDEDOR',\n        base_salary: 500000,\n        weekly_hours: 45,\n        pension_fund: 'PROVIDA',\n        health_system: 'FONASA',\n        allowed_modules: ['POS', 'INVENTORY']\n    },\n    {\n        id: 'EMP-004',\n        rut: '44.444.444-4',\n        name: 'Pedro Bodega',\n        role: 'WAREHOUSE',\n        access_pin: '9080',\n        status: 'ACTIVE',\n        current_status: 'OUT',\n        base_location_id: 'BODEGA_CENTRAL',\n        assigned_location_id: 'BODEGA_CENTRAL',\n        job_title: 'ASISTENTE_BODEGA',\n        base_salary: 550000,\n        weekly_hours: 45,\n        pension_fund: 'CAPITAL',\n        health_system: 'FONASA',\n        allowed_modules: ['INVENTORY', 'SUPPLIERS']\n    },\n];\n\n// --- MOCK SUPPLIERS ---\nconst MOCK_SUPPLIERS: Supplier[] = [\n    {\n        id: 'SUP-001',\n        rut: '76.111.111-1',\n        business_name: 'Laboratorio Chile S.A.',\n        fantasy_name: 'LabChile',\n        contact_email: 'ventas@labchile.cl',\n        lead_time_days: 2,\n        contacts: [\n            { name: 'Juan PÃ©rez', role: 'SALES', email: 'juan.perez@labchile.cl', phone: '+56911111111', is_primary: true },\n            { name: 'MarÃ­a GonzÃ¡lez', role: 'BILLING', email: 'facturacion@labchile.cl', phone: '+56911111112', is_primary: false }\n        ],\n        categories: ['MEDICAMENTOS'],\n        payment_terms: '30_DIAS',\n        rating: 5,\n        bank_account: { bank: 'Banco de Chile', account_type: 'CORRIENTE', account_number: '111-222-333', email_notification: 'pagos@labchile.cl' },\n        address: 'Av. Marathon 1315', region: 'RM', city: 'Santiago', commune: 'Ã‘uÃ±oa', postal_code: '7750000',\n        phone_1: '+56223334444', email_orders: 'pedidos@labchile.cl', email_billing: 'facturacion@labchile.cl', sector: 'LABORATORIO', brands: ['LabChile']\n    },\n    {\n        id: 'SUP-002',\n        rut: '76.222.222-2',\n        business_name: 'Novo Nordisk FarmacÃ©utica Ltda.',\n        fantasy_name: 'Novo Nordisk',\n        contact_email: 'orders@novo.com',\n        lead_time_days: 5,\n        contacts: [\n            { name: 'Ana Silva', role: 'SALES', email: 'ana.silva@novo.com', phone: '+56922222222', is_primary: true }\n        ],\n        categories: ['MEDICAMENTOS', 'INSUMOS'],\n        payment_terms: '60_DIAS',\n        rating: 4,\n        address: 'Av. Alonso de CÃ³rdova 5151', region: 'RM', city: 'Santiago', commune: 'Las Condes', postal_code: '7550000',\n        phone_1: '+56225556666', email_orders: 'pedidos@novo.com', email_billing: 'billing@novo.com', sector: 'LABORATORIO', brands: ['Novo Nordisk']\n    },\n    {\n        id: 'SUP-003',\n        rut: '76.333.333-3',\n        business_name: 'DroguerÃ­a Hofmann S.A.',\n        fantasy_name: 'DroguerÃ­a Hofmann',\n        contact_email: 'contacto@hofmann.cl',\n        lead_time_days: 3,\n        contacts: [],\n        categories: ['INSUMOS', 'RETAIL'],\n        payment_terms: 'CONTADO',\n        rating: 3,\n        address: 'San Ignacio 500', region: 'RM', city: 'Santiago', commune: 'Quilicura', postal_code: '8700000',\n        phone_1: '+56227778888', email_orders: 'ventas@hofmann.cl', email_billing: 'pagos@hofmann.cl', sector: 'DISTRIBUIDORA', brands: ['Varios']\n    },\n];\n\n// --- MOCK SHIPMENTS FOR WMS ---\nconst MOCK_SHIPMENTS: Shipment[] = [\n    // INBOUND from Laboratorio Chile\n    {\n        id: 'SHP-001',\n        type: 'INBOUND_PROVIDER',\n        origin_location_id: 'PROVEEDOR_LABCHILE',\n        destination_location_id: 'SUCURSAL_CENTRO',\n        status: 'IN_TRANSIT',\n        transport_data: {\n            carrier: 'STARKEN',\n            tracking_number: 'STK-2024-001',\n            package_count: 3,\n            driver_name: 'Juan PÃ©rez'\n        },\n        documentation: {\n            invoice_url: '/docs/invoice-001.pdf',\n            dispatch_guide_url: '/docs/guide-001.pdf',\n            evidence_photos: []\n        },\n        items: [\n            { batchId: 'P001', sku: '780001', name: 'PARACETAMOL 500MG', quantity: 500, condition: 'GOOD' },\n            { batchId: 'P003', sku: '780003', name: 'IBUPROFENO 600MG', quantity: 300, condition: 'GOOD' }\n        ],\n        valuation: 450000,\n        created_at: Date.now() - 86400000, // 1 day ago\n        updated_at: Date.now() - 86400000\n    },\n    // INBOUND from DroguerÃ­a Ã‘uÃ±oa\n    {\n        id: 'SHP-002',\n        type: 'INBOUND_PROVIDER',\n        origin_location_id: 'PROVEEDOR_DROGÃ‘UÃ‘OA',\n        destination_location_id: 'SUCURSAL_CENTRO',\n        status: 'PREPARING',\n        transport_data: {\n            carrier: 'CHILEXPRESS',\n            tracking_number: 'CHX-2024-002',\n            package_count: 2,\n        },\n        documentation: {\n            evidence_photos: []\n        },\n        items: [\n            { batchId: 'G003', sku: 'LC-003', name: 'OMEPRAZOL 20MG', quantity: 200, condition: 'GOOD' },\n            { batchId: 'R001', sku: 'RET-01', name: 'MAAM CREMA PRENATAL', quantity: 50, condition: 'GOOD' }\n        ],\n        valuation: 850000,\n        created_at: Date.now() - 43200000, // 12 hours ago\n        updated_at: Date.now() - 43200000\n    },\n    // OUTBOUND to Sucursal Norte\n    {\n        id: 'SHP-003',\n        type: 'INTERNAL_TRANSFER',\n        origin_location_id: 'SUCURSAL_CENTRO',\n        destination_location_id: 'SUCURSAL_NORTE',\n        status: 'IN_TRANSIT',\n        transport_data: {\n            carrier: 'FLOTA_PROPIA',\n            tracking_number: 'FP-2024-003',\n            package_count: 1,\n            driver_name: 'Carlos MuÃ±oz'\n        },\n        documentation: {\n            dispatch_guide_url: '/docs/guide-003.pdf',\n            evidence_photos: []\n        },\n        items: [\n            { batchId: 'P002', sku: '780002', name: 'LOSARTÃN 50MG', quantity: 100, condition: 'GOOD' }\n        ],\n        valuation: 299000,\n        created_at: Date.now() - 7200000, // 2 hours ago\n        updated_at: Date.now() - 7200000\n    },\n    // RETURN (LogÃ­stica Inversa)\n    {\n        id: 'SHP-004',\n        type: 'RETURN',\n        origin_location_id: 'SUCURSAL_CENTRO',\n        destination_location_id: 'BODEGA_CENTRAL',\n        status: 'PREPARING',\n        transport_data: {\n            carrier: 'STARKEN',\n            tracking_number: 'STK-RET-001',\n            package_count: 1,\n        },\n        documentation: {\n            evidence_photos: []\n        },\n        items: [\n            { batchId: 'G001', sku: 'LC-001', name: 'ACICLOVIR 200MG', quantity: 20, condition: 'DAMAGED' }\n        ],\n        valuation: 43340,\n        created_at: Date.now() - 3600000, // 1 hour ago\n        updated_at: Date.now() - 3600000\n    }\n];\n\ninterface PharmaState {\n    // Auth\n    user: EmployeeProfile | null;\n    employees: EmployeeProfile[]; // Store loaded employees\n    login: (userId: string, pin: string) => boolean;\n    logout: () => void;\n\n    // Data Sync\n    isLoading: boolean;\n    syncData: () => Promise<void>;\n\n    // Inventory\n    inventory: InventoryBatch[];\n    suppliers: Supplier[];\n    supplierDocuments: SupplierDocument[];\n    purchaseOrders: PurchaseOrder[];\n    updateStock: (batchId: string, quantity: number) => void;\n    addStock: (batchId: string, quantity: number, expiry?: number) => void;\n    addNewProduct: (product: InventoryBatch) => void;\n    transferStock: (batchId: string, targetLocation: 'BODEGA_CENTRAL' | 'SUCURSAL_CENTRO' | 'SUCURSAL_NORTE' | 'KIOSCO', quantity: number) => void;\n    addPurchaseOrder: (po: PurchaseOrder) => void;\n    receivePurchaseOrder: (poId: string, receivedItems: { sku: string, received_qty: number }[]) => void;\n\n    // SRM Actions\n    addSupplier: (supplier: Omit<Supplier, 'id'>) => void;\n    updateSupplier: (id: string, data: Partial<Supplier>) => void;\n    addSupplierDocument: (doc: Omit<SupplierDocument, 'id'>) => void;\n\n    // POS & Cart\n    cart: CartItem[];\n    currentCustomer: Customer | null;\n    setCustomer: (customer: Customer | null) => void;\n    addToCart: (batch: InventoryBatch, quantity: number) => void;\n    addManualItem: (item: { description: string, price: number, quantity: number, sku?: string, is_fractional?: boolean, original_name?: string, active_ingredients?: string[] }) => void;\n    removeFromCart: (sku: string) => void;\n    clearCart: () => void;\n    processSale: (paymentMethod: string, customer?: Customer) => Promise<boolean>;\n\n    // Inventory Actions\n    updateProduct: (id: string, data: Partial<InventoryBatch>) => void;\n    updateBatchDetails: (productId: string, batchId: string, data: Partial<InventoryBatch>) => void;\n\n    // Printer & Hardware\n    printerConfig: PrinterConfig;\n    updatePrinterConfig: (config: Partial<PrinterConfig>) => void;\n\n    // CRM\n    customers: Customer[];\n    addCustomer: (customer: Omit<Customer, 'id' | 'totalPoints' | 'lastVisit' | 'health_tags' | 'name' | 'age'>) => Customer;\n    updateCustomer: (id: string, data: Partial<Customer>) => void;\n\n    // BI & Reports\n    salesHistory: SaleTransaction[];\n    expenses: Expense[];\n    addExpense: (expense: Omit<Expense, 'id'>) => void;\n\n    // Cash Management\n    currentShift: CashShift | null;\n    dailyShifts: CashShift[]; // History of shifts for the day\n    cashMovements: CashMovement[];\n    openShift: (amount: number, authorizedBy: string) => void;\n    closeShift: (finalAmount: number, authorizedBy: string) => void;\n    updateOpeningAmount: (newAmount: number) => void;\n    registerCashMovement: (movement: Omit<CashMovement, 'id' | 'timestamp' | 'shift_id' | 'user_id'>) => void;\n    getShiftMetrics: () => {\n        totalSales: number;\n        cashSales: number;\n        cardSales: number;\n        transferSales: number;\n        initialFund: number;\n        totalOutflows: number;\n        expectedCash: number;\n    };\n\n    // Attendance & HR\n    attendanceLogs: AttendanceLog[];\n    registerAttendance: (employeeId: string, type: AttendanceType, observation?: string, evidence_photo_url?: string) => void;\n    updateEmployeeBiometrics: (employeeId: string, credentialId: string) => void;\n\n    // WMS & Logistics\n    stockTransfers: StockTransfer[]; // Legacy\n    shipments: Shipment[]; // New\n    warehouseIncidents: WarehouseIncident[];\n    dispatchTransfer: (transfer: Omit<StockTransfer, 'id' | 'status' | 'timeline'>) => void;\n    receiveTransfer: (transferId: string, incidents?: Omit<WarehouseIncident, 'id' | 'transfer_id' | 'reported_at' | 'status'>[]) => void;\n\n    // Logistics\n    createDispatch: (shipmentData: Omit<Shipment, 'id' | 'status' | 'created_at' | 'updated_at'>) => void;\n    confirmReception: (shipmentId: string, data: { photos: string[], notes: string, receivedItems: { batchId: string, quantity: number, condition: 'GOOD' | 'DAMAGED' }[] }) => void;\n    uploadLogisticsDocument: (shipmentId: string, type: 'INVOICE' | 'GUIDE' | 'PHOTO', url: string, observations?: string) => void;\n\n    // Import\n    importInventory: (items: InventoryBatch[]) => void;\n\n    // Queue\n    tickets: QueueTicket[];\n    generateTicket: (rut?: string, branch_id?: string) => QueueTicket;\n    callNextTicket: () => QueueTicket | null;\n\n    // SII (FacturaciÃ³n ElectrÃ³nica)\n    siiConfiguration: SiiConfiguration | null;\n    siiCafs: SiiCaf[];\n    dteDocuments: DteDocument[];\n    updateSiiConfiguration: (config: SiiConfiguration) => void;\n    addCaf: (caf: Omit<SiiCaf, 'id'>) => void;\n    getAvailableFolios: (tipoDte: DteTipo) => number;\n\n    // Marketing\n    promotions: Promotion[];\n    giftCards: GiftCard[];\n    loyaltyRewards: LoyaltyReward[];\n    addPromotion: (promo: Promotion) => void;\n    togglePromotion: (id: string) => void;\n    createGiftCard: (amount: number) => GiftCard;\n    redeemGiftCard: (code: string, amount: number) => boolean;\n    getGiftCard: (code: string) => GiftCard | undefined;\n}\n\n\nexport const usePharmaStore = create<PharmaState>()(\n    persist(\n        (set, get) => ({\n            // --- Auth ---\n            user: null, // ALWAYS start logged out - force login\n            employees: MOCK_EMPLOYEES,\n            login: (userId, pin) => {\n                const { employees } = get();\n                const employee = employees.find(e => e.id === userId && e.access_pin === pin);\n                if (employee) {\n                    set({ user: employee });\n                    return true;\n                }\n                return false;\n            },\n            logout: () => set({ user: null }),\n\n            // --- Data Sync ---\n            isLoading: false,\n            syncData: async () => {\n                set({ isLoading: true });\n                try {\n                    const [inventory, employees] = await Promise.all([\n                        fetchInventory(),\n                        fetchEmployees()\n                    ]);\n\n                    // Si falla la DB (Safe Mode devuelve []), mantenemos lo que haya o usamos un fallback mÃ­nimo si estÃ¡ vacÃ­o\n                    if (inventory.length > 0) set({ inventory });\n                    if (employees.length > 0) set({ employees });\n\n                    const state = get();\n\n                    // Initialize TigerDataService with current store data\n                    const { TigerDataService } = await import('../../domain/services/TigerDataService');\n                    TigerDataService.initializeStorage({\n                        products: state.inventory,\n                        employees: state.employees,\n                        sales: state.salesHistory,\n                        cashMovements: state.cashMovements,\n                        expenses: state.expenses\n                    });\n\n                    console.log('âœ… Data Synced & Tiger Data Initialized:', {\n                        inventoryCount: state.inventory.length,\n                        employeeCount: state.employees.length,\n                        salesCount: state.salesHistory.length,\n                        source: inventory.length > 0 ? 'DB' : 'MOCK/CACHE'\n                    });\n                } catch (error) {\n                    console.error('âŒ Sync failed:', error);\n                    // Show a friendly toast to the user\n                    import('sonner').then(({ toast }) => {\n                        toast.error('Modo Sin ConexiÃ³n / Demo', {\n                            description: 'No se pudo conectar con el servidor. Usando datos locales.',\n                            duration: 5000,\n                        });\n                    });\n                } finally {\n                    set({ isLoading: false });\n                }\n            },\n\n            // --- Inventory ---\n            inventory: MOCK_INVENTORY, // Start with real data\n            suppliers: MOCK_SUPPLIERS,\n            supplierDocuments: [],\n            purchaseOrders: [],\n            updateStock: (batchId, quantity) => set((state) => ({\n                inventory: state.inventory.map(item =>\n                    item.id === batchId ? { ...item, stock_actual: item.stock_actual + quantity } : item\n                )\n            })),\n            addStock: (batchId, quantity, expiry) => set((state) => ({\n                inventory: state.inventory.map(item =>\n                    item.id === batchId ? {\n                        ...item,\n                        stock_actual: item.stock_actual + quantity,\n                        expiry_date: expiry || item.expiry_date\n                    } : item\n                )\n            })),\n            addNewProduct: (product) => set((state) => ({\n                inventory: [...state.inventory, { ...product, id: `BATCH - ${Date.now()} ` }]\n            })),\n            transferStock: (batchId, targetLocation, quantity) => set((state) => {\n                const sourceItem = state.inventory.find(i => i.id === batchId);\n                if (!sourceItem || sourceItem.stock_actual < quantity) return state;\n\n                // 1. Deduct from source\n                const updatedInventory = state.inventory.map(i =>\n                    i.id === batchId ? { ...i, stock_actual: i.stock_actual - quantity } : i\n                );\n\n                // 2. Add to target (Find existing batch in target location or create new)\n                // For simplicity in this demo, we'll clone the item with new location\n                // In a real DB, we'd check if SKU exists in target location\n                const existingInTarget = updatedInventory.find(i => i.sku === sourceItem.sku && i.location_id === targetLocation);\n\n                if (existingInTarget) {\n                    existingInTarget.stock_actual += quantity;\n                } else {\n                    updatedInventory.push({\n                        ...sourceItem,\n                        id: `TRF - ${Date.now()} `,\n                        location_id: targetLocation,\n                        stock_actual: quantity\n                    });\n                }\n\n                return { inventory: updatedInventory };\n            }),\n            addPurchaseOrder: (po) => set((state) => ({ purchaseOrders: [...state.purchaseOrders, po] })),\n            receivePurchaseOrder: (poId, receivedItems) => set((state) => {\n                // 1. Actualizar estado de la PO\n                const updatedPOs = state.purchaseOrders.map(po =>\n                    po.id === poId ? { ...po, status: 'COMPLETED' as const } : po\n                );\n\n                // 2. Actualizar Inventario\n                const updatedInventory = [...state.inventory];\n                receivedItems.forEach(rec => {\n                    const itemIndex = updatedInventory.findIndex(i => i.sku === rec.sku);\n                    if (itemIndex >= 0) {\n                        updatedInventory[itemIndex] = {\n                            ...updatedInventory[itemIndex],\n                            stock_actual: updatedInventory[itemIndex].stock_actual + rec.received_qty\n                        };\n                    }\n                });\n\n                return { purchaseOrders: updatedPOs, inventory: updatedInventory };\n            }),\n\n            // --- SRM Actions ---\n            addSupplier: (supplierData) => set((state) => ({\n                suppliers: [...state.suppliers, { ...supplierData, id: `SUP - ${Date.now()} ` }]\n            })),\n            updateSupplier: (id, data) => set((state) => ({\n                suppliers: state.suppliers.map(s => s.id === id ? { ...s, ...data } : s)\n            })),\n            addSupplierDocument: (docData) => set((state) => ({\n                supplierDocuments: [...state.supplierDocuments, { ...docData, id: `DOC - ${Date.now()} ` }]\n            })),\n\n            // --- POS ---\n            cart: [],\n            currentCustomer: null,\n            // Printer Config\n            printerConfig: {\n                auto_print_sale: true,\n                auto_print_cash: true,\n                auto_print_queue: true,\n                header_text: 'FARMACIAS VALLENAR SUIT',\n                footer_text: 'Gracias por su preferencia'\n            },\n            updatePrinterConfig: (config) => set((state) => ({\n                printerConfig: { ...state.printerConfig, ...config }\n            })),\n\n            // Actions Implementation\n            setCustomer: (customer) => set({ currentCustomer: customer }),\n            // --- ACTIONS ---\n            updateProduct: (id: string, data: Partial<InventoryBatch>) => set((state) => ({\n                inventory: state.inventory.map(item =>\n                    item.id === id ? { ...item, ...data } : item\n                )\n            })),\n\n            updateBatchDetails: (productId, batchId, data) => {\n                set((state) => ({\n                    inventory: state.inventory.map((item) => {\n                        // In this simplified model, items ARE batches. \n                        // So we just find the item by ID (which acts as batch ID here) and update it.\n                        // In a more complex model with Product -> Batches relation, we would drill down.\n                        if (item.id === batchId) {\n                            return { ...item, ...data };\n                        }\n                        return item;\n                    })\n                }));\n            },\n            addToCart: (item, quantity = 1) => set((state) => {\n                const existingItem = state.cart.find(i => i.id === item.id);\n                if (existingItem) {\n                    return {\n                        cart: state.cart.map(i =>\n                            i.id === item.id ? { ...i, quantity: i.quantity + quantity } : i\n                        )\n                    };\n                }\n                const newItem: CartItem = {\n                    id: item.id,\n                    sku: item.sku,\n                    name: item.name,\n                    price: item.price,\n                    quantity: quantity,\n                    allows_commission: item.allows_commission,\n                    active_ingredients: item.active_ingredients\n                };\n                return { cart: [...state.cart, newItem] };\n            }),\n            // --- ImportaciÃ³n Masiva ---\n            importInventory: (items: InventoryBatch[]) => {\n                set((state) => {\n                    // In a real app, this would be a backend call.\n                    // Here we merge with existing inventory or add new.\n                    const newInventory = [...state.inventory];\n\n                    items.forEach(newItem => {\n                        // Check if product exists (by SKU) to update or add\n                        // For simplicity in this mock, we just push new items\n                        // In production, we should check for duplicates and handle batches properly\n                        newInventory.push(newItem);\n                    });\n\n                    return { inventory: newInventory };\n                });\n            },\n\n            // --- Queue Management ---\n            // Moved to bottom with other Queue actions\n\n            addManualItem: (item) => set((state) => ({\n                cart: [...state.cart, {\n                    id: 'MANUAL-' + Date.now(),\n                    batch_id: 'MANUAL',\n                    sku: item.sku || 'MANUAL-SKU',\n                    name: item.description,\n                    price: item.price,\n                    quantity: item.quantity,\n                    allows_commission: true,\n                    active_ingredients: item.active_ingredients || [],\n                    is_fractional: item.is_fractional,\n                    original_name: item.original_name\n                }]\n            })),\n            removeFromCart: (sku) => set((state) => ({\n                cart: state.cart.filter(i => i.sku !== sku)\n            })),\n            clearCart: () => set({ cart: [] }),\n            processSale: async (paymentMethod, customer) => {\n                const state = get();\n\n                try {\n                    // 1. Create sale transaction object\n                    const saleTransaction: SaleTransaction = {\n                        id: `SALE - ${Date.now()} -${Math.floor(Math.random() * 1000)} `,\n                        timestamp: Date.now(),\n                        items: state.cart.map(item => ({\n                            batch_id: item.batch_id || 'UNKNOWN',\n                            sku: item.sku,\n                            name: item.name,\n                            price: item.price,\n                            quantity: item.quantity,\n                            allows_commission: item.allows_commission || false,\n                            active_ingredients: item.active_ingredients\n                        })),\n                        total: state.cart.reduce((a, b) => a + b.price * b.quantity, 0),\n                        payment_method: paymentMethod as any,\n                        seller_id: state.user?.id || 'UNKNOWN',\n                        customer: customer || undefined\n                    };\n\n                    // 2. CRITICAL: Save to Tiger Data BEFORE clearing cart\n                    const { TigerDataService } = await import('../../domain/services/TigerDataService');\n                    const result = await TigerDataService.saveSaleTransaction(\n                        saleTransaction,\n                        'SUCURSAL_CENTRO' // TODO: Get from location context\n                    );\n\n                    if (!result.success) {\n                        console.error('âŒ Failed to save sale to Tiger Data');\n                        return false;\n                    }\n\n                    console.log('âœ… Sale saved to Tiger Data:', result.transactionId);\n\n                    // 3. Update local inventory (deduct stock)\n                    const newInventory = state.inventory.map(item => {\n                        const cartItem = state.cart.find(c => c.sku === item.sku);\n                        if (cartItem) {\n                            return { ...item, stock_actual: item.stock_actual - cartItem.quantity };\n                        }\n                        return item;\n                    });\n\n                    // 4. Update customer points if applicable\n                    if (customer) {\n                        const pointsEarned = Math.floor(saleTransaction.total * 0.01); // 1% points\n                        state.updateCustomer(customer.id, {\n                            totalPoints: customer.totalPoints + pointsEarned,\n                            lastVisit: Date.now()\n                        });\n                    }\n\n                    // 5. Update local state (clear cart and add to history)\n                    set({\n                        inventory: newInventory,\n                        cart: [],\n                        currentCustomer: null,\n                        salesHistory: [...state.salesHistory, saleTransaction]\n                    });\n\n                    console.log('âœ… Sale processed successfully:', {\n                        items: saleTransaction.items.length,\n                        total: saleTransaction.total,\n                        paymentMethod,\n                        customer: customer?.fullName\n                    });\n\n                    return true;\n                } catch (error) {\n                    console.error('âŒ Error processing sale:', error);\n                    // Don't clear cart on error - allow retry\n                    return false;\n                }\n            },\n\n            // --- CRM ---\n            customers: [\n                { id: 'C-001', rut: '11.111.111-1', fullName: 'Cliente Frecuente Demo', name: 'Cliente Frecuente Demo', phone: '+56912345678', email: 'demo@cliente.cl', totalPoints: 1500, registrationSource: 'ADMIN', lastVisit: Date.now() - 86400000, age: 45, health_tags: ['HYPERTENSION'] }\n            ],\n            addCustomer: (data) => {\n                const newCustomer: Customer = {\n                    ...data,\n                    id: `CUST - ${Date.now()} `,\n                    totalPoints: 0,\n                    lastVisit: Date.now(),\n                    health_tags: [],\n                    name: data.fullName, // Legacy support\n                    age: 0 // Default\n                };\n                set((state) => ({\n                    customers: [...state.customers, newCustomer],\n                    currentCustomer: newCustomer\n                }));\n                return newCustomer;\n            },\n            updateCustomer: (id, data) => set((state) => ({\n                customers: state.customers.map(c => c.id === id ? { ...c, ...data } : c)\n            })),\n\n            // --- BI & Reports ---\n            salesHistory: [],\n            expenses: [],\n            addExpense: (expense) => set((state) => ({\n                expenses: [...state.expenses, { ...expense, id: `EXP - ${Date.now()} ` }]\n            })),\n\n            // --- Marketing ---\n            promotions: [],\n            giftCards: [],\n            loyaltyRewards: [\n                { id: 'REW-1', name: 'Canje Shampoo', points_cost: 5000, description: 'Shampoo 400ml' },\n                { id: 'REW-2', name: 'Descuento $5.000', points_cost: 4000, description: 'En total de compra' }\n            ],\n            addPromotion: (promo) => set((state) => ({ promotions: [...state.promotions, promo] })),\n            togglePromotion: (id) => set((state) => ({\n                promotions: state.promotions.map(p => p.id === id ? { ...p, isActive: !p.isActive } : p)\n            })),\n            createGiftCard: (amount) => {\n                const code = `GIFT - ${Math.floor(1000 + Math.random() * 9000)} -${new Date().getFullYear()} `;\n                const newCard: GiftCard = {\n                    code,\n                    balance: amount,\n                    initial_balance: amount,\n                    status: 'ACTIVE',\n                    created_at: Date.now()\n                };\n                set((state) => ({ giftCards: [...state.giftCards, newCard] }));\n                return newCard;\n            },\n            redeemGiftCard: (code, amount) => {\n                const state = get();\n                const card = state.giftCards.find(c => c.code === code);\n                if (!card || card.status !== 'ACTIVE' || card.balance < amount) return false;\n\n                const newBalance = card.balance - amount;\n                set((state) => ({\n                    giftCards: state.giftCards.map(c =>\n                        c.code === code ? {\n                            ...c,\n                            balance: newBalance,\n                            status: newBalance === 0 ? 'REDEEMED' : 'ACTIVE'\n                        } : c\n                    )\n                }));\n                return true;\n            },\n            getGiftCard: (code) => get().giftCards.find(c => c.code === code),\n\n\n            // --- Cash Management ---\n            currentShift: null,\n            dailyShifts: [],\n            cashMovements: [],\n            openShift: (amount, authorizedBy) => set((state) => {\n                if (state.currentShift?.status === 'OPEN') return state;\n\n                // Calculate shift number (1-based)\n                const todayStart = new Date().setHours(0, 0, 0, 0);\n                const shiftsToday = state.dailyShifts.filter(s => s.start_time >= todayStart).length;\n\n                const newShift: CashShift = {\n                    id: `SHIFT - ${Date.now()} `,\n                    user_id: state.user?.id || 'UNKNOWN',\n                    start_time: Date.now(),\n                    opening_amount: amount,\n                    status: 'OPEN',\n                    openedBy: state.user?.id || 'UNKNOWN',\n                    authorizedBy: authorizedBy,\n                    shiftNumber: shiftsToday + 1\n                };\n                return { currentShift: newShift };\n            }),\n            closeShift: (finalAmount, authorizedBy) => set((state) => {\n                if (!state.currentShift) return state;\n                const metrics = state.getShiftMetrics();\n\n                const closedShift: CashShift = {\n                    ...state.currentShift,\n                    end_time: Date.now(),\n                    status: 'CLOSED',\n                    closedBy: authorizedBy,\n                    closing_amount: finalAmount,\n                    difference: finalAmount - metrics.expectedCash\n                };\n\n                return {\n                    currentShift: null, // Reset current shift\n                    dailyShifts: [...state.dailyShifts, closedShift], // Archive it\n                    cart: [], // Clear cart\n                    currentCustomer: null // Clear customer\n                };\n            }),\n            updateOpeningAmount: (newAmount) => set((state) => {\n                if (!state.currentShift) return state;\n                return {\n                    currentShift: {\n                        ...state.currentShift,\n                        opening_amount: newAmount\n                    }\n                };\n            }),\n            registerCashMovement: (movement) => set((state) => {\n                if (!state.currentShift) return state;\n                const newMovement: CashMovement = {\n                    id: `MOV - ${Date.now()} `,\n                    shift_id: state.currentShift.id,\n                    timestamp: Date.now(),\n                    user_id: state.user?.id || 'UNKNOWN',\n                    ...movement\n                };\n                return { cashMovements: [...state.cashMovements, newMovement] };\n            }),\n            getShiftMetrics: () => {\n                const state = get();\n                if (!state.currentShift) return {\n                    totalSales: 0, cashSales: 0, cardSales: 0, transferSales: 0, initialFund: 0, totalOutflows: 0, expectedCash: 0\n                };\n\n                // Filter sales within the current shift\n                const shiftSales = state.salesHistory.filter(s => s.timestamp >= state.currentShift!.start_time && (!state.currentShift!.end_time || s.timestamp <= state.currentShift!.end_time));\n\n                const totalSales = shiftSales.reduce((sum, s) => sum + s.total, 0);\n                const cashSalesList = shiftSales.filter(s => s.payment_method === 'CASH');\n                const cardSalesList = shiftSales.filter(s => s.payment_method === 'DEBIT' || s.payment_method === 'CREDIT');\n                const transferSalesList = shiftSales.filter(s => s.payment_method === 'TRANSFER');\n\n                const cashSales = cashSalesList.reduce((sum, s) => sum + s.total, 0);\n                const cardSales = cardSalesList.reduce((sum, s) => sum + s.total, 0);\n                const transferSales = transferSalesList.reduce((sum, s) => sum + s.total, 0);\n\n                const initialFund = state.currentShift.opening_amount;\n\n                const shiftMovements = state.cashMovements.filter(m => m.shift_id === state.currentShift!.id);\n                const totalOutflows = shiftMovements.filter(m => m.type === 'OUT' && m.is_cash).reduce((sum, m) => sum + m.amount, 0);\n                const totalInflows = shiftMovements.filter(m => m.type === 'IN' && m.is_cash).reduce((sum, m) => sum + m.amount, 0);\n\n                const expectedCash = initialFund + cashSales + totalInflows - totalOutflows;\n\n                return {\n                    totalSales,\n                    cashSales,\n                    cardSales,\n                    transferSales,\n                    initialFund,\n                    totalOutflows,\n                    expectedCash,\n                    // Detailed Lists\n                    cashSalesList,\n                    cardSalesList,\n                    transferSalesList,\n                    // Counts\n                    cardCount: cardSalesList.length,\n                    transferCount: transferSalesList.length\n                };\n            },\n\n            // --- Attendance ---\n            attendanceLogs: [],\n            registerAttendance: (employeeId: string, type: AttendanceType, observation?: string, evidence_photo_url?: string) => set((state) => {\n                const now = Date.now();\n                let newStatus: AttendanceStatus = 'OUT';\n\n                if (['CHECK_IN', 'BREAK_END', 'PERMISSION_END'].includes(type)) newStatus = 'IN';\n                if (type === 'BREAK_START') newStatus = 'LUNCH';\n                if (type === 'PERMISSION_START') newStatus = 'ON_PERMISSION';\n                if (['CHECK_OUT', 'MEDICAL_LEAVE', 'EMERGENCY', 'WORK_ACCIDENT'].includes(type)) newStatus = 'OUT';\n\n                // Calculate overtime if CHECK_OUT\n                let overtime = 0;\n                if (type === 'CHECK_OUT') {\n                    // Simple logic: find last CHECK_IN today\n                    const todayStart = new Date().setHours(0, 0, 0, 0);\n                    const lastCheckIn = state.attendanceLogs.find(l => l.employee_id === employeeId && l.type === 'CHECK_IN' && l.timestamp >= todayStart);\n\n                    if (lastCheckIn) {\n                        const workedMinutes = (now - lastCheckIn.timestamp) / 1000 / 60;\n                        const contractMinutes = 9 * 60; // 9 hours default\n                        if (workedMinutes > contractMinutes) {\n                            overtime = Math.round(workedMinutes - contractMinutes);\n                        }\n                    }\n                }\n\n                // WORK ACCIDENT ALERT\n                if (type === 'WORK_ACCIDENT') {\n                    // In a real app, this would trigger an email/SMS\n                    console.error('ðŸš¨ ALERTA DE ACCIDENTE LABORAL:', employeeId, observation);\n                    // We could also add a notification to a notifications store if we had one\n                }\n\n                const newLog: AttendanceLog = {\n                    id: `LOG - ${now} `,\n                    employee_id: employeeId,\n                    timestamp: now,\n                    type,\n                    overtime_minutes: overtime,\n                    observation,\n                    evidence_photo_url\n                };\n\n                return {\n                    attendanceLogs: [...state.attendanceLogs, newLog],\n                    employees: state.employees.map(emp =>\n                        emp.id === employeeId ? { ...emp, current_status: newStatus } : emp\n                    )\n                };\n            }),\n            updateEmployeeBiometrics: (employeeId, credentialId) => set((state) => ({\n                employees: state.employees.map(emp =>\n                    emp.id === employeeId\n                        ? { ...emp, biometric_credentials: [...(emp.biometric_credentials || []), credentialId] }\n                        : emp\n                )\n            })),\n\n            // --- WMS & Logistics ---\n            stockTransfers: [],\n            shipments: MOCK_SHIPMENTS,\n            warehouseIncidents: [],\n\n            createDispatch: (shipmentData) => set((state) => {\n                const now = Date.now();\n\n                // Enrich items with Batch Data\n                const enrichedItems = shipmentData.items.map(item => {\n                    const batch = state.inventory.find(b => b.id === item.batchId);\n                    return {\n                        ...item,\n                        lot_number: batch?.lot_number,\n                        expiry_date: batch?.expiry_date,\n                        dci: batch?.dci,\n                        unit_price: batch?.price_per_unit || batch?.price\n                    };\n                });\n\n                const newShipment: Shipment = {\n                    ...shipmentData,\n                    items: enrichedItems,\n                    id: `SHP - ${now} `,\n                    status: 'IN_TRANSIT',\n                    created_at: now,\n                    updated_at: now,\n                    documentation: {\n                        evidence_photos: []\n                    }\n                };\n\n                // Deduct stock from Origin\n                const updatedInventory = [...state.inventory];\n                shipmentData.items.forEach(item => {\n                    const batchIndex = updatedInventory.findIndex(b => b.id === item.batchId);\n                    if (batchIndex !== -1) {\n                        updatedInventory[batchIndex] = {\n                            ...updatedInventory[batchIndex],\n                            stock_actual: updatedInventory[batchIndex].stock_actual - item.quantity\n                        };\n                    }\n                });\n\n                return {\n                    shipments: [...state.shipments, newShipment],\n                    inventory: updatedInventory\n                };\n            }),\n\n            confirmReception: (shipmentId, evidenceData) => set((state) => {\n                const shipmentIndex = state.shipments.findIndex(s => s.id === shipmentId);\n                if (shipmentIndex === -1) return {};\n\n                const shipment = state.shipments[shipmentIndex];\n                const now = Date.now();\n                const updatedInventory = [...state.inventory];\n\n                evidenceData.receivedItems.forEach(recItem => {\n                    // 1. Add to Destination (if GOOD)\n                    if (recItem.condition === 'GOOD') {\n                        // Try to find existing batch of same SKU + Lot + Expiry at destination\n                        const originalItem = shipment.items.find(i => i.batchId === recItem.batchId);\n\n                        // Find match by SKU and Location\n                        const destBatchIndex = updatedInventory.findIndex(b =>\n                            b.sku === originalItem?.sku &&\n                            b.location_id === shipment.destination_location_id &&\n                            b.lot_number === originalItem?.lot_number && // Match Lot\n                            b.expiry_date === originalItem?.expiry_date // Match Expiry\n                        );\n\n                        if (destBatchIndex !== -1) {\n                            // Update existing batch\n                            updatedInventory[destBatchIndex] = {\n                                ...updatedInventory[destBatchIndex],\n                                stock_actual: updatedInventory[destBatchIndex].stock_actual + recItem.quantity\n                            };\n                        } else if (originalItem) {\n                            // Create NEW batch with inherited data\n                            // We need a template for other fields (name, format, etc.)\n                            // We can find any batch of this SKU to copy static data, or use what we have\n                            const templateBatch = state.inventory.find(b => b.sku === originalItem.sku);\n\n                            if (templateBatch) {\n                                updatedInventory.push({\n                                    ...templateBatch, // Copy static data (Name, Format, ISP)\n                                    id: `BATCH - ${now} -${Math.random().toString(36).substr(2, 5)} `,\n                                    location_id: shipment.destination_location_id,\n                                    stock_actual: recItem.quantity,\n\n                                    // INHERITED DYNAMIC DATA\n                                    lot_number: originalItem.lot_number || 'S/L',\n                                    expiry_date: originalItem.expiry_date || (now + 31536000000), // Default 1 year if missing\n                                    price: originalItem.unit_price || templateBatch.price,\n\n                                    stock_min: 10, // Default\n                                    stock_max: 100 // Default\n                                });\n                            }\n                        }\n                    } else {\n                        // Handle DAMAGED (Log incident, move to quarantine, etc.)\n                        console.log(`Item ${recItem.batchId} received DAMAGED.Quantity: ${recItem.quantity} `);\n                    }\n                });\n\n                // Update Shipment Status\n                const updatedShipments = [...state.shipments];\n                updatedShipments[shipmentIndex] = {\n                    ...shipment,\n                    status: 'DELIVERED',\n                    updated_at: now,\n                    documentation: {\n                        ...shipment.documentation,\n                        evidence_photos: [...shipment.documentation.evidence_photos, ...evidenceData.photos],\n                        observations: evidenceData.notes\n                    }\n                };\n\n                return {\n                    shipments: updatedShipments,\n                    inventory: updatedInventory\n                };\n            }),\n            uploadLogisticsDocument: (shipmentId: string, type: 'INVOICE' | 'GUIDE' | 'PHOTO', url: string, observations?: string) => set((state) => {\n                const shipmentIndex = state.shipments.findIndex(s => s.id === shipmentId);\n                if (shipmentIndex === -1) return {};\n\n                const updatedShipments = [...state.shipments];\n                const doc = { ...updatedShipments[shipmentIndex].documentation };\n\n                if (type === 'INVOICE') doc.invoice_url = url;\n                if (type === 'GUIDE') doc.dispatch_guide_url = url;\n                if (type === 'PHOTO') doc.evidence_photos = [...doc.evidence_photos, url];\n                if (observations) doc.observations = observations;\n\n                updatedShipments[shipmentIndex] = {\n                    ...updatedShipments[shipmentIndex],\n                    documentation: doc,\n                    updated_at: Date.now()\n                };\n\n                return { shipments: updatedShipments };\n            }),\n\n            dispatchTransfer: (transferData) => set((state) => {\n                const now = Date.now();\n                // Legacy Support: Create Shipment from Transfer\n                const newShipment: Shipment = {\n                    id: `SHP - LEGACY - ${now} `,\n                    type: 'INTERNAL_TRANSFER',\n                    origin_location_id: transferData.origin_location_id,\n                    destination_location_id: transferData.destination_location_id,\n                    status: 'IN_TRANSIT',\n                    transport_data: {\n                        carrier: transferData.shipment_data.carrier_name,\n                        tracking_number: transferData.shipment_data.tracking_number,\n                        package_count: 1,\n                        driver_name: transferData.shipment_data.driver_name\n                    },\n                    documentation: {\n                        evidence_photos: transferData.evidence.photos\n                    },\n                    items: transferData.items.map(i => ({\n                        batchId: i.batchId,\n                        sku: i.sku,\n                        name: i.productName,\n                        quantity: i.quantity,\n                        condition: 'GOOD'\n                    })),\n                    valuation: 0,\n                    created_at: now,\n                    updated_at: now\n                };\n\n                const updatedInventory = [...state.inventory];\n                transferData.items.forEach(item => {\n                    const batchIndex = updatedInventory.findIndex(b => b.id === item.batchId);\n                    if (batchIndex !== -1) {\n                        updatedInventory[batchIndex] = {\n                            ...updatedInventory[batchIndex],\n                            stock_actual: updatedInventory[batchIndex].stock_actual - item.quantity\n                        };\n                    }\n                });\n\n                return {\n                    shipments: [...state.shipments, newShipment],\n                    stockTransfers: [...state.stockTransfers, { ...transferData, id: `TRF - ${now} `, status: 'IN_TRANSIT', timeline: { created_at: now } }],\n                    inventory: updatedInventory\n                };\n            }),\n\n            receiveTransfer: (transferId, incidents) => set((state) => {\n                const transferIndex = state.stockTransfers.findIndex(t => t.id === transferId);\n                if (transferIndex === -1) return {};\n\n                const updatedTransfers = [...state.stockTransfers];\n                updatedTransfers[transferIndex] = {\n                    ...updatedTransfers[transferIndex],\n                    status: 'RECEIVED',\n                    timeline: { ...updatedTransfers[transferIndex].timeline, received_at: Date.now() }\n                };\n\n                return { stockTransfers: updatedTransfers };\n            }),\n\n            // --- Queue ---\n            tickets: [],\n            addTicketToQueue: (ticket: QueueTicket) => set((state) => ({\n                tickets: [...state.tickets, ticket]\n            })),\n            generateTicket: (rut = 'ANON', branch_id = 'SUC-CENTRO') => {\n                const ticket: QueueTicket = {\n                    id: `T - ${Date.now()} `,\n                    number: `A - ${Math.floor(Math.random() * 100)} `,\n                    status: 'WAITING',\n                    rut,\n                    timestamp: Date.now(),\n                    branch_id // Default, should be dynamic in real app\n                };\n                set((state) => ({ tickets: [...state.tickets, ticket] }));\n                return ticket;\n            },\n            callNextTicket: () => {\n                const state = get();\n                const nextTicket = state.tickets.find(t => t.status === 'WAITING');\n                if (!nextTicket) return null;\n\n                const updatedTickets = state.tickets.map(t =>\n                    t.id === nextTicket.id ? { ...t, status: 'CALLED' as const } : t\n                );\n\n                set({ tickets: updatedTickets });\n                return nextTicket;\n            },\n\n            // --- SII ---\n            siiConfiguration: null,\n            siiCafs: [],\n            dteDocuments: [],\n            updateSiiConfiguration: (config) => set({ siiConfiguration: config }),\n            addCaf: (cafData) => set((state) => ({\n                siiCafs: [...state.siiCafs, { ...cafData, id: `CAF - ${Date.now()} ` }]\n            })),\n            getAvailableFolios: (tipoDte) => {\n                const state = get();\n                const caf = state.siiCafs.find(c => c.tipo_dte === tipoDte && c.active);\n                if (!caf) return 0;\n                return (caf.rango_hasta - caf.rango_desde) - caf.folios_usados;\n            }\n        }),\n        {\n            name: 'farmacias-vallenar-v6-prices', // Force cache clear - Price Structure Update\n            version: 6,\n            storage: createJSONStorage(() => localStorage),\n            partialize: (state) => ({\n                user: state.user,\n                cart: state.cart,\n                inventory: state.inventory,\n                customers: state.customers,\n                salesHistory: state.salesHistory,\n                expenses: state.expenses,\n                currentShift: state.currentShift,\n                cashMovements: state.cashMovements,\n                attendanceLogs: state.attendanceLogs,\n                employees: state.employees,\n                stockTransfers: state.stockTransfers,\n                warehouseIncidents: state.warehouseIncidents,\n                siiConfiguration: state.siiConfiguration,\n                siiCafs: state.siiCafs,\n                dteDocuments: state.dteDocuments\n            }),\n            // Merge function to ensure employees are never empty\n            merge: (persistedState: any, currentState: PharmaState) => ({\n                ...currentState,\n                ...persistedState,\n                // Always ensure employees are populated\n                employees: (persistedState?.employees && persistedState.employees.length > 0)\n                    ? persistedState.employees\n                    : MOCK_EMPLOYEES\n            })\n        }\n    )\n);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1531, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/store/useLocationStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist, createJSONStorage } from 'zustand/middleware';\nimport { Location, KioskConfig } from '../../domain/types';\n\ninterface LocationState {\n    locations: Location[];\n    kiosks: KioskConfig[];\n    currentLocation: Location | null;\n\n    // Actions\n    addLocation: (location: Location) => void;\n    updateLocation: (id: string, data: Partial<Location>) => void;\n    switchLocation: (id: string, onSuccess?: () => void) => void;\n    canSwitchLocation: (userRole: string) => boolean;\n\n    registerKiosk: (kiosk: KioskConfig) => void;\n    updateKioskStatus: (id: string, status: 'ACTIVE' | 'INACTIVE') => void;\n    generatePairingCode: (kioskId: string) => string;\n}\n\n// Mock Initial Data - Extended with more locations\nconst INITIAL_LOCATIONS: Location[] = [\n    {\n        id: 'SUCURSAL_CENTRO',\n        type: 'STORE',\n        name: 'Farmacia Vallenar Centro',\n        address: 'Arturo Prat 123, Vallenar',\n        associated_kiosks: ['KIOSK-001']\n    },\n    {\n        id: 'SUCURSAL_NORTE',\n        type: 'STORE',\n        name: 'Farmacia Vallenar Norte',\n        address: 'Av. Brasil 456, Vallenar',\n        associated_kiosks: ['KIOSK-002']\n    },\n    {\n        id: 'SUCURSAL_SUR',\n        type: 'STORE',\n        name: 'Farmacia Vallenar Sur',\n        address: 'Los Carrera 789, Vallenar',\n        associated_kiosks: []\n    },\n    {\n        id: 'BODEGA_CENTRAL',\n        type: 'WAREHOUSE',\n        name: 'Bodega Central DistribuciÃ³n',\n        address: 'Ruta 5 Norte Km 600',\n        associated_kiosks: []\n    }\n];\n\nconst INITIAL_KIOSKS: KioskConfig[] = [\n    {\n        id: 'KIOSK-001',\n        type: 'QUEUE',\n        location_id: 'SUCURSAL_CENTRO',\n        status: 'ACTIVE'\n    },\n    {\n        id: 'KIOSK-002',\n        type: 'ATTENDANCE',\n        location_id: 'SUCURSAL_NORTE',\n        status: 'ACTIVE'\n    }\n];\n\nexport const useLocationStore = create<LocationState>()(\n    persist(\n        (set, get) => ({\n            locations: INITIAL_LOCATIONS,\n            kiosks: INITIAL_KIOSKS,\n            currentLocation: INITIAL_LOCATIONS[0], // Default to Sucursal Centro\n\n            addLocation: (location) => set((state) => ({\n                locations: [...state.locations, location]\n            })),\n\n            updateLocation: (id, data) => set((state) => ({\n                locations: state.locations.map(loc =>\n                    loc.id === id ? { ...loc, ...data } : loc\n                )\n            })),\n\n            switchLocation: (id, onSuccess) => {\n                const target = get().locations.find(l => l.id === id);\n                if (target) {\n                    set({ currentLocation: target });\n                    console.log(`ðŸ“ Location switched to: ${target.name} (${target.type})`);\n                    if (onSuccess) onSuccess();\n                }\n            },\n\n            canSwitchLocation: (userRole) => {\n                // MANAGER and QF can switch freely\n                // CASHIER and WAREHOUSE are locked to their assigned location\n                return userRole === 'MANAGER' || userRole === 'QF';\n            },\n\n            registerKiosk: (kiosk) => set((state) => ({\n                kiosks: [...state.kiosks, kiosk]\n            })),\n\n            updateKioskStatus: (id, status) => set((state) => ({\n                kiosks: state.kiosks.map(k =>\n                    k.id === id ? { ...k, status } : k\n                )\n            })),\n\n            generatePairingCode: (kioskId) => {\n                // Simple mock generation\n                const code = Math.random().toString(36).substring(2, 8).toUpperCase();\n                // In a real app, we would save this code temporarily\n                return code;\n            }\n        }),\n        {\n            name: 'location-storage-v2',\n            version: 2,\n            storage: createJSONStorage(() => localStorage),\n        }\n    )\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAmBA,mDAAmD;AACnD,MAAM,oBAAgC;IAClC;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,SAAS;QACT,mBAAmB;YAAC;SAAY;IACpC;IACA;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,SAAS;QACT,mBAAmB;YAAC;SAAY;IACpC;IACA;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,SAAS;QACT,mBAAmB,EAAE;IACzB;IACA;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,SAAS;QACT,mBAAmB,EAAE;IACzB;CACH;AAED,MAAM,iBAAgC;IAClC;QACI,IAAI;QACJ,MAAM;QACN,aAAa;QACb,QAAQ;IACZ;IACA;QACI,IAAI;QACJ,MAAM;QACN,aAAa;QACb,QAAQ;IACZ;CACH;AAEM,MAAM,mBAAmB,IAAA,qJAAM,IAClC,IAAA,2JAAO,EACH,CAAC,KAAK,MAAQ,CAAC;QACX,WAAW;QACX,QAAQ;QACR,iBAAiB,iBAAiB,CAAC,EAAE;QAErC,aAAa,CAAC,WAAa,IAAI,CAAC,QAAU,CAAC;oBACvC,WAAW;2BAAI,MAAM,SAAS;wBAAE;qBAAS;gBAC7C,CAAC;QAED,gBAAgB,CAAC,IAAI,OAAS,IAAI,CAAC,QAAU,CAAC;oBAC1C,WAAW,MAAM,SAAS,CAAC,GAAG,CAAC,CAAA,MAC3B,IAAI,EAAE,KAAK,KAAK;4BAAE,GAAG,GAAG;4BAAE,GAAG,IAAI;wBAAC,IAAI;gBAE9C,CAAC;QAED,gBAAgB,CAAC,IAAI;YACjB,MAAM,SAAS,MAAM,SAAS,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;YAClD,IAAI,QAAQ;gBACR,IAAI;oBAAE,iBAAiB;gBAAO;gBAC9B,QAAQ,GAAG,CAAC,CAAC,yBAAyB,EAAE,OAAO,IAAI,CAAC,EAAE,EAAE,OAAO,IAAI,CAAC,CAAC,CAAC;gBACtE,IAAI,WAAW;YACnB;QACJ;QAEA,mBAAmB,CAAC;YAChB,mCAAmC;YACnC,8DAA8D;YAC9D,OAAO,aAAa,aAAa,aAAa;QAClD;QAEA,eAAe,CAAC,QAAU,IAAI,CAAC,QAAU,CAAC;oBACtC,QAAQ;2BAAI,MAAM,MAAM;wBAAE;qBAAM;gBACpC,CAAC;QAED,mBAAmB,CAAC,IAAI,SAAW,IAAI,CAAC,QAAU,CAAC;oBAC/C,QAAQ,MAAM,MAAM,CAAC,GAAG,CAAC,CAAA,IACrB,EAAE,EAAE,KAAK,KAAK;4BAAE,GAAG,CAAC;4BAAE;wBAAO,IAAI;gBAEzC,CAAC;QAED,qBAAqB,CAAC;YAClB,yBAAyB;YACzB,MAAM,OAAO,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,GAAG,WAAW;YACnE,qDAAqD;YACrD,OAAO;QACX;IACJ,CAAC,GACD;IACI,MAAM;IACN,SAAS;IACT,SAAS,IAAA,qKAAiB,EAAC,IAAM;AACrC"}},
    {"offset": {"line": 1649, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/store/useNotificationStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport type NotificationType = 'INFO' | 'WARNING' | 'CRITICAL' | 'SUCCESS';\nexport type NotificationRole = 'ALL' | 'MANAGER' | 'CASHIER' | 'WAREHOUSE' | 'QF';\n\nexport interface Notification {\n    id: string;\n    title: string;\n    message: string;\n    type: NotificationType;\n    roleTarget: NotificationRole;\n    read: boolean;\n    timestamp: number;\n    link?: string;\n}\n\ninterface NotificationState {\n    notifications: Notification[];\n    pushNotification: (notification: Omit<Notification, 'id' | 'read' | 'timestamp'>) => void;\n    markAsRead: (id: string) => void;\n    markAllAsRead: () => void;\n    clearAll: () => void;\n    getUnreadCount: (userRole: string) => number;\n}\n\nexport const useNotificationStore = create<NotificationState>()(\n    persist(\n        (set, get) => ({\n            notifications: [],\n\n            pushNotification: (notification) => {\n                const newNotification: Notification = {\n                    ...notification,\n                    id: `notif-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n                    read: false,\n                    timestamp: Date.now(),\n                };\n                set((state) => ({\n                    notifications: [newNotification, ...state.notifications],\n                }));\n            },\n\n            markAsRead: (id) => {\n                set((state) => ({\n                    notifications: state.notifications.map((n) =>\n                        n.id === id ? { ...n, read: true } : n\n                    ),\n                }));\n            },\n\n            markAllAsRead: () => {\n                set((state) => ({\n                    notifications: state.notifications.map((n) => ({ ...n, read: true })),\n                }));\n            },\n\n            clearAll: () => {\n                set({ notifications: [] });\n            },\n\n            getUnreadCount: (userRole) => {\n                const { notifications } = get();\n                return notifications.filter(\n                    (n) =>\n                        !n.read &&\n                        (n.roleTarget === 'ALL' || n.roleTarget === userRole)\n                ).length;\n            },\n        }),\n        {\n            name: 'notification-storage',\n        }\n    )\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAyBO,MAAM,uBAAuB,IAAA,qJAAM,IACtC,IAAA,2JAAO,EACH,CAAC,KAAK,MAAQ,CAAC;QACX,eAAe,EAAE;QAEjB,kBAAkB,CAAC;YACf,MAAM,kBAAgC;gBAClC,GAAG,YAAY;gBACf,IAAI,CAAC,MAAM,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;gBACpE,MAAM;gBACN,WAAW,KAAK,GAAG;YACvB;YACA,IAAI,CAAC,QAAU,CAAC;oBACZ,eAAe;wBAAC;2BAAoB,MAAM,aAAa;qBAAC;gBAC5D,CAAC;QACL;QAEA,YAAY,CAAC;YACT,IAAI,CAAC,QAAU,CAAC;oBACZ,eAAe,MAAM,aAAa,CAAC,GAAG,CAAC,CAAC,IACpC,EAAE,EAAE,KAAK,KAAK;4BAAE,GAAG,CAAC;4BAAE,MAAM;wBAAK,IAAI;gBAE7C,CAAC;QACL;QAEA,eAAe;YACX,IAAI,CAAC,QAAU,CAAC;oBACZ,eAAe,MAAM,aAAa,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;4BAAE,GAAG,CAAC;4BAAE,MAAM;wBAAK,CAAC;gBACvE,CAAC;QACL;QAEA,UAAU;YACN,IAAI;gBAAE,eAAe,EAAE;YAAC;QAC5B;QAEA,gBAAgB,CAAC;YACb,MAAM,EAAE,aAAa,EAAE,GAAG;YAC1B,OAAO,cAAc,MAAM,CACvB,CAAC,IACG,CAAC,EAAE,IAAI,IACP,CAAC,EAAE,UAAU,KAAK,SAAS,EAAE,UAAU,KAAK,QAAQ,GAC1D,MAAM;QACZ;IACJ,CAAC,GACD;IACI,MAAM;AACV"}},
    {"offset": {"line": 1708, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/store/useSettingsStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nimport { HardwareConfig } from '../../domain/types';\n\ninterface SettingsState {\n    enable_sii_integration: boolean;\n    toggleSiiIntegration: () => void;\n    setSiiIntegration: (enabled: boolean) => void;\n\n    // Hardware\n    hardware: HardwareConfig;\n    updateHardwareConfig: (config: Partial<HardwareConfig>) => void;\n}\n\nexport const useSettingsStore = create<SettingsState>()(\n    persist(\n        (set) => ({\n            enable_sii_integration: false, // Default to false as per requirements\n            toggleSiiIntegration: () => set((state) => ({ enable_sii_integration: !state.enable_sii_integration })),\n            setSiiIntegration: (enabled) => set({ enable_sii_integration: enabled }),\n\n            // Hardware Defaults\n            hardware: {\n                pos_printer_width: '80mm',\n                label_printer_size: '50x25',\n                auto_print_pos: false,\n                auto_print_labels: false,\n                scanner_mode: 'KEYBOARD_WEDGE'\n            },\n            updateHardwareConfig: (config) => set((state) => ({\n                hardware: { ...state.hardware, ...config }\n            }))\n        }),\n        {\n            name: 'settings-storage',\n        }\n    )\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAcO,MAAM,mBAAmB,IAAA,qJAAM,IAClC,IAAA,2JAAO,EACH,CAAC,MAAQ,CAAC;QACN,wBAAwB;QACxB,sBAAsB,IAAM,IAAI,CAAC,QAAU,CAAC;oBAAE,wBAAwB,CAAC,MAAM,sBAAsB;gBAAC,CAAC;QACrG,mBAAmB,CAAC,UAAY,IAAI;gBAAE,wBAAwB;YAAQ;QAEtE,oBAAoB;QACpB,UAAU;YACN,mBAAmB;YACnB,oBAAoB;YACpB,gBAAgB;YAChB,mBAAmB;YACnB,cAAc;QAClB;QACA,sBAAsB,CAAC,SAAW,IAAI,CAAC,QAAU,CAAC;oBAC9C,UAAU;wBAAE,GAAG,MAAM,QAAQ;wBAAE,GAAG,MAAM;oBAAC;gBAC7C,CAAC;IACL,CAAC,GACD;IACI,MAAM;AACV"}},
    {"offset": {"line": 1748, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/hooks/useCashSession.ts"],"sourcesContent":["import { useMemo } from 'react';\nimport { usePharmaStore } from '../store/useStore';\nimport { SaleTransaction, CashMovement } from '../../domain/types';\n\nexport const useCashSession = () => {\n    const { currentShift, salesHistory, cashMovements } = usePharmaStore();\n\n    const metrics = useMemo(() => {\n        if (!currentShift) {\n            return null;\n        }\n\n        // 1. Filter Data for Current Shift\n        const shiftSales = salesHistory.filter(s =>\n            s.timestamp >= currentShift.start_time &&\n            (!currentShift.end_time || s.timestamp <= currentShift.end_time)\n        );\n\n        const shiftMovements = cashMovements.filter(m =>\n            m.shift_id === currentShift.id\n        );\n\n        // 2. Process Sales by Method\n        const cashSalesItems = shiftSales.filter(s => s.payment_method === 'CASH');\n        const cardSalesItems = shiftSales.filter(s => s.payment_method === 'DEBIT' || s.payment_method === 'CREDIT');\n        const transferSalesItems = shiftSales.filter(s => s.payment_method === 'TRANSFER');\n\n        const cashSales = {\n            count: cashSalesItems.length,\n            total: cashSalesItems.reduce((sum, s) => sum + s.total, 0),\n            items: cashSalesItems\n        };\n\n        const cardSales = {\n            count: cardSalesItems.length,\n            total: cardSalesItems.reduce((sum, s) => sum + s.total, 0),\n            items: cardSalesItems\n        };\n\n        const transferSales = {\n            count: transferSalesItems.length,\n            total: transferSalesItems.reduce((sum, s) => sum + s.total, 0),\n            items: transferSalesItems\n        };\n\n        const totalSales = shiftSales.reduce((sum, s) => sum + s.total, 0);\n\n        // 3. Process Movements\n        const inflows = shiftMovements.filter(m => m.type === 'IN' && m.is_cash);\n        const outflows = shiftMovements.filter(m => m.type === 'OUT' && m.is_cash);\n\n        const otherIncomes = {\n            count: inflows.length,\n            total: inflows.reduce((sum, m) => sum + m.amount, 0),\n            items: inflows\n        };\n\n        const expenses = {\n            count: outflows.length,\n            total: outflows.reduce((sum, m) => sum + m.amount, 0),\n            items: outflows\n        };\n\n        // 4. Calculate Theoretical Cash\n        // Base + Ventas Efectivo + Otros Ingresos - Salidas\n        const initialFund = currentShift.opening_amount;\n        const expectedCash = initialFund + cashSales.total + otherIncomes.total - expenses.total;\n\n        return {\n            totalSales,\n            cashSales,\n            cardSales,\n            transferSales,\n            otherIncomes,\n            expenses,\n            initialFund,\n            expectedCash\n        };\n    }, [currentShift, salesHistory, cashMovements]);\n\n    return metrics;\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAGO,MAAM,iBAAiB;;IAC1B,MAAM,EAAE,YAAY,EAAE,YAAY,EAAE,aAAa,EAAE,GAAG,IAAA,6JAAc;IAEpE,MAAM,UAAU,IAAA,wKAAO;2CAAC;YACpB,IAAI,CAAC,cAAc;gBACf,OAAO;YACX;YAEA,mCAAmC;YACnC,MAAM,aAAa,aAAa,MAAM;8DAAC,CAAA,IACnC,EAAE,SAAS,IAAI,aAAa,UAAU,IACtC,CAAC,CAAC,aAAa,QAAQ,IAAI,EAAE,SAAS,IAAI,aAAa,QAAQ;;YAGnE,MAAM,iBAAiB,cAAc,MAAM;kEAAC,CAAA,IACxC,EAAE,QAAQ,KAAK,aAAa,EAAE;;YAGlC,6BAA6B;YAC7B,MAAM,iBAAiB,WAAW,MAAM;kEAAC,CAAA,IAAK,EAAE,cAAc,KAAK;;YACnE,MAAM,iBAAiB,WAAW,MAAM;kEAAC,CAAA,IAAK,EAAE,cAAc,KAAK,WAAW,EAAE,cAAc,KAAK;;YACnG,MAAM,qBAAqB,WAAW,MAAM;sEAAC,CAAA,IAAK,EAAE,cAAc,KAAK;;YAEvE,MAAM,YAAY;gBACd,OAAO,eAAe,MAAM;gBAC5B,OAAO,eAAe,MAAM;uDAAC,CAAC,KAAK,IAAM,MAAM,EAAE,KAAK;sDAAE;gBACxD,OAAO;YACX;YAEA,MAAM,YAAY;gBACd,OAAO,eAAe,MAAM;gBAC5B,OAAO,eAAe,MAAM;uDAAC,CAAC,KAAK,IAAM,MAAM,EAAE,KAAK;sDAAE;gBACxD,OAAO;YACX;YAEA,MAAM,gBAAgB;gBAClB,OAAO,mBAAmB,MAAM;gBAChC,OAAO,mBAAmB,MAAM;uDAAC,CAAC,KAAK,IAAM,MAAM,EAAE,KAAK;sDAAE;gBAC5D,OAAO;YACX;YAEA,MAAM,aAAa,WAAW,MAAM;8DAAC,CAAC,KAAK,IAAM,MAAM,EAAE,KAAK;6DAAE;YAEhE,uBAAuB;YACvB,MAAM,UAAU,eAAe,MAAM;2DAAC,CAAA,IAAK,EAAE,IAAI,KAAK,QAAQ,EAAE,OAAO;;YACvE,MAAM,WAAW,eAAe,MAAM;4DAAC,CAAA,IAAK,EAAE,IAAI,KAAK,SAAS,EAAE,OAAO;;YAEzE,MAAM,eAAe;gBACjB,OAAO,QAAQ,MAAM;gBACrB,OAAO,QAAQ,MAAM;uDAAC,CAAC,KAAK,IAAM,MAAM,EAAE,MAAM;sDAAE;gBAClD,OAAO;YACX;YAEA,MAAM,WAAW;gBACb,OAAO,SAAS,MAAM;gBACtB,OAAO,SAAS,MAAM;uDAAC,CAAC,KAAK,IAAM,MAAM,EAAE,MAAM;sDAAE;gBACnD,OAAO;YACX;YAEA,gCAAgC;YAChC,oDAAoD;YACpD,MAAM,cAAc,aAAa,cAAc;YAC/C,MAAM,eAAe,cAAc,UAAU,KAAK,GAAG,aAAa,KAAK,GAAG,SAAS,KAAK;YAExF,OAAO;gBACH;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;YACJ;QACJ;0CAAG;QAAC;QAAc;QAAc;KAAc;IAE9C,OAAO;AACX;GA7Ea;;QAC6C,6JAAc"}},
    {"offset": {"line": 1861, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/hooks/useKioskGuard.ts"],"sourcesContent":["import { useEffect } from 'react';\n\nexport const useKioskGuard = (enabled: boolean = true) => {\n    useEffect(() => {\n        if (!enabled) return;\n\n        // 1. Block Back Button\n        const blockBackNavigation = () => {\n            window.history.pushState(null, '', window.location.href);\n        };\n\n        // Initial push to stack\n        blockBackNavigation();\n\n        window.addEventListener('popstate', blockBackNavigation);\n\n        // 2. Block Tab Close / Refresh\n        const handleBeforeUnload = (e: BeforeUnloadEvent) => {\n            e.preventDefault();\n            e.returnValue = ''; // Legacy support for Chrome\n            return '';\n        };\n\n        window.addEventListener('beforeunload', handleBeforeUnload);\n\n        // 3. Request Full Screen on First Interaction\n        const enterFullScreen = async () => {\n            try {\n                if (!document.fullscreenElement) {\n                    await document.documentElement.requestFullscreen();\n                }\n            } catch (err) {\n                console.log('Fullscreen request denied or not supported');\n            }\n        };\n\n        // Attach to click listener to satisfy browser policy\n        const handleInteraction = () => {\n            enterFullScreen();\n            window.removeEventListener('click', handleInteraction);\n        };\n\n        window.addEventListener('click', handleInteraction);\n\n        return () => {\n            window.removeEventListener('popstate', blockBackNavigation);\n            window.removeEventListener('beforeunload', handleBeforeUnload);\n            window.removeEventListener('click', handleInteraction);\n        };\n    }, [enabled]);\n};\n"],"names":[],"mappings":";;;;AAAA;;;AAEO,MAAM,gBAAgB,CAAC,UAAmB,IAAI;;IACjD,IAAA,0KAAS;mCAAC;YACN,IAAI,CAAC,SAAS;YAEd,uBAAuB;YACvB,MAAM;+DAAsB;oBACxB,OAAO,OAAO,CAAC,SAAS,CAAC,MAAM,IAAI,OAAO,QAAQ,CAAC,IAAI;gBAC3D;;YAEA,wBAAwB;YACxB;YAEA,OAAO,gBAAgB,CAAC,YAAY;YAEpC,+BAA+B;YAC/B,MAAM;8DAAqB,CAAC;oBACxB,EAAE,cAAc;oBAChB,EAAE,WAAW,GAAG,IAAI,4BAA4B;oBAChD,OAAO;gBACX;;YAEA,OAAO,gBAAgB,CAAC,gBAAgB;YAExC,8CAA8C;YAC9C,MAAM;2DAAkB;oBACpB,IAAI;wBACA,IAAI,CAAC,SAAS,iBAAiB,EAAE;4BAC7B,MAAM,SAAS,eAAe,CAAC,iBAAiB;wBACpD;oBACJ,EAAE,OAAO,KAAK;wBACV,QAAQ,GAAG,CAAC;oBAChB;gBACJ;;YAEA,qDAAqD;YACrD,MAAM;6DAAoB;oBACtB;oBACA,OAAO,mBAAmB,CAAC,SAAS;gBACxC;;YAEA,OAAO,gBAAgB,CAAC,SAAS;YAEjC;2CAAO;oBACH,OAAO,mBAAmB,CAAC,YAAY;oBACvC,OAAO,mBAAmB,CAAC,gBAAgB;oBAC3C,OAAO,mBAAmB,CAAC,SAAS;gBACxC;;QACJ;kCAAG;QAAC;KAAQ;AAChB;GAhDa"}},
    {"offset": {"line": 1931, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/hooks/useBarcodeScanner.ts"],"sourcesContent":["import { useEffect, useCallback, useRef } from 'react';\n\ninterface UseBarcodeScannerProps {\n    onScan: (barcode: string) => void;\n    minLength?: number;\n    latency?: number;\n    targetInputRef?: React.RefObject<HTMLInputElement | null>; // Optional: if provided, only listens to this input\n}\n\nexport const useBarcodeScanner = ({ onScan, minLength = 3, latency = 50, targetInputRef }: UseBarcodeScannerProps) => {\n    // We use a ref to keep track of the buffer to avoid dependency issues in the effect\n    const bufferRef = useRef('');\n    const lastKeyTimeRef = useRef(Date.now());\n\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            const target = e.target as HTMLElement;\n            const isInput = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA';\n\n            // If a specific input ref is provided, ONLY listen to that input\n            if (targetInputRef) {\n                if (target !== targetInputRef.current) return;\n            } else {\n                // Global mode: Ignore inputs to prevent interfering with normal typing\n                if (isInput) return;\n            }\n\n            const currentTime = Date.now();\n\n            // Reset buffer if latency exceeded (manual typing vs scanner speed)\n            if (currentTime - lastKeyTimeRef.current > latency) {\n                bufferRef.current = '';\n            }\n\n            if (e.key === 'Enter') {\n                // If buffer has enough length, trigger scan\n                if (bufferRef.current.length >= minLength) {\n                    e.preventDefault(); // Prevent form submission or newline\n                    onScan(bufferRef.current);\n                    bufferRef.current = '';\n                }\n            } else if (e.key.length === 1) {\n                // Accumulate characters\n                bufferRef.current += e.key;\n            }\n\n            lastKeyTimeRef.current = currentTime;\n        };\n\n        // If targetInputRef is provided, we attach to the element (if possible) or window but filter by target\n        // Since React refs might not be ready immediately or we want to capture bubbling, window listener is often safer for scanners\n        // acting as keyboards, but we check e.target.\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [onScan, minLength, latency, targetInputRef]);\n};\n"],"names":[],"mappings":";;;;AAAA;;;AASO,MAAM,oBAAoB,CAAC,EAAE,MAAM,EAAE,YAAY,CAAC,EAAE,UAAU,EAAE,EAAE,cAAc,EAA0B;;IAC7G,oFAAoF;IACpF,MAAM,YAAY,IAAA,uKAAM,EAAC;IACzB,MAAM,iBAAiB,IAAA,uKAAM,EAAC,KAAK,GAAG;IAEtC,IAAA,0KAAS;uCAAC;YACN,MAAM;6DAAgB,CAAC;oBACnB,MAAM,SAAS,EAAE,MAAM;oBACvB,MAAM,UAAU,OAAO,OAAO,KAAK,WAAW,OAAO,OAAO,KAAK;oBAEjE,iEAAiE;oBACjE,IAAI,gBAAgB;wBAChB,IAAI,WAAW,eAAe,OAAO,EAAE;oBAC3C,OAAO;wBACH,uEAAuE;wBACvE,IAAI,SAAS;oBACjB;oBAEA,MAAM,cAAc,KAAK,GAAG;oBAE5B,oEAAoE;oBACpE,IAAI,cAAc,eAAe,OAAO,GAAG,SAAS;wBAChD,UAAU,OAAO,GAAG;oBACxB;oBAEA,IAAI,EAAE,GAAG,KAAK,SAAS;wBACnB,4CAA4C;wBAC5C,IAAI,UAAU,OAAO,CAAC,MAAM,IAAI,WAAW;4BACvC,EAAE,cAAc,IAAI,qCAAqC;4BACzD,OAAO,UAAU,OAAO;4BACxB,UAAU,OAAO,GAAG;wBACxB;oBACJ,OAAO,IAAI,EAAE,GAAG,CAAC,MAAM,KAAK,GAAG;wBAC3B,wBAAwB;wBACxB,UAAU,OAAO,IAAI,EAAE,GAAG;oBAC9B;oBAEA,eAAe,OAAO,GAAG;gBAC7B;;YAEA,uGAAuG;YACvG,8HAA8H;YAC9H,8CAA8C;YAC9C,OAAO,gBAAgB,CAAC,WAAW;YACnC;+CAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;;QACvD;sCAAG;QAAC;QAAQ;QAAW;QAAS;KAAe;AACnD;GA9Ca"}}]
}