{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/settings/SiiSettings.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { Shield, Upload, FileText, CheckCircle, AlertTriangle, Key, Building2, Briefcase, Hash } from 'lucide-react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { validateCertificate } from '../../../domain/logic/sii/crypto';\n\nconst SiiSettings = () => {\n    const { siiConfiguration, siiCafs, updateSiiConfiguration, addCaf, getAvailableFolios } = usePharmaStore();\n\n    const [certFile, setCertFile] = useState<File | null>(null);\n    const [certPassword, setCertPassword] = useState('');\n    const [isValidating, setIsValidating] = useState(false);\n    const [validationResult, setValidationResult] = useState<{ valid: boolean; commonName?: string; expiryDate?: Date; error?: string } | null>(null);\n\n    // Company Info State\n    const [companyData, setCompanyData] = useState({\n        rut: siiConfiguration?.rut_emisor || '',\n        razonSocial: siiConfiguration?.razon_social || '',\n        giro: siiConfiguration?.giro || '',\n        acteco: siiConfiguration?.acteco || 477310\n    });\n\n    const handleCertificateUpload = async () => {\n        if (!certFile || !certPassword) {\n            alert('Por favor seleccione un certificado e ingrese la contrase√±a');\n            return;\n        }\n\n        setIsValidating(true);\n        try {\n            // Convert file to base64\n            const reader = new FileReader();\n            reader.onload = async (e) => {\n                const base64 = e.target?.result as string;\n                const pfxBase64 = base64.split(',')[1]; // Remove data:application/x-pkcs12;base64,\n\n                // Validate certificate\n                const result = await validateCertificate(pfxBase64, certPassword);\n                setValidationResult(result);\n\n                if (result.valid) {\n                    // Save to store\n                    const config = {\n                        id: siiConfiguration?.id || `SII-${Date.now()}`,\n                        rut_emisor: companyData.rut,\n                        razon_social: companyData.razonSocial,\n                        giro: companyData.giro,\n                        acteco: companyData.acteco,\n                        certificado_pfx_base64: pfxBase64,\n                        certificado_password: certPassword, // In production, encrypt this!\n                        fecha_vencimiento_firma: result.expiryDate?.getTime() || Date.now(),\n                        ambiente: siiConfiguration?.ambiente || 'CERTIFICACION' as const,\n                    };\n                    updateSiiConfiguration(config);\n                }\n            };\n            reader.readAsDataURL(certFile);\n        } catch (error) {\n            setValidationResult({ valid: false, error: 'Error al procesar el certificado' });\n        } finally {\n            setIsValidating(false);\n        }\n    };\n\n    const handleCafUpload = async (e: React.ChangeEvent<HTMLInputElement>, tipoDte: 39 | 33) => {\n        const file = e.target.files?.[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = (event) => {\n            const xmlContent = event.target?.result as string;\n\n            // TODO: Parse XML to extract rango_desde and rango_hasta\n            // For MVP, using mock values\n            const mockRangoDesde = 1;\n            const mockRangoHasta = tipoDte === 39 ? 1000 : 500;\n\n            addCaf({\n                tipo_dte: tipoDte,\n                xml_content: xmlContent,\n                rango_desde: mockRangoDesde,\n                rango_hasta: mockRangoHasta,\n                folios_usados: 0,\n                fecha_carga: Date.now(),\n                active: true\n            });\n\n            alert(`‚úÖ CAF cargado exitosamente. Folios disponibles: ${mockRangoHasta - mockRangoDesde}`);\n        };\n        reader.readAsText(file);\n    };\n\n    const toggleAmbiente = () => {\n        if (!siiConfiguration) return;\n        updateSiiConfiguration({\n            ...siiConfiguration,\n            ambiente: siiConfiguration.ambiente === 'CERTIFICACION' ? 'PRODUCCION' : 'CERTIFICACION'\n        });\n    };\n\n    return (\n        <div className=\"p-6 bg-slate-50 min-h-screen\">\n            <header className=\"mb-8\">\n                <h1 className=\"text-3xl font-extrabold text-slate-900 flex items-center gap-3\">\n                    <Shield className=\"text-green-600\" />\n                    Conexi√≥n SII (Servicio de Impuestos Internos)\n                </h1>\n                <p className=\"text-slate-500 mt-1\">Configure la facturaci√≥n electr√≥nica nativa. Sus datos est√°n protegidos.</p>\n            </header>\n\n            <div className=\"grid grid-cols-2 gap-6\">\n                {/* Company Information */}\n                <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-6\">\n                    <h2 className=\"text-xl font-bold text-slate-800 mb-4 flex items-center gap-2\">\n                        <Building2 className=\"text-blue-500\" size={20} />\n                        Informaci√≥n de la Empresa\n                    </h2>\n                    <div className=\"space-y-4\">\n                        <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-1\">RUT Emisor</label>\n                            <input\n                                type=\"text\"\n                                value={companyData.rut}\n                                onChange={(e) => setCompanyData({ ...companyData, rut: e.target.value })}\n                                placeholder=\"76.123.456-7\"\n                                className=\"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                            />\n                        </div>\n                        <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-1\">Raz√≥n Social</label>\n                            <input\n                                type=\"text\"\n                                value={companyData.razonSocial}\n                                onChange={(e) => setCompanyData({ ...companyData, razonSocial: e.target.value })}\n                                placeholder=\"FARMACIAS VALLENAR LTDA\"\n                                className=\"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                            />\n                        </div>\n                        <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-1\">Giro Comercial</label>\n                            <input\n                                type=\"text\"\n                                value={companyData.giro}\n                                onChange={(e) => setCompanyData({ ...companyData, giro: e.target.value })}\n                                placeholder=\"VENTA AL POR MENOR DE PRODUCTOS FARMACEUTICOS\"\n                                className=\"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                            />\n                        </div>\n                        <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-1\">ACTECO (C√≥digo Actividad)</label>\n                            <input\n                                type=\"number\"\n                                value={companyData.acteco}\n                                onChange={(e) => setCompanyData({ ...companyData, acteco: Number(e.target.value) })}\n                                placeholder=\"477310\"\n                                className=\"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                            />\n                        </div>\n                    </div>\n                </div>\n\n                {/* Certificate Upload */}\n                <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-6\">\n                    <h2 className=\"text-xl font-bold text-slate-800 mb-4 flex items-center gap-2\">\n                        <Key className=\"text-purple-500\" size={20} />\n                        Certificado Digital\n                    </h2>\n\n                    {validationResult?.valid ? (\n                        <div className=\"bg-green-50 border border-green-200 rounded-xl p-4 mb-4\">\n                            <div className=\"flex items-center gap-2 text-green-700 font-bold mb-2\">\n                                <CheckCircle size={20} />\n                                Certificado Cargado\n                            </div>\n                            <div className=\"text-sm text-green-600\">\n                                <p><strong>Titular:</strong> {validationResult.commonName}</p>\n                                <p><strong>Vencimiento:</strong> {validationResult.expiryDate?.toLocaleDateString()}</p>\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"space-y-4\">\n                            <div>\n                                <label className=\"block text-sm font-bold text-slate-700 mb-2\">Archivo PFX / P12</label>\n                                <input\n                                    type=\"file\"\n                                    accept=\".pfx,.p12\"\n                                    onChange={(e) => setCertFile(e.target.files?.[0] || null)}\n                                    className=\"w-full p-3 border border-slate-300 rounded-xl\"\n                                />\n                            </div>\n                            <div>\n                                <label className=\"block text-sm font-bold text-slate-700 mb-2\">Contrase√±a del Certificado</label>\n                                <input\n                                    type=\"password\"\n                                    value={certPassword}\n                                    onChange={(e) => setCertPassword(e.target.value)}\n                                    placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                                    className=\"w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500\"\n                                />\n                            </div>\n                            <button\n                                onClick={handleCertificateUpload}\n                                disabled={!certFile || !certPassword || isValidating}\n                                className=\"w-full py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-purple-200\"\n                            >\n                                {isValidating ? 'Validando...' : 'Cargar y Validar'}\n                            </button>\n                        </div>\n                    )}\n\n                    {validationResult && !validationResult.valid && (\n                        <div className=\"bg-red-50 border border-red-200 rounded-xl p-4 mt-4\">\n                            <div className=\"flex items-center gap-2 text-red-700 font-bold mb-1\">\n                                <AlertTriangle size={20} />\n                                Error\n                            </div>\n                            <p className=\"text-sm text-red-600\">{validationResult.error}</p>\n                        </div>\n                    )}\n                </div>\n\n                {/* CAF Management */}\n                <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-6 col-span-2\">\n                    <h2 className=\"text-xl font-bold text-slate-800 mb-4 flex items-center gap-2\">\n                        <FileText className=\"text-orange-500\" size={20} />\n                        Folios (CAF - C√≥digo de Autorizaci√≥n de Folios)\n                    </h2>\n\n                    <div className=\"grid grid-cols-2 gap-6\">\n                        {/* Boletas (39) */}\n                        <div className=\"border border-blue-200 rounded-xl p-4 bg-blue-50\">\n                            <h3 className=\"font-bold text-blue-800 mb-3 flex items-center gap-2\">\n                                <Hash size={18} />\n                                Boletas Electr√≥nicas (Tipo 39)\n                            </h3>\n                            <div className=\"mb-4\">\n                                <div className=\"text-sm text-blue-600 mb-2\">\n                                    <strong>Folios Disponibles:</strong> {getAvailableFolios(39)}\n                                </div>\n                                {siiCafs.filter(c => c.tipo_dte === 39).map(caf => (\n                                    <div key={caf.id} className=\"text-xs text-blue-500 bg-white p-2 rounded mb-1\">\n                                        Rango: {caf.rango_desde} - {caf.rango_hasta} | Usados: {caf.folios_usados}\n                                    </div>\n                                ))}\n                            </div>\n                            <input\n                                type=\"file\"\n                                accept=\".xml\"\n                                onChange={(e) => handleCafUpload(e, 39)}\n                                className=\"w-full p-2 border border-blue-300 rounded-lg text-sm\"\n                            />\n                        </div>\n\n                        {/* Facturas (33) */}\n                        <div className=\"border border-green-200 rounded-xl p-4 bg-green-50\">\n                            <h3 className=\"font-bold text-green-800 mb-3 flex items-center gap-2\">\n                                <Hash size={18} />\n                                Facturas Electr√≥nicas (Tipo 33)\n                            </h3>\n                            <div className=\"mb-4\">\n                                <div className=\"text-sm text-green-600 mb-2\">\n                                    <strong>Folios Disponibles:</strong> {getAvailableFolios(33)}\n                                </div>\n                                {siiCafs.filter(c => c.tipo_dte === 33).map(caf => (\n                                    <div key={caf.id} className=\"text-xs text-green-500 bg-white p-2 rounded mb-1\">\n                                        Rango: {caf.rango_desde} - {caf.rango_hasta} | Usados: {caf.folios_usados}\n                                    </div>\n                                ))}\n                            </div>\n                            <input\n                                type=\"file\"\n                                accept=\".xml\"\n                                onChange={(e) => handleCafUpload(e, 33)}\n                                className=\"w-full p-2 border border-green-300 rounded-lg text-sm\"\n                            />\n                        </div>\n                    </div>\n                </div>\n\n                {/* Environment Toggle */}\n                <div className=\"bg-white rounded-2xl shadow-sm border border-slate-200 p-6 col-span-2\">\n                    <h2 className=\"text-xl font-bold text-slate-800 mb-4 flex items-center gap-2\">\n                        <Briefcase className=\"text-indigo-500\" size={20} />\n                        Ambiente\n                    </h2>\n                    <div className=\"flex items-center gap-6\">\n                        <button\n                            onClick={toggleAmbiente}\n                            disabled={!siiConfiguration}\n                            className={`px-8 py-4 rounded-xl font-bold text-lg transition-all ${siiConfiguration?.ambiente === 'CERTIFICACION'\n                                    ? 'bg-yellow-500 text-white shadow-lg shadow-yellow-200'\n                                    : 'bg-slate-200 text-slate-500'\n                                }`}\n                        >\n                            üß™ Certificaci√≥n (Pruebas - Maullin)\n                        </button>\n                        <button\n                            onClick={toggleAmbiente}\n                            disabled={!siiConfiguration}\n                            className={`px-8 py-4 rounded-xl font-bold text-lg transition-all ${siiConfiguration?.ambiente === 'PRODUCCION'\n                                    ? 'bg-green-600 text-white shadow-lg shadow-green-200'\n                                    : 'bg-slate-200 text-slate-500'\n                                }`}\n                        >\n                            ‚úÖ Producci√≥n (Real - Palena)\n                        </button>\n                    </div>\n                    <p className=\"text-sm text-slate-500 mt-4\">\n                        <strong>Nota:</strong> Cambie a Producci√≥n solo cuando est√© listo para emitir documentos reales ante el SII.\n                    </p>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default SiiSettings;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 802, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/pages/settings/HardwarePage.tsx"],"sourcesContent":["import React, { useState, useRef } from 'react';\nimport { Printer, Scan, Settings, Save, CheckCircle, AlertTriangle, Barcode, Zap } from 'lucide-react';\nimport { useSettingsStore } from '../../store/useSettingsStore';\nimport { PrinterService } from '../../../infrastructure/services/PrinterService';\nimport { toast } from 'sonner';\n\nconst HardwarePage: React.FC = () => {\n    const { hardware, updateHardwareConfig } = useSettingsStore();\n    const [testBarcode, setTestBarcode] = useState('');\n    const [scanSpeed, setScanSpeed] = useState<number | null>(null);\n    const lastKeyTime = useRef<number>(0);\n\n    const handleScanTest = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const now = performance.now();\n        const timeDiff = now - lastKeyTime.current;\n        lastKeyTime.current = now;\n\n        setTestBarcode(e.target.value);\n\n        // Simple heuristic: if typing is super fast (<50ms per char), it's likely a scanner\n        if (timeDiff < 50 && e.target.value.length > 2) {\n            setScanSpeed(Math.round(timeDiff));\n        } else {\n            setScanSpeed(null);\n        }\n    };\n\n    const handleTestTicket = () => {\n        PrinterService.printTestTicket(hardware);\n        toast.success('Enviando ticket de prueba...');\n    };\n\n    const handleTestLabel = () => {\n        PrinterService.printLabel({\n            name: 'PARACETAMOL 500MG',\n            sku: '780000123456',\n            price: 1990,\n            barcode: '780000123456'\n        }, hardware);\n        toast.success('Enviando etiqueta de prueba...');\n    };\n\n    return (\n        <div className=\"p-8 max-w-6xl mx-auto space-y-8\">\n            <div className=\"flex items-center gap-3 mb-8\">\n                <div className=\"bg-blue-100 p-3 rounded-xl text-blue-600\">\n                    <Settings size={32} />\n                </div>\n                <div>\n                    <h1 className=\"text-2xl font-bold text-gray-800\">Hardware & Perif√©ricos</h1>\n                    <p className=\"text-gray-500\">Configuraci√≥n de impresoras, etiquetas y lectores de c√≥digo</p>\n                </div>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                {/* POS Printer Config */}\n                <div className=\"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden\">\n                    <div className=\"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center\">\n                        <h2 className=\"font-bold text-gray-800 flex items-center gap-2\">\n                            <Printer className=\"text-blue-500\" />\n                            Impresora de Tickets (POS)\n                        </h2>\n                        <span className=\"text-xs font-bold px-2 py-1 bg-blue-100 text-blue-600 rounded\">Caja / Mes√≥n</span>\n                    </div>\n                    <div className=\"p-6 space-y-6\">\n                        <div>\n                            <label className=\"block text-sm font-bold text-gray-700 mb-2\">Ancho del Papel</label>\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <button\n                                    onClick={() => updateHardwareConfig({ pos_printer_width: '80mm' })}\n                                    className={`p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-2 ${hardware.pos_printer_width === '80mm'\n                                        ? 'border-blue-500 bg-blue-50 text-blue-700'\n                                        : 'border-gray-200 hover:border-gray-300 text-gray-500'\n                                        }`}\n                                >\n                                    <span className=\"text-2xl font-bold\">80mm</span>\n                                    <span className=\"text-xs\">Est√°ndar</span>\n                                </button>\n                                <button\n                                    onClick={() => updateHardwareConfig({ pos_printer_width: '58mm' })}\n                                    className={`p-4 rounded-xl border-2 transition-all flex flex-col items-center gap-2 ${hardware.pos_printer_width === '58mm'\n                                        ? 'border-blue-500 bg-blue-50 text-blue-700'\n                                        : 'border-gray-200 hover:border-gray-300 text-gray-500'\n                                        }`}\n                                >\n                                    <span className=\"text-xl font-bold\">58mm</span>\n                                    <span className=\"text-xs\">Compacto</span>\n                                </button>\n                            </div>\n                        </div>\n\n                        <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100\">\n                            <div>\n                                <span className=\"block font-bold text-gray-700\">Impresi√≥n Autom√°tica</span>\n                                <span className=\"text-xs text-gray-500\">Imprimir al finalizar venta sin preguntar</span>\n                            </div>\n                            <button\n                                onClick={() => updateHardwareConfig({ auto_print_pos: !hardware.auto_print_pos })}\n                                className={`w-12 h-6 rounded-full transition-colors relative ${hardware.auto_print_pos ? 'bg-green-500' : 'bg-gray-300'\n                                    }`}\n                            >\n                                <div className={`absolute top-1 w-4 h-4 bg-white rounded-full transition-transform ${hardware.auto_print_pos ? 'left-7' : 'left-1'\n                                    }`} />\n                            </button>\n                        </div>\n\n                        <button\n                            onClick={handleTestTicket}\n                            className=\"w-full py-3 bg-gray-800 text-white font-bold rounded-xl hover:bg-gray-900 transition-colors flex items-center justify-center gap-2\"\n                        >\n                            <Printer size={18} />\n                            Probar Ticket de Prueba\n                        </button>\n                    </div>\n                </div>\n\n                {/* Label Printer Config */}\n                <div className=\"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden\">\n                    <div className=\"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center\">\n                        <h2 className=\"font-bold text-gray-800 flex items-center gap-2\">\n                            <Barcode className=\"text-purple-500\" />\n                            Impresora de Etiquetas\n                        </h2>\n                        <span className=\"text-xs font-bold px-2 py-1 bg-purple-100 text-purple-600 rounded\">Bodega</span>\n                    </div>\n                    <div className=\"p-6 space-y-6\">\n                        <div>\n                            <label className=\"block text-sm font-bold text-gray-700 mb-2\">Tama√±o de Etiqueta</label>\n                            <select\n                                value={hardware.label_printer_size}\n                                onChange={(e) => updateHardwareConfig({ label_printer_size: e.target.value as any })}\n                                className=\"w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-purple-500 outline-none\"\n                            >\n                                <option value=\"50x25\">50mm x 25mm (Est√°ndar Farmacia)</option>\n                                <option value=\"100x50\">100mm x 50mm (Caja/Bulto)</option>\n                            </select>\n                        </div>\n\n                        <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100\">\n                            <div>\n                                <span className=\"block font-bold text-gray-700\">Impresi√≥n Autom√°tica</span>\n                                <span className=\"text-xs text-gray-500\">Imprimir al recepcionar stock</span>\n                            </div>\n                            <button\n                                onClick={() => updateHardwareConfig({ auto_print_labels: !hardware.auto_print_labels })}\n                                className={`w-12 h-6 rounded-full transition-colors relative ${hardware.auto_print_labels ? 'bg-green-500' : 'bg-gray-300'\n                                    }`}\n                            >\n                                <div className={`absolute top-1 w-4 h-4 bg-white rounded-full transition-transform ${hardware.auto_print_labels ? 'left-7' : 'left-1'\n                                    }`} />\n                            </button>\n                        </div>\n\n                        <button\n                            onClick={handleTestLabel}\n                            className=\"w-full py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition-colors flex items-center justify-center gap-2\"\n                        >\n                            <Barcode size={18} />\n                            Probar Etiqueta\n                        </button>\n                    </div>\n                </div>\n\n                {/* Scanner Test */}\n                <div className=\"md:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden\">\n                    <div className=\"p-6 border-b border-gray-100 bg-gray-50 flex justify-between items-center\">\n                        <h2 className=\"font-bold text-gray-800 flex items-center gap-2\">\n                            <Scan className=\"text-orange-500\" />\n                            Prueba de Esc√°ner\n                        </h2>\n                        <div className=\"flex gap-2\">\n                            <span className={`text-xs font-bold px-2 py-1 rounded ${hardware.scanner_mode === 'KEYBOARD_WEDGE' ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-500'}`}>Teclado (Wedge)</span>\n                            <span className={`text-xs font-bold px-2 py-1 rounded ${hardware.scanner_mode === 'HID' ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-500'}`}>HID Nativo</span>\n                        </div>\n                    </div>\n                    <div className=\"p-6\">\n                        <div className=\"flex gap-6 items-center\">\n                            <div className=\"flex-1\">\n                                <label className=\"block text-sm font-bold text-gray-700 mb-2\">√Årea de Prueba</label>\n                                <div className=\"relative\">\n                                    <input\n                                        type=\"text\"\n                                        value={testBarcode}\n                                        onChange={handleScanTest}\n                                        placeholder=\"Haga clic aqu√≠ y escanee un c√≥digo...\"\n                                        className=\"w-full px-4 py-4 pl-12 rounded-xl border-2 border-dashed border-gray-300 focus:border-orange-500 focus:ring-4 focus:ring-orange-100 outline-none text-lg font-mono transition-all\"\n                                    />\n                                    <Scan className=\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\" />\n                                </div>\n                            </div>\n                            <div className=\"w-48 p-4 bg-gray-50 rounded-xl border border-gray-100 text-center\">\n                                <p className=\"text-xs font-bold text-gray-500 uppercase mb-1\">Velocidad</p>\n                                <div className=\"flex items-center justify-center gap-2\">\n                                    <Zap size={18} className={scanSpeed !== null ? 'text-yellow-500' : 'text-gray-300'} />\n                                    <span className=\"text-2xl font-bold text-gray-800\">{scanSpeed ? `${scanSpeed}ms` : '--'}</span>\n                                </div>\n                                <p className=\"text-[10px] text-gray-400 mt-1\">Latencia entre caracteres</p>\n                            </div>\n                        </div>\n                        {testBarcode && (\n                            <div className=\"mt-4 p-3 bg-green-50 border border-green-100 rounded-lg flex items-center gap-2 text-green-700\">\n                                <CheckCircle size={18} />\n                                <span className=\"font-bold\">C√≥digo detectado:</span>\n                                <span className=\"font-mono\">{testBarcode}</span>\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default HardwarePage;\n"],"names":[],"mappings":"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"}}]
}