{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/clinical/ClinicalSidebar.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { AlertTriangle, Clock, RefreshCw, XCircle, Send, Search, PlusCircle, Bot } from 'lucide-react';\nimport { ClinicalAnalysisResult, InventoryBatch } from '../../../domain/types';\nimport { ClinicalAgent } from '../../../domain/logic/clinicalAgent';\nimport { usePharmaStore } from '../../store/useStore';\n\ninterface ClinicalSidebarProps {\n    analysis: ClinicalAnalysisResult | null;\n    lastChecked: number;\n}\n\nconst ClinicalSidebar: React.FC<ClinicalSidebarProps> = ({ analysis, lastChecked }) => {\n    const { inventory, addToCart } = usePharmaStore();\n    const [query, setQuery] = useState('');\n    const [searchResults, setSearchResults] = useState<InventoryBatch[]>([]);\n    const [isSearching, setIsSearching] = useState(false);\n\n    const handleSearch = () => {\n        if (!query.trim()) {\n            setSearchResults([]);\n            setIsSearching(false);\n            return;\n        }\n\n        setIsSearching(true);\n        const results = ClinicalAgent.searchBySymptom(query, inventory);\n        setSearchResults(results);\n    };\n\n    const handleKeyDown = (e: React.KeyboardEvent) => {\n        if (e.key === 'Enter') {\n            handleSearch();\n        }\n    };\n\n    const statusColor = analysis?.status === 'BLOCK' ? 'bg-red-600' : analysis?.status === 'WARNING' ? 'bg-amber-500' : 'bg-emerald-600';\n\n    return (\n        <div className=\"w-full h-full flex flex-col bg-slate-800 rounded-xl shadow-lg overflow-hidden\">\n            {/* Header */}\n            <div className=\"p-4 border-b border-slate-700\">\n                <h3 className=\"text-lg font-bold text-cyan-400 flex items-center gap-2\">\n                    <Bot size={20} /> Agente Clínico IA\n                </h3>\n                <p className=\"text-[10px] text-slate-400\">Asistente Terapéutico & Seguridad</p>\n            </div>\n\n            {/* Content Area */}\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n\n                {/* 1. Safety Alerts (Always Visible if Critical) */}\n                {analysis && analysis.status !== 'SAFE' && (\n                    <div className={`p-3 rounded-xl text-white ${statusColor} animate-in fade-in slide-in-from-top-2`}>\n                        <div className=\"flex items-start gap-3\">\n                            {analysis.status === 'BLOCK' ? <XCircle size={24} className=\"shrink-0\" /> : <AlertTriangle size={24} className=\"shrink-0\" />}\n                            <div>\n                                <p className=\"font-bold text-sm mb-1\">\n                                    {analysis.status === 'BLOCK' ? 'INTERACCIÓN CRÍTICA' : 'ADVERTENCIA'}\n                                </p>\n                                <p className=\"text-xs opacity-90 leading-relaxed\">{analysis.message}</p>\n                                {analysis.blocking_items && (\n                                    <ul className=\"mt-2 text-[10px] bg-black/20 p-2 rounded-lg list-disc list-inside\">\n                                        {analysis.blocking_items.map((item, i) => <li key={i}>{item}</li>)}\n                                    </ul>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* 2. Search Results or Default State */}\n                {isSearching ? (\n                    <div className=\"space-y-3\">\n                        <div className=\"flex justify-between items-center\">\n                            <h4 className=\"text-xs font-bold text-cyan-300 uppercase tracking-wider\">\n                                Tratamientos Sugeridos\n                            </h4>\n                            <button\n                                onClick={() => { setIsSearching(false); setQuery(''); setSearchResults([]); }}\n                                className=\"text-[10px] text-slate-400 hover:text-white underline\"\n                            >\n                                Limpiar\n                            </button>\n                        </div>\n\n                        {searchResults.length > 0 ? (\n                            searchResults.map(item => (\n                                <div\n                                    key={item.id}\n                                    onClick={() => addToCart(item, 1)}\n                                    className=\"bg-slate-700 hover:bg-slate-600 p-3 rounded-xl cursor-pointer transition-colors group border border-transparent hover:border-cyan-500/50\"\n                                >\n                                    <div className=\"flex justify-between items-start mb-1\">\n                                        <h5 className=\"font-bold text-white text-sm line-clamp-1 group-hover:text-cyan-300\">{item.name}</h5>\n                                        <span className=\"text-[10px] font-mono bg-slate-800 text-slate-300 px-1.5 py-0.5 rounded\">\n                                            Stock: {item.stock_actual}\n                                        </span>\n                                    </div>\n                                    <p className=\"text-[10px] text-slate-400 mb-2 line-clamp-1\">{item.dci}</p>\n                                    <div className=\"flex justify-between items-center\">\n                                        <span className=\"font-bold text-emerald-400\">${item.price.toLocaleString()}</span>\n                                        <PlusCircle size={16} className=\"text-cyan-500 opacity-0 group-hover:opacity-100 transition-opacity\" />\n                                    </div>\n                                </div>\n                            ))\n                        ) : (\n                            <div className=\"text-center py-8 text-slate-500\">\n                                <Search size={32} className=\"mx-auto mb-2 opacity-50\" />\n                                <p className=\"text-xs\">No se encontraron productos para \"{query}\"</p>\n                            </div>\n                        )}\n                    </div>\n                ) : (\n                    /* Default State: Cross Selling Suggestions */\n                    analysis?.suggested_items && analysis.suggested_items.length > 0 ? (\n                        <div className=\"bg-slate-700/50 rounded-xl p-3 border border-slate-700\">\n                            <p className=\"text-xs text-cyan-300 font-bold mb-2 flex items-center gap-1\">\n                                <RefreshCw size={12} /> Oportunidades de Venta\n                            </p>\n                            <ul className=\"space-y-2\">\n                                {analysis.suggested_items.map((item, index) => (\n                                    <li key={index} className=\"text-xs text-slate-300 flex items-start gap-2 bg-slate-800 p-2 rounded-lg\">\n                                        <span className=\"text-cyan-500\">•</span> {item}\n                                    </li>\n                                ))}\n                            </ul>\n                        </div>\n                    ) : (\n                        <div className=\"text-center py-10 text-slate-600\">\n                            <Bot size={48} className=\"mx-auto mb-3 opacity-20\" />\n                            <p className=\"text-xs\">El agente está listo para ayudar.</p>\n                            <p className=\"text-[10px] mt-1\">Escribe un síntoma abajo.</p>\n                        </div>\n                    )\n                )}\n            </div>\n\n            {/* Chat Input Area */}\n            <div className=\"p-4 bg-slate-900 border-t border-slate-700\">\n                <div className=\"relative\">\n                    <input\n                        type=\"text\"\n                        value={query}\n                        onChange={(e) => setQuery(e.target.value)}\n                        onKeyDown={handleKeyDown}\n                        placeholder=\"Escribe síntoma (ej: dolor de cabeza)...\"\n                        className=\"w-full bg-slate-800 text-white pl-4 pr-10 py-3 rounded-xl border border-slate-700 focus:border-cyan-500 focus:outline-none text-sm placeholder:text-slate-500\"\n                    />\n                    <button\n                        onClick={handleSearch}\n                        className=\"absolute right-2 top-1/2 -translate-y-1/2 text-cyan-500 hover:text-cyan-400 p-1.5 hover:bg-cyan-500/10 rounded-lg transition-colors\"\n                    >\n                        <Send size={16} />\n                    </button>\n                </div>\n                <div className=\"flex justify-between items-center mt-2 px-1\">\n                    <p className=\"text-[10px] text-slate-500 flex items-center gap-1\">\n                        <Clock size={10} /> Actualizado: {new Date(lastChecked).toLocaleTimeString('es-CL')}\n                    </p>\n                    <span className=\"text-[10px] font-bold text-emerald-500/80\">ONLINE</span>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default ClinicalSidebar;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 490, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/ClientPanel.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { User, Search, UserPlus, X, Save } from 'lucide-react';\nimport { Customer } from '../../../domain/types';\n\nconst ClientPanel: React.FC = () => {\n    const { currentCustomer, setCustomer, customers, addCustomer } = usePharmaStore();\n    const [rutInput, setRutInput] = useState('');\n    const [isSearching, setIsSearching] = useState(false);\n\n    // Modal State\n    const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);\n    const [newClientName, setNewClientName] = useState('');\n    const [newClientPhone, setNewClientPhone] = useState('');\n\n    // Formateador de RUT Chileno\n    const formatRut = (value: string) => {\n        // Eliminar puntos y guión\n        const clean = value.replace(/[^0-9kK]/g, '');\n        if (clean.length <= 1) return clean;\n\n        const body = clean.slice(0, -1);\n        const dv = clean.slice(-1).toUpperCase();\n\n        // Formato con puntos\n        let formattedBody = '';\n        for (let i = body.length - 1, j = 0; i >= 0; i--, j++) {\n            formattedBody = body.charAt(i) + (j > 0 && j % 3 === 0 ? '.' : '') + formattedBody;\n        }\n\n        return `${formattedBody}-${dv}`;\n    };\n\n    const handleRutChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        setRutInput(formatRut(e.target.value));\n    };\n\n    const handleSearch = () => {\n        if (!rutInput) return;\n        setIsSearching(true);\n\n        // Búsqueda Real en Store\n        const found = customers.find(c => c.rut === rutInput);\n\n        if (found) {\n            setCustomer(found);\n        } else {\n            setCustomer(null);\n            // Si no existe, sugerir crear\n        }\n        setIsSearching(false);\n    };\n\n    const handleCreateClient = () => {\n        if (!newClientName) return;\n\n        const newCustomer = addCustomer({\n            rut: rutInput,\n            fullName: newClientName,\n            phone: newClientPhone,\n            registrationSource: 'POS'\n        });\n\n        setCustomer(newCustomer);\n        setIsCreateModalOpen(false);\n        setNewClientName('');\n        setNewClientPhone('');\n    };\n\n    return (\n        <div className=\"bg-white rounded-2xl p-4 shadow-sm border border-slate-200 mb-4\">\n            <h3 className=\"text-sm font-bold text-slate-500 mb-3 flex items-center gap-2\">\n                <User size={16} /> CLIENTE (CRM)\n            </h3>\n\n            {!currentCustomer ? (\n                <div className=\"flex gap-2\">\n                    <div className=\"relative flex-1\">\n                        <input\n                            type=\"text\"\n                            placeholder=\"RUT (12.345.678-K)\"\n                            className=\"w-full pl-3 pr-10 py-2 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none font-mono text-sm\"\n                            value={rutInput}\n                            onChange={handleRutChange}\n                            onKeyDown={(e) => e.key === 'Enter' && handleSearch()}\n                        />\n                        <button\n                            onClick={handleSearch}\n                            className=\"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-cyan-600\"\n                        >\n                            <Search size={18} />\n                        </button>\n                    </div>\n                    {rutInput.length > 8 && !isSearching && !customers.find(c => c.rut === rutInput) && (\n                        <button\n                            onClick={() => setIsCreateModalOpen(true)}\n                            className=\"bg-cyan-100 text-cyan-700 p-2 rounded-xl hover:bg-cyan-200 transition\"\n                            title=\"Crear Cliente Rápido\"\n                        >\n                            <UserPlus size={20} />\n                        </button>\n                    )}\n                </div>\n            ) : (\n                <div className=\"bg-emerald-50 border border-emerald-100 rounded-xl p-3 relative\">\n                    <button\n                        onClick={() => { setCustomer(null); setRutInput(''); }}\n                        className=\"absolute top-2 right-2 text-emerald-400 hover:text-emerald-700\"\n                    >\n                        <X size={16} />\n                    </button>\n\n                    <div className=\"flex items-center gap-3 mb-2\">\n                        <div className=\"w-10 h-10 rounded-full bg-emerald-200 flex items-center justify-center text-emerald-700 font-bold\">\n                            {currentCustomer.fullName.charAt(0)}\n                        </div>\n                        <div>\n                            <h4 className=\"font-bold text-slate-800 text-sm\">{currentCustomer.fullName}</h4>\n                            <p className=\"text-xs text-slate-500 font-mono\">{currentCustomer.rut}</p>\n                        </div>\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                        <span className=\"text-[10px] bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full font-bold border border-amber-200\">\n                            ★ {currentCustomer.totalPoints} pts\n                        </span>\n                        {currentCustomer.health_tags.map(tag => (\n                            <span key={tag} className=\"text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded-full font-bold border border-red-200\">\n                                {tag}\n                            </span>\n                        ))}\n                    </div>\n                </div>\n            )}\n\n            {/* Quick Create Form (Inline) */}\n            {isCreateModalOpen ? (\n                <div className=\"mt-4 p-4 bg-cyan-50 rounded-xl border border-cyan-100 animate-in fade-in slide-in-from-top-2\">\n                    <div className=\"flex justify-between items-center mb-3\">\n                        <h4 className=\"font-bold text-cyan-800 text-sm\">Alta Rápida de Cliente</h4>\n                        <button onClick={() => setIsCreateModalOpen(false)}><X size={16} className=\"text-cyan-400 hover:text-cyan-700\" /></button>\n                    </div>\n\n                    <div className=\"space-y-3\">\n                        <div>\n                            <label className=\"block text-[10px] font-bold text-cyan-600 uppercase mb-1\">RUT</label>\n                            <input type=\"text\" value={rutInput} disabled className=\"w-full p-2 bg-white rounded-lg border border-cyan-200 text-slate-500 font-mono text-xs\" />\n                        </div>\n                        <div>\n                            <label className=\"block text-[10px] font-bold text-cyan-600 uppercase mb-1\">Nombre Completo *</label>\n                            <input\n                                type=\"text\"\n                                autoFocus\n                                className=\"w-full p-2 border-2 border-cyan-200 rounded-lg focus:border-cyan-500 focus:outline-none text-sm\"\n                                placeholder=\"Ej: Juan Pérez\"\n                                value={newClientName}\n                                onChange={(e) => setNewClientName(e.target.value)}\n                            />\n                        </div>\n                        <div>\n                            <label className=\"block text-[10px] font-bold text-cyan-600 uppercase mb-1\">WhatsApp (Opcional)</label>\n                            <input\n                                type=\"tel\"\n                                placeholder=\"+569...\"\n                                className=\"w-full p-2 border-2 border-cyan-200 rounded-lg focus:border-cyan-500 focus:outline-none text-sm\"\n                                value={newClientPhone}\n                                onChange={(e) => setNewClientPhone(e.target.value)}\n                            />\n                        </div>\n                        <button\n                            onClick={handleCreateClient}\n                            disabled={!newClientName}\n                            className=\"w-full py-2 bg-cyan-600 text-white font-bold rounded-lg hover:bg-cyan-700 transition flex items-center justify-center gap-2 disabled:opacity-50 text-sm shadow-sm\"\n                        >\n                            <Save size={14} /> Guardar y Asignar\n                        </button>\n                    </div>\n                </div>\n            ) : null}\n        </div>\n    );\n};\n\nexport default ClientPanel;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 909, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/PrescriptionModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { FileText, Stethoscope, CheckSquare, AlertTriangle } from 'lucide-react';\n\ninterface PrescriptionModalProps {\n    isOpen: boolean;\n    onConfirm: (data: { folio: string, doctorRut: string }) => void;\n    onCancel: () => void;\n    itemName: string;\n}\n\nconst PrescriptionModal: React.FC<PrescriptionModalProps> = ({ isOpen, onConfirm, onCancel, itemName }) => {\n    const [folio, setFolio] = useState('');\n    const [doctorRut, setDoctorRut] = useState('');\n    const [isArchived, setIsArchived] = useState(false);\n\n    if (!isOpen) return null;\n\n    const isValid = folio.length > 0 && doctorRut.length > 8 && isArchived;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-amber-50 p-6 border-b border-amber-100\">\n                    <h3 className=\"text-xl font-bold text-amber-800 flex items-center gap-2\">\n                        <AlertTriangle className=\"text-amber-600\" /> Receta Retenida\n                    </h3>\n                    <p className=\"text-sm text-amber-700 mt-1\">\n                        La venta de <strong>{itemName}</strong> requiere receta retenida.\n                    </p>\n                </div>\n\n                <div className=\"p-6 space-y-4\">\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-700 mb-1 flex items-center gap-2\">\n                            <FileText size={16} /> Folio Receta\n                        </label>\n                        <input\n                            type=\"text\"\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none\"\n                            placeholder=\"Ej: A-123456\"\n                            value={folio}\n                            onChange={(e) => setFolio(e.target.value)}\n                        />\n                    </div>\n\n                    <div>\n                        <label className=\"block text-sm font-bold text-slate-700 mb-1 flex items-center gap-2\">\n                            <Stethoscope size={16} /> RUT Médico Prescriptor\n                        </label>\n                        <input\n                            type=\"text\"\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-amber-500 focus:outline-none\"\n                            placeholder=\"Ej: 11.222.333-4\"\n                            value={doctorRut}\n                            onChange={(e) => setDoctorRut(e.target.value)}\n                        />\n                    </div>\n\n                    <div className=\"bg-slate-50 p-4 rounded-xl border border-slate-200\">\n                        <label className=\"flex items-center gap-3 cursor-pointer\">\n                            <div className={`w-6 h-6 rounded border-2 flex items-center justify-center transition-colors ${isArchived ? 'bg-amber-500 border-amber-500 text-white' : 'border-slate-300 bg-white'}`}>\n                                {isArchived && <CheckSquare size={16} />}\n                            </div>\n                            <input\n                                type=\"checkbox\"\n                                className=\"hidden\"\n                                checked={isArchived}\n                                onChange={(e) => setIsArchived(e.target.checked)}\n                            />\n                            <span className=\"text-sm font-bold text-slate-700\">Receta Física Archivada</span>\n                        </label>\n                        <p className=\"text-xs text-slate-400 mt-2 ml-9\">\n                            Declaro haber recibido y archivado la receta física correspondiente.\n                        </p>\n                    </div>\n\n                    <div className=\"flex gap-3 pt-4\">\n                        <button\n                            onClick={onCancel}\n                            className=\"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl transition\"\n                        >\n                            Cancelar\n                        </button>\n                        <button\n                            onClick={() => isValid && onConfirm({ folio, doctorRut })}\n                            disabled={!isValid}\n                            className=\"flex-1 py-3 bg-amber-600 text-white font-bold rounded-xl hover:bg-amber-700 transition disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-amber-200\"\n                        >\n                            Confirmar\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default PrescriptionModal;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;AAAA;;;;;AASA,MAAM,oBAAsD,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE;;IAClG,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAE7C,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,UAAU,MAAM,MAAM,GAAG,KAAK,UAAU,MAAM,GAAG,KAAK;IAE5D,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAG,WAAU;;8CACV,6LAAC,4OAAa;oCAAC,WAAU;;;;;;gCAAmB;;;;;;;sCAEhD,6LAAC;4BAAE,WAAU;;gCAA8B;8CAC3B,6LAAC;8CAAQ;;;;;;gCAAkB;;;;;;;;;;;;;8BAI/C,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;;8CACG,6LAAC;oCAAM,WAAU;;sDACb,6LAAC,6NAAQ;4CAAC,MAAM;;;;;;wCAAM;;;;;;;8CAE1B,6LAAC;oCACG,MAAK;oCACL,WAAU;oCACV,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;sCAIhD,6LAAC;;8CACG,6LAAC;oCAAM,WAAU;;sDACb,6LAAC,kOAAW;4CAAC,MAAM;;;;;;wCAAM;;;;;;;8CAE7B,6LAAC;oCACG,MAAK;oCACL,WAAU;oCACV,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;sCAIpD,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAM,WAAU;;sDACb,6LAAC;4CAAI,WAAW,CAAC,4EAA4E,EAAE,aAAa,6CAA6C,6BAA6B;sDACjL,4BAAc,6LAAC,6OAAW;gDAAC,MAAM;;;;;;;;;;;sDAEtC,6LAAC;4CACG,MAAK;4CACL,WAAU;4CACV,SAAS;4CACT,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,OAAO;;;;;;sDAEnD,6LAAC;4CAAK,WAAU;sDAAmC;;;;;;;;;;;;8CAEvD,6LAAC;oCAAE,WAAU;8CAAmC;;;;;;;;;;;;sCAKpD,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCACG,SAAS;oCACT,WAAU;8CACb;;;;;;8CAGD,6LAAC;oCACG,SAAS,IAAM,WAAW,UAAU;4CAAE;4CAAO;wCAAU;oCACvD,UAAU,CAAC;oCACX,WAAU;8CACb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQzB;GArFM;KAAA;uCAuFS"}},
    {"offset": {"line": 1173, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/ManualItemModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { PlusCircle, DollarSign, Package } from 'lucide-react';\n\ninterface ManualItemModalProps {\n    isOpen: boolean;\n    onConfirm: (data: { description: string, price: number, quantity: number }) => void;\n    onClose: () => void;\n}\n\nconst ManualItemModal: React.FC<ManualItemModalProps> = ({ isOpen, onConfirm, onClose }) => {\n    const [description, setDescription] = useState('');\n    const [price, setPrice] = useState('');\n    const [quantity, setQuantity] = useState('1');\n\n    if (!isOpen) return null;\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (description && price) {\n            onConfirm({\n                description,\n                price: parseInt(price),\n                quantity: parseInt(quantity)\n            });\n            // Reset\n            setDescription('');\n            setPrice('');\n            setQuantity('1');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-slate-900 p-4 border-b border-slate-800 text-white\">\n                    <h3 className=\"text-lg font-bold flex items-center gap-2\">\n                        <PlusCircle className=\"text-cyan-400\" /> Ítem Manual / Vario\n                    </h3>\n                </div>\n\n                <form onSubmit={handleSubmit} className=\"p-6 space-y-4\">\n                    <div>\n                        <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Descripción</label>\n                        <input\n                            type=\"text\"\n                            autoFocus\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                            placeholder=\"Ej: Servicio Inyectable\"\n                            value={description}\n                            onChange={(e) => setDescription(e.target.value)}\n                        />\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Precio Unit.</label>\n                            <div className=\"relative\">\n                                <DollarSign size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" />\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full pl-8 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                                    placeholder=\"0\"\n                                    value={price}\n                                    onChange={(e) => setPrice(e.target.value)}\n                                />\n                            </div>\n                        </div>\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Cantidad</label>\n                            <div className=\"relative\">\n                                <Package size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" />\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full pl-8 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                                    value={quantity}\n                                    onChange={(e) => setQuantity(e.target.value)}\n                                />\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"flex gap-3 pt-4\">\n                        <button\n                            type=\"button\"\n                            onClick={onClose}\n                            className=\"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl transition\"\n                        >\n                            Cancelar\n                        </button>\n                        <button\n                            type=\"submit\"\n                            className=\"flex-1 py-3 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition shadow-lg shadow-cyan-200\"\n                        >\n                            Agregar\n                        </button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    );\n};\n\nexport default ManualItemModal;\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;;;;;AAQA,MAAM,kBAAkD,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE;;IACnF,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IAEzC,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,eAAe,CAAC;QAClB,EAAE,cAAc;QAChB,IAAI,eAAe,OAAO;YACtB,UAAU;gBACN;gBACA,OAAO,SAAS;gBAChB,UAAU,SAAS;YACvB;YACA,QAAQ;YACR,eAAe;YACf,SAAS;YACT,YAAY;QAChB;IACJ;IAEA,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;8BACX,cAAA,6LAAC;wBAAG,WAAU;;0CACV,6LAAC,mOAAU;gCAAC,WAAU;;;;;;4BAAkB;;;;;;;;;;;;8BAIhD,6LAAC;oBAAK,UAAU;oBAAc,WAAU;;sCACpC,6LAAC;;8CACG,6LAAC;oCAAM,WAAU;8CAAwD;;;;;;8CACzE,6LAAC;oCACG,MAAK;oCACL,SAAS;oCACT,WAAU;oCACV,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;sCAItD,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;;sDACG,6LAAC;4CAAM,WAAU;sDAAwD;;;;;;sDACzE,6LAAC;4CAAI,WAAU;;8DACX,6LAAC,mOAAU;oDAAC,MAAM;oDAAI,WAAU;;;;;;8DAChC,6LAAC;oDACG,MAAK;oDACL,WAAU;oDACV,aAAY;oDACZ,OAAO;oDACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;;;8CAIpD,6LAAC;;sDACG,6LAAC;4CAAM,WAAU;sDAAwD;;;;;;sDACzE,6LAAC;4CAAI,WAAU;;8DACX,6LAAC,sNAAO;oDAAC,MAAM;oDAAI,WAAU;;;;;;8DAC7B,6LAAC;oDACG,MAAK;oDACL,WAAU;oDACV,OAAO;oDACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;;;;;;;;;sCAM3D,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCACG,MAAK;oCACL,SAAS;oCACT,WAAU;8CACb;;;;;;8CAGD,6LAAC;oCACG,MAAK;oCACL,WAAU;8CACb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQzB;GA3FM;KAAA;uCA6FS"}},
    {"offset": {"line": 1421, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/CashManagementModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, DollarSign, Camera, AlertTriangle, CheckCircle, TrendingDown, TrendingUp, Lock } from 'lucide-react';\nimport { CashMovementReason } from '../../../domain/types';\n\ninterface CashManagementModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst CashManagementModal: React.FC<CashManagementModalProps> = ({ isOpen, onClose }) => {\n    const { currentShift, openShift, closeShift, registerCashMovement, getShiftMetrics } = usePharmaStore();\n    const [activeTab, setActiveTab] = useState<'OPENING' | 'EXPENSE' | 'CLOSING'>('OPENING');\n\n    // Opening State\n    const [openingAmount, setOpeningAmount] = useState('');\n\n    // Expense State\n    const [expenseAmount, setExpenseAmount] = useState('');\n    const [expenseReason, setExpenseReason] = useState<CashMovementReason>('SUPPLIES');\n    const [expenseDescription, setExpenseDescription] = useState('');\n    const [expenseEvidence, setExpenseEvidence] = useState<string | null>(null);\n\n    // Closing State\n    const [closingAmount, setClosingAmount] = useState('');\n    const [metrics, setMetrics] = useState<any>(null);\n\n    useEffect(() => {\n        if (isOpen) {\n            if (!currentShift || currentShift.status === 'CLOSED') {\n                setActiveTab('OPENING');\n            } else {\n                setActiveTab('EXPENSE'); // Default to expense if open\n                setMetrics(getShiftMetrics());\n            }\n        }\n    }, [isOpen, currentShift]);\n\n    useEffect(() => {\n        if (currentShift?.status === 'OPEN') {\n            const interval = setInterval(() => {\n                setMetrics(getShiftMetrics());\n            }, 1000); // Update metrics every second\n            return () => clearInterval(interval);\n        }\n    }, [currentShift]);\n\n\n    const handleOpenShift = () => {\n        const amount = parseInt(openingAmount);\n        if (isNaN(amount) || amount < 0) return;\n        openShift(amount);\n        setActiveTab('EXPENSE');\n    };\n\n    const handleRegisterExpense = () => {\n        const amount = parseInt(expenseAmount);\n        if (isNaN(amount) || amount <= 0) return;\n        if (!expenseEvidence && expenseDescription.length < 10) return; // Validation rule\n\n        registerCashMovement({\n            type: 'OUT',\n            amount,\n            reason: expenseReason,\n            description: expenseDescription,\n            evidence_url: expenseEvidence || undefined,\n            is_cash: true\n        });\n\n        // Reset form\n        setExpenseAmount('');\n        setExpenseDescription('');\n        setExpenseEvidence(null);\n        alert('Gasto registrado correctamente');\n    };\n\n    const handleCloseShift = () => {\n        const amount = parseInt(closingAmount);\n        if (isNaN(amount) || amount < 0) return;\n\n        if (window.confirm('¿Estás seguro de cerrar la caja? Esta acción no se puede deshacer.')) {\n            closeShift(amount);\n            onClose();\n        }\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <AnimatePresence>\n            <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\"\n            >\n                <motion.div\n                    initial={{ scale: 0.95, opacity: 0 }}\n                    animate={{ scale: 1, opacity: 1 }}\n                    exit={{ scale: 0.95, opacity: 0 }}\n                    className=\"bg-white rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]\"\n                >\n                    {/* Header */}\n                    <div className=\"p-6 border-b border-gray-100 flex justify-between items-center bg-slate-50\">\n                        <div>\n                            <h2 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\n                                <DollarSign className=\"text-blue-600\" />\n                                Gestión de Caja\n                            </h2>\n                            <p className=\"text-sm text-slate-500\">\n                                {currentShift?.status === 'OPEN' ? `Turno Abierto - Inicio: ${new Date(currentShift.start_time).toLocaleTimeString()}` : 'Turno Cerrado'}\n                            </p>\n                        </div>\n                        <button onClick={onClose} className=\"text-slate-400 hover:text-slate-600\">\n                            <X size={24} />\n                        </button>\n                    </div>\n\n                    {/* Tabs (Only visible if shift is open) */}\n                    {currentShift?.status === 'OPEN' && (\n                        <div className=\"flex border-b border-gray-100\">\n                            <button\n                                onClick={() => setActiveTab('EXPENSE')}\n                                className={`flex-1 py-4 text-sm font-semibold transition-colors ${activeTab === 'EXPENSE' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50' : 'text-slate-500 hover:bg-slate-50'}`}\n                            >\n                                Registrar Salida/Gasto\n                            </button>\n                            <button\n                                onClick={() => setActiveTab('CLOSING')}\n                                className={`flex-1 py-4 text-sm font-semibold transition-colors ${activeTab === 'CLOSING' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50' : 'text-slate-500 hover:bg-slate-50'}`}\n                            >\n                                Arqueo y Cierre\n                            </button>\n                        </div>\n                    )}\n\n                    {/* Content */}\n                    <div className=\"p-6 overflow-y-auto flex-1\">\n\n                        {/* A. OPENING */}\n                        {activeTab === 'OPENING' && (\n                            <div className=\"text-center py-8\">\n                                <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-green-600\">\n                                    <Lock size={40} />\n                                </div>\n                                <h3 className=\"text-2xl font-bold text-slate-800 mb-2\">Apertura de Caja</h3>\n                                <p className=\"text-slate-500 mb-8\">Ingresa el monto de dinero sencillo con el que inicias el turno.</p>\n\n                                <div className=\"max-w-xs mx-auto\">\n                                    <label className=\"block text-sm font-medium text-slate-700 mb-2 text-left\">Monto Inicial</label>\n                                    <div className=\"relative\">\n                                        <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-lg\">$</span>\n                                        <input\n                                            type=\"number\"\n                                            value={openingAmount}\n                                            onChange={(e) => setOpeningAmount(e.target.value)}\n                                            className=\"w-full pl-8 pr-4 py-4 text-2xl font-bold text-slate-800 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all\"\n                                            placeholder=\"0\"\n                                            autoFocus\n                                        />\n                                    </div>\n                                    <button\n                                        onClick={handleOpenShift}\n                                        disabled={!openingAmount}\n                                        className=\"w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold shadow-lg shadow-blue-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all\"\n                                    >\n                                        Abrir Caja\n                                    </button>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* B. EXPENSE */}\n                        {activeTab === 'EXPENSE' && (\n                            <div className=\"space-y-6\">\n                                <div className=\"grid grid-cols-2 gap-6\">\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">Monto a Retirar</label>\n                                        <div className=\"relative\">\n                                            <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\">$</span>\n                                            <input\n                                                type=\"number\"\n                                                value={expenseAmount}\n                                                onChange={(e) => setExpenseAmount(e.target.value)}\n                                                className=\"w-full pl-8 pr-4 py-3 text-lg font-bold text-slate-800 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none\"\n                                                placeholder=\"0\"\n                                            />\n                                        </div>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-sm font-medium text-slate-700 mb-2\">Motivo</label>\n                                        <select\n                                            value={expenseReason}\n                                            onChange={(e) => setExpenseReason(e.target.value as CashMovementReason)}\n                                            className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none\"\n                                        >\n                                            <option value=\"SUPPLIES\">Insumos / Gastos Menores</option>\n                                            <option value=\"SERVICES\">Pago Servicios</option>\n                                            <option value=\"WITHDRAWAL\">Retiro de Utilidades</option>\n                                            <option value=\"OTHER\">Otro</option>\n                                        </select>\n                                    </div>\n                                </div>\n\n                                <div>\n                                    <label className=\"block text-sm font-medium text-slate-700 mb-2\">Descripción / Justificación</label>\n                                    <textarea\n                                        value={expenseDescription}\n                                        onChange={(e) => setExpenseDescription(e.target.value)}\n                                        className=\"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none h-24 resize-none\"\n                                        placeholder=\"Detalla el gasto (mínimo 10 caracteres si no hay foto)...\"\n                                    />\n                                </div>\n\n                                <div className=\"border-2 border-dashed border-slate-300 rounded-xl p-6 text-center hover:bg-slate-50 transition-colors cursor-pointer relative\">\n                                    <input\n                                        type=\"file\"\n                                        className=\"absolute inset-0 opacity-0 cursor-pointer\"\n                                        onChange={(e) => setExpenseEvidence('https://via.placeholder.com/300')} // Mock upload\n                                    />\n                                    {expenseEvidence ? (\n                                        <div className=\"flex items-center justify-center gap-2 text-green-600 font-medium\">\n                                            <CheckCircle size={20} />\n                                            Evidencia Cargada\n                                        </div>\n                                    ) : (\n                                        <div className=\"flex flex-col items-center gap-2 text-slate-400\">\n                                            <Camera size={32} />\n                                            <span className=\"text-sm font-medium\">Subir Foto Boleta / Comprobante</span>\n                                        </div>\n                                    )}\n                                </div>\n\n                                <button\n                                    onClick={handleRegisterExpense}\n                                    disabled={!expenseAmount || (!expenseEvidence && expenseDescription.length < 10)}\n                                    className=\"w-full bg-red-500 hover:bg-red-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-red-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2\"\n                                >\n                                    <TrendingDown size={20} />\n                                    Registrar Salida de Efectivo\n                                </button>\n                            </div>\n                        )}\n\n                        {/* C. CLOSING (RECONCILIATION) */}\n                        {activeTab === 'CLOSING' && metrics && (\n                            <div className=\"space-y-6\">\n                                {/* Waterfall */}\n                                <div className=\"space-y-3 bg-slate-50 p-6 rounded-2xl border border-slate-100\">\n                                    <div className=\"flex justify-between items-center text-slate-600\">\n                                        <span>(+) Ventas Totales</span>\n                                        <span className=\"font-medium\">${metrics.totalSales.toLocaleString()}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center text-slate-400 text-sm\">\n                                        <span>(-) Tarjetas / Transferencias</span>\n                                        <span>-${(metrics.cardSales + metrics.transferSales).toLocaleString()}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center text-green-600 text-sm\">\n                                        <span>(+) Fondo Inicial</span>\n                                        <span>+${metrics.initialFund.toLocaleString()}</span>\n                                    </div>\n                                    <div className=\"flex justify-between items-center text-red-500 text-sm\">\n                                        <span>(-) Gastos / Salidas</span>\n                                        <span>-${metrics.totalOutflows.toLocaleString()}</span>\n                                    </div>\n                                    <div className=\"h-px bg-slate-200 my-2\"></div>\n                                    <div className=\"flex justify-between items-center text-xl font-bold text-slate-800\">\n                                        <span>(=) DEBE HABER EN CAJA</span>\n                                        <span>${metrics.expectedCash.toLocaleString()}</span>\n                                    </div>\n                                </div>\n\n                                <div className=\"bg-blue-50 p-6 rounded-2xl border border-blue-100\">\n                                    <label className=\"block text-sm font-bold text-blue-900 mb-2 text-center\">DINERO CONTADO REAL (ARQUEO)</label>\n                                    <div className=\"relative max-w-xs mx-auto\">\n                                        <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-blue-400 text-xl\">$</span>\n                                        <input\n                                            type=\"number\"\n                                            value={closingAmount}\n                                            onChange={(e) => setClosingAmount(e.target.value)}\n                                            className=\"w-full pl-8 pr-4 py-4 text-3xl font-bold text-blue-900 bg-white border-2 border-blue-200 rounded-xl focus:ring-4 focus:ring-blue-200 focus:border-blue-400 outline-none text-center\"\n                                            placeholder=\"0\"\n                                        />\n                                    </div>\n\n                                    {closingAmount && (\n                                        <div className={`mt-4 text-center font-bold p-3 rounded-lg ${parseInt(closingAmount) - metrics.expectedCash === 0 ? 'bg-green-100 text-green-700' :\n                                                parseInt(closingAmount) - metrics.expectedCash > 0 ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'\n                                            }`}>\n                                            {parseInt(closingAmount) - metrics.expectedCash === 0 ? 'Cuadratura Perfecta ✨' :\n                                                parseInt(closingAmount) - metrics.expectedCash > 0 ? `Sobrante: +$${(parseInt(closingAmount) - metrics.expectedCash).toLocaleString()}` :\n                                                    `Faltante: -$${Math.abs(parseInt(closingAmount) - metrics.expectedCash).toLocaleString()}`}\n                                        </div>\n                                    )}\n                                </div>\n\n                                <button\n                                    onClick={handleCloseShift}\n                                    disabled={!closingAmount}\n                                    className=\"w-full bg-slate-900 hover:bg-slate-800 text-white py-4 rounded-xl font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2\"\n                                >\n                                    <Lock size={20} />\n                                    Cerrar Turno y Generar Reporte\n                                </button>\n                            </div>\n                        )}\n                    </div>\n                </motion.div>\n            </motion.div>\n        </AnimatePresence>\n    );\n};\n\nexport default CashManagementModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2220, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/CashOutModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { X, DollarSign, AlertTriangle, Lock } from 'lucide-react';\nimport { PrinterService } from '../../../domain/services/PrinterService';\nimport { toast } from 'sonner';\n\ninterface CashOutModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst CashOutModal: React.FC<CashOutModalProps> = ({ isOpen, onClose }) => {\n    const { registerCashMovement, employees, currentShift, printerConfig } = usePharmaStore();\n\n    const [amount, setAmount] = useState('');\n    const [description, setDescription] = useState('');\n    const [type, setType] = useState<'GASTO' | 'RETIRO' | 'ADELANTO'>('GASTO');\n    const [pin, setPin] = useState('');\n    const [error, setError] = useState('');\n\n    if (!isOpen) return null;\n\n    const handleSave = () => {\n        if (!amount || !description || !pin) {\n            setError('Todos los campos son obligatorios');\n            return;\n        }\n\n        // Validate PIN (Manager/Admin only)\n        const supervisor = employees.find(e => (e.role === 'MANAGER' || e.role === 'ADMIN') && e.access_pin === pin);\n\n        if (!supervisor) {\n            setError('PIN no autorizado o incorrecto');\n            return;\n        }\n\n        if (!currentShift) {\n            setError('No hay turno de caja abierto');\n            return;\n        }\n\n        // Register Movement\n        const movement = {\n            type: 'OUT' as const,\n            amount: Number(amount),\n            description: `[${type}] ${description} (Auth: ${supervisor.name})`,\n            reason: (type === 'RETIRO' || type === 'ADELANTO' ? 'WITHDRAWAL' : 'SUPPLIES') as any,\n            is_cash: true\n        };\n\n        registerCashMovement(movement);\n\n        // ...\n\n        // Auto-Print\n        PrinterService.printVoucher({\n            ...movement,\n            id: `MOV-${Date.now()}`,\n            timestamp: Date.now(),\n            shift_id: currentShift.id,\n            user_id: supervisor.id\n        }, printerConfig);\n\n        toast.success('Retiro registrado y cajón abierto.');\n        onClose();\n\n        // Reset form\n        setAmount('');\n        setDescription('');\n        setPin('');\n        setError('');\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50\">\n                    <h3 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\n                        <DollarSign className=\"text-red-500\" /> Retiro de Caja\n                    </h3>\n                    <button onClick={onClose}><X className=\"text-slate-400 hover:text-slate-600\" /></button>\n                </div>\n\n                <div className=\"p-6 space-y-4\">\n                    {/* Type Selector */}\n                    <div className=\"grid grid-cols-3 gap-2\">\n                        {(['GASTO', 'RETIRO', 'ADELANTO'] as const).map((t) => (\n                            <button\n                                key={t}\n                                onClick={() => setType(t)}\n                                className={`py-2 px-1 rounded-xl text-xs font-bold border-2 transition-all ${type === t\n                                    ? 'border-red-500 bg-red-50 text-red-700'\n                                    : 'border-slate-100 text-slate-400 hover:bg-slate-50'\n                                    }`}\n                            >\n                                {t}\n                            </button>\n                        ))}\n                    </div>\n\n                    {/* Amount */}\n                    <div>\n                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Monto a Retirar</label>\n                        <div className=\"relative\">\n                            <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold\">$</span>\n                            <input\n                                type=\"number\"\n                                className=\"w-full pl-8 pr-4 py-3 border-2 border-slate-200 rounded-xl font-bold text-xl focus:border-red-500 focus:outline-none\"\n                                placeholder=\"0\"\n                                value={amount}\n                                onChange={(e) => setAmount(e.target.value)}\n                            />\n                        </div>\n                    </div>\n\n                    {/* Description */}\n                    <div>\n                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Motivo / Descripción</label>\n                        <textarea\n                            className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-red-500 focus:outline-none text-sm\"\n                            rows={2}\n                            placeholder=\"Ej: Compra de artículos de aseo...\"\n                            value={description}\n                            onChange={(e) => setDescription(e.target.value)}\n                        />\n                    </div>\n\n                    {/* Security PIN */}\n                    <div className=\"bg-red-50 p-4 rounded-xl border border-red-100\">\n                        <div className=\"flex items-center gap-2 mb-2 text-red-800 font-bold text-xs uppercase tracking-wider\">\n                            <Lock size={12} /> Autorización Requerida\n                        </div>\n                        <input\n                            type=\"password\"\n                            maxLength={4}\n                            className=\"w-full p-3 border-2 border-red-200 rounded-xl font-bold text-center tracking-[1em] focus:border-red-500 focus:outline-none bg-white\"\n                            placeholder=\"••••\"\n                            value={pin}\n                            onChange={(e) => {\n                                setPin(e.target.value);\n                                setError('');\n                            }}\n                        />\n                        <p className=\"text-[10px] text-red-600/70 text-center mt-2\">PIN de Gerente o Administrador</p>\n                    </div>\n\n                    {error && (\n                        <div className=\"flex items-center gap-2 text-red-600 text-xs font-bold bg-red-50 p-3 rounded-lg\">\n                            <AlertTriangle size={16} /> {error}\n                        </div>\n                    )}\n\n                    <button\n                        onClick={handleSave}\n                        className=\"w-full py-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 transition-colors shadow-lg shadow-red-200\"\n                    >\n                        Confirmar Retiro\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default CashOutModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2539, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/pos/CustomerCaptureModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { User, UserPlus, ArrowRight, X, Check } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\ninterface CustomerCaptureModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onConfirm: (customerRut: string) => void;\n    onSkip: () => void;\n}\n\nconst CustomerCaptureModal: React.FC<CustomerCaptureModalProps> = ({ isOpen, onClose, onConfirm, onSkip }) => {\n    const { customers, addCustomer } = usePharmaStore();\n    const [rut, setRut] = useState('');\n    const [name, setName] = useState('');\n    const [phone, setPhone] = useState('');\n    const [isNewCustomer, setIsNewCustomer] = useState(false);\n    const [foundCustomer, setFoundCustomer] = useState<any>(null);\n    const inputRef = useRef<HTMLInputElement>(null);\n\n    useEffect(() => {\n        if (isOpen) {\n            setRut('');\n            setName('');\n            setPhone('');\n            setIsNewCustomer(false);\n            setFoundCustomer(null);\n            setTimeout(() => inputRef.current?.focus(), 100);\n        }\n    }, [isOpen]);\n\n    // Keyboard Shortcuts\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if (!isOpen) return;\n            if (e.key === 'Escape') onSkip();\n        };\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [isOpen, onSkip]);\n\n    const formatRut = (value: string) => {\n        const clean = value.replace(/[^0-9kK]/g, '');\n        if (clean.length <= 1) return clean;\n        const body = clean.slice(0, -1);\n        const dv = clean.slice(-1).toUpperCase();\n        let formattedBody = '';\n        for (let i = body.length - 1, j = 0; i >= 0; i--, j++) {\n            formattedBody = body.charAt(i) + (j > 0 && j % 3 === 0 ? '.' : '') + formattedBody;\n        }\n        return `${formattedBody}-${dv}`;\n    };\n\n    const handleRutChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const val = formatRut(e.target.value);\n        setRut(val);\n\n        // Real-time search\n        if (val.length >= 8) {\n            const existing = customers.find(c => c.rut === val);\n            if (existing) {\n                setFoundCustomer(existing);\n                setIsNewCustomer(false);\n            } else {\n                setFoundCustomer(null);\n                // If it looks like a complete RUT, assume new\n                if (val.length >= 9) setIsNewCustomer(true);\n            }\n        } else {\n            setFoundCustomer(null);\n            setIsNewCustomer(false);\n        }\n    };\n\n    const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        if (foundCustomer) {\n            onConfirm(foundCustomer.rut);\n        } else if (isNewCustomer && name) {\n            // Register new\n            const newCust = addCustomer({\n                rut,\n                fullName: name,\n                phone,\n                registrationSource: 'POS'\n            });\n            onConfirm(newCust.rut);\n        }\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/70 backdrop-blur-sm z-[60] flex items-center justify-center p-4\">\n            <motion.div\n                initial={{ scale: 0.9, opacity: 0 }}\n                animate={{ scale: 1, opacity: 1 }}\n                className=\"bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden\"\n            >\n                <div className=\"p-6 bg-slate-900 text-white flex justify-between items-center\">\n                    <h3 className=\"text-xl font-bold flex items-center gap-2\">\n                        <User className=\"text-cyan-400\" /> ¿A quién vendemos?\n                    </h3>\n                    <button onClick={onSkip} className=\"text-slate-400 hover:text-white text-xs font-bold uppercase tracking-wider\">\n                        Omitir (ESC)\n                    </button>\n                </div>\n\n                <form onSubmit={handleSubmit} className=\"p-8\">\n                    <div className=\"mb-6\">\n                        <label className=\"block text-sm font-bold text-slate-600 mb-2\">RUT del Cliente</label>\n                        <input\n                            ref={inputRef}\n                            type=\"text\"\n                            value={rut}\n                            onChange={handleRutChange}\n                            className=\"w-full p-4 text-3xl font-mono font-bold border-2 border-slate-200 rounded-2xl focus:border-cyan-500 focus:outline-none text-center uppercase\"\n                            placeholder=\"12.345.678-K\"\n                            maxLength={12}\n                        />\n                    </div>\n\n                    <AnimatePresence mode=\"wait\">\n                        {foundCustomer && (\n                            <motion.div\n                                initial={{ opacity: 0, y: 10 }}\n                                animate={{ opacity: 1, y: 0 }}\n                                className=\"bg-emerald-50 border border-emerald-200 rounded-xl p-4 mb-6 flex items-center gap-4\"\n                            >\n                                <div className=\"w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center text-emerald-600\">\n                                    <Check size={24} />\n                                </div>\n                                <div>\n                                    <p className=\"text-emerald-800 font-bold text-lg\">{foundCustomer.fullName}</p>\n                                    <p className=\"text-emerald-600 text-sm\">Cliente Registrado</p>\n                                </div>\n                            </motion.div>\n                        )}\n\n                        {isNewCustomer && !foundCustomer && (\n                            <motion.div\n                                initial={{ opacity: 0, height: 0 }}\n                                animate={{ opacity: 1, height: 'auto' }}\n                                className=\"space-y-4 mb-6 overflow-hidden\"\n                            >\n                                <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-3 text-blue-800 text-sm font-bold flex items-center gap-2\">\n                                    <UserPlus size={16} /> Cliente Nuevo - Registro Rápido\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Nombre Completo *</label>\n                                    <input\n                                        type=\"text\"\n                                        required\n                                        value={name}\n                                        onChange={(e) => setName(e.target.value)}\n                                        className=\"w-full p-3 border-2 border-slate-200 rounded-xl font-bold focus:border-blue-500 focus:outline-none\"\n                                        placeholder=\"Ej: Juan Pérez\"\n                                        autoFocus\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Teléfono (Opcional)</label>\n                                    <input\n                                        type=\"tel\"\n                                        value={phone}\n                                        onChange={(e) => setPhone(e.target.value)}\n                                        className=\"w-full p-3 border-2 border-slate-200 rounded-xl font-bold focus:border-blue-500 focus:outline-none\"\n                                        placeholder=\"+569...\"\n                                    />\n                                </div>\n                            </motion.div>\n                        )}\n                    </AnimatePresence>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                        <button\n                            type=\"button\"\n                            onClick={onSkip}\n                            className=\"py-4 rounded-xl font-bold text-slate-500 hover:bg-slate-100 border-2 border-transparent hover:border-slate-200 transition-all\"\n                        >\n                            Omitir\n                        </button>\n                        <button\n                            type=\"submit\"\n                            disabled={!foundCustomer && (!isNewCustomer || !name)}\n                            className=\"py-4 rounded-xl font-bold bg-cyan-600 text-white hover:bg-cyan-700 shadow-lg shadow-cyan-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\n                        >\n                            {foundCustomer ? 'Confirmar' : 'Registrar'} <ArrowRight size={20} />\n                        </button>\n                    </div>\n                </form>\n            </motion.div>\n        </div>\n    );\n};\n\nexport default CustomerCaptureModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2956, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/POSMainScreen.tsx"],"sourcesContent":["'use client';\nimport React, { useState, useMemo, useEffect } from 'react';\nimport { usePharmaStore } from '../store/useStore';\nimport { Search, Plus, X, Tag, CreditCard, Banknote, Smartphone, AlertTriangle, ShoppingCart, PlusCircle, Coins, DollarSign, Lock as LockIcon, Edit, TrendingDown, TrendingUp, Wallet, User, Bot, AlertOctagon, Snowflake } from 'lucide-react';\nimport ClinicalSidebar from './clinical/ClinicalSidebar';\nimport { ClinicalAgent } from '../../domain/logic/clinicalAgent';\nimport ClientPanel from './pos/ClientPanel';\nimport PrescriptionModal from './pos/PrescriptionModal';\nimport ManualItemModal from './pos/ManualItemModal';\nimport CashManagementModal from './pos/CashManagementModal';\nimport CashOutModal from './pos/CashOutModal';\nimport { CartItem } from '../../domain/types';\nimport { motion, AnimatePresence } from 'framer-motion';\n\nimport { useKioskGuard } from '../hooks/useKioskGuard';\nimport SafeExitButton from './security/SafeExitButton';\nimport { PrinterService } from '../../domain/services/PrinterService';\nimport CustomerCaptureModal from './pos/CustomerCaptureModal';\nimport { toast } from 'sonner';\nimport { shouldGenerateDTE } from '../../domain/logic/sii_dte';\n\nconst POSMainScreen: React.FC = () => {\n    useKioskGuard(true); // Enable Kiosk Lock\n    const {\n        inventory, cart, addToCart, addManualItem, removeFromCart, clearCart,\n        processSale, currentCustomer, currentShift, getShiftMetrics, updateOpeningAmount, employees, printerConfig,\n        setCustomer\n    } = usePharmaStore();\n\n    const metrics = getShiftMetrics();\n    const [isEditBaseModalOpen, setIsEditBaseModalOpen] = useState(false);\n    const [supervisorPin, setSupervisorPin] = useState('');\n    const [newBaseAmount, setNewBaseAmount] = useState('');\n    const [editBaseError, setEditBaseError] = useState('');\n\n    const total = useMemo(() => cart.reduce((sum, item) => sum + item.price * item.quantity, 0), [cart]);\n    const [searchTerm, setSearchTerm] = useState('');\n    const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false);\n    const [isPrescriptionModalOpen, setIsPrescriptionModalOpen] = useState(false);\n    const [isManualItemModalOpen, setIsManualItemModalOpen] = useState(false);\n    const [isCashModalOpen, setIsCashModalOpen] = useState(false);\n    const [isCashOutModalOpen, setIsCashOutModalOpen] = useState(false);\n    const [isCustomerCaptureModalOpen, setIsCustomerCaptureModalOpen] = useState(false);\n    const [pendingItemForPrescription, setPendingItemForPrescription] = useState<CartItem | null>(null);\n    const [paymentMethod, setPaymentMethod] = useState<'CASH' | 'DEBIT' | 'TRANSFER'>('CASH');\n    const [transferId, setTransferId] = useState('');\n\n    // Sidebar Tabs State\n    const [activeTab, setActiveTab] = useState<'CART' | 'CLIENT' | 'AI'>('CART');\n\n    // FEFO Sorting & Filtering\n    const filteredInventory = useMemo(() => {\n        return inventory\n            .filter(item =>\n                item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                item.dci.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                item.sku.toLowerCase().includes(searchTerm.toLowerCase())\n            )\n            .sort((a, b) => a.expiry_date - b.expiry_date); // FEFO: First Expired, First Out\n    }, [inventory, searchTerm]);\n\n    // Clinical Analysis\n    const clinicalAnalysis = useMemo(() => ClinicalAgent.analyzeCart(cart, currentCustomer || undefined), [cart, currentCustomer]);\n    const cartTotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);\n\n    // AI Alert Logic\n    useEffect(() => {\n        if (clinicalAnalysis.status === 'WARNING' || clinicalAnalysis.status === 'BLOCK') {\n            setActiveTab('AI'); // Auto-switch to AI tab on alert\n        }\n    }, [clinicalAnalysis.status]);\n\n    // Check for Restricted Items (R/RR/RCH)\n    const isRestricted = (item: CartItem) => {\n        const inventoryItem = inventory.find(i => i.id === item.id);\n        return inventoryItem && (inventoryItem.condition === 'R' || inventoryItem.condition === 'RR' || inventoryItem.condition === 'RCH');\n    };\n    const hasRestrictedItems = cart.some(isRestricted);\n\n    const proceedToPaymentFlow = () => {\n        if (hasRestrictedItems) {\n            setIsPrescriptionModalOpen(true);\n        } else {\n            setIsPaymentModalOpen(true);\n        }\n    };\n\n    const handlePrePayment = () => {\n        if (cart.length === 0) return;\n\n        if (!currentCustomer) {\n            setIsCustomerCaptureModalOpen(true);\n        } else {\n            proceedToPaymentFlow();\n        }\n    };\n\n    const handleCustomerCaptured = (customerRut: string) => {\n        // Find customer in store (it should be there, added by modal if new)\n        const { customers } = usePharmaStore.getState();\n        const customer = customers.find(c => c.rut === customerRut);\n        if (customer) {\n            setCustomer(customer);\n        }\n        setIsCustomerCaptureModalOpen(false);\n        proceedToPaymentFlow();\n    };\n\n    const handleCustomerSkip = () => {\n        setIsCustomerCaptureModalOpen(false);\n        proceedToPaymentFlow();\n    };\n\n    const handlePrescriptionConfirm = (data: { folio: string, doctorRut: string }) => {\n        setIsPrescriptionModalOpen(false);\n        setIsPaymentModalOpen(true); // Proceed to payment\n        // In a real app, we would store prescription data in the transaction here\n    };\n\n    const handleCheckout = () => {\n        if (cart.length === 0) return;\n        if (!currentShift || currentShift.status === 'CLOSED') {\n            toast.error('Debe abrir caja antes de vender.');\n            return;\n        }\n        if (paymentMethod === 'TRANSFER' && !transferId) {\n            toast.error('Debe ingresar el ID de transacción');\n            return;\n        }\n\n        // Determine DTE Status\n        const dteResult = shouldGenerateDTE(paymentMethod);\n        const dteFolio = dteResult.shouldGenerate ? Math.floor(Math.random() * 100000).toString() : undefined; // Mock Folio\n\n        // Capture sale data before processing (since cart clears)\n        const saleToPrint: any = {\n            id: `V-${Date.now()}`, // Mock ID, ideally returned by processSale\n            timestamp: Date.now(),\n            items: [...cart],\n            total: cart.reduce((sum, item) => sum + item.price * item.quantity, 0),\n            payment_method: paymentMethod,\n            customer: currentCustomer || undefined,\n            transfer_id: paymentMethod === 'TRANSFER' ? transferId : undefined,\n            dte_status: dteResult.status,\n            dte_folio: dteFolio\n        };\n\n        processSale(paymentMethod, currentCustomer || undefined);\n\n        // Auto-Print Trigger\n        PrinterService.printTicket(saleToPrint, printerConfig);\n\n        setIsPaymentModalOpen(false);\n        setTransferId('');\n        setPaymentMethod('CASH');\n\n        if (dteResult.shouldGenerate) {\n            toast.success(`¡Venta Exitosa! Boleta Nº ${dteFolio} generada.`, { duration: 3000 });\n        } else {\n            toast.success('¡Venta Exitosa! Fiscalizada por Voucher.', { duration: 3000 });\n        }\n    };\n\n    const getExpiryStatus = (timestamp: number) => {\n        const months = (timestamp - Date.now()) / (1000 * 60 * 60 * 24 * 30);\n        if (months < 3) return 'border-amber-400 bg-amber-50';\n        return 'border-slate-100 bg-white';\n    };\n\n    const handleUpdateBase = () => {\n        const supervisor = employees.find(e => (e.role === 'MANAGER' || e.role === 'ADMIN') && e.access_pin === supervisorPin);\n        if (supervisor) {\n            updateOpeningAmount(Number(newBaseAmount));\n            setIsEditBaseModalOpen(false);\n            setSupervisorPin('');\n            setNewBaseAmount('');\n            setEditBaseError('');\n            alert('Base actualizada correctamente');\n        } else {\n            setEditBaseError('PIN no autorizado');\n        }\n    };\n\n    return (\n        <div className=\"flex h-[calc(100vh-80px)] bg-slate-100 overflow-hidden\">\n\n            {/* COL 1: Catálogo (70%) */}\n            <div className=\"flex-1 flex flex-col p-6 pr-3\">\n                <div className=\"bg-white rounded-3xl shadow-sm border border-slate-200 flex flex-col h-full overflow-hidden\">\n                    <div className=\"p-6 border-b border-slate-100 flex justify-between items-center gap-4\">\n                        <div>\n                            <h2 className=\"text-xl font-bold text-slate-800\">Catálogo</h2>\n                            <p className=\"text-xs text-slate-400\">{filteredInventory.length} productos disponibles</p>\n                        </div>\n                        <div className=\"flex-1 relative max-w-md\">\n                            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400\" size={20} />\n                            <input\n                                type=\"text\"\n                                placeholder=\"Buscar por Nombre, SKU o DCI...\"\n                                className=\"w-full pl-12 pr-4 py-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none transition-colors font-medium\"\n                                value={searchTerm}\n                                onChange={(e) => setSearchTerm(e.target.value)}\n                            />\n                        </div>\n                        <button\n                            onClick={() => setIsManualItemModalOpen(true)}\n                            className=\"flex items-center gap-2 bg-purple-100 text-purple-700 px-4 py-3 rounded-xl hover:bg-purple-200 font-bold transition-colors\"\n                        >\n                            <Plus size={20} />\n                            <span className=\"hidden xl:inline\">Item Manual</span>\n                        </button>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto p-6 grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 content-start\">\n                        {filteredInventory.map(item => (\n                            <div\n                                key={item.id}\n                                onClick={() => addToCart(item, 1)}\n                                className=\"bg-white p-4 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md hover:border-cyan-200 cursor-pointer transition-all group flex flex-col justify-between h-full\"\n                            >\n                                <div>\n                                    <div className=\"flex justify-between items-start mb-2\">\n                                        <span className=\"text-[10px] font-bold text-slate-400 bg-slate-50 px-2 py-1 rounded-lg border border-slate-100\">\n                                            {item.location_id}\n                                        </span>\n                                        <div className=\"flex gap-1\">\n                                            {item.storage_condition === 'REFRIGERADO' && (\n                                                <span className=\"p-1 bg-cyan-100 text-cyan-600 rounded-lg\" title=\"Cadena de Frío\">\n                                                    <Snowflake size={12} />\n                                                </span>\n                                            )}\n                                            {item.condition === 'R' && <span className=\"p-1 bg-purple-100 text-purple-600 rounded-lg text-[10px] font-bold\">R</span>}\n                                        </div>\n                                    </div>\n\n                                    <h3 className=\"font-bold text-slate-800 text-sm leading-tight mb-1 group-hover:text-cyan-600 transition-colors line-clamp-2\">\n                                        {item.name}\n                                    </h3>\n                                    <p className=\"text-[10px] text-slate-500 font-mono mb-2\">{item.dci}</p>\n\n                                    {/* Clinical Tags */}\n                                    {item.therapeutic_tags && item.therapeutic_tags.length > 0 && (\n                                        <div className=\"flex flex-wrap gap-1 mb-2\">\n                                            {item.therapeutic_tags.slice(0, 2).map(tag => (\n                                                <span key={tag} className=\"text-[9px] px-1.5 py-0.5 bg-slate-50 text-slate-500 rounded border border-slate-100\">\n                                                    {tag}\n                                                </span>\n                                            ))}\n                                        </div>\n                                    )}\n                                </div>\n\n                                <div className=\"flex justify-between items-end mt-2\">\n                                    <div>\n                                        <p className=\"text-[10px] text-slate-400 mb-0.5\">Precio</p>\n                                        <span className=\"font-bold text-lg text-slate-800\">${item.price.toLocaleString()}</span>\n                                    </div>\n                                    <div className={`px-2 py-1 rounded-lg text-[10px] font-bold ${item.stock_actual > 0 ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}`}>\n                                        Stock: {item.stock_actual}\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            </div>\n\n            {/* COL 2: Smart Sidebar (30% - Fixed Width) */}\n            <div className=\"w-[400px] flex flex-col p-6 pl-0 gap-4\">\n\n                {/* Cash Monitor Widget (Compact) */}\n                <div className=\"bg-slate-900 rounded-3xl p-4 text-white shadow-xl relative overflow-hidden shrink-0\">\n                    <div className=\"flex justify-between items-center mb-2\">\n                        <div className=\"flex items-center gap-2\">\n                            <Wallet size={16} className=\"text-cyan-400\" />\n                            <span className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Caja</span>\n                        </div>\n                        <button\n                            onClick={() => setIsCashModalOpen(true)}\n                            className={`text-[10px] font-bold px-2 py-1 rounded-lg flex items-center gap-1 ${currentShift?.status === 'OPEN' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-red-500/20 text-red-400'}`}\n                        >\n                            {currentShift?.status === 'OPEN' ? 'ABIERTA' : 'CERRADA'}\n                        </button>\n                    </div>\n                    <div className=\"flex justify-between items-end\">\n                        <div>\n                            <span className=\"text-2xl font-extrabold text-white\">${metrics.expectedCash.toLocaleString()}</span>\n                            <p className=\"text-[10px] text-slate-400\">Efectivo Teórico</p>\n                        </div>\n                        <div className=\"text-right\">\n                            <div className=\"flex items-center justify-end gap-1\">\n                                <span className=\"font-bold text-slate-300\">${metrics.initialFund.toLocaleString()}</span>\n                                <button onClick={() => setIsEditBaseModalOpen(true)} className=\"p-1 hover:bg-white/10 rounded-full transition-colors\">\n                                    <Edit size={12} className=\"text-cyan-400\" />\n                                </button>\n                            </div>\n                            <p className=\"text-[10px] text-slate-500\">Base Inicial</p>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Quick Actions */}\n                <div className=\"grid grid-cols-2 gap-2 shrink-0\">\n                    <button\n                        onClick={() => setIsCashOutModalOpen(true)}\n                        className=\"bg-red-500/10 hover:bg-red-500/20 text-red-600 border border-red-200 text-[10px] font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-colors\"\n                    >\n                        <DollarSign size={14} /> RETIRO / GASTO\n                    </button>\n                    <button\n                        onClick={() => setIsCashModalOpen(true)}\n                        className=\"bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-600 border border-emerald-200 text-[10px] font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-colors\"\n                    >\n                        <Wallet size={14} /> GESTIÓN CAJA\n                    </button>\n                </div>\n\n                {/* Smart Tabs */}\n                <div className=\"flex-1 flex flex-col bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden\">\n                    {/* Tab Headers */}\n                    <div className=\"flex border-b border-slate-100\">\n                        <button\n                            onClick={() => setActiveTab('CART')}\n                            className={`flex-1 py-4 flex flex-col items-center justify-center gap-1 transition-all border-b-2 ${activeTab === 'CART' ? 'border-cyan-500 text-cyan-600 bg-cyan-50/50' : 'border-transparent text-slate-400 hover:bg-slate-50'}`}\n                        >\n                            <div className=\"relative\">\n                                <ShoppingCart size={20} />\n                                {cart.length > 0 && <span className=\"absolute -top-2 -right-2 bg-cyan-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center\">{cart.length}</span>}\n                            </div>\n                            <span className=\"text-[10px] font-bold\">CARRITO</span>\n                        </button>\n                        <button\n                            onClick={() => setActiveTab('CLIENT')}\n                            className={`flex-1 py-4 flex flex-col items-center justify-center gap-1 transition-all border-b-2 ${activeTab === 'CLIENT' ? 'border-blue-500 text-blue-600 bg-blue-50/50' : 'border-transparent text-slate-400 hover:bg-slate-50'}`}\n                        >\n                            <User size={20} />\n                            <span className=\"text-[10px] font-bold\">CLIENTE</span>\n                        </button>\n                        <button\n                            onClick={() => setActiveTab('AI')}\n                            className={`flex-1 py-4 flex flex-col items-center justify-center gap-1 transition-all border-b-2 ${activeTab === 'AI' ? 'border-purple-500 text-purple-600 bg-purple-50/50' : 'border-transparent text-slate-400 hover:bg-slate-50'}`}\n                        >\n                            <div className=\"relative\">\n                                <Bot size={20} className={clinicalAnalysis.status !== 'SAFE' ? 'text-amber-500 animate-pulse' : ''} />\n                                {clinicalAnalysis.status !== 'SAFE' && <span className=\"absolute -top-2 -right-2 bg-amber-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center\">!</span>}\n                            </div>\n                            <span className=\"text-[10px] font-bold\">COPILOT</span>\n                        </button>\n                    </div>\n\n                    {/* Tab Content */}\n                    <div className=\"flex-1 overflow-hidden relative\">\n                        <AnimatePresence mode=\"wait\">\n                            {activeTab === 'CART' && (\n                                <motion.div\n                                    key=\"cart\"\n                                    initial={{ opacity: 0, x: -20 }}\n                                    animate={{ opacity: 1, x: 0 }}\n                                    exit={{ opacity: 0, x: 20 }}\n                                    className=\"absolute inset-0 flex flex-col\"\n                                >\n                                    <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n                                        {cart.length === 0 ? (\n                                            <div className=\"h-full flex flex-col items-center justify-center text-slate-400 opacity-50\">\n                                                <ShoppingCart size={48} className=\"mb-4\" />\n                                                <p>Carrito vacío</p>\n                                            </div>\n                                        ) : (\n                                            cart.map((item, idx) => (\n                                                <div key={idx} className=\"flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100\">\n                                                    <div className=\"flex-1\">\n                                                        <h4 className=\"font-bold text-slate-700 text-sm line-clamp-1\">{item.name}</h4>\n                                                        <div className=\"flex items-center gap-2 mt-1\">\n                                                            <span className=\"text-xs text-slate-500\">{item.quantity} x ${item.price.toLocaleString()}</span>\n                                                            {item.allows_commission && (\n                                                                <span className=\"flex items-center gap-1 text-[10px] bg-emerald-100 text-emerald-700 px-1.5 py-0.5 rounded font-bold border border-emerald-200\" title=\"Comisionable\">\n                                                                    <Coins size={10} />\n                                                                </span>\n                                                            )}\n                                                        </div>\n                                                    </div>\n                                                    <div className=\"flex items-center gap-3\">\n                                                        <span className=\"font-bold text-slate-900\">${(item.price * item.quantity).toLocaleString()}</span>\n                                                        <button onClick={() => removeFromCart(item.sku)} className=\"text-slate-400 hover:text-red-500 transition-colors\">\n                                                            <X size={16} />\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            ))\n                                        )}\n                                    </div>\n                                </motion.div>\n                            )}\n\n                            {activeTab === 'CLIENT' && (\n                                <motion.div\n                                    key=\"client\"\n                                    initial={{ opacity: 0, x: -20 }}\n                                    animate={{ opacity: 1, x: 0 }}\n                                    exit={{ opacity: 0, x: 20 }}\n                                    className=\"absolute inset-0 p-4 overflow-y-auto\"\n                                >\n                                    <ClientPanel />\n                                </motion.div>\n                            )}\n\n                            {activeTab === 'AI' && (\n                                <motion.div\n                                    key=\"ai\"\n                                    initial={{ opacity: 0, x: -20 }}\n                                    animate={{ opacity: 1, x: 0 }}\n                                    exit={{ opacity: 0, x: 20 }}\n                                    className=\"absolute inset-0 p-4 overflow-y-auto\"\n                                >\n                                    <ClinicalSidebar analysis={clinicalAnalysis} lastChecked={Date.now()} />\n                                </motion.div>\n                            )}\n                        </AnimatePresence>\n                    </div>\n\n                    {/* Footer Totals & Actions */}\n                    <div className=\"p-6 bg-slate-50 border-t border-slate-200 z-10\">\n                        {/* Toast Notification for AI Alert */}\n                        <AnimatePresence>\n                            {activeTab !== 'AI' && clinicalAnalysis.status !== 'SAFE' && (\n                                <motion.div\n                                    initial={{ opacity: 0, y: 20 }}\n                                    animate={{ opacity: 1, y: 0 }}\n                                    exit={{ opacity: 0, y: 20 }}\n                                    className={`absolute bottom-[140px] left-4 right-4 p-3 rounded-xl shadow-lg flex items-center gap-3 cursor-pointer ${clinicalAnalysis.status === 'BLOCK' ? 'bg-red-600 text-white' : 'bg-amber-500 text-white'}`}\n                                    onClick={() => setActiveTab('AI')}\n                                >\n                                    <AlertOctagon size={20} />\n                                    <div className=\"flex-1\">\n                                        <p className=\"text-xs font-bold\">Alerta Clínica Detectada</p>\n                                        <p className=\"text-[10px] opacity-90 line-clamp-1\">{clinicalAnalysis.message}</p>\n                                    </div>\n                                    <div className=\"bg-white/20 p-1 rounded\">\n                                        <TrendingUp size={12} />\n                                    </div>\n                                </motion.div>\n                            )}\n                        </AnimatePresence>\n\n                        <div className=\"flex justify-between items-end mb-4\">\n                            <span className=\"text-slate-500 font-medium\">Total a Pagar</span>\n                            <span className=\"text-3xl font-extrabold text-slate-900\">${cartTotal.toLocaleString('es-CL')}</span>\n                        </div>\n\n                        <button\n                            onClick={handlePrePayment}\n                            disabled={cart.length === 0 || clinicalAnalysis.status === 'BLOCK'}\n                            className={`w-full py-4 rounded-xl font-bold text-lg shadow-lg transition-all flex items-center justify-center gap-2\n                            ${clinicalAnalysis.status === 'BLOCK'\n                                    ? 'bg-slate-200 text-slate-400 cursor-not-allowed'\n                                    : 'bg-emerald-600 text-white hover:bg-emerald-700 shadow-emerald-200'\n                                }`}\n                        >\n                            {clinicalAnalysis.status === 'BLOCK' ? '⛔ VENTA BLOQUEADA' : 'PAGAR AHORA'}\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            {/* Modals */}\n            <PrescriptionModal\n                isOpen={isPrescriptionModalOpen}\n                onCancel={() => setIsPrescriptionModalOpen(false)}\n                onConfirm={handlePrescriptionConfirm}\n                itemName={pendingItemForPrescription?.name || ''}\n            />\n\n            <ManualItemModal\n                isOpen={isManualItemModalOpen}\n                onClose={() => setIsManualItemModalOpen(false)}\n                onConfirm={(item) => { addManualItem(item); setIsManualItemModalOpen(false); }}\n            />\n\n            <CashManagementModal\n                isOpen={isCashModalOpen}\n                onClose={() => setIsCashModalOpen(false)}\n            />\n\n            <CashOutModal\n                isOpen={isCashOutModalOpen}\n                onClose={() => setIsCashOutModalOpen(false)}\n            />\n\n            {/* Edit Base Modal */}\n            {isEditBaseModalOpen && (\n                <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n                    <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-sm p-6 animate-in fade-in zoom-in duration-200\">\n                        <h3 className=\"text-xl font-bold text-slate-800 mb-4\">Ajustar Base Inicial</h3>\n\n                        <div className=\"space-y-4\">\n                            <div>\n                                <label className=\"block text-sm font-bold text-slate-600 mb-1\">Nuevo Monto Base</label>\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full p-3 border-2 border-slate-200 rounded-xl font-bold text-lg\"\n                                    value={newBaseAmount}\n                                    onChange={(e) => setNewBaseAmount(e.target.value)}\n                                    placeholder=\"$0\"\n                                />\n                            </div>\n\n                            <div>\n                                <label className=\"block text-sm font-bold text-slate-600 mb-1\">PIN Supervisor (Manager)</label>\n                                <input\n                                    type=\"password\"\n                                    maxLength={4}\n                                    className=\"w-full p-3 border-2 border-slate-200 rounded-xl font-bold text-lg tracking-widest text-center\"\n                                    value={supervisorPin}\n                                    onChange={(e) => {\n                                        setSupervisorPin(e.target.value);\n                                        setEditBaseError('');\n                                    }}\n                                    placeholder=\"••••\"\n                                />\n                            </div>\n\n                            {editBaseError && <p className=\"text-red-500 text-sm font-bold text-center\">{editBaseError}</p>}\n\n                            <div className=\"grid grid-cols-2 gap-3 mt-6\">\n                                <button\n                                    onClick={() => setIsEditBaseModalOpen(false)}\n                                    className=\"py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100\"\n                                >\n                                    Cancelar\n                                </button>\n                                <button\n                                    onClick={handleUpdateBase}\n                                    className=\"py-3 rounded-xl font-bold bg-cyan-600 text-white hover:bg-cyan-700\"\n                                >\n                                    Confirmar\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Payment Modal */}\n            {isPaymentModalOpen && (\n                <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n                    <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200\">\n                        <div className=\"p-6 border-b border-slate-100 flex justify-between items-center\">\n                            <h3 className=\"text-xl font-bold text-slate-800\">Finalizar Venta</h3>\n                            <button onClick={() => setIsPaymentModalOpen(false)}><X className=\"text-slate-400\" /></button>\n                        </div>\n\n                        <div className=\"p-6\">\n                            <div className=\"grid grid-cols-3 gap-4 mb-8\">\n                                <button\n                                    onClick={() => setPaymentMethod('CASH')}\n                                    className={`p-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all ${paymentMethod === 'CASH' ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-slate-100 text-slate-400'}`}\n                                >\n                                    <Banknote size={24} />\n                                    <span className=\"text-xs font-bold\">EFECTIVO</span>\n                                </button>\n                                <button\n                                    onClick={() => setPaymentMethod('DEBIT')}\n                                    className={`p-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all ${paymentMethod === 'DEBIT' ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-100 text-slate-400'}`}\n                                >\n                                    <CreditCard size={24} />\n                                    <span className=\"text-xs font-bold\">TARJETA</span>\n                                </button>\n                                <button\n                                    onClick={() => setPaymentMethod('TRANSFER')}\n                                    className={`p-4 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all ${paymentMethod === 'TRANSFER' ? 'border-purple-500 bg-purple-50 text-purple-700' : 'border-slate-100 text-slate-400'}`}\n                                >\n                                    <Smartphone size={24} />\n                                    <span className=\"text-xs font-bold\">TRANSF.</span>\n                                </button>\n                            </div>\n\n                            {paymentMethod === 'TRANSFER' && (\n                                <div className=\"mb-6 animate-in fade-in slide-in-from-top-2\">\n                                    <label className=\"block text-sm font-bold text-slate-700 mb-2\">ID de Transacción</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-3 border-2 border-slate-300 rounded-xl focus:border-purple-500 focus:outline-none\"\n                                        placeholder=\"Ej: 12345678\"\n                                        value={transferId}\n                                        onChange={(e) => setTransferId(e.target.value)}\n                                    />\n                                    <p className=\"text-xs text-slate-400 mt-2 flex items-center\"><AlertTriangle size={12} className=\"mr-1\" /> Verifique el comprobante antes de confirmar.</p>\n                                </div>\n                            )}\n\n                            <button\n                                onClick={handleCheckout}\n                                className=\"w-full py-4 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition shadow-lg shadow-cyan-200 flex items-center justify-center gap-2\"\n                            >\n                                <DollarSign size={20} /> CONFIRMAR PAGO\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n            {/* Customer Capture Modal */}\n            <CustomerCaptureModal\n                isOpen={isCustomerCaptureModalOpen}\n                onClose={() => setIsCustomerCaptureModalOpen(false)}\n                onConfirm={handleCustomerCaptured}\n                onSkip={handleCustomerSkip}\n            />\n        </div>\n    );\n};\n\n// Helper Icon\nconst ClockIcon = ({ size }: { size: number }) => (\n    <svg width={size} height={size} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\" />\n        <polyline points=\"12 6 12 12 16 14\" />\n    </svg>\n);\n\nexport default POSMainScreen;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4528, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/scm/BlindReceptionModal.tsx"],"sourcesContent":["\nimport React, { useState } from 'react';\nimport { Truck, Lock, Save } from 'lucide-react';\nimport { PurchaseOrder } from '../../../domain/types';\n\ninterface BlindReceptionModalProps {\n    order: PurchaseOrder;\n    onReceive: (order: PurchaseOrder, receivedItems: { sku: string; receivedQty: number }[]) => void;\n    onClose: () => void;\n}\n\nconst BlindReceptionModal: React.FC<BlindReceptionModalProps> = ({ order, onReceive, onClose }) => {\n    const [receivedQuantities, setReceivedQuantities] = useState<{ [sku: string]: number }>({});\n\n    const handleInputChange = (sku: string, value: string) => {\n        setReceivedQuantities(prev => ({\n            ...prev,\n            [sku]: parseInt(value) || 0\n        }));\n    };\n\n    const totalReceived = order.items.reduce((sum, item) => sum + (receivedQuantities[item.sku] || 0), 0);\n\n    // Comprobar si todas las cantidades han sido ingresadas manualmente\n    const isComplete = order.items.every(item => receivedQuantities[item.sku] !== undefined && receivedQuantities[item.sku] >= 0);\n\n    const inputStyle = \"w-full py-2 border-2 border-slate-400 rounded-lg text-center font-semibold text-lg text-slate-900\";\n\n\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white p-8 rounded-xl w-full max-w-2xl shadow-2xl\">\n                <h3 className=\"text-2xl font-bold text-slate-900 mb-6 flex items-center\">\n                    <Truck className=\"mr-3\" /> Recepción Ciega de Orden #{order.id}\n                </h3>\n\n                <p className=\"text-red-600 font-semibold mb-4 flex items-center\">\n                    <Lock size={18} className=\"mr-2\" /> La cantidad esperada (Expected Qty) NO es visible. Debe contar manualmente.\n                </p>\n\n                <div className=\"max-h-80 overflow-y-auto space-y-4 pr-2\">\n                    {order.items.map((item) => (\n                        <div key={item.sku} className=\"flex items-center justify-between border-b pb-3\">\n                            <p className=\"font-semibold text-slate-700 w-1/2\">{item.name}</p>\n                            <div className=\"w-1/3 ml-4\">\n                                <input\n                                    type=\"number\"\n                                    placeholder=\"Cantidad Real Recibida\"\n                                    className={inputStyle}\n                                    value={receivedQuantities[item.sku] || ''}\n                                    onChange={(e) => handleInputChange(item.sku, e.target.value)}\n                                />\n                            </div>\n                        </div>\n                    ))}\n                </div>\n\n                <div className=\"mt-8 pt-4 border-t border-slate-200\">\n                    <p className=\"text-xl font-bold text-slate-900 mb-4\">Total de Unidades Contadas: {totalReceived}</p>\n                    <button\n                        className=\"w-full py-3 bg-cyan-700 text-white font-bold rounded-xl hover:bg-cyan-800 transition disabled:opacity-50 flex items-center justify-center\"\n                        onClick={() => isComplete && onReceive(order, Object.entries(receivedQuantities).map(([sku, receivedQty]) => ({ sku, receivedQty })))}\n                        disabled={!isComplete}\n                    >\n                        <Save size={20} className=\"mr-2\" /> Confirmar Recepción Ciega\n                    </button>\n                    <button className=\"mt-2 w-full py-2 text-slate-600 hover:text-slate-900 transition\" onClick={onClose}>Cancelar</button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default BlindReceptionModal;\n"],"names":[],"mappings":";;;;;AACA;AACA;AAAA;AAAA;;;;;AASA,MAAM,sBAA0D,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE,OAAO,EAAE;;IAC1F,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,yKAAQ,EAA4B,CAAC;IAEzF,MAAM,oBAAoB,CAAC,KAAa;QACpC,sBAAsB,CAAA,OAAQ,CAAC;gBAC3B,GAAG,IAAI;gBACP,CAAC,IAAI,EAAE,SAAS,UAAU;YAC9B,CAAC;IACL;IAEA,MAAM,gBAAgB,MAAM,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,CAAC,kBAAkB,CAAC,KAAK,GAAG,CAAC,IAAI,CAAC,GAAG;IAEnG,oEAAoE;IACpE,MAAM,aAAa,MAAM,KAAK,CAAC,KAAK,CAAC,CAAA,OAAQ,kBAAkB,CAAC,KAAK,GAAG,CAAC,KAAK,aAAa,kBAAkB,CAAC,KAAK,GAAG,CAAC,IAAI;IAE3H,MAAM,aAAa;IAGnB,qBACI,6LAAC;QAAI,WAAU;kBACX,cAAA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAG,WAAU;;sCACV,6LAAC,gNAAK;4BAAC,WAAU;;;;;;wBAAS;wBAA4B,MAAM,EAAE;;;;;;;8BAGlE,6LAAC;oBAAE,WAAU;;sCACT,6LAAC,6MAAI;4BAAC,MAAM;4BAAI,WAAU;;;;;;wBAAS;;;;;;;8BAGvC,6LAAC;oBAAI,WAAU;8BACV,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,qBACd,6LAAC;4BAAmB,WAAU;;8CAC1B,6LAAC;oCAAE,WAAU;8CAAsC,KAAK,IAAI;;;;;;8CAC5D,6LAAC;oCAAI,WAAU;8CACX,cAAA,6LAAC;wCACG,MAAK;wCACL,aAAY;wCACZ,WAAW;wCACX,OAAO,kBAAkB,CAAC,KAAK,GAAG,CAAC,IAAI;wCACvC,UAAU,CAAC,IAAM,kBAAkB,KAAK,GAAG,EAAE,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;2BAR7D,KAAK,GAAG;;;;;;;;;;8BAe1B,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAE,WAAU;;gCAAwC;gCAA6B;;;;;;;sCAClF,6LAAC;4BACG,WAAU;4BACV,SAAS,IAAM,cAAc,UAAU,OAAO,OAAO,OAAO,CAAC,oBAAoB,GAAG,CAAC,CAAC,CAAC,KAAK,YAAY,GAAK,CAAC;wCAAE;wCAAK;oCAAY,CAAC;4BAClI,UAAU,CAAC;;8CAEX,6LAAC,6MAAI;oCAAC,MAAM;oCAAI,WAAU;;;;;;gCAAS;;;;;;;sCAEvC,6LAAC;4BAAO,WAAU;4BAAkE,SAAS;sCAAS;;;;;;;;;;;;;;;;;;;;;;;AAK1H;GA5DM;KAAA;uCA8DS"}},
    {"offset": {"line": 4713, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/StockEntryModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { Scan, PackagePlus, Save, X, Search, AlertTriangle } from 'lucide-react';\nimport { InventoryBatch, DrugCategory, SaleCondition } from '../../../domain/types';\n\ninterface StockEntryModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst StockEntryModal: React.FC<StockEntryModalProps> = ({ isOpen, onClose }) => {\n    const { inventory, addStock, addNewProduct } = usePharmaStore();\n    const [mode, setMode] = useState<'SCAN' | 'NEW'>('SCAN');\n    const [skuInput, setSkuInput] = useState('');\n    const [foundProduct, setFoundProduct] = useState<InventoryBatch | null>(null);\n\n    // Form States\n    const [qty, setQty] = useState('');\n    const [expiry, setExpiry] = useState('');\n    const [newProduct, setNewProduct] = useState<Partial<InventoryBatch>>({\n        category: 'MEDICAMENTO',\n        condition: 'VD',\n        is_bioequivalent: false,\n        allows_commission: false,\n        location_id: 'BODEGA_CENTRAL'\n    });\n\n    if (!isOpen) return null;\n\n    const handleScan = () => {\n        const product = inventory.find(i => i.sku === skuInput);\n        if (product) {\n            setFoundProduct(product);\n            setMode('SCAN');\n        } else {\n            setFoundProduct(null);\n            setNewProduct(prev => ({ ...prev, sku: skuInput }));\n            setMode('NEW');\n        }\n    };\n\n    const handleQuickEntry = () => {\n        if (foundProduct && qty && expiry) {\n            addStock(foundProduct.id, parseInt(qty), new Date(expiry).getTime());\n            onClose();\n            reset();\n        }\n    };\n\n    const handleNewProductSubmit = () => {\n        if (newProduct.name && newProduct.sku && qty) {\n            addNewProduct({\n                ...newProduct,\n                stock_actual: parseInt(qty),\n                expiry_date: new Date(expiry).getTime(),\n                active_ingredients: [], // Default\n                stock_min: 10,\n                stock_max: 100,\n                cost_price: 0 // Default\n            } as InventoryBatch);\n            onClose();\n            reset();\n        }\n    };\n\n    const reset = () => {\n        setSkuInput('');\n        setFoundProduct(null);\n        setQty('');\n        setExpiry('');\n        setMode('SCAN');\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-slate-900 p-6 border-b border-slate-800 flex justify-between items-center\">\n                    <h3 className=\"text-xl font-bold text-white flex items-center gap-2\">\n                        {mode === 'SCAN' ? <Scan className=\"text-cyan-400\" /> : <PackagePlus className=\"text-emerald-400\" />}\n                        {mode === 'SCAN' ? 'Recepción Rápida' : 'Alta de Producto Nuevo'}\n                    </h3>\n                    <button onClick={onClose} className=\"text-slate-400 hover:text-white\"><X /></button>\n                </div>\n\n                <div className=\"p-6\">\n                    {/* Search Bar */}\n                    <div className=\"flex gap-2 mb-6\">\n                        <div className=\"relative flex-1\">\n                            <Scan className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={20} />\n                            <input\n                                type=\"text\"\n                                autoFocus\n                                placeholder=\"Escanear Código de Barras / SKU...\"\n                                className=\"w-full pl-10 pr-4 py-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none font-mono text-lg\"\n                                value={skuInput}\n                                onChange={(e) => setSkuInput(e.target.value)}\n                                onKeyDown={(e) => e.key === 'Enter' && handleScan()}\n                            />\n                        </div>\n                        <button\n                            onClick={handleScan}\n                            className=\"bg-slate-100 text-slate-600 px-4 rounded-xl font-bold hover:bg-slate-200\"\n                        >\n                            <Search />\n                        </button>\n                    </div>\n\n                    {mode === 'SCAN' && foundProduct && (\n                        <div className=\"bg-cyan-50 border border-cyan-100 rounded-2xl p-4 mb-6 flex items-start gap-4\">\n                            <div className=\"w-16 h-16 bg-white rounded-xl flex items-center justify-center text-2xl shadow-sm\">💊</div>\n                            <div>\n                                <h4 className=\"font-bold text-slate-800 text-lg\">{foundProduct.name}</h4>\n                                <p className=\"text-slate-500 text-sm\">{foundProduct.dci}</p>\n                                <div className=\"flex gap-2 mt-2\">\n                                    <span className=\"text-xs font-bold bg-white px-2 py-1 rounded border border-cyan-200 text-cyan-700\">Stock: {foundProduct.stock_actual}</span>\n                                    <span className=\"text-xs font-bold bg-white px-2 py-1 rounded border border-cyan-200 text-cyan-700\">{foundProduct.location_id}</span>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n\n                    {mode === 'SCAN' && foundProduct && (\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1\">Cantidad a Ingresar</label>\n                                <input\n                                    type=\"number\"\n                                    className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none text-xl font-bold\"\n                                    value={qty}\n                                    onChange={(e) => setQty(e.target.value)}\n                                />\n                            </div>\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1\">Vencimiento</label>\n                                <input\n                                    type=\"date\"\n                                    className=\"w-full p-3 border-2 border-slate-200 rounded-xl focus:border-cyan-500 focus:outline-none\"\n                                    value={expiry}\n                                    onChange={(e) => setExpiry(e.target.value)}\n                                />\n                            </div>\n                            <button\n                                onClick={handleQuickEntry}\n                                className=\"col-span-2 py-4 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition shadow-lg shadow-cyan-200 mt-2\"\n                            >\n                                INGRESAR STOCK\n                            </button>\n                        </div>\n                    )}\n\n                    {mode === 'NEW' && (\n                        <div className=\"space-y-4 animate-in fade-in slide-in-from-bottom-4\">\n                            <div className=\"bg-amber-50 p-3 rounded-xl border border-amber-100 flex items-center gap-2 text-amber-700 text-sm mb-4\">\n                                <AlertTriangle size={16} />\n                                Producto no encontrado. Complete la ficha para dar de alta.\n                            </div>\n\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div className=\"col-span-2\">\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Nombre Comercial</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.name || ''}\n                                        onChange={(e) => setNewProduct({ ...newProduct, name: e.target.value })}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Principio Activo (DCI)</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.dci || ''}\n                                        onChange={(e) => setNewProduct({ ...newProduct, dci: e.target.value })}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Laboratorio</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.laboratory || ''}\n                                        onChange={(e) => setNewProduct({ ...newProduct, laboratory: e.target.value })}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Categoría</label>\n                                    <select\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.category}\n                                        onChange={(e) => setNewProduct({ ...newProduct, category: e.target.value as DrugCategory })}\n                                    >\n                                        <option value=\"MEDICAMENTO\">Medicamento</option>\n                                        <option value=\"INSUMO_MEDICO\">Insumo Médico</option>\n                                        <option value=\"COSMETICO\">Cosmético</option>\n                                        <option value=\"SUPLEMENTO\">Suplemento</option>\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Condición Venta</label>\n                                    <select\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.condition}\n                                        onChange={(e) => setNewProduct({ ...newProduct, condition: e.target.value as SaleCondition })}\n                                    >\n                                        <option value=\"VD\">Venta Directa</option>\n                                        <option value=\"R\">Receta Simple</option>\n                                        <option value=\"RR\">Receta Retenida</option>\n                                        <option value=\"RCH\">Receta Cheque</option>\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Precio Venta</label>\n                                    <input\n                                        type=\"number\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.price || ''}\n                                        onChange={(e) => setNewProduct({ ...newProduct, price: parseInt(e.target.value) })}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Ubicación</label>\n                                    <select\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={newProduct.location_id}\n                                        onChange={(e) => setNewProduct({ ...newProduct, location_id: e.target.value as any })}\n                                    >\n                                        <option value=\"BODEGA_CENTRAL\">Bodega Central</option>\n                                        <option value=\"SUCURSAL_CENTRO\">Sucursal Centro</option>\n                                    </select>\n                                </div>\n                            </div>\n\n                            <div className=\"grid grid-cols-2 gap-4 pt-4 border-t border-slate-100\">\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Cantidad Inicial</label>\n                                    <input\n                                        type=\"number\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg font-bold\"\n                                        value={qty}\n                                        onChange={(e) => setQty(e.target.value)}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-1\">Vencimiento</label>\n                                    <input\n                                        type=\"date\"\n                                        className=\"w-full p-2 border border-slate-300 rounded-lg\"\n                                        value={expiry}\n                                        onChange={(e) => setExpiry(e.target.value)}\n                                    />\n                                </div>\n                            </div>\n\n                            <button\n                                onClick={handleNewProductSubmit}\n                                className=\"w-full py-4 bg-emerald-600 text-white font-bold rounded-xl hover:bg-emerald-700 transition shadow-lg shadow-emerald-200\"\n                            >\n                                CREAR PRODUCTO\n                            </button>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default StockEntryModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5460, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/StockTransferModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { ArrowRightLeft, MapPin, Box, Search } from 'lucide-react';\nimport { InventoryBatch } from '../../../domain/types';\n\ninterface StockTransferModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst StockTransferModal: React.FC<StockTransferModalProps> = ({ isOpen, onClose }) => {\n    const { inventory, transferStock } = usePharmaStore();\n    const [searchTerm, setSearchTerm] = useState('');\n    const [selectedProduct, setSelectedProduct] = useState<InventoryBatch | null>(null);\n    const [qty, setQty] = useState('');\n    const [targetLocation, setTargetLocation] = useState('SUCURSAL_CENTRO');\n\n    if (!isOpen) return null;\n\n    const filteredInventory = inventory.filter(i =>\n        i.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        i.sku.includes(searchTerm)\n    );\n\n    const handleTransfer = () => {\n        if (selectedProduct && qty) {\n            transferStock(selectedProduct.id, targetLocation as any, parseInt(qty));\n            onClose();\n            setSearchTerm('');\n            setSelectedProduct(null);\n            setQty('');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200\">\n                <div className=\"bg-slate-900 p-6 border-b border-slate-800 text-white\">\n                    <h3 className=\"text-xl font-bold flex items-center gap-2\">\n                        <ArrowRightLeft className=\"text-purple-400\" /> Transferencia de Stock\n                    </h3>\n                </div>\n\n                <div className=\"p-6 space-y-6\">\n                    {/* 1. Select Product */}\n                    {!selectedProduct ? (\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 mb-2 uppercase\">1. Buscar Producto (Origen)</label>\n                            <div className=\"relative mb-4\">\n                                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={18} />\n                                <input\n                                    type=\"text\"\n                                    autoFocus\n                                    placeholder=\"Nombre o SKU...\"\n                                    className=\"w-full pl-10 pr-4 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none\"\n                                    value={searchTerm}\n                                    onChange={(e) => setSearchTerm(e.target.value)}\n                                />\n                            </div>\n                            <div className=\"h-48 overflow-y-auto border border-slate-100 rounded-xl bg-slate-50 p-2 space-y-2\">\n                                {filteredInventory.map(item => (\n                                    <div\n                                        key={item.id}\n                                        onClick={() => setSelectedProduct(item)}\n                                        className=\"p-3 bg-white rounded-lg border border-slate-200 hover:border-purple-400 cursor-pointer transition flex justify-between items-center\"\n                                    >\n                                        <div>\n                                            <p className=\"font-bold text-sm text-slate-800\">{item.name}</p>\n                                            <p className=\"text-xs text-slate-500\">{item.location_id}</p>\n                                        </div>\n                                        <span className=\"bg-slate-100 text-slate-600 px-2 py-1 rounded text-xs font-bold\">Stock: {item.stock_actual}</span>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    ) : (\n                        <div className=\"bg-purple-50 border border-purple-100 rounded-xl p-4 flex justify-between items-center\">\n                            <div>\n                                <h4 className=\"font-bold text-purple-900\">{selectedProduct.name}</h4>\n                                <p className=\"text-xs text-purple-700\">Origen: {selectedProduct.location_id}</p>\n                            </div>\n                            <button onClick={() => setSelectedProduct(null)} className=\"text-xs font-bold text-purple-500 hover:text-purple-700\">CAMBIAR</button>\n                        </div>\n                    )}\n\n                    {/* 2. Transfer Details */}\n                    {selectedProduct && (\n                        <div className=\"grid grid-cols-2 gap-4 animate-in fade-in slide-in-from-bottom-2\">\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Destino</label>\n                                <div className=\"relative\">\n                                    <MapPin className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n                                    <select\n                                        className=\"w-full pl-9 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none appearance-none bg-white\"\n                                        value={targetLocation}\n                                        onChange={(e) => setTargetLocation(e.target.value)}\n                                    >\n                                        <option value=\"SUCURSAL_CENTRO\">Sucursal Centro</option>\n                                        <option value=\"SUCURSAL_NORTE\">Sucursal Norte</option>\n                                        <option value=\"BODEGA_CENTRAL\">Bodega Central</option>\n                                        <option value=\"KIOSCO\">Kiosco</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div>\n                                <label className=\"block text-xs font-bold text-slate-500 mb-1 uppercase\">Cantidad</label>\n                                <div className=\"relative\">\n                                    <Box className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n                                    <input\n                                        type=\"number\"\n                                        className=\"w-full pl-9 pr-3 py-3 border-2 border-slate-200 rounded-xl focus:border-purple-500 focus:outline-none\"\n                                        max={selectedProduct.stock_actual}\n                                        value={qty}\n                                        onChange={(e) => setQty(e.target.value)}\n                                    />\n                                </div>\n                                <p className=\"text-[10px] text-right text-slate-400 mt-1\">Máx: {selectedProduct.stock_actual}</p>\n                            </div>\n                        </div>\n                    )}\n\n                    <div className=\"flex gap-3 pt-4\">\n                        <button onClick={onClose} className=\"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 rounded-xl transition\">Cancelar</button>\n                        <button\n                            onClick={handleTransfer}\n                            disabled={!selectedProduct || !qty || parseInt(qty) > (selectedProduct?.stock_actual || 0)}\n                            className=\"flex-1 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition shadow-lg shadow-purple-200 disabled:opacity-50\"\n                        >\n                            Transferir\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default StockTransferModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5869, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/inventory/InventoryEditModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { X, Save, Thermometer, AlertTriangle, Tag, Package, DollarSign, Activity } from 'lucide-react';\nimport { InventoryBatch } from '../../../domain/types';\nimport { usePharmaStore } from '../../store/useStore';\n\ninterface InventoryEditModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    product: InventoryBatch | null;\n}\n\nconst InventoryEditModal: React.FC<InventoryEditModalProps> = ({ isOpen, onClose, product }) => {\n    const { updateProduct } = usePharmaStore();\n    const [formData, setFormData] = useState<Partial<InventoryBatch>>({});\n    const [newTag, setNewTag] = useState('');\n\n    useEffect(() => {\n        if (product) {\n            setFormData({ ...product });\n        }\n    }, [product]);\n\n    if (!isOpen || !product) return null;\n\n    const handleSave = () => {\n        if (product.id) {\n            updateProduct(product.id, formData);\n            onClose();\n        }\n    };\n\n    const handleAddTag = (e: React.KeyboardEvent) => {\n        if (e.key === 'Enter' && newTag.trim()) {\n            e.preventDefault();\n            const currentTags = formData.therapeutic_tags || [];\n            if (!currentTags.includes(newTag.trim().toUpperCase())) {\n                setFormData({\n                    ...formData,\n                    therapeutic_tags: [...currentTags, newTag.trim().toUpperCase()]\n                });\n            }\n            setNewTag('');\n        }\n    };\n\n    const removeTag = (tagToRemove: string) => {\n        setFormData({\n            ...formData,\n            therapeutic_tags: (formData.therapeutic_tags || []).filter(tag => tag !== tagToRemove)\n        });\n    };\n\n    const toggleContraindication = (ci: string) => {\n        const current = formData.contraindications || [];\n        if (current.includes(ci)) {\n            setFormData({ ...formData, contraindications: current.filter(c => c !== ci) });\n        } else {\n            setFormData({ ...formData, contraindications: [...current, ci] });\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-4xl h-[90vh] flex flex-col animate-in fade-in zoom-in duration-200\">\n                {/* Header */}\n                <div className=\"p-6 border-b border-slate-100 flex justify-between items-center\">\n                    <div>\n                        <h2 className=\"text-2xl font-bold text-slate-800 flex items-center gap-2\">\n                            <Package className=\"text-cyan-600\" />\n                            Editar Producto\n                        </h2>\n                        <p className=\"text-slate-500 text-sm\">{product.name} ({product.sku})</p>\n                    </div>\n                    <button onClick={onClose} className=\"p-2 hover:bg-slate-100 rounded-full transition-colors\">\n                        <X size={24} className=\"text-slate-400\" />\n                    </button>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-y-auto p-8\">\n                    <div className=\"grid grid-cols-12 gap-8\">\n\n                        {/* Left Column: Commercial & Logistics */}\n                        <div className=\"col-span-7 space-y-8\">\n\n                            {/* Commercial Data */}\n                            <section>\n                                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <DollarSign size={16} /> Datos Comerciales\n                                </h3>\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div className=\"col-span-2\">\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Nombre Comercial</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-bold text-slate-700 focus:border-cyan-500 focus:outline-none\"\n                                            value={formData.name || ''}\n                                            onChange={e => setFormData({ ...formData, name: e.target.value })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Precio Venta</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                            value={formData.price || 0}\n                                            onChange={e => setFormData({ ...formData, price: Number(e.target.value) })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Costo Neto</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                            value={formData.cost_price || 0}\n                                            onChange={e => setFormData({ ...formData, cost_price: Number(e.target.value) })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Stock Mínimo</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl font-mono\"\n                                            value={formData.stock_min || 0}\n                                            onChange={e => setFormData({ ...formData, stock_min: Number(e.target.value) })}\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Condición Venta</label>\n                                        <select\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl text-sm font-bold\"\n                                            value={formData.condition}\n                                            onChange={e => setFormData({ ...formData, condition: e.target.value as any })}\n                                        >\n                                            <option value=\"VD\">Venta Directa</option>\n                                            <option value=\"R\">Receta Simple (R)</option>\n                                            <option value=\"RR\">Receta Retenida (RR)</option>\n                                            <option value=\"RCH\">Receta Cheque (RCH)</option>\n                                        </select>\n                                    </div>\n                                </div>\n                            </section>\n\n                            {/* Logistics */}\n                            <section>\n                                <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                    <Package size={16} /> Logística\n                                </h3>\n                                <div className=\"bg-slate-50 p-4 rounded-2xl border border-slate-100 space-y-4\">\n                                    <div>\n                                        <label className=\"block text-xs font-bold text-slate-500 mb-1\">Ubicación Física (Estante/Pasillo)</label>\n                                        <input\n                                            type=\"text\"\n                                            className=\"w-full p-3 border border-slate-200 rounded-xl text-sm\"\n                                            value={formData.aisle || ''}\n                                            onChange={e => setFormData({ ...formData, aisle: e.target.value })}\n                                            placeholder=\"Ej: ESTANTE A-2\"\n                                        />\n                                    </div>\n\n                                    <div className=\"flex items-center justify-between p-3 bg-white rounded-xl border border-slate-200\">\n                                        <div className=\"flex items-center gap-3\">\n                                            <div className={`p-2 rounded-lg ${formData.storage_condition === 'REFRIGERADO' ? 'bg-cyan-100 text-cyan-600' : 'bg-slate-100 text-slate-400'}`}>\n                                                <Thermometer size={20} />\n                                            </div>\n                                            <div>\n                                                <p className=\"font-bold text-sm text-slate-700\">Cadena de Frío</p>\n                                                <p className=\"text-xs text-slate-400\">Requiere refrigeración (2°C - 8°C)</p>\n                                            </div>\n                                        </div>\n                                        <label className=\"relative inline-flex items-center cursor-pointer\">\n                                            <input\n                                                type=\"checkbox\"\n                                                className=\"sr-only peer\"\n                                                checked={formData.storage_condition === 'REFRIGERADO'}\n                                                onChange={e => setFormData({ ...formData, storage_condition: e.target.checked ? 'REFRIGERADO' : 'AMBIENTE' })}\n                                            />\n                                            <div className=\"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-cyan-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600\"></div>\n                                        </label>\n                                    </div>\n                                </div>\n                            </section>\n                        </div>\n\n                        {/* Right Column: Clinical Intelligence */}\n                        <div className=\"col-span-5 bg-slate-50 rounded-3xl p-6 border border-slate-200 h-full\">\n                            <h3 className=\"text-sm font-bold text-cyan-700 uppercase tracking-wider mb-6 flex items-center gap-2\">\n                                <Activity size={16} /> Inteligencia Clínica\n                            </h3>\n\n                            <div className=\"space-y-6\">\n                                {/* Therapeutic Tags */}\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-2 flex items-center gap-2\">\n                                        <Tag size={14} /> Tags Terapéuticos (Síntomas)\n                                    </label>\n                                    <div className=\"bg-white p-3 rounded-xl border border-slate-200 min-h-[100px]\">\n                                        <div className=\"flex flex-wrap gap-2 mb-2\">\n                                            {formData.therapeutic_tags?.map(tag => (\n                                                <span key={tag} className=\"px-2 py-1 bg-cyan-100 text-cyan-700 text-xs font-bold rounded-lg flex items-center gap-1\">\n                                                    {tag}\n                                                    <button onClick={() => removeTag(tag)} className=\"hover:text-cyan-900\"><X size={12} /></button>\n                                                </span>\n                                            ))}\n                                        </div>\n                                        <input\n                                            type=\"text\"\n                                            placeholder=\"Escribe y presiona Enter...\"\n                                            className=\"w-full text-sm outline-none bg-transparent placeholder:text-slate-400\"\n                                            value={newTag}\n                                            onChange={e => setNewTag(e.target.value)}\n                                            onKeyDown={handleAddTag}\n                                        />\n                                    </div>\n                                    <p className=\"text-[10px] text-slate-400 mt-1\">Estos tags permiten que la IA recomiende este producto.</p>\n                                </div>\n\n                                {/* Contraindications */}\n                                <div>\n                                    <label className=\"block text-xs font-bold text-slate-500 mb-2 flex items-center gap-2\">\n                                        <AlertTriangle size={14} /> Contraindicaciones\n                                    </label>\n                                    <div className=\"space-y-2\">\n                                        {['EMBARAZO', 'HIPERTENSION', 'DIABETES', 'ULCERA', 'LACTANCIA'].map(ci => (\n                                            <label key={ci} className=\"flex items-center gap-2 p-2 bg-white rounded-lg border border-slate-200 cursor-pointer hover:bg-slate-50 transition-colors\">\n                                                <input\n                                                    type=\"checkbox\"\n                                                    className=\"rounded text-red-500 focus:ring-red-500\"\n                                                    checked={formData.contraindications?.includes(ci)}\n                                                    onChange={() => toggleContraindication(ci)}\n                                                />\n                                                <span className=\"text-xs font-bold text-slate-600\">{ci}</span>\n                                            </label>\n                                        ))}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Footer */}\n                <div className=\"p-6 border-t border-slate-100 flex justify-end gap-3 bg-slate-50/50 rounded-b-3xl\">\n                    <button\n                        onClick={onClose}\n                        className=\"px-6 py-3 font-bold text-slate-500 hover:bg-slate-100 rounded-xl transition-colors\"\n                    >\n                        Cancelar\n                    </button>\n                    <button\n                        onClick={handleSave}\n                        className=\"px-6 py-3 bg-cyan-600 text-white font-bold rounded-xl hover:bg-cyan-700 transition-colors shadow-lg shadow-cyan-200 flex items-center gap-2\"\n                    >\n                        <Save size={18} />\n                        Guardar Cambios\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default InventoryEditModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6656, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/bi/TimeFilter.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { Calendar, ChevronDown } from 'lucide-react';\n\nexport interface DateRange {\n    from: Date;\n    to: Date;\n}\n\ninterface TimeFilterProps {\n    onFilterChange: (range: DateRange) => void;\n    initialRange?: DateRange;\n}\n\nconst TimeFilter: React.FC<TimeFilterProps> = ({ onFilterChange, initialRange }) => {\n    const [fromDate, setFromDate] = useState<string>(\n        initialRange?.from.toISOString().split('T')[0] ||\n        new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n    );\n    const [toDate, setToDate] = useState<string>(\n        initialRange?.to.toISOString().split('T')[0] ||\n        new Date().toISOString().split('T')[0]\n    );\n    const [showPresets, setShowPresets] = useState(false);\n\n    const presets = [\n        { label: 'Últimos 7 días', days: 7 },\n        { label: 'Últimos 30 días', days: 30 },\n        { label: 'Este mes', days: 'current_month' as const },\n        { label: 'Mes anterior', days: 'last_month' as const },\n        { label: 'Este trimestre', days: 'current_quarter' as const },\n        { label: 'Este año', days: 'current_year' as const },\n    ];\n\n    const applyPreset = (preset: typeof presets[0]) => {\n        const today = new Date();\n        let from: Date;\n        let to: Date = today;\n\n        if (typeof preset.days === 'number') {\n            from = new Date(today.getTime() - preset.days * 24 * 60 * 60 * 1000);\n        } else {\n            switch (preset.days) {\n                case 'current_month':\n                    from = new Date(today.getFullYear(), today.getMonth(), 1);\n                    break;\n                case 'last_month':\n                    from = new Date(today.getFullYear(), today.getMonth() - 1, 1);\n                    to = new Date(today.getFullYear(), today.getMonth(), 0);\n                    break;\n                case 'current_quarter':\n                    const quarter = Math.floor(today.getMonth() / 3);\n                    from = new Date(today.getFullYear(), quarter * 3, 1);\n                    break;\n                case 'current_year':\n                    from = new Date(today.getFullYear(), 0, 1);\n                    break;\n                default:\n                    from = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);\n            }\n        }\n\n        setFromDate(from.toISOString().split('T')[0]);\n        setToDate(to.toISOString().split('T')[0]);\n        setShowPresets(false);\n    };\n\n    const handleApply = () => {\n        onFilterChange({\n            from: new Date(fromDate),\n            to: new Date(toDate + 'T23:59:59')\n        });\n    };\n\n    return (\n        <div className=\"bg-white rounded-xl shadow-sm border border-gray-200 p-4\">\n            <div className=\"flex flex-wrap items-end gap-4\">\n                {/* Date Range */}\n                <div className=\"flex-1 min-w-[200px]\">\n                    <label className=\"block text-sm font-bold text-gray-700 mb-2\">\n                        Desde\n                    </label>\n                    <div className=\"relative\">\n                        <Calendar className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                        <input\n                            type=\"date\"\n                            value={fromDate}\n                            onChange={(e) => setFromDate(e.target.value)}\n                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        />\n                    </div>\n                </div>\n\n                <div className=\"flex-1 min-w-[200px]\">\n                    <label className=\"block text-sm font-bold text-gray-700 mb-2\">\n                        Hasta\n                    </label>\n                    <div className=\"relative\">\n                        <Calendar className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                        <input\n                            type=\"date\"\n                            value={toDate}\n                            onChange={(e) => setToDate(e.target.value)}\n                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        />\n                    </div>\n                </div>\n\n                {/* Presets Dropdown */}\n                <div className=\"relative\">\n                    <button\n                        onClick={() => setShowPresets(!showPresets)}\n                        className=\"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center gap-2 font-medium text-sm border border-gray-300\"\n                    >\n                        Presets\n                        <ChevronDown className=\"w-4 h-4\" />\n                    </button>\n                    {showPresets && (\n                        <div className=\"absolute top-full mt-2 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-[180px]\">\n                            {presets.map((preset, idx) => (\n                                <button\n                                    key={idx}\n                                    onClick={() => applyPreset(preset)}\n                                    className=\"w-full text-left px-4 py-2 hover:bg-gray-50 text-sm text-gray-700 first:rounded-t-lg last:rounded-b-lg\"\n                                >\n                                    {preset.label}\n                                </button>\n                            ))}\n                        </div>\n                    )}\n                </div>\n\n                {/* Apply Button */}\n                <button\n                    onClick={handleApply}\n                    className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold text-sm shadow-lg shadow-blue-200\"\n                >\n                    Aplicar Filtros\n                </button>\n            </div>\n        </div>\n    );\n};\n\nexport default TimeFilter;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6902, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/warehouse/ShipmentReceptionModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { X, Camera, FileText, CheckCircle, AlertTriangle, Package } from 'lucide-react';\nimport { Shipment } from '../../../domain/types';\nimport { usePharmaStore } from '../../store/useStore';\nimport { toast } from 'sonner';\n\ninterface ShipmentReceptionModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    shipment: Shipment;\n}\n\nconst ShipmentReceptionModal: React.FC<ShipmentReceptionModalProps> = ({ isOpen, onClose, shipment }) => {\n    const { confirmReception, uploadLogisticsDocument } = usePharmaStore();\n    const [receivedItems, setReceivedItems] = useState(\n        shipment.items.map(item => ({ ...item, receivedQty: item.quantity, condition: 'GOOD' as 'GOOD' | 'DAMAGED' }))\n    );\n    const [notes, setNotes] = useState('');\n    const [photos, setPhotos] = useState<string[]>([]);\n\n    if (!isOpen) return null;\n\n    const handleConfirm = () => {\n        confirmReception(shipment.id, {\n            photos,\n            notes,\n            receivedItems: receivedItems.map(i => ({\n                batchId: i.batchId,\n                quantity: i.receivedQty,\n                condition: i.condition\n            }))\n        });\n        toast.success('Recepción confirmada exitosamente');\n        onClose();\n    };\n\n    const handlePhotoUpload = () => {\n        // Mock upload\n        const mockUrl = `https://fake-url.com/photo-${Date.now()}.jpg`;\n        setPhotos([...photos, mockUrl]);\n        uploadLogisticsDocument(shipment.id, 'PHOTO', mockUrl);\n        toast.success('Foto subida (simulado)');\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col\">\n                <div className=\"p-6 border-b border-slate-100 flex justify-between items-center\">\n                    <div>\n                        <h2 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\n                            <CheckCircle className=\"text-emerald-500\" />\n                            Recepción de Carga\n                        </h2>\n                        <p className=\"text-sm text-slate-500\">OT: {shipment.transport_data.tracking_number} | Origen: {shipment.origin_location_id}</p>\n                    </div>\n                    <button onClick={onClose}><X className=\"text-slate-400\" /></button>\n                </div>\n\n                <div className=\"flex-1 overflow-y-auto p-6\">\n                    {/* Items Table */}\n                    <table className=\"w-full mb-6\">\n                        <thead className=\"bg-slate-50 text-xs text-slate-500 font-bold uppercase\">\n                            <tr>\n                                <th className=\"px-4 py-3 text-left\">Producto</th>\n                                <th className=\"px-4 py-3 text-center\">Enviado</th>\n                                <th className=\"px-4 py-3 text-center\">Recibido</th>\n                                <th className=\"px-4 py-3 text-center\">Estado</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-slate-100\">\n                            {receivedItems.map((item, idx) => (\n                                <tr key={idx}>\n                                    <td className=\"px-4 py-3\">\n                                        <p className=\"font-bold text-slate-700\">{item.name}</p>\n                                        <p className=\"text-xs text-slate-400\">{item.sku}</p>\n                                    </td>\n                                    <td className=\"px-4 py-3 text-center font-mono\">{item.quantity}</td>\n                                    <td className=\"px-4 py-3 text-center\">\n                                        <input\n                                            type=\"number\"\n                                            className=\"w-16 p-1 border rounded text-center font-bold\"\n                                            value={item.receivedQty}\n                                            onChange={(e) => {\n                                                const newItems = [...receivedItems];\n                                                newItems[idx].receivedQty = Number(e.target.value);\n                                                setReceivedItems(newItems);\n                                            }}\n                                        />\n                                    </td>\n                                    <td className=\"px-4 py-3 text-center\">\n                                        <select\n                                            className={`p-1 rounded text-xs font-bold ${item.condition === 'GOOD' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}`}\n                                            value={item.condition}\n                                            onChange={(e) => {\n                                                const newItems = [...receivedItems];\n                                                newItems[idx].condition = e.target.value as 'GOOD' | 'DAMAGED';\n                                                setReceivedItems(newItems);\n                                            }}\n                                        >\n                                            <option value=\"GOOD\">CONFORME</option>\n                                            <option value=\"DAMAGED\">DAÑADO</option>\n                                        </select>\n                                    </td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n\n                    {/* Evidence & Notes */}\n                    <div className=\"grid grid-cols-2 gap-6\">\n                        <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-2\">Observaciones</label>\n                            <textarea\n                                className=\"w-full p-3 border border-slate-200 rounded-xl h-32 resize-none\"\n                                placeholder=\"Ej: Caja 2 llegó mojada...\"\n                                value={notes}\n                                onChange={(e) => setNotes(e.target.value)}\n                            />\n                        </div>\n                        <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-2\">Evidencia Fotográfica</label>\n                            <div className=\"grid grid-cols-3 gap-2 mb-2\">\n                                {photos.map((url, i) => (\n                                    <div key={i} className=\"aspect-square bg-slate-100 rounded-lg overflow-hidden relative\">\n                                        <img src={url} alt=\"Evidence\" className=\"w-full h-full object-cover\" />\n                                    </div>\n                                ))}\n                                <button\n                                    onClick={handlePhotoUpload}\n                                    className=\"aspect-square border-2 border-dashed border-slate-300 rounded-lg flex flex-col items-center justify-center text-slate-400 hover:border-cyan-500 hover:text-cyan-500 transition-colors\"\n                                >\n                                    <Camera size={24} />\n                                    <span className=\"text-xs font-bold mt-1\">Subir</span>\n                                </button>\n                            </div>\n                            <button className=\"w-full py-2 bg-slate-100 text-slate-600 font-bold rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-slate-200\">\n                                <FileText size={16} /> Escanear Factura/Guía\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"p-6 border-t border-slate-100 flex justify-end gap-3\">\n                    <button onClick={onClose} className=\"px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-50\">Cancelar</button>\n                    <button\n                        onClick={handleConfirm}\n                        className=\"px-6 py-3 rounded-xl font-bold bg-emerald-600 text-white hover:bg-emerald-700 shadow-lg shadow-emerald-200 flex items-center gap-2\"\n                    >\n                        <CheckCircle size={20} />\n                        Confirmar Recepción\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default ShipmentReceptionModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7380, "column": 0}, "map": {"version":3,"sources":["file:///Users/miguelperdomoserrato/farmacias-vallenar-suit/src/presentation/components/warehouse/ShipmentDispatchModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { X, Truck, Package, ArrowRight, Search } from 'lucide-react';\nimport { usePharmaStore } from '../../store/useStore';\nimport { toast } from 'sonner';\nimport { InventoryBatch } from '../../../domain/types';\n\ninterface ShipmentDispatchModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n}\n\nconst ShipmentDispatchModal: React.FC<ShipmentDispatchModalProps> = ({ isOpen, onClose }) => {\n    const { inventory, createDispatch } = usePharmaStore();\n    const [step, setStep] = useState(1);\n    const [destination, setDestination] = useState('');\n    const [selectedItems, setSelectedItems] = useState<{ batch: InventoryBatch, quantity: number }[]>([]);\n    const [searchTerm, setSearchTerm] = useState('');\n    const [transportData, setTransportData] = useState({\n        carrier: '',\n        trackingNumber: '',\n        packageCount: 1,\n        driverName: ''\n    });\n\n    if (!isOpen) return null;\n\n    const filteredInventory = inventory.filter(item =>\n        item.stock_actual > 0 &&\n        (item.name.toLowerCase().includes(searchTerm.toLowerCase()) || item.sku.includes(searchTerm))\n    );\n\n    const handleAddItem = (batch: InventoryBatch) => {\n        const existing = selectedItems.find(i => i.batch.id === batch.id);\n        if (existing) return;\n        setSelectedItems([...selectedItems, { batch, quantity: 1 }]);\n    };\n\n    const handleUpdateQuantity = (batchId: string, qty: number) => {\n        const newItems = selectedItems.map(i =>\n            i.batch.id === batchId ? { ...i, quantity: Math.min(i.batch.stock_actual, Math.max(1, qty)) } : i\n        );\n        setSelectedItems(newItems);\n    };\n\n    const handleRemoveItem = (batchId: string) => {\n        setSelectedItems(selectedItems.filter(i => i.batch.id !== batchId));\n    };\n\n    const handleSubmit = () => {\n        if (!destination || selectedItems.length === 0 || !transportData.carrier) {\n            toast.error('Complete todos los campos requeridos');\n            return;\n        }\n\n        createDispatch({\n            type: 'INTERNAL_TRANSFER',\n            origin_location_id: 'SUCURSAL_CENTRO', // Should be dynamic based on user location\n            destination_location_id: destination,\n            transport_data: {\n                carrier: transportData.carrier,\n                tracking_number: transportData.trackingNumber,\n                package_count: transportData.packageCount,\n                driver_name: transportData.driverName\n            },\n            items: selectedItems.map(i => ({\n                batchId: i.batch.id,\n                sku: i.batch.sku,\n                name: i.batch.name,\n                quantity: i.quantity,\n                condition: 'GOOD'\n            })),\n            documentation: { evidence_photos: [] },\n            valuation: selectedItems.reduce((sum, i) => sum + (i.batch.cost_price * i.quantity), 0)\n        });\n\n        toast.success('Despacho creado exitosamente');\n        onClose();\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col\">\n                <div className=\"p-6 border-b border-slate-100 flex justify-between items-center\">\n                    <h2 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\n                        <Truck className=\"text-blue-600\" />\n                        Nuevo Despacho Inter-Sucursal\n                    </h2>\n                    <button onClick={onClose}><X className=\"text-slate-400\" /></button>\n                </div>\n\n                <div className=\"flex-1 overflow-y-auto p-6\">\n                    {/* Stepper */}\n                    <div className=\"flex items-center justify-center mb-8\">\n                        <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${step >= 1 ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-400'}`}>1</div>\n                        <div className=\"w-12 h-1 bg-slate-100 mx-2\"></div>\n                        <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${step >= 2 ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-400'}`}>2</div>\n                        <div className=\"w-12 h-1 bg-slate-100 mx-2\"></div>\n                        <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${step >= 3 ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-400'}`}>3</div>\n                    </div>\n\n                    {step === 1 && (\n                        <div className=\"space-y-6 animate-in fade-in slide-in-from-right-4\">\n                            <h3 className=\"font-bold text-lg\">Seleccionar Destino</h3>\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                {['SUCURSAL_NORTE', 'SUCURSAL_SUR', 'BODEGA_CENTRAL'].map(loc => (\n                                    <button\n                                        key={loc}\n                                        onClick={() => setDestination(loc)}\n                                        className={`p-6 rounded-xl border-2 text-left transition-all ${destination === loc ? 'border-blue-500 bg-blue-50' : 'border-slate-100 hover:border-slate-300'}`}\n                                    >\n                                        <p className=\"font-bold text-slate-800\">{loc}</p>\n                                        <p className=\"text-sm text-slate-500\">Sucursal Operativa</p>\n                                    </button>\n                                ))}\n                            </div>\n                        </div>\n                    )}\n\n                    {step === 2 && (\n                        <div className=\"space-y-6 animate-in fade-in slide-in-from-right-4 h-full flex flex-col\">\n                            <h3 className=\"font-bold text-lg\">Selección de Productos (Picking)</h3>\n\n                            <div className=\"flex gap-4 mb-4\">\n                                <div className=\"relative flex-1\">\n                                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={20} />\n                                    <input\n                                        type=\"text\"\n                                        placeholder=\"Buscar productos...\"\n                                        className=\"w-full pl-10 p-3 border border-slate-200 rounded-xl\"\n                                        value={searchTerm}\n                                        onChange={(e) => setSearchTerm(e.target.value)}\n                                    />\n                                </div>\n                            </div>\n\n                            <div className=\"grid grid-cols-2 gap-6 flex-1 min-h-0\">\n                                {/* Inventory List */}\n                                <div className=\"border border-slate-200 rounded-xl overflow-y-auto max-h-[400px]\">\n                                    {filteredInventory.map(item => (\n                                        <div key={item.id} className=\"p-3 border-b border-slate-100 hover:bg-slate-50 flex justify-between items-center\">\n                                            <div>\n                                                <p className=\"font-bold text-sm\">{item.name}</p>\n                                                <p className=\"text-xs text-slate-500\">SKU: {item.sku} | Stock: {item.stock_actual}</p>\n                                            </div>\n                                            <button\n                                                onClick={() => handleAddItem(item)}\n                                                className=\"px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold hover:bg-blue-200\"\n                                            >\n                                                Agregar\n                                            </button>\n                                        </div>\n                                    ))}\n                                </div>\n\n                                {/* Selected Items */}\n                                <div className=\"border border-slate-200 rounded-xl overflow-y-auto max-h-[400px] bg-slate-50 p-4\">\n                                    <h4 className=\"font-bold text-slate-700 mb-3\">Items Seleccionados ({selectedItems.length})</h4>\n                                    {selectedItems.length === 0 ? (\n                                        <p className=\"text-slate-400 text-sm text-center py-8\">No hay items seleccionados</p>\n                                    ) : (\n                                        selectedItems.map((item, idx) => (\n                                            <div key={idx} className=\"bg-white p-3 rounded-lg shadow-sm mb-2\">\n                                                <div className=\"flex justify-between mb-2\">\n                                                    <span className=\"font-bold text-sm truncate\">{item.batch.name}</span>\n                                                    <button onClick={() => handleRemoveItem(item.batch.id)}><X size={14} className=\"text-red-400\" /></button>\n                                                </div>\n                                                <div className=\"flex items-center justify-between\">\n                                                    <span className=\"text-xs text-slate-500\">Cant:</span>\n                                                    <input\n                                                        type=\"number\"\n                                                        className=\"w-20 p-1 border rounded text-center font-bold text-sm\"\n                                                        value={item.quantity}\n                                                        onChange={(e) => handleUpdateQuantity(item.batch.id, Number(e.target.value))}\n                                                    />\n                                                </div>\n                                            </div>\n                                        ))\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n                    )}\n\n                    {step === 3 && (\n                        <div className=\"space-y-6 animate-in fade-in slide-in-from-right-4\">\n                            <h3 className=\"font-bold text-lg\">Datos de Transporte</h3>\n                            <div className=\"grid grid-cols-2 gap-4\">\n                                <div>\n                                    <label className=\"block text-sm font-bold text-slate-700 mb-1\">Empresa de Transporte</label>\n                                    <select\n                                        className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                        value={transportData.carrier}\n                                        onChange={(e) => setTransportData({ ...transportData, carrier: e.target.value })}\n                                    >\n                                        <option value=\"\">Seleccionar...</option>\n                                        <option value=\"STARKEN\">Starken</option>\n                                        <option value=\"CHILEXPRESS\">Chilexpress</option>\n                                        <option value=\"BLUE_EXPRESS\">Blue Express</option>\n                                        <option value=\"FLOTA_PROPIA\">Flota Propia</option>\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-bold text-slate-700 mb-1\">Nº Orden Transporte (OT)</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                        placeholder=\"Ej: 123456789\"\n                                        value={transportData.trackingNumber}\n                                        onChange={(e) => setTransportData({ ...transportData, trackingNumber: e.target.value })}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-bold text-slate-700 mb-1\">Cantidad de Bultos</label>\n                                    <input\n                                        type=\"number\"\n                                        className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                        value={transportData.packageCount}\n                                        onChange={(e) => setTransportData({ ...transportData, packageCount: Number(e.target.value) })}\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-bold text-slate-700 mb-1\">Nombre Chofer (Opcional)</label>\n                                    <input\n                                        type=\"text\"\n                                        className=\"w-full p-3 border border-slate-200 rounded-xl\"\n                                        placeholder=\"Juan Pérez\"\n                                        value={transportData.driverName}\n                                        onChange={(e) => setTransportData({ ...transportData, driverName: e.target.value })}\n                                    />\n                                </div>\n                            </div>\n                        </div>\n                    )}\n                </div>\n\n                <div className=\"p-6 border-t border-slate-100 flex justify-between\">\n                    {step > 1 ? (\n                        <button onClick={() => setStep(step - 1)} className=\"px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-50\">Atrás</button>\n                    ) : (\n                        <div></div>\n                    )}\n\n                    {step < 3 ? (\n                        <button\n                            onClick={() => {\n                                if (step === 1 && !destination) return toast.error('Seleccione un destino');\n                                if (step === 2 && selectedItems.length === 0) return toast.error('Seleccione al menos un producto');\n                                setStep(step + 1);\n                            }}\n                            className=\"px-6 py-3 rounded-xl font-bold bg-blue-600 text-white hover:bg-blue-700 flex items-center gap-2\"\n                        >\n                            Siguiente <ArrowRight size={20} />\n                        </button>\n                    ) : (\n                        <button\n                            onClick={handleSubmit}\n                            className=\"px-6 py-3 rounded-xl font-bold bg-emerald-600 text-white hover:bg-emerald-700 shadow-lg shadow-emerald-200 flex items-center gap-2\"\n                        >\n                            <Package size={20} />\n                            Generar Despacho\n                        </button>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default ShipmentDispatchModal;\n"],"names":[],"mappings":"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"}}]
}